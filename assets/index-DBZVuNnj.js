function d5(){import.meta.url,import("_").catch(()=>1),async function*(){}().next()}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function t(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(s){if(s.ep)return;s.ep=!0;const r=t(s);fetch(s.href,r)}})();/**
* @vue/shared v3.5.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**//*! #__NO_SIDE_EFFECTS__ */function FA(i){const e=Object.create(null);for(const t of i.split(","))e[t]=1;return t=>t in e}const sn={},Ja=[],Vs=()=>{},uS=()=>!1,Id=i=>i.charCodeAt(0)===111&&i.charCodeAt(1)===110&&(i.charCodeAt(2)>122||i.charCodeAt(2)<97),NA=i=>i.startsWith("onUpdate:"),bi=Object.assign,kA=(i,e)=>{const t=i.indexOf(e);t>-1&&i.splice(t,1)},dS=Object.prototype.hasOwnProperty,qt=(i,e)=>dS.call(i,e),xt=Array.isArray,Za=i=>mh(i)==="[object Map]",Md=i=>mh(i)==="[object Set]",Ev=i=>mh(i)==="[object Date]",Mt=i=>typeof i=="function",kn=i=>typeof i=="string",Gs=i=>typeof i=="symbol",un=i=>i!==null&&typeof i=="object",Jy=i=>(un(i)||Mt(i))&&Mt(i.then)&&Mt(i.catch),Zy=Object.prototype.toString,mh=i=>Zy.call(i),fS=i=>mh(i).slice(8,-1),ex=i=>mh(i)==="[object Object]",OA=i=>kn(i)&&i!=="NaN"&&i[0]!=="-"&&""+parseInt(i,10)===i,fc=FA(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),Td=i=>{const e=Object.create(null);return t=>e[t]||(e[t]=i(t))},pS=/-(\w)/g,ao=Td(i=>i.replace(pS,(e,t)=>t?t.toUpperCase():"")),mS=/\B([A-Z])/g,ha=Td(i=>i.replace(mS,"-$1").toLowerCase()),tx=Td(i=>i.charAt(0).toUpperCase()+i.slice(1)),gf=Td(i=>i?"on".concat(tx(i)):""),Zr=(i,e)=>!Object.is(i,e),Ru=(i,...e)=>{for(let t=0;t<i.length;t++)i[t](...e)},nx=(i,e,t,n=!1)=>{Object.defineProperty(i,e,{configurable:!0,enumerable:!1,writable:n,value:t})},im=i=>{const e=parseFloat(i);return isNaN(e)?i:e};let Cv;const Bd=()=>Cv||(Cv=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});function UA(i){if(xt(i)){const e={};for(let t=0;t<i.length;t++){const n=i[t],s=kn(n)?_S(n):UA(n);if(s)for(const r in s)e[r]=s[r]}return e}else if(kn(i)||un(i))return i}const AS=/;(?![^(]*\))/g,gS=/:([^]+)/,vS=/\/\*[^]*?\*\//g;function _S(i){const e={};return i.replace(vS,"").split(AS).forEach(t=>{if(t){const n=t.split(gS);n.length>1&&(e[n[0].trim()]=n[1].trim())}}),e}function QA(i){let e="";if(kn(i))e=i;else if(xt(i))for(let t=0;t<i.length;t++){const n=QA(i[t]);n&&(e+=n+" ")}else if(un(i))for(const t in i)i[t]&&(e+=t+" ");return e.trim()}const yS="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",xS=FA(yS);function ix(i){return!!i||i===""}function wS(i,e){if(i.length!==e.length)return!1;let t=!0;for(let n=0;t&&n<i.length;n++)t=Rd(i[n],e[n]);return t}function Rd(i,e){if(i===e)return!0;let t=Ev(i),n=Ev(e);if(t||n)return t&&n?i.getTime()===e.getTime():!1;if(t=Gs(i),n=Gs(e),t||n)return i===e;if(t=xt(i),n=xt(e),t||n)return t&&n?wS(i,e):!1;if(t=un(i),n=un(e),t||n){if(!t||!n)return!1;const s=Object.keys(i).length,r=Object.keys(e).length;if(s!==r)return!1;for(const o in i){const a=i.hasOwnProperty(o),l=e.hasOwnProperty(o);if(a&&!l||!a&&l||!Rd(i[o],e[o]))return!1}}return String(i)===String(e)}function sx(i,e){return i.findIndex(t=>Rd(t,e))}const rx=i=>!!(i&&i.__v_isRef===!0),$t=i=>kn(i)?i:i==null?"":xt(i)||un(i)&&(i.toString===Zy||!Mt(i.toString))?rx(i)?$t(i.value):JSON.stringify(i,ox,2):String(i),ox=(i,e)=>rx(e)?ox(i,e.value):Za(e)?{["Map(".concat(e.size,")")]:[...e.entries()].reduce((t,[n,s],r)=>(t[vf(n,r)+" =>"]=s,t),{})}:Md(e)?{["Set(".concat(e.size,")")]:[...e.values()].map(t=>vf(t))}:Gs(e)?vf(e):un(e)&&!xt(e)&&!ex(e)?String(e):e,vf=(i,e="")=>{var t;return Gs(i)?"Symbol(".concat((t=i.description)!=null?t:e,")"):i};/**
* @vue/reactivity v3.5.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let gi;class ax{constructor(e=!1){this.detached=e,this._active=!0,this.effects=[],this.cleanups=[],this._isPaused=!1,this.parent=gi,!e&&gi&&(this.index=(gi.scopes||(gi.scopes=[])).push(this)-1)}get active(){return this._active}pause(){if(this._active){this._isPaused=!0;let e,t;if(this.scopes)for(e=0,t=this.scopes.length;e<t;e++)this.scopes[e].pause();for(e=0,t=this.effects.length;e<t;e++)this.effects[e].pause()}}resume(){if(this._active&&this._isPaused){this._isPaused=!1;let e,t;if(this.scopes)for(e=0,t=this.scopes.length;e<t;e++)this.scopes[e].resume();for(e=0,t=this.effects.length;e<t;e++)this.effects[e].resume()}}run(e){if(this._active){const t=gi;try{return gi=this,e()}finally{gi=t}}}on(){gi=this}off(){gi=this.parent}stop(e){if(this._active){this._active=!1;let t,n;for(t=0,n=this.effects.length;t<n;t++)this.effects[t].stop();for(this.effects.length=0,t=0,n=this.cleanups.length;t<n;t++)this.cleanups[t]();if(this.cleanups.length=0,this.scopes){for(t=0,n=this.scopes.length;t<n;t++)this.scopes[t].stop(!0);this.scopes.length=0}if(!this.detached&&this.parent&&!e){const s=this.parent.scopes.pop();s&&s!==this&&(this.parent.scopes[this.index]=s,s.index=this.index)}this.parent=void 0}}}function lx(i){return new ax(i)}function cx(){return gi}function bS(i,e=!1){gi&&gi.cleanups.push(i)}let an;const _f=new WeakSet;class hx{constructor(e){this.fn=e,this.deps=void 0,this.depsTail=void 0,this.flags=5,this.next=void 0,this.cleanup=void 0,this.scheduler=void 0,gi&&gi.active&&gi.effects.push(this)}pause(){this.flags|=64}resume(){this.flags&64&&(this.flags&=-65,_f.has(this)&&(_f.delete(this),this.trigger()))}notify(){this.flags&2&&!(this.flags&32)||this.flags&8||dx(this)}run(){if(!(this.flags&1))return this.fn();this.flags|=2,Sv(this),fx(this);const e=an,t=Ss;an=this,Ss=!0;try{return this.fn()}finally{px(this),an=e,Ss=t,this.flags&=-3}}stop(){if(this.flags&1){for(let e=this.deps;e;e=e.nextDep)GA(e);this.deps=this.depsTail=void 0,Sv(this),this.onStop&&this.onStop(),this.flags&=-2}}trigger(){this.flags&64?_f.add(this):this.scheduler?this.scheduler():this.runIfDirty()}runIfDirty(){sm(this)&&this.run()}get dirty(){return sm(this)}}let ux=0,pc,mc;function dx(i,e=!1){if(i.flags|=8,e){i.next=mc,mc=i;return}i.next=pc,pc=i}function VA(){ux++}function zA(){if(--ux>0)return;if(mc){let e=mc;for(mc=void 0;e;){const t=e.next;e.next=void 0,e.flags&=-9,e=t}}let i;for(;pc;){let e=pc;for(pc=void 0;e;){const t=e.next;if(e.next=void 0,e.flags&=-9,e.flags&1)try{e.trigger()}catch(n){i||(i=n)}e=t}}if(i)throw i}function fx(i){for(let e=i.deps;e;e=e.nextDep)e.version=-1,e.prevActiveLink=e.dep.activeLink,e.dep.activeLink=e}function px(i){let e,t=i.depsTail,n=t;for(;n;){const s=n.prevDep;n.version===-1?(n===t&&(t=s),GA(n),ES(n)):e=n,n.dep.activeLink=n.prevActiveLink,n.prevActiveLink=void 0,n=s}i.deps=e,i.depsTail=t}function sm(i){for(let e=i.deps;e;e=e.nextDep)if(e.dep.version!==e.version||e.dep.computed&&(mx(e.dep.computed)||e.dep.version!==e.version))return!0;return!!i._dirty}function mx(i){if(i.flags&4&&!(i.flags&16)||(i.flags&=-17,i.globalVersion===Uc))return;i.globalVersion=Uc;const e=i.dep;if(i.flags|=2,e.version>0&&!i.isSSR&&i.deps&&!sm(i)){i.flags&=-3;return}const t=an,n=Ss;an=i,Ss=!0;try{fx(i);const s=i.fn(i._value);(e.version===0||Zr(s,i._value))&&(i._value=s,e.version++)}catch(s){throw e.version++,s}finally{an=t,Ss=n,px(i),i.flags&=-3}}function GA(i,e=!1){const{dep:t,prevSub:n,nextSub:s}=i;if(n&&(n.nextSub=s,i.prevSub=void 0),s&&(s.prevSub=n,i.nextSub=void 0),t.subs===i&&(t.subs=n,!n&&t.computed)){t.computed.flags&=-5;for(let r=t.computed.deps;r;r=r.nextDep)GA(r,!0)}!e&&!--t.sc&&t.map&&t.map.delete(t.key)}function ES(i){const{prevDep:e,nextDep:t}=i;e&&(e.nextDep=t,i.prevDep=void 0),t&&(t.prevDep=e,i.nextDep=void 0)}let Ss=!0;const Ax=[];function mo(){Ax.push(Ss),Ss=!1}function Ao(){const i=Ax.pop();Ss=i===void 0?!0:i}function Sv(i){const{cleanup:e}=i;if(i.cleanup=void 0,e){const t=an;an=void 0;try{e()}finally{an=t}}}let Uc=0;class CS{constructor(e,t){this.sub=e,this.dep=t,this.version=t.version,this.nextDep=this.prevDep=this.nextSub=this.prevSub=this.prevActiveLink=void 0}}class HA{constructor(e){this.computed=e,this.version=0,this.activeLink=void 0,this.subs=void 0,this.map=void 0,this.key=void 0,this.sc=0}track(e){if(!an||!Ss||an===this.computed)return;let t=this.activeLink;if(t===void 0||t.sub!==an)t=this.activeLink=new CS(an,this),an.deps?(t.prevDep=an.depsTail,an.depsTail.nextDep=t,an.depsTail=t):an.deps=an.depsTail=t,gx(t);else if(t.version===-1&&(t.version=this.version,t.nextDep)){const n=t.nextDep;n.prevDep=t.prevDep,t.prevDep&&(t.prevDep.nextDep=n),t.prevDep=an.depsTail,t.nextDep=void 0,an.depsTail.nextDep=t,an.depsTail=t,an.deps===t&&(an.deps=n)}return t}trigger(e){this.version++,Uc++,this.notify(e)}notify(e){VA();try{for(let t=this.subs;t;t=t.prevSub)t.sub.notify()&&t.sub.dep.notify()}finally{zA()}}}function gx(i){if(i.dep.sc++,i.sub.flags&4){const e=i.dep.computed;if(e&&!i.dep.subs){e.flags|=20;for(let n=e.deps;n;n=n.nextDep)gx(n)}const t=i.dep.subs;t!==i&&(i.prevSub=t,t&&(t.nextSub=i)),i.dep.subs=i}}const Wu=new WeakMap,Ho=Symbol(""),rm=Symbol(""),Qc=Symbol("");function ri(i,e,t){if(Ss&&an){let n=Wu.get(i);n||Wu.set(i,n=new Map);let s=n.get(t);s||(n.set(t,s=new HA),s.map=n,s.key=t),s.track()}}function dr(i,e,t,n,s,r){const o=Wu.get(i);if(!o){Uc++;return}const a=l=>{l&&l.trigger()};if(VA(),e==="clear")o.forEach(a);else{const l=xt(i),c=l&&OA(t);if(l&&t==="length"){const h=Number(n);o.forEach((u,d)=>{(d==="length"||d===Qc||!Gs(d)&&d>=h)&&a(u)})}else switch((t!==void 0||o.has(void 0))&&a(o.get(t)),c&&a(o.get(Qc)),e){case"add":l?c&&a(o.get("length")):(a(o.get(Ho)),Za(i)&&a(o.get(rm)));break;case"delete":l||(a(o.get(Ho)),Za(i)&&a(o.get(rm)));break;case"set":Za(i)&&a(o.get(Ho));break}}zA()}function SS(i,e){const t=Wu.get(i);return t&&t.get(e)}function Aa(i){const e=Qt(i);return e===i?e:(ri(e,"iterate",Qc),hs(i)?e:e.map(oi))}function Pd(i){return ri(i=Qt(i),"iterate",Qc),i}const IS={__proto__:null,[Symbol.iterator](){return yf(this,Symbol.iterator,oi)},concat(...i){return Aa(this).concat(...i.map(e=>xt(e)?Aa(e):e))},entries(){return yf(this,"entries",i=>(i[1]=oi(i[1]),i))},every(i,e){return $s(this,"every",i,e,void 0,arguments)},filter(i,e){return $s(this,"filter",i,e,t=>t.map(oi),arguments)},find(i,e){return $s(this,"find",i,e,oi,arguments)},findIndex(i,e){return $s(this,"findIndex",i,e,void 0,arguments)},findLast(i,e){return $s(this,"findLast",i,e,oi,arguments)},findLastIndex(i,e){return $s(this,"findLastIndex",i,e,void 0,arguments)},forEach(i,e){return $s(this,"forEach",i,e,void 0,arguments)},includes(...i){return xf(this,"includes",i)},indexOf(...i){return xf(this,"indexOf",i)},join(i){return Aa(this).join(i)},lastIndexOf(...i){return xf(this,"lastIndexOf",i)},map(i,e){return $s(this,"map",i,e,void 0,arguments)},pop(){return Vl(this,"pop")},push(...i){return Vl(this,"push",i)},reduce(i,...e){return Iv(this,"reduce",i,e)},reduceRight(i,...e){return Iv(this,"reduceRight",i,e)},shift(){return Vl(this,"shift")},some(i,e){return $s(this,"some",i,e,void 0,arguments)},splice(...i){return Vl(this,"splice",i)},toReversed(){return Aa(this).toReversed()},toSorted(i){return Aa(this).toSorted(i)},toSpliced(...i){return Aa(this).toSpliced(...i)},unshift(...i){return Vl(this,"unshift",i)},values(){return yf(this,"values",oi)}};function yf(i,e,t){const n=Pd(i),s=n[e]();return n!==i&&!hs(i)&&(s._next=s.next,s.next=()=>{const r=s._next();return r.value&&(r.value=t(r.value)),r}),s}const MS=Array.prototype;function $s(i,e,t,n,s,r){const o=Pd(i),a=o!==i&&!hs(i),l=o[e];if(l!==MS[e]){const u=l.apply(i,r);return a?oi(u):u}let c=t;o!==i&&(a?c=function(u,d){return t.call(this,oi(u),d,i)}:t.length>2&&(c=function(u,d){return t.call(this,u,d,i)}));const h=l.call(o,c,n);return a&&s?s(h):h}function Iv(i,e,t,n){const s=Pd(i);let r=t;return s!==i&&(hs(i)?t.length>3&&(r=function(o,a,l){return t.call(this,o,a,l,i)}):r=function(o,a,l){return t.call(this,o,oi(a),l,i)}),s[e](r,...n)}function xf(i,e,t){const n=Qt(i);ri(n,"iterate",Qc);const s=n[e](...t);return(s===-1||s===!1)&&jA(t[0])?(t[0]=Qt(t[0]),n[e](...t)):s}function Vl(i,e,t=[]){mo(),VA();const n=Qt(i)[e].apply(i,t);return zA(),Ao(),n}const TS=FA("__proto__,__v_isRef,__isVue"),vx=new Set(Object.getOwnPropertyNames(Symbol).filter(i=>i!=="arguments"&&i!=="caller").map(i=>Symbol[i]).filter(Gs));function BS(i){Gs(i)||(i=String(i));const e=Qt(this);return ri(e,"has",i),e.hasOwnProperty(i)}class _x{constructor(e=!1,t=!1){this._isReadonly=e,this._isShallow=t}get(e,t,n){if(t==="__v_skip")return e.__v_skip;const s=this._isReadonly,r=this._isShallow;if(t==="__v_isReactive")return!s;if(t==="__v_isReadonly")return s;if(t==="__v_isShallow")return r;if(t==="__v_raw")return n===(s?r?QS:bx:r?wx:xx).get(e)||Object.getPrototypeOf(e)===Object.getPrototypeOf(n)?e:void 0;const o=xt(e);if(!s){let l;if(o&&(l=IS[t]))return l;if(t==="hasOwnProperty")return BS}const a=Reflect.get(e,t,yn(e)?e:n);return(Gs(t)?vx.has(t):TS(t))||(s||ri(e,"get",t),r)?a:yn(a)?o&&OA(t)?a:a.value:un(a)?s?Ex(a):Dd(a):a}}class yx extends _x{constructor(e=!1){super(!1,e)}set(e,t,n,s){let r=e[t];if(!this._isShallow){const l=Jo(r);if(!hs(n)&&!Jo(n)&&(r=Qt(r),n=Qt(n)),!xt(e)&&yn(r)&&!yn(n))return l?!1:(r.value=n,!0)}const o=xt(e)&&OA(t)?Number(t)<e.length:qt(e,t),a=Reflect.set(e,t,n,yn(e)?e:s);return e===Qt(s)&&(o?Zr(n,r)&&dr(e,"set",t,n):dr(e,"add",t,n)),a}deleteProperty(e,t){const n=qt(e,t);e[t];const s=Reflect.deleteProperty(e,t);return s&&n&&dr(e,"delete",t,void 0),s}has(e,t){const n=Reflect.has(e,t);return(!Gs(t)||!vx.has(t))&&ri(e,"has",t),n}ownKeys(e){return ri(e,"iterate",xt(e)?"length":Ho),Reflect.ownKeys(e)}}class RS extends _x{constructor(e=!1){super(!0,e)}set(e,t){return!0}deleteProperty(e,t){return!0}}const PS=new yx,DS=new RS,LS=new yx(!0);const om=i=>i,Nh=i=>Reflect.getPrototypeOf(i);function FS(i,e,t){return function(...n){const s=this.__v_raw,r=Qt(s),o=Za(r),a=i==="entries"||i===Symbol.iterator&&o,l=i==="keys"&&o,c=s[i](...n),h=t?om:e?am:oi;return!e&&ri(r,"iterate",l?rm:Ho),{next(){const{value:u,done:d}=c.next();return d?{value:u,done:d}:{value:a?[h(u[0]),h(u[1])]:h(u),done:d}},[Symbol.iterator](){return this}}}}function kh(i){return function(...e){return i==="delete"?!1:i==="clear"?void 0:this}}function NS(i,e){const t={get(s){const r=this.__v_raw,o=Qt(r),a=Qt(s);i||(Zr(s,a)&&ri(o,"get",s),ri(o,"get",a));const{has:l}=Nh(o),c=e?om:i?am:oi;if(l.call(o,s))return c(r.get(s));if(l.call(o,a))return c(r.get(a));r!==o&&r.get(s)},get size(){const s=this.__v_raw;return!i&&ri(Qt(s),"iterate",Ho),Reflect.get(s,"size",s)},has(s){const r=this.__v_raw,o=Qt(r),a=Qt(s);return i||(Zr(s,a)&&ri(o,"has",s),ri(o,"has",a)),s===a?r.has(s):r.has(s)||r.has(a)},forEach(s,r){const o=this,a=o.__v_raw,l=Qt(a),c=e?om:i?am:oi;return!i&&ri(l,"iterate",Ho),a.forEach((h,u)=>s.call(r,c(h),c(u),o))}};return bi(t,i?{add:kh("add"),set:kh("set"),delete:kh("delete"),clear:kh("clear")}:{add(s){!e&&!hs(s)&&!Jo(s)&&(s=Qt(s));const r=Qt(this);return Nh(r).has.call(r,s)||(r.add(s),dr(r,"add",s,s)),this},set(s,r){!e&&!hs(r)&&!Jo(r)&&(r=Qt(r));const o=Qt(this),{has:a,get:l}=Nh(o);let c=a.call(o,s);c||(s=Qt(s),c=a.call(o,s));const h=l.call(o,s);return o.set(s,r),c?Zr(r,h)&&dr(o,"set",s,r):dr(o,"add",s,r),this},delete(s){const r=Qt(this),{has:o,get:a}=Nh(r);let l=o.call(r,s);l||(s=Qt(s),l=o.call(r,s)),a&&a.call(r,s);const c=r.delete(s);return l&&dr(r,"delete",s,void 0),c},clear(){const s=Qt(this),r=s.size!==0,o=s.clear();return r&&dr(s,"clear",void 0,void 0),o}}),["keys","values","entries",Symbol.iterator].forEach(s=>{t[s]=FS(s,i,e)}),t}function WA(i,e){const t=NS(i,e);return(n,s,r)=>s==="__v_isReactive"?!i:s==="__v_isReadonly"?i:s==="__v_raw"?n:Reflect.get(qt(t,s)&&s in n?t:n,s,r)}const kS={get:WA(!1,!1)},OS={get:WA(!1,!0)},US={get:WA(!0,!1)};const xx=new WeakMap,wx=new WeakMap,bx=new WeakMap,QS=new WeakMap;function VS(i){switch(i){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function zS(i){return i.__v_skip||!Object.isExtensible(i)?0:VS(fS(i))}function Dd(i){return Jo(i)?i:qA(i,!1,PS,kS,xx)}function GS(i){return qA(i,!1,LS,OS,wx)}function Ex(i){return qA(i,!0,DS,US,bx)}function qA(i,e,t,n,s){if(!un(i)||i.__v_raw&&!(e&&i.__v_isReactive))return i;const r=s.get(i);if(r)return r;const o=zS(i);if(o===0)return i;const a=new Proxy(i,o===2?n:t);return s.set(i,a),a}function gr(i){return Jo(i)?gr(i.__v_raw):!!(i&&i.__v_isReactive)}function Jo(i){return!!(i&&i.__v_isReadonly)}function hs(i){return!!(i&&i.__v_isShallow)}function jA(i){return i?!!i.__v_raw:!1}function Qt(i){const e=i&&i.__v_raw;return e?Qt(e):i}function XA(i){return!qt(i,"__v_skip")&&Object.isExtensible(i)&&nx(i,"__v_skip",!0),i}const oi=i=>un(i)?Dd(i):i,am=i=>un(i)?Ex(i):i;function yn(i){return i?i.__v_isRef===!0:!1}function cn(i){return HS(i,!1)}function HS(i,e){return yn(i)?i:new WS(i,e)}class WS{constructor(e,t){this.dep=new HA,this.__v_isRef=!0,this.__v_isShallow=!1,this._rawValue=t?e:Qt(e),this._value=t?e:oi(e),this.__v_isShallow=t}get value(){return this.dep.track(),this._value}set value(e){const t=this._rawValue,n=this.__v_isShallow||hs(e)||Jo(e);e=n?e:Qt(e),Zr(e,t)&&(this._rawValue=e,this._value=n?e:oi(e),this.dep.trigger())}}function Cx(i){return yn(i)?i.value:i}const qS={get:(i,e,t)=>e==="__v_raw"?i:Cx(Reflect.get(i,e,t)),set:(i,e,t,n)=>{const s=i[e];return yn(s)&&!yn(t)?(s.value=t,!0):Reflect.set(i,e,t,n)}};function Sx(i){return gr(i)?i:new Proxy(i,qS)}function jS(i){const e=xt(i)?new Array(i.length):{};for(const t in i)e[t]=Ix(i,t);return e}class XS{constructor(e,t,n){this._object=e,this._key=t,this._defaultValue=n,this.__v_isRef=!0,this._value=void 0}get value(){const e=this._object[this._key];return this._value=e===void 0?this._defaultValue:e}set value(e){this._object[this._key]=e}get dep(){return SS(Qt(this._object),this._key)}}class YS{constructor(e){this._getter=e,this.__v_isRef=!0,this.__v_isReadonly=!0,this._value=void 0}get value(){return this._value=this._getter()}}function KS(i,e,t){return yn(i)?i:Mt(i)?new YS(i):un(i)&&arguments.length>1?Ix(i,e,t):cn(i)}function Ix(i,e,t){const n=i[e];return yn(n)?n:new XS(i,e,t)}class $S{constructor(e,t,n){this.fn=e,this.setter=t,this._value=void 0,this.dep=new HA(this),this.__v_isRef=!0,this.deps=void 0,this.depsTail=void 0,this.flags=16,this.globalVersion=Uc-1,this.next=void 0,this.effect=this,this.__v_isReadonly=!t,this.isSSR=n}notify(){if(this.flags|=16,!(this.flags&8)&&an!==this)return dx(this,!0),!0}get value(){const e=this.dep.track();return mx(this),e&&(e.version=this.dep.version),this._value}set value(e){this.setter&&this.setter(e)}}function JS(i,e,t=!1){let n,s;return Mt(i)?n=i:(n=i.get,s=i.set),new $S(n,s,t)}const Oh={},qu=new WeakMap;let Do;function ZS(i,e=!1,t=Do){if(t){let n=qu.get(t);n||qu.set(t,n=[]),n.push(i)}}function eI(i,e,t=sn){const{immediate:n,deep:s,once:r,scheduler:o,augmentJob:a,call:l}=t,c=v=>s?v:hs(v)||s===!1||s===0?fr(v,1):fr(v);let h,u,d,f,p=!1,A=!1;if(yn(i)?(u=()=>i.value,p=hs(i)):gr(i)?(u=()=>c(i),p=!0):xt(i)?(A=!0,p=i.some(v=>gr(v)||hs(v)),u=()=>i.map(v=>{if(yn(v))return v.value;if(gr(v))return c(v);if(Mt(v))return l?l(v,2):v()})):Mt(i)?e?u=l?()=>l(i,2):i:u=()=>{if(d){mo();try{d()}finally{Ao()}}const v=Do;Do=h;try{return l?l(i,3,[f]):i(f)}finally{Do=v}}:u=Vs,e&&s){const v=u,b=s===!0?1/0:s;u=()=>fr(v(),b)}const m=cx(),g=()=>{h.stop(),m&&m.active&&kA(m.effects,h)};if(r&&e){const v=e;e=(...b)=>{v(...b),g()}}let y=A?new Array(i.length).fill(Oh):Oh;const _=v=>{if(!(!(h.flags&1)||!h.dirty&&!v))if(e){const b=h.run();if(s||p||(A?b.some((T,L)=>Zr(T,y[L])):Zr(b,y))){d&&d();const T=Do;Do=h;try{const L=[b,y===Oh?void 0:A&&y[0]===Oh?[]:y,f];l?l(e,3,L):e(...L),y=b}finally{Do=T}}}else h.run()};return a&&a(_),h=new hx(u),h.scheduler=o?()=>o(_,!1):_,f=v=>ZS(v,!1,h),d=h.onStop=()=>{const v=qu.get(h);if(v){if(l)l(v,4);else for(const b of v)b();qu.delete(h)}},e?n?_(!0):y=h.run():o?o(_.bind(null,!0),!0):h.run(),g.pause=h.pause.bind(h),g.resume=h.resume.bind(h),g.stop=g,g}function fr(i,e=1/0,t){if(e<=0||!un(i)||i.__v_skip||(t=t||new Set,t.has(i)))return i;if(t.add(i),e--,yn(i))fr(i.value,e,t);else if(xt(i))for(let n=0;n<i.length;n++)fr(i[n],e,t);else if(Md(i)||Za(i))i.forEach(n=>{fr(n,e,t)});else if(ex(i)){for(const n in i)fr(i[n],e,t);for(const n of Object.getOwnPropertySymbols(i))Object.prototype.propertyIsEnumerable.call(i,n)&&fr(i[n],e,t)}return i}/**
* @vue/runtime-core v3.5.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/function Ah(i,e,t,n){try{return n?i(...n):i()}catch(s){Ld(s,e,t)}}function Hs(i,e,t,n){if(Mt(i)){const s=Ah(i,e,t,n);return s&&Jy(s)&&s.catch(r=>{Ld(r,e,t)}),s}if(xt(i)){const s=[];for(let r=0;r<i.length;r++)s.push(Hs(i[r],e,t,n));return s}}function Ld(i,e,t,n=!0){const s=e?e.vnode:null,{errorHandler:r,throwUnhandledErrorInProduction:o}=e&&e.appContext.config||sn;if(e){let a=e.parent;const l=e.proxy,c="https://vuejs.org/error-reference/#runtime-".concat(t);for(;a;){const h=a.ec;if(h){for(let u=0;u<h.length;u++)if(h[u](i,l,c)===!1)return}a=a.parent}if(r){mo(),Ah(r,null,10,[i,l,c]),Ao();return}}tI(i,t,s,n,o)}function tI(i,e,t,n=!0,s=!1){if(s)throw i;console.error(i)}const vi=[];let Ps=-1;const el=[];let Gr=null,Va=0;const Mx=Promise.resolve();let ju=null;function Tx(i){const e=ju||Mx;return i?e.then(this?i.bind(this):i):e}function nI(i){let e=Ps+1,t=vi.length;for(;e<t;){const n=e+t>>>1,s=vi[n],r=Vc(s);r<i||r===i&&s.flags&2?e=n+1:t=n}return e}function YA(i){if(!(i.flags&1)){const e=Vc(i),t=vi[vi.length-1];!t||!(i.flags&2)&&e>=Vc(t)?vi.push(i):vi.splice(nI(e),0,i),i.flags|=1,Bx()}}function Bx(){ju||(ju=Mx.then(Px))}function iI(i){xt(i)?el.push(...i):Gr&&i.id===-1?Gr.splice(Va+1,0,i):i.flags&1||(el.push(i),i.flags|=1),Bx()}function Mv(i,e,t=Ps+1){for(;t<vi.length;t++){const n=vi[t];if(n&&n.flags&2){if(i&&n.id!==i.uid)continue;vi.splice(t,1),t--,n.flags&4&&(n.flags&=-2),n(),n.flags&4||(n.flags&=-2)}}}function Rx(i){if(el.length){const e=[...new Set(el)].sort((t,n)=>Vc(t)-Vc(n));if(el.length=0,Gr){Gr.push(...e);return}for(Gr=e,Va=0;Va<Gr.length;Va++){const t=Gr[Va];t.flags&4&&(t.flags&=-2),t.flags&8||t(),t.flags&=-2}Gr=null,Va=0}}const Vc=i=>i.id==null?i.flags&2?-1:1/0:i.id;function Px(i){try{for(Ps=0;Ps<vi.length;Ps++){const e=vi[Ps];e&&!(e.flags&8)&&(e.flags&4&&(e.flags&=-2),Ah(e,e.i,e.i?15:14),e.flags&4||(e.flags&=-2))}}finally{for(;Ps<vi.length;Ps++){const e=vi[Ps];e&&(e.flags&=-2)}Ps=-1,vi.length=0,Rx(),ju=null,(vi.length||el.length)&&Px()}}let zi=null,Dx=null;function Xu(i){const e=zi;return zi=i,Dx=i&&i.type.__scopeId||null,e}function sI(i,e=zi,t){if(!e||i._n)return i;const n=(...s)=>{n._d&&kv(-1);const r=Xu(e);let o;try{o=i(...s)}finally{Xu(r),n._d&&kv(1)}return o};return n._n=!0,n._c=!0,n._d=!0,n}function Lx(i,e){if(zi===null)return i;const t=Od(zi),n=i.dirs||(i.dirs=[]);for(let s=0;s<e.length;s++){let[r,o,a,l=sn]=e[s];r&&(Mt(r)&&(r={mounted:r,updated:r}),r.deep&&fr(o),n.push({dir:r,instance:t,value:o,oldValue:void 0,arg:a,modifiers:l}))}return i}function yo(i,e,t,n){const s=i.dirs,r=e&&e.dirs;for(let o=0;o<s.length;o++){const a=s[o];r&&(a.oldValue=r[o].value);let l=a.dir[n];l&&(mo(),Hs(l,t,8,[i.el,a,i,e]),Ao())}}const rI=Symbol("_vte"),oI=i=>i.__isTeleport;function KA(i,e){i.shapeFlag&6&&i.component?(i.transition=e,KA(i.component.subTree,e)):i.shapeFlag&128?(i.ssContent.transition=e.clone(i.ssContent),i.ssFallback.transition=e.clone(i.ssFallback)):i.transition=e}function Fx(i){i.ids=[i.ids[0]+i.ids[2]+++"-",0,0]}function Yu(i,e,t,n,s=!1){if(xt(i)){i.forEach((p,A)=>Yu(p,e&&(xt(e)?e[A]:e),t,n,s));return}if(Ac(n)&&!s){n.shapeFlag&512&&n.type.__asyncResolved&&n.component.subTree.component&&Yu(i,e,t,n.component.subTree);return}const r=n.shapeFlag&4?Od(n.component):n.el,o=s?null:r,{i:a,r:l}=i,c=e&&e.r,h=a.refs===sn?a.refs={}:a.refs,u=a.setupState,d=Qt(u),f=u===sn?()=>!1:p=>qt(d,p);if(c!=null&&c!==l&&(kn(c)?(h[c]=null,f(c)&&(u[c]=null)):yn(c)&&(c.value=null)),Mt(l))Ah(l,a,12,[o,h]);else{const p=kn(l),A=yn(l);if(p||A){const m=()=>{if(i.f){const g=p?f(l)?u[l]:h[l]:l.value;s?xt(g)&&kA(g,r):xt(g)?g.includes(r)||g.push(r):p?(h[l]=[r],f(l)&&(u[l]=h[l])):(l.value=[r],i.k&&(h[i.k]=l.value))}else p?(h[l]=o,f(l)&&(u[l]=o)):A&&(l.value=o,i.k&&(h[i.k]=o))};o?(m.id=-1,Oi(m,t)):m()}}}Bd().requestIdleCallback;Bd().cancelIdleCallback;const Ac=i=>!!i.type.__asyncLoader,Nx=i=>i.type.__isKeepAlive;function aI(i,e){kx(i,"a",e)}function lI(i,e){kx(i,"da",e)}function kx(i,e,t=li){const n=i.__wdc||(i.__wdc=()=>{let s=t;for(;s;){if(s.isDeactivated)return;s=s.parent}return i()});if(Fd(e,n,t),t){let s=t.parent;for(;s&&s.parent;)Nx(s.parent.vnode)&&cI(n,e,t,s),s=s.parent}}function cI(i,e,t,n){const s=Fd(e,i,n,!0);Ux(()=>{kA(n[e],s)},t)}function Fd(i,e,t=li,n=!1){if(t){const s=t[i]||(t[i]=[]),r=e.__weh||(e.__weh=(...o)=>{mo();const a=gh(t),l=Hs(e,t,i,o);return a(),Ao(),l});return n?s.unshift(r):s.push(r),r}}const Cr=i=>(e,t=li)=>{(!Gc||i==="sp")&&Fd(i,(...n)=>e(...n),t)},hI=Cr("bm"),Rl=Cr("m"),uI=Cr("bu"),dI=Cr("u"),Ox=Cr("bum"),Ux=Cr("um"),fI=Cr("sp"),pI=Cr("rtg"),mI=Cr("rtc");function AI(i,e=li){Fd("ec",i,e)}const gI=Symbol.for("v-ndc");function Qx(i,e,t,n){let s;const r=t,o=xt(i);if(o||kn(i)){const a=o&&gr(i);let l=!1;a&&(l=!hs(i),i=Pd(i)),s=new Array(i.length);for(let c=0,h=i.length;c<h;c++)s[c]=e(l?oi(i[c]):i[c],c,void 0,r)}else if(typeof i=="number"){s=new Array(i);for(let a=0;a<i;a++)s[a]=e(a+1,a,void 0,r)}else if(un(i))if(i[Symbol.iterator])s=Array.from(i,(a,l)=>e(a,l,void 0,r));else{const a=Object.keys(i);s=new Array(a.length);for(let l=0,c=a.length;l<c;l++){const h=a[l];s[l]=e(i[h],h,l,r)}}else s=[];return s}const lm=i=>i?lw(i)?Od(i):lm(i.parent):null,gc=bi(Object.create(null),{$:i=>i,$el:i=>i.vnode.el,$data:i=>i.data,$props:i=>i.props,$attrs:i=>i.attrs,$slots:i=>i.slots,$refs:i=>i.refs,$parent:i=>lm(i.parent),$root:i=>lm(i.root),$host:i=>i.ce,$emit:i=>i.emit,$options:i=>zx(i),$forceUpdate:i=>i.f||(i.f=()=>{YA(i.update)}),$nextTick:i=>i.n||(i.n=Tx.bind(i.proxy)),$watch:i=>QI.bind(i)}),wf=(i,e)=>i!==sn&&!i.__isScriptSetup&&qt(i,e),vI={get({_:i},e){if(e==="__v_skip")return!0;const{ctx:t,setupState:n,data:s,props:r,accessCache:o,type:a,appContext:l}=i;let c;if(e[0]!=="$"){const f=o[e];if(f!==void 0)switch(f){case 1:return n[e];case 2:return s[e];case 4:return t[e];case 3:return r[e]}else{if(wf(n,e))return o[e]=1,n[e];if(s!==sn&&qt(s,e))return o[e]=2,s[e];if((c=i.propsOptions[0])&&qt(c,e))return o[e]=3,r[e];if(t!==sn&&qt(t,e))return o[e]=4,t[e];cm&&(o[e]=0)}}const h=gc[e];let u,d;if(h)return e==="$attrs"&&ri(i.attrs,"get",""),h(i);if((u=a.__cssModules)&&(u=u[e]))return u;if(t!==sn&&qt(t,e))return o[e]=4,t[e];if(d=l.config.globalProperties,qt(d,e))return d[e]},set({_:i},e,t){const{data:n,setupState:s,ctx:r}=i;return wf(s,e)?(s[e]=t,!0):n!==sn&&qt(n,e)?(n[e]=t,!0):qt(i.props,e)||e[0]==="$"&&e.slice(1)in i?!1:(r[e]=t,!0)},has({_:{data:i,setupState:e,accessCache:t,ctx:n,appContext:s,propsOptions:r}},o){let a;return!!t[o]||i!==sn&&qt(i,o)||wf(e,o)||(a=r[0])&&qt(a,o)||qt(n,o)||qt(gc,o)||qt(s.config.globalProperties,o)},defineProperty(i,e,t){return t.get!=null?i._.accessCache[e]=0:qt(t,"value")&&this.set(i,e,t.value,null),Reflect.defineProperty(i,e,t)}};function Tv(i){return xt(i)?i.reduce((e,t)=>(e[t]=null,e),{}):i}let cm=!0;function _I(i){const e=zx(i),t=i.proxy,n=i.ctx;cm=!1,e.beforeCreate&&Bv(e.beforeCreate,i,"bc");const{data:s,computed:r,methods:o,watch:a,provide:l,inject:c,created:h,beforeMount:u,mounted:d,beforeUpdate:f,updated:p,activated:A,deactivated:m,beforeDestroy:g,beforeUnmount:y,destroyed:_,unmounted:v,render:b,renderTracked:T,renderTriggered:L,errorCaptured:I,serverPrefetch:x,expose:w,inheritAttrs:P,components:z,directives:H,filters:K}=e;if(c&&yI(c,n,null),o)for(const W in o){const O=o[W];Mt(O)&&(n[W]=O.bind(t))}if(s){const W=s.call(t,t);un(W)&&(i.data=Dd(W))}if(cm=!0,r)for(const W in r){const O=r[W],fe=Mt(O)?O.bind(t,t):Mt(O.get)?O.get.bind(t,t):Vs,ue=!Mt(O)&&Mt(O.set)?O.set.bind(t):Vs,ee=ZA({get:fe,set:ue});Object.defineProperty(n,W,{enumerable:!0,configurable:!0,get:()=>ee.value,set:de=>ee.value=de})}if(a)for(const W in a)Vx(a[W],n,t,W);if(l){const W=Mt(l)?l.call(t):l;Reflect.ownKeys(W).forEach(O=>{SI(O,W[O])})}h&&Bv(h,i,"c");function J(W,O){xt(O)?O.forEach(fe=>W(fe.bind(t))):O&&W(O.bind(t))}if(J(hI,u),J(Rl,d),J(uI,f),J(dI,p),J(aI,A),J(lI,m),J(AI,I),J(mI,T),J(pI,L),J(Ox,y),J(Ux,v),J(fI,x),xt(w))if(w.length){const W=i.exposed||(i.exposed={});w.forEach(O=>{Object.defineProperty(W,O,{get:()=>t[O],set:fe=>t[O]=fe})})}else i.exposed||(i.exposed={});b&&i.render===Vs&&(i.render=b),P!=null&&(i.inheritAttrs=P),z&&(i.components=z),H&&(i.directives=H),x&&Fx(i)}function yI(i,e,t=Vs){xt(i)&&(i=hm(i));for(const n in i){const s=i[n];let r;un(s)?"default"in s?r=vc(s.from||n,s.default,!0):r=vc(s.from||n):r=vc(s),yn(r)?Object.defineProperty(e,n,{enumerable:!0,configurable:!0,get:()=>r.value,set:o=>r.value=o}):e[n]=r}}function Bv(i,e,t){Hs(xt(i)?i.map(n=>n.bind(e.proxy)):i.bind(e.proxy),e,t)}function Vx(i,e,t,n){let s=n.includes(".")?nw(t,n):()=>t[n];if(kn(i)){const r=e[i];Mt(r)&&_c(s,r)}else if(Mt(i))_c(s,i.bind(t));else if(un(i))if(xt(i))i.forEach(r=>Vx(r,e,t,n));else{const r=Mt(i.handler)?i.handler.bind(t):e[i.handler];Mt(r)&&_c(s,r,i)}}function zx(i){const e=i.type,{mixins:t,extends:n}=e,{mixins:s,optionsCache:r,config:{optionMergeStrategies:o}}=i.appContext,a=r.get(e);let l;return a?l=a:!s.length&&!t&&!n?l=e:(l={},s.length&&s.forEach(c=>Ku(l,c,o,!0)),Ku(l,e,o)),un(e)&&r.set(e,l),l}function Ku(i,e,t,n=!1){const{mixins:s,extends:r}=e;r&&Ku(i,r,t,!0),s&&s.forEach(o=>Ku(i,o,t,!0));for(const o in e)if(!(n&&o==="expose")){const a=xI[o]||t&&t[o];i[o]=a?a(i[o],e[o]):e[o]}return i}const xI={data:Rv,props:Pv,emits:Pv,methods:rc,computed:rc,beforeCreate:pi,created:pi,beforeMount:pi,mounted:pi,beforeUpdate:pi,updated:pi,beforeDestroy:pi,beforeUnmount:pi,destroyed:pi,unmounted:pi,activated:pi,deactivated:pi,errorCaptured:pi,serverPrefetch:pi,components:rc,directives:rc,watch:bI,provide:Rv,inject:wI};function Rv(i,e){return e?i?function(){return bi(Mt(i)?i.call(this,this):i,Mt(e)?e.call(this,this):e)}:e:i}function wI(i,e){return rc(hm(i),hm(e))}function hm(i){if(xt(i)){const e={};for(let t=0;t<i.length;t++)e[i[t]]=i[t];return e}return i}function pi(i,e){return i?[...new Set([].concat(i,e))]:e}function rc(i,e){return i?bi(Object.create(null),i,e):e}function Pv(i,e){return i?xt(i)&&xt(e)?[...new Set([...i,...e])]:bi(Object.create(null),Tv(i),Tv(e!=null?e:{})):e}function bI(i,e){if(!i)return e;if(!e)return i;const t=bi(Object.create(null),i);for(const n in e)t[n]=pi(i[n],e[n]);return t}function Gx(){return{app:null,config:{isNativeTag:uS,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let EI=0;function CI(i,e){return function(n,s=null){Mt(n)||(n=bi({},n)),s!=null&&!un(s)&&(s=null);const r=Gx(),o=new WeakSet,a=[];let l=!1;const c=r.app={_uid:EI++,_component:n,_props:s,_container:null,_context:r,_instance:null,version:aM,get config(){return r.config},set config(h){},use(h,...u){return o.has(h)||(h&&Mt(h.install)?(o.add(h),h.install(c,...u)):Mt(h)&&(o.add(h),h(c,...u))),c},mixin(h){return r.mixins.includes(h)||r.mixins.push(h),c},component(h,u){return u?(r.components[h]=u,c):r.components[h]},directive(h,u){return u?(r.directives[h]=u,c):r.directives[h]},mount(h,u,d){if(!l){const f=c._ceVNode||us(n,s);return f.appContext=r,d===!0?d="svg":d===!1&&(d=void 0),i(f,h,d),l=!0,c._container=h,h.__vue_app__=c,Od(f.component)}},onUnmount(h){a.push(h)},unmount(){l&&(Hs(a,c._instance,16),i(null,c._container),delete c._container.__vue_app__)},provide(h,u){return r.provides[h]=u,c},runWithContext(h){const u=Wo;Wo=c;try{return h()}finally{Wo=u}}};return c}}let Wo=null;function SI(i,e){if(li){let t=li.provides;const n=li.parent&&li.parent.provides;n===t&&(t=li.provides=Object.create(n)),t[i]=e}}function vc(i,e,t=!1){const n=li||zi;if(n||Wo){const s=Wo?Wo._context.provides:n?n.parent==null?n.vnode.appContext&&n.vnode.appContext.provides:n.parent.provides:void 0;if(s&&i in s)return s[i];if(arguments.length>1)return t&&Mt(e)?e.call(n&&n.proxy):e}}function II(){return!!(li||zi||Wo)}const Hx={},Wx=()=>Object.create(Hx),qx=i=>Object.getPrototypeOf(i)===Hx;function MI(i,e,t,n=!1){const s={},r=Wx();i.propsDefaults=Object.create(null),jx(i,e,s,r);for(const o in i.propsOptions[0])o in s||(s[o]=void 0);t?i.props=n?s:GS(s):i.type.props?i.props=s:i.props=r,i.attrs=r}function TI(i,e,t,n){const{props:s,attrs:r,vnode:{patchFlag:o}}=i,a=Qt(s),[l]=i.propsOptions;let c=!1;if((n||o>0)&&!(o&16)){if(o&8){const h=i.vnode.dynamicProps;for(let u=0;u<h.length;u++){let d=h[u];if(Nd(i.emitsOptions,d))continue;const f=e[d];if(l)if(qt(r,d))f!==r[d]&&(r[d]=f,c=!0);else{const p=ao(d);s[p]=um(l,a,p,f,i,!1)}else f!==r[d]&&(r[d]=f,c=!0)}}}else{jx(i,e,s,r)&&(c=!0);let h;for(const u in a)(!e||!qt(e,u)&&((h=ha(u))===u||!qt(e,h)))&&(l?t&&(t[u]!==void 0||t[h]!==void 0)&&(s[u]=um(l,a,u,void 0,i,!0)):delete s[u]);if(r!==a)for(const u in r)(!e||!qt(e,u))&&(delete r[u],c=!0)}c&&dr(i.attrs,"set","")}function jx(i,e,t,n){const[s,r]=i.propsOptions;let o=!1,a;if(e)for(let l in e){if(fc(l))continue;const c=e[l];let h;s&&qt(s,h=ao(l))?!r||!r.includes(h)?t[h]=c:(a||(a={}))[h]=c:Nd(i.emitsOptions,l)||(!(l in n)||c!==n[l])&&(n[l]=c,o=!0)}if(r){const l=Qt(t),c=a||sn;for(let h=0;h<r.length;h++){const u=r[h];t[u]=um(s,l,u,c[u],i,!qt(c,u))}}return o}function um(i,e,t,n,s,r){const o=i[t];if(o!=null){const a=qt(o,"default");if(a&&n===void 0){const l=o.default;if(o.type!==Function&&!o.skipFactory&&Mt(l)){const{propsDefaults:c}=s;if(t in c)n=c[t];else{const h=gh(s);n=c[t]=l.call(null,e),h()}}else n=l;s.ce&&s.ce._setProp(t,n)}o[0]&&(r&&!a?n=!1:o[1]&&(n===""||n===ha(t))&&(n=!0))}return n}const BI=new WeakMap;function Xx(i,e,t=!1){const n=t?BI:e.propsCache,s=n.get(i);if(s)return s;const r=i.props,o={},a=[];let l=!1;if(!Mt(i)){const h=u=>{l=!0;const[d,f]=Xx(u,e,!0);bi(o,d),f&&a.push(...f)};!t&&e.mixins.length&&e.mixins.forEach(h),i.extends&&h(i.extends),i.mixins&&i.mixins.forEach(h)}if(!r&&!l)return un(i)&&n.set(i,Ja),Ja;if(xt(r))for(let h=0;h<r.length;h++){const u=ao(r[h]);Dv(u)&&(o[u]=sn)}else if(r)for(const h in r){const u=ao(h);if(Dv(u)){const d=r[h],f=o[u]=xt(d)||Mt(d)?{type:d}:bi({},d),p=f.type;let A=!1,m=!0;if(xt(p))for(let g=0;g<p.length;++g){const y=p[g],_=Mt(y)&&y.name;if(_==="Boolean"){A=!0;break}else _==="String"&&(m=!1)}else A=Mt(p)&&p.name==="Boolean";f[0]=A,f[1]=m,(A||qt(f,"default"))&&a.push(u)}}const c=[o,a];return un(i)&&n.set(i,c),c}function Dv(i){return i[0]!=="$"&&!fc(i)}const Yx=i=>i[0]==="_"||i==="$stable",$A=i=>xt(i)?i.map(Ls):[Ls(i)],RI=(i,e,t)=>{if(e._n)return e;const n=sI((...s)=>$A(e(...s)),t);return n._c=!1,n},Kx=(i,e,t)=>{const n=i._ctx;for(const s in i){if(Yx(s))continue;const r=i[s];if(Mt(r))e[s]=RI(s,r,n);else if(r!=null){const o=$A(r);e[s]=()=>o}}},$x=(i,e)=>{const t=$A(e);i.slots.default=()=>t},Jx=(i,e,t)=>{for(const n in e)(t||n!=="_")&&(i[n]=e[n])},PI=(i,e,t)=>{const n=i.slots=Wx();if(i.vnode.shapeFlag&32){const s=e._;s?(Jx(n,e,t),t&&nx(n,"_",s,!0)):Kx(e,n)}else e&&$x(i,e)},DI=(i,e,t)=>{const{vnode:n,slots:s}=i;let r=!0,o=sn;if(n.shapeFlag&32){const a=e._;a?t&&a===1?r=!1:Jx(s,e,t):(r=!e.$stable,Kx(e,s)),o=e}else e&&($x(i,e),o={default:1});if(r)for(const a in s)!Yx(a)&&o[a]==null&&delete s[a]},Oi=jI;function LI(i){return FI(i)}function FI(i,e){const t=Bd();t.__VUE__=!0;const{insert:n,remove:s,patchProp:r,createElement:o,createText:a,createComment:l,setText:c,setElementText:h,parentNode:u,nextSibling:d,setScopeId:f=Vs,insertStaticContent:p}=i,A=(F,Q,E,j=null,q=null,ce=null,G=void 0,V=null,re=!!Q.dynamicChildren)=>{if(F===Q)return;F&&!zl(F,Q)&&(j=D(F),de(F,q,ce,!0),F=null),Q.patchFlag===-2&&(re=!1,Q.dynamicChildren=null);const{type:k,ref:N,shapeFlag:oe}=Q;switch(k){case kd:m(F,Q,E,j);break;case Zo:g(F,Q,E,j);break;case Ef:F==null&&y(Q,E,j,G);break;case ws:z(F,Q,E,j,q,ce,G,V,re);break;default:oe&1?b(F,Q,E,j,q,ce,G,V,re):oe&6?H(F,Q,E,j,q,ce,G,V,re):(oe&64||oe&128)&&k.process(F,Q,E,j,q,ce,G,V,re,Z)}N!=null&&q&&Yu(N,F&&F.ref,ce,Q||F,!Q)},m=(F,Q,E,j)=>{if(F==null)n(Q.el=a(Q.children),E,j);else{const q=Q.el=F.el;Q.children!==F.children&&c(q,Q.children)}},g=(F,Q,E,j)=>{F==null?n(Q.el=l(Q.children||""),E,j):Q.el=F.el},y=(F,Q,E,j)=>{[F.el,F.anchor]=p(F.children,Q,E,j,F.el,F.anchor)},_=({el:F,anchor:Q},E,j)=>{let q;for(;F&&F!==Q;)q=d(F),n(F,E,j),F=q;n(Q,E,j)},v=({el:F,anchor:Q})=>{let E;for(;F&&F!==Q;)E=d(F),s(F),F=E;s(Q)},b=(F,Q,E,j,q,ce,G,V,re)=>{Q.type==="svg"?G="svg":Q.type==="math"&&(G="mathml"),F==null?T(Q,E,j,q,ce,G,V,re):x(F,Q,q,ce,G,V,re)},T=(F,Q,E,j,q,ce,G,V)=>{let re,k;const{props:N,shapeFlag:oe,transition:pe,dirs:ve}=F;if(re=F.el=o(F.type,ce,N&&N.is,N),oe&8?h(re,F.children):oe&16&&I(F.children,re,null,j,q,bf(F,ce),G,V),ve&&yo(F,null,j,"created"),L(re,F,F.scopeId,G,j),N){for(const Pe in N)Pe!=="value"&&!fc(Pe)&&r(re,Pe,null,N[Pe],ce,j);"value"in N&&r(re,"value",null,N.value,ce),(k=N.onVnodeBeforeMount)&&Ms(k,j,F)}ve&&yo(F,null,j,"beforeMount");const xe=NI(q,pe);xe&&pe.beforeEnter(re),n(re,Q,E),((k=N&&N.onVnodeMounted)||xe||ve)&&Oi(()=>{k&&Ms(k,j,F),xe&&pe.enter(re),ve&&yo(F,null,j,"mounted")},q)},L=(F,Q,E,j,q)=>{if(E&&f(F,E),j)for(let ce=0;ce<j.length;ce++)f(F,j[ce]);if(q){let ce=q.subTree;if(Q===ce||sw(ce.type)&&(ce.ssContent===Q||ce.ssFallback===Q)){const G=q.vnode;L(F,G,G.scopeId,G.slotScopeIds,q.parent)}}},I=(F,Q,E,j,q,ce,G,V,re=0)=>{for(let k=re;k<F.length;k++){const N=F[k]=V?Hr(F[k]):Ls(F[k]);A(null,N,Q,E,j,q,ce,G,V)}},x=(F,Q,E,j,q,ce,G)=>{const V=Q.el=F.el;let{patchFlag:re,dynamicChildren:k,dirs:N}=Q;re|=F.patchFlag&16;const oe=F.props||sn,pe=Q.props||sn;let ve;if(E&&xo(E,!1),(ve=pe.onVnodeBeforeUpdate)&&Ms(ve,E,Q,F),N&&yo(Q,F,E,"beforeUpdate"),E&&xo(E,!0),(oe.innerHTML&&pe.innerHTML==null||oe.textContent&&pe.textContent==null)&&h(V,""),k?w(F.dynamicChildren,k,V,E,j,bf(Q,q),ce):G||O(F,Q,V,null,E,j,bf(Q,q),ce,!1),re>0){if(re&16)P(V,oe,pe,E,q);else if(re&2&&oe.class!==pe.class&&r(V,"class",null,pe.class,q),re&4&&r(V,"style",oe.style,pe.style,q),re&8){const xe=Q.dynamicProps;for(let Pe=0;Pe<xe.length;Pe++){const Te=xe[Pe],Qe=oe[Te],lt=pe[Te];(lt!==Qe||Te==="value")&&r(V,Te,Qe,lt,q,E)}}re&1&&F.children!==Q.children&&h(V,Q.children)}else!G&&k==null&&P(V,oe,pe,E,q);((ve=pe.onVnodeUpdated)||N)&&Oi(()=>{ve&&Ms(ve,E,Q,F),N&&yo(Q,F,E,"updated")},j)},w=(F,Q,E,j,q,ce,G)=>{for(let V=0;V<Q.length;V++){const re=F[V],k=Q[V],N=re.el&&(re.type===ws||!zl(re,k)||re.shapeFlag&70)?u(re.el):E;A(re,k,N,null,j,q,ce,G,!0)}},P=(F,Q,E,j,q)=>{if(Q!==E){if(Q!==sn)for(const ce in Q)!fc(ce)&&!(ce in E)&&r(F,ce,Q[ce],null,q,j);for(const ce in E){if(fc(ce))continue;const G=E[ce],V=Q[ce];G!==V&&ce!=="value"&&r(F,ce,V,G,q,j)}"value"in E&&r(F,"value",Q.value,E.value,q)}},z=(F,Q,E,j,q,ce,G,V,re)=>{const k=Q.el=F?F.el:a(""),N=Q.anchor=F?F.anchor:a("");let{patchFlag:oe,dynamicChildren:pe,slotScopeIds:ve}=Q;ve&&(V=V?V.concat(ve):ve),F==null?(n(k,E,j),n(N,E,j),I(Q.children||[],E,N,q,ce,G,V,re)):oe>0&&oe&64&&pe&&F.dynamicChildren?(w(F.dynamicChildren,pe,E,q,ce,G,V),(Q.key!=null||q&&Q===q.subTree)&&Zx(F,Q,!0)):O(F,Q,E,N,q,ce,G,V,re)},H=(F,Q,E,j,q,ce,G,V,re)=>{Q.slotScopeIds=V,F==null?Q.shapeFlag&512?q.ctx.activate(Q,E,j,G,re):K(Q,E,j,q,ce,G,re):le(F,Q,re)},K=(F,Q,E,j,q,ce,G)=>{const V=F.component=tM(F,j,q);if(Nx(F)&&(V.ctx.renderer=Z),nM(V,!1,G),V.asyncDep){if(q&&q.registerDep(V,J,G),!F.el){const re=V.subTree=us(Zo);g(null,re,Q,E)}}else J(V,F,Q,E,q,ce,G)},le=(F,Q,E)=>{const j=Q.component=F.component;if(WI(F,Q,E))if(j.asyncDep&&!j.asyncResolved){W(j,Q,E);return}else j.next=Q,j.update();else Q.el=F.el,j.vnode=Q},J=(F,Q,E,j,q,ce,G)=>{const V=()=>{if(F.isMounted){let{next:oe,bu:pe,u:ve,parent:xe,vnode:Pe}=F;{const qe=ew(F);if(qe){oe&&(oe.el=Pe.el,W(F,oe,G)),qe.asyncDep.then(()=>{F.isUnmounted||V()});return}}let Te=oe,Qe;xo(F,!1),oe?(oe.el=Pe.el,W(F,oe,G)):oe=Pe,pe&&Ru(pe),(Qe=oe.props&&oe.props.onVnodeBeforeUpdate)&&Ms(Qe,xe,oe,Pe),xo(F,!0);const lt=Fv(F),Ne=F.subTree;F.subTree=lt,A(Ne,lt,u(Ne.el),D(Ne),F,q,ce),oe.el=lt.el,Te===null&&qI(F,lt.el),ve&&Oi(ve,q),(Qe=oe.props&&oe.props.onVnodeUpdated)&&Oi(()=>Ms(Qe,xe,oe,Pe),q)}else{let oe;const{el:pe,props:ve}=Q,{bm:xe,m:Pe,parent:Te,root:Qe,type:lt}=F,Ne=Ac(Q);xo(F,!1),xe&&Ru(xe),!Ne&&(oe=ve&&ve.onVnodeBeforeMount)&&Ms(oe,Te,Q),xo(F,!0);{Qe.ce&&Qe.ce._injectChildStyle(lt);const qe=F.subTree=Fv(F);A(null,qe,E,j,F,q,ce),Q.el=qe.el}if(Pe&&Oi(Pe,q),!Ne&&(oe=ve&&ve.onVnodeMounted)){const qe=Q;Oi(()=>Ms(oe,Te,qe),q)}(Q.shapeFlag&256||Te&&Ac(Te.vnode)&&Te.vnode.shapeFlag&256)&&F.a&&Oi(F.a,q),F.isMounted=!0,Q=E=j=null}};F.scope.on();const re=F.effect=new hx(V);F.scope.off();const k=F.update=re.run.bind(re),N=F.job=re.runIfDirty.bind(re);N.i=F,N.id=F.uid,re.scheduler=()=>YA(N),xo(F,!0),k()},W=(F,Q,E)=>{Q.component=F;const j=F.vnode.props;F.vnode=Q,F.next=null,TI(F,Q.props,j,E),DI(F,Q.children,E),mo(),Mv(F),Ao()},O=(F,Q,E,j,q,ce,G,V,re=!1)=>{const k=F&&F.children,N=F?F.shapeFlag:0,oe=Q.children,{patchFlag:pe,shapeFlag:ve}=Q;if(pe>0){if(pe&128){ue(k,oe,E,j,q,ce,G,V,re);return}else if(pe&256){fe(k,oe,E,j,q,ce,G,V,re);return}}ve&8?(N&16&&B(k,q,ce),oe!==k&&h(E,oe)):N&16?ve&16?ue(k,oe,E,j,q,ce,G,V,re):B(k,q,ce,!0):(N&8&&h(E,""),ve&16&&I(oe,E,j,q,ce,G,V,re))},fe=(F,Q,E,j,q,ce,G,V,re)=>{F=F||Ja,Q=Q||Ja;const k=F.length,N=Q.length,oe=Math.min(k,N);let pe;for(pe=0;pe<oe;pe++){const ve=Q[pe]=re?Hr(Q[pe]):Ls(Q[pe]);A(F[pe],ve,E,null,q,ce,G,V,re)}k>N?B(F,q,ce,!0,!1,oe):I(Q,E,j,q,ce,G,V,re,oe)},ue=(F,Q,E,j,q,ce,G,V,re)=>{let k=0;const N=Q.length;let oe=F.length-1,pe=N-1;for(;k<=oe&&k<=pe;){const ve=F[k],xe=Q[k]=re?Hr(Q[k]):Ls(Q[k]);if(zl(ve,xe))A(ve,xe,E,null,q,ce,G,V,re);else break;k++}for(;k<=oe&&k<=pe;){const ve=F[oe],xe=Q[pe]=re?Hr(Q[pe]):Ls(Q[pe]);if(zl(ve,xe))A(ve,xe,E,null,q,ce,G,V,re);else break;oe--,pe--}if(k>oe){if(k<=pe){const ve=pe+1,xe=ve<N?Q[ve].el:j;for(;k<=pe;)A(null,Q[k]=re?Hr(Q[k]):Ls(Q[k]),E,xe,q,ce,G,V,re),k++}}else if(k>pe)for(;k<=oe;)de(F[k],q,ce,!0),k++;else{const ve=k,xe=k,Pe=new Map;for(k=xe;k<=pe;k++){const je=Q[k]=re?Hr(Q[k]):Ls(Q[k]);je.key!=null&&Pe.set(je.key,k)}let Te,Qe=0;const lt=pe-xe+1;let Ne=!1,qe=0;const Ke=new Array(lt);for(k=0;k<lt;k++)Ke[k]=0;for(k=ve;k<=oe;k++){const je=F[k];if(Qe>=lt){de(je,q,ce,!0);continue}let dt;if(je.key!=null)dt=Pe.get(je.key);else for(Te=xe;Te<=pe;Te++)if(Ke[Te-xe]===0&&zl(je,Q[Te])){dt=Te;break}dt===void 0?de(je,q,ce,!0):(Ke[dt-xe]=k+1,dt>=qe?qe=dt:Ne=!0,A(je,Q[dt],E,null,q,ce,G,V,re),Qe++)}const it=Ne?kI(Ke):Ja;for(Te=it.length-1,k=lt-1;k>=0;k--){const je=xe+k,dt=Q[je],ct=je+1<N?Q[je+1].el:j;Ke[k]===0?A(null,dt,E,ct,q,ce,G,V,re):Ne&&(Te<0||k!==it[Te]?ee(dt,E,ct,2):Te--)}}},ee=(F,Q,E,j,q=null)=>{const{el:ce,type:G,transition:V,children:re,shapeFlag:k}=F;if(k&6){ee(F.component.subTree,Q,E,j);return}if(k&128){F.suspense.move(Q,E,j);return}if(k&64){G.move(F,Q,E,Z);return}if(G===ws){n(ce,Q,E);for(let oe=0;oe<re.length;oe++)ee(re[oe],Q,E,j);n(F.anchor,Q,E);return}if(G===Ef){_(F,Q,E);return}if(j!==2&&k&1&&V)if(j===0)V.beforeEnter(ce),n(ce,Q,E),Oi(()=>V.enter(ce),q);else{const{leave:oe,delayLeave:pe,afterLeave:ve}=V,xe=()=>n(ce,Q,E),Pe=()=>{oe(ce,()=>{xe(),ve&&ve()})};pe?pe(ce,xe,Pe):Pe()}else n(ce,Q,E)},de=(F,Q,E,j=!1,q=!1)=>{const{type:ce,props:G,ref:V,children:re,dynamicChildren:k,shapeFlag:N,patchFlag:oe,dirs:pe,cacheIndex:ve}=F;if(oe===-2&&(q=!1),V!=null&&Yu(V,null,E,F,!0),ve!=null&&(Q.renderCache[ve]=void 0),N&256){Q.ctx.deactivate(F);return}const xe=N&1&&pe,Pe=!Ac(F);let Te;if(Pe&&(Te=G&&G.onVnodeBeforeUnmount)&&Ms(Te,Q,F),N&6)M(F.component,E,j);else{if(N&128){F.suspense.unmount(E,j);return}xe&&yo(F,null,Q,"beforeUnmount"),N&64?F.type.remove(F,Q,E,Z,j):k&&!k.hasOnce&&(ce!==ws||oe>0&&oe&64)?B(k,Q,E,!1,!0):(ce===ws&&oe&384||!q&&N&16)&&B(re,Q,E),j&&ae(F)}(Pe&&(Te=G&&G.onVnodeUnmounted)||xe)&&Oi(()=>{Te&&Ms(Te,Q,F),xe&&yo(F,null,Q,"unmounted")},E)},ae=F=>{const{type:Q,el:E,anchor:j,transition:q}=F;if(Q===ws){R(E,j);return}if(Q===Ef){v(F);return}const ce=()=>{s(E),q&&!q.persisted&&q.afterLeave&&q.afterLeave()};if(F.shapeFlag&1&&q&&!q.persisted){const{leave:G,delayLeave:V}=q,re=()=>G(E,ce);V?V(F.el,ce,re):re()}else ce()},R=(F,Q)=>{let E;for(;F!==Q;)E=d(F),s(F),F=E;s(Q)},M=(F,Q,E)=>{const{bum:j,scope:q,job:ce,subTree:G,um:V,m:re,a:k}=F;Lv(re),Lv(k),j&&Ru(j),q.stop(),ce&&(ce.flags|=8,de(G,F,Q,E)),V&&Oi(V,Q),Oi(()=>{F.isUnmounted=!0},Q),Q&&Q.pendingBranch&&!Q.isUnmounted&&F.asyncDep&&!F.asyncResolved&&F.suspenseId===Q.pendingId&&(Q.deps--,Q.deps===0&&Q.resolve())},B=(F,Q,E,j=!1,q=!1,ce=0)=>{for(let G=ce;G<F.length;G++)de(F[G],Q,E,j,q)},D=F=>{if(F.shapeFlag&6)return D(F.component.subTree);if(F.shapeFlag&128)return F.suspense.next();const Q=d(F.anchor||F.el),E=Q&&Q[rI];return E?d(E):Q};let te=!1;const ie=(F,Q,E)=>{F==null?Q._vnode&&de(Q._vnode,null,null,!0):A(Q._vnode||null,F,Q,null,null,null,E),Q._vnode=F,te||(te=!0,Mv(),Rx(),te=!1)},Z={p:A,um:de,m:ee,r:ae,mt:K,mc:I,pc:O,pbc:w,n:D,o:i};return{render:ie,hydrate:void 0,createApp:CI(ie)}}function bf({type:i,props:e},t){return t==="svg"&&i==="foreignObject"||t==="mathml"&&i==="annotation-xml"&&e&&e.encoding&&e.encoding.includes("html")?void 0:t}function xo({effect:i,job:e},t){t?(i.flags|=32,e.flags|=4):(i.flags&=-33,e.flags&=-5)}function NI(i,e){return(!i||i&&!i.pendingBranch)&&e&&!e.persisted}function Zx(i,e,t=!1){const n=i.children,s=e.children;if(xt(n)&&xt(s))for(let r=0;r<n.length;r++){const o=n[r];let a=s[r];a.shapeFlag&1&&!a.dynamicChildren&&((a.patchFlag<=0||a.patchFlag===32)&&(a=s[r]=Hr(s[r]),a.el=o.el),!t&&a.patchFlag!==-2&&Zx(o,a)),a.type===kd&&(a.el=o.el)}}function kI(i){const e=i.slice(),t=[0];let n,s,r,o,a;const l=i.length;for(n=0;n<l;n++){const c=i[n];if(c!==0){if(s=t[t.length-1],i[s]<c){e[n]=s,t.push(n);continue}for(r=0,o=t.length-1;r<o;)a=r+o>>1,i[t[a]]<c?r=a+1:o=a;c<i[t[r]]&&(r>0&&(e[n]=t[r-1]),t[r]=n)}}for(r=t.length,o=t[r-1];r-- >0;)t[r]=o,o=e[o];return t}function ew(i){const e=i.subTree.component;if(e)return e.asyncDep&&!e.asyncResolved?e:ew(e)}function Lv(i){if(i)for(let e=0;e<i.length;e++)i[e].flags|=8}const OI=Symbol.for("v-scx"),UI=()=>vc(OI);function _c(i,e,t){return tw(i,e,t)}function tw(i,e,t=sn){const{immediate:n,deep:s,flush:r,once:o}=t,a=bi({},t),l=e&&n||!e&&r!=="post";let c;if(Gc){if(r==="sync"){const f=UI();c=f.__watcherHandles||(f.__watcherHandles=[])}else if(!l){const f=()=>{};return f.stop=Vs,f.resume=Vs,f.pause=Vs,f}}const h=li;a.call=(f,p,A)=>Hs(f,h,p,A);let u=!1;r==="post"?a.scheduler=f=>{Oi(f,h&&h.suspense)}:r!=="sync"&&(u=!0,a.scheduler=(f,p)=>{p?f():YA(f)}),a.augmentJob=f=>{e&&(f.flags|=4),u&&(f.flags|=2,h&&(f.id=h.uid,f.i=h))};const d=eI(i,e,a);return Gc&&(c?c.push(d):l&&d()),d}function QI(i,e,t){const n=this.proxy,s=kn(i)?i.includes(".")?nw(n,i):()=>n[i]:i.bind(n,n);let r;Mt(e)?r=e:(r=e.handler,t=e);const o=gh(this),a=tw(s,r.bind(n),t);return o(),a}function nw(i,e){const t=e.split(".");return()=>{let n=i;for(let s=0;s<t.length&&n;s++)n=n[t[s]];return n}}const VI=(i,e)=>e==="modelValue"||e==="model-value"?i.modelModifiers:i["".concat(e,"Modifiers")]||i["".concat(ao(e),"Modifiers")]||i["".concat(ha(e),"Modifiers")];function zI(i,e,...t){if(i.isUnmounted)return;const n=i.vnode.props||sn;let s=t;const r=e.startsWith("update:"),o=r&&VI(n,e.slice(7));o&&(o.trim&&(s=t.map(h=>kn(h)?h.trim():h)),o.number&&(s=t.map(im)));let a,l=n[a=gf(e)]||n[a=gf(ao(e))];!l&&r&&(l=n[a=gf(ha(e))]),l&&Hs(l,i,6,s);const c=n[a+"Once"];if(c){if(!i.emitted)i.emitted={};else if(i.emitted[a])return;i.emitted[a]=!0,Hs(c,i,6,s)}}function iw(i,e,t=!1){const n=e.emitsCache,s=n.get(i);if(s!==void 0)return s;const r=i.emits;let o={},a=!1;if(!Mt(i)){const l=c=>{const h=iw(c,e,!0);h&&(a=!0,bi(o,h))};!t&&e.mixins.length&&e.mixins.forEach(l),i.extends&&l(i.extends),i.mixins&&i.mixins.forEach(l)}return!r&&!a?(un(i)&&n.set(i,null),null):(xt(r)?r.forEach(l=>o[l]=null):bi(o,r),un(i)&&n.set(i,o),o)}function Nd(i,e){return!i||!Id(e)?!1:(e=e.slice(2).replace(/Once$/,""),qt(i,e[0].toLowerCase()+e.slice(1))||qt(i,ha(e))||qt(i,e))}function Fv(i){const{type:e,vnode:t,proxy:n,withProxy:s,propsOptions:[r],slots:o,attrs:a,emit:l,render:c,renderCache:h,props:u,data:d,setupState:f,ctx:p,inheritAttrs:A}=i,m=Xu(i);let g,y;try{if(t.shapeFlag&4){const v=s||n,b=v;g=Ls(c.call(b,v,h,u,f,d,p)),y=a}else{const v=e;g=Ls(v.length>1?v(u,{attrs:a,slots:o,emit:l}):v(u,null)),y=e.props?a:GI(a)}}catch(v){yc.length=0,Ld(v,i,1),g=us(Zo)}let _=g;if(y&&A!==!1){const v=Object.keys(y),{shapeFlag:b}=_;v.length&&b&7&&(r&&v.some(NA)&&(y=HI(y,r)),_=ml(_,y,!1,!0))}return t.dirs&&(_=ml(_,null,!1,!0),_.dirs=_.dirs?_.dirs.concat(t.dirs):t.dirs),t.transition&&KA(_,t.transition),g=_,Xu(m),g}const GI=i=>{let e;for(const t in i)(t==="class"||t==="style"||Id(t))&&((e||(e={}))[t]=i[t]);return e},HI=(i,e)=>{const t={};for(const n in i)(!NA(n)||!(n.slice(9)in e))&&(t[n]=i[n]);return t};function WI(i,e,t){const{props:n,children:s,component:r}=i,{props:o,children:a,patchFlag:l}=e,c=r.emitsOptions;if(e.dirs||e.transition)return!0;if(t&&l>=0){if(l&1024)return!0;if(l&16)return n?Nv(n,o,c):!!o;if(l&8){const h=e.dynamicProps;for(let u=0;u<h.length;u++){const d=h[u];if(o[d]!==n[d]&&!Nd(c,d))return!0}}}else return(s||a)&&(!a||!a.$stable)?!0:n===o?!1:n?o?Nv(n,o,c):!0:!!o;return!1}function Nv(i,e,t){const n=Object.keys(e);if(n.length!==Object.keys(i).length)return!0;for(let s=0;s<n.length;s++){const r=n[s];if(e[r]!==i[r]&&!Nd(t,r))return!0}return!1}function qI({vnode:i,parent:e},t){for(;e;){const n=e.subTree;if(n.suspense&&n.suspense.activeBranch===i&&(n.el=i.el),n===i)(i=e.vnode).el=t,e=e.parent;else break}}const sw=i=>i.__isSuspense;function jI(i,e){e&&e.pendingBranch?xt(i)?e.effects.push(...i):e.effects.push(i):iI(i)}const ws=Symbol.for("v-fgt"),kd=Symbol.for("v-txt"),Zo=Symbol.for("v-cmt"),Ef=Symbol.for("v-stc"),yc=[];let Gi=null;function ln(i=!1){yc.push(Gi=i?null:[])}function XI(){yc.pop(),Gi=yc[yc.length-1]||null}let zc=1;function kv(i,e=!1){zc+=i,i<0&&Gi&&e&&(Gi.hasOnce=!0)}function rw(i){return i.dynamicChildren=zc>0?Gi||Ja:null,XI(),zc>0&&Gi&&Gi.push(i),i}function En(i,e,t,n,s,r){return rw(ft(i,e,t,n,s,r,!0))}function $u(i,e,t,n,s){return rw(us(i,e,t,n,s,!0))}function ow(i){return i?i.__v_isVNode===!0:!1}function zl(i,e){return i.type===e.type&&i.key===e.key}const aw=({key:i})=>i!=null?i:null,Pu=({ref:i,ref_key:e,ref_for:t})=>(typeof i=="number"&&(i=""+i),i!=null?kn(i)||yn(i)||Mt(i)?{i:zi,r:i,k:e,f:!!t}:i:null);function ft(i,e=null,t=null,n=0,s=null,r=i===ws?0:1,o=!1,a=!1){const l={__v_isVNode:!0,__v_skip:!0,type:i,props:e,key:e&&aw(e),ref:e&&Pu(e),scopeId:Dx,slotScopeIds:null,children:t,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetStart:null,targetAnchor:null,staticCount:0,shapeFlag:r,patchFlag:n,dynamicProps:s,dynamicChildren:null,appContext:null,ctx:zi};return a?(JA(l,t),r&128&&i.normalize(l)):t&&(l.shapeFlag|=kn(t)?8:16),zc>0&&!o&&Gi&&(l.patchFlag>0||r&6)&&l.patchFlag!==32&&Gi.push(l),l}const us=YI;function YI(i,e=null,t=null,n=0,s=null,r=!1){if((!i||i===gI)&&(i=Zo),ow(i)){const a=ml(i,e,!0);return t&&JA(a,t),zc>0&&!r&&Gi&&(a.shapeFlag&6?Gi[Gi.indexOf(i)]=a:Gi.push(a)),a.patchFlag=-2,a}if(oM(i)&&(i=i.__vccOpts),e){e=KI(e);let{class:a,style:l}=e;a&&!kn(a)&&(e.class=QA(a)),un(l)&&(jA(l)&&!xt(l)&&(l=bi({},l)),e.style=UA(l))}const o=kn(i)?1:sw(i)?128:oI(i)?64:un(i)?4:Mt(i)?2:0;return ft(i,e,t,n,s,o,r,!0)}function KI(i){return i?jA(i)||qx(i)?bi({},i):i:null}function ml(i,e,t=!1,n=!1){const{props:s,ref:r,patchFlag:o,children:a,transition:l}=i,c=e?JI(s||{},e):s,h={__v_isVNode:!0,__v_skip:!0,type:i.type,props:c,key:c&&aw(c),ref:e&&e.ref?t&&r?xt(r)?r.concat(Pu(e)):[r,Pu(e)]:Pu(e):r,scopeId:i.scopeId,slotScopeIds:i.slotScopeIds,children:a,target:i.target,targetStart:i.targetStart,targetAnchor:i.targetAnchor,staticCount:i.staticCount,shapeFlag:i.shapeFlag,patchFlag:e&&i.type!==ws?o===-1?16:o|16:o,dynamicProps:i.dynamicProps,dynamicChildren:i.dynamicChildren,appContext:i.appContext,dirs:i.dirs,transition:l,component:i.component,suspense:i.suspense,ssContent:i.ssContent&&ml(i.ssContent),ssFallback:i.ssFallback&&ml(i.ssFallback),el:i.el,anchor:i.anchor,ctx:i.ctx,ce:i.ce};return l&&n&&KA(h,l.clone(h)),h}function $I(i=" ",e=0){return us(kd,null,i,e)}function tl(i="",e=!1){return e?(ln(),$u(Zo,null,i)):us(Zo,null,i)}function Ls(i){return i==null||typeof i=="boolean"?us(Zo):xt(i)?us(ws,null,i.slice()):ow(i)?Hr(i):us(kd,null,String(i))}function Hr(i){return i.el===null&&i.patchFlag!==-1||i.memo?i:ml(i)}function JA(i,e){let t=0;const{shapeFlag:n}=i;if(e==null)e=null;else if(xt(e))t=16;else if(typeof e=="object")if(n&65){const s=e.default;s&&(s._c&&(s._d=!1),JA(i,s()),s._c&&(s._d=!0));return}else{t=32;const s=e._;!s&&!qx(e)?e._ctx=zi:s===3&&zi&&(zi.slots._===1?e._=1:(e._=2,i.patchFlag|=1024))}else Mt(e)?(e={default:e,_ctx:zi},t=32):(e=String(e),n&64?(t=16,e=[$I(e)]):t=8);i.children=e,i.shapeFlag|=t}function JI(...i){const e={};for(let t=0;t<i.length;t++){const n=i[t];for(const s in n)if(s==="class")e.class!==n.class&&(e.class=QA([e.class,n.class]));else if(s==="style")e.style=UA([e.style,n.style]);else if(Id(s)){const r=e[s],o=n[s];o&&r!==o&&!(xt(r)&&r.includes(o))&&(e[s]=r?[].concat(r,o):o)}else s!==""&&(e[s]=n[s])}return e}function Ms(i,e,t,n=null){Hs(i,e,7,[t,n])}const ZI=Gx();let eM=0;function tM(i,e,t){const n=i.type,s=(e?e.appContext:i.appContext)||ZI,r={uid:eM++,vnode:i,type:n,parent:e,appContext:s,root:null,next:null,subTree:null,effect:null,update:null,job:null,scope:new ax(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:e?e.provides:Object.create(s.provides),ids:e?e.ids:["",0,0],accessCache:null,renderCache:[],components:null,directives:null,propsOptions:Xx(n,s),emitsOptions:iw(n,s),emit:null,emitted:null,propsDefaults:sn,inheritAttrs:n.inheritAttrs,ctx:sn,data:sn,props:sn,attrs:sn,slots:sn,refs:sn,setupState:sn,setupContext:null,suspense:t,suspenseId:t?t.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return r.ctx={_:r},r.root=e?e.root:r,r.emit=zI.bind(null,r),i.ce&&i.ce(r),r}let li=null,Ju,dm;{const i=Bd(),e=(t,n)=>{let s;return(s=i[t])||(s=i[t]=[]),s.push(n),r=>{s.length>1?s.forEach(o=>o(r)):s[0](r)}};Ju=e("__VUE_INSTANCE_SETTERS__",t=>li=t),dm=e("__VUE_SSR_SETTERS__",t=>Gc=t)}const gh=i=>{const e=li;return Ju(i),i.scope.on(),()=>{i.scope.off(),Ju(e)}},Ov=()=>{li&&li.scope.off(),Ju(null)};function lw(i){return i.vnode.shapeFlag&4}let Gc=!1;function nM(i,e=!1,t=!1){e&&dm(e);const{props:n,children:s}=i.vnode,r=lw(i);MI(i,n,r,e),PI(i,s,t);const o=r?iM(i,e):void 0;return e&&dm(!1),o}function iM(i,e){const t=i.type;i.accessCache=Object.create(null),i.proxy=new Proxy(i.ctx,vI);const{setup:n}=t;if(n){mo();const s=i.setupContext=n.length>1?rM(i):null,r=gh(i),o=Ah(n,i,0,[i.props,s]),a=Jy(o);if(Ao(),r(),(a||i.sp)&&!Ac(i)&&Fx(i),a){if(o.then(Ov,Ov),e)return o.then(l=>{Uv(i,l)}).catch(l=>{Ld(l,i,0)});i.asyncDep=o}else Uv(i,o)}else cw(i)}function Uv(i,e,t){Mt(e)?i.type.__ssrInlineRender?i.ssrRender=e:i.render=e:un(e)&&(i.setupState=Sx(e)),cw(i)}function cw(i,e,t){const n=i.type;i.render||(i.render=n.render||Vs);{const s=gh(i);mo();try{_I(i)}finally{Ao(),s()}}}const sM={get(i,e){return ri(i,"get",""),i[e]}};function rM(i){const e=t=>{i.exposed=t||{}};return{attrs:new Proxy(i.attrs,sM),slots:i.slots,emit:i.emit,expose:e}}function Od(i){return i.exposed?i.exposeProxy||(i.exposeProxy=new Proxy(Sx(XA(i.exposed)),{get(e,t){if(t in e)return e[t];if(t in gc)return gc[t](i)},has(e,t){return t in e||t in gc}})):i.proxy}function oM(i){return Mt(i)&&"__vccOpts"in i}const ZA=(i,e)=>JS(i,e,Gc),aM="3.5.13";/**
* @vue/runtime-dom v3.5.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let fm;const Qv=typeof window<"u"&&window.trustedTypes;if(Qv)try{fm=Qv.createPolicy("vue",{createHTML:i=>i})}catch(i){}const hw=fm?i=>fm.createHTML(i):i=>i,lM="http://www.w3.org/2000/svg",cM="http://www.w3.org/1998/Math/MathML",ar=typeof document<"u"?document:null,Vv=ar&&ar.createElement("template"),hM={insert:(i,e,t)=>{e.insertBefore(i,t||null)},remove:i=>{const e=i.parentNode;e&&e.removeChild(i)},createElement:(i,e,t,n)=>{const s=e==="svg"?ar.createElementNS(lM,i):e==="mathml"?ar.createElementNS(cM,i):t?ar.createElement(i,{is:t}):ar.createElement(i);return i==="select"&&n&&n.multiple!=null&&s.setAttribute("multiple",n.multiple),s},createText:i=>ar.createTextNode(i),createComment:i=>ar.createComment(i),setText:(i,e)=>{i.nodeValue=e},setElementText:(i,e)=>{i.textContent=e},parentNode:i=>i.parentNode,nextSibling:i=>i.nextSibling,querySelector:i=>ar.querySelector(i),setScopeId(i,e){i.setAttribute(e,"")},insertStaticContent(i,e,t,n,s,r){const o=t?t.previousSibling:e.lastChild;if(s&&(s===r||s.nextSibling))for(;e.insertBefore(s.cloneNode(!0),t),!(s===r||!(s=s.nextSibling)););else{Vv.innerHTML=hw(n==="svg"?"<svg>".concat(i,"</svg>"):n==="mathml"?"<math>".concat(i,"</math>"):i);const a=Vv.content;if(n==="svg"||n==="mathml"){const l=a.firstChild;for(;l.firstChild;)a.appendChild(l.firstChild);a.removeChild(l)}e.insertBefore(a,t)}return[o?o.nextSibling:e.firstChild,t?t.previousSibling:e.lastChild]}},uM=Symbol("_vtc");function dM(i,e,t){const n=i[uM];n&&(e=(e?[e,...n]:[...n]).join(" ")),e==null?i.removeAttribute("class"):t?i.setAttribute("class",e):i.className=e}const zv=Symbol("_vod"),fM=Symbol("_vsh"),pM=Symbol(""),mM=/(^|;)\s*display\s*:/;function AM(i,e,t){const n=i.style,s=kn(t);let r=!1;if(t&&!s){if(e)if(kn(e))for(const o of e.split(";")){const a=o.slice(0,o.indexOf(":")).trim();t[a]==null&&Du(n,a,"")}else for(const o in e)t[o]==null&&Du(n,o,"");for(const o in t)o==="display"&&(r=!0),Du(n,o,t[o])}else if(s){if(e!==t){const o=n[pM];o&&(t+=";"+o),n.cssText=t,r=mM.test(t)}}else e&&i.removeAttribute("style");zv in i&&(i[zv]=r?n.display:"",i[fM]&&(n.display="none"))}const Gv=/\s*!important$/;function Du(i,e,t){if(xt(t))t.forEach(n=>Du(i,e,n));else if(t==null&&(t=""),e.startsWith("--"))i.setProperty(e,t);else{const n=gM(i,e);Gv.test(t)?i.setProperty(ha(n),t.replace(Gv,""),"important"):i[n]=t}}const Hv=["Webkit","Moz","ms"],Cf={};function gM(i,e){const t=Cf[e];if(t)return t;let n=ao(e);if(n!=="filter"&&n in i)return Cf[e]=n;n=tx(n);for(let s=0;s<Hv.length;s++){const r=Hv[s]+n;if(r in i)return Cf[e]=r}return e}const Wv="http://www.w3.org/1999/xlink";function qv(i,e,t,n,s,r=xS(e)){n&&e.startsWith("xlink:")?t==null?i.removeAttributeNS(Wv,e.slice(6,e.length)):i.setAttributeNS(Wv,e,t):t==null||r&&!ix(t)?i.removeAttribute(e):i.setAttribute(e,r?"":Gs(t)?String(t):t)}function jv(i,e,t,n,s){if(e==="innerHTML"||e==="textContent"){t!=null&&(i[e]=e==="innerHTML"?hw(t):t);return}const r=i.tagName;if(e==="value"&&r!=="PROGRESS"&&!r.includes("-")){const a=r==="OPTION"?i.getAttribute("value")||"":i.value,l=t==null?i.type==="checkbox"?"on":"":String(t);(a!==l||!("_value"in i))&&(i.value=l),t==null&&i.removeAttribute(e),i._value=t;return}let o=!1;if(t===""||t==null){const a=typeof i[e];a==="boolean"?t=ix(t):t==null&&a==="string"?(t="",o=!0):a==="number"&&(t=0,o=!0)}try{i[e]=t}catch(a){}o&&i.removeAttribute(s||e)}function ko(i,e,t,n){i.addEventListener(e,t,n)}function vM(i,e,t,n){i.removeEventListener(e,t,n)}const Xv=Symbol("_vei");function _M(i,e,t,n,s=null){const r=i[Xv]||(i[Xv]={}),o=r[e];if(n&&o)o.value=n;else{const[a,l]=yM(e);if(n){const c=r[e]=bM(n,s);ko(i,a,c,l)}else o&&(vM(i,a,o,l),r[e]=void 0)}}const Yv=/(?:Once|Passive|Capture)$/;function yM(i){let e;if(Yv.test(i)){e={};let n;for(;n=i.match(Yv);)i=i.slice(0,i.length-n[0].length),e[n[0].toLowerCase()]=!0}return[i[2]===":"?i.slice(3):ha(i.slice(2)),e]}let Sf=0;const xM=Promise.resolve(),wM=()=>Sf||(xM.then(()=>Sf=0),Sf=Date.now());function bM(i,e){const t=n=>{if(!n._vts)n._vts=Date.now();else if(n._vts<=t.attached)return;Hs(EM(n,t.value),e,5,[n])};return t.value=i,t.attached=wM(),t}function EM(i,e){if(xt(e)){const t=i.stopImmediatePropagation;return i.stopImmediatePropagation=()=>{t.call(i),i._stopped=!0},e.map(n=>s=>!s._stopped&&n&&n(s))}else return e}const Kv=i=>i.charCodeAt(0)===111&&i.charCodeAt(1)===110&&i.charCodeAt(2)>96&&i.charCodeAt(2)<123,CM=(i,e,t,n,s,r)=>{const o=s==="svg";e==="class"?dM(i,n,o):e==="style"?AM(i,t,n):Id(e)?NA(e)||_M(i,e,t,n,r):(e[0]==="."?(e=e.slice(1),!0):e[0]==="^"?(e=e.slice(1),!1):SM(i,e,n,o))?(jv(i,e,n),!i.tagName.includes("-")&&(e==="value"||e==="checked"||e==="selected")&&qv(i,e,n,o,r,e!=="value")):i._isVueCE&&(/[A-Z]/.test(e)||!kn(n))?jv(i,ao(e),n,r,e):(e==="true-value"?i._trueValue=n:e==="false-value"&&(i._falseValue=n),qv(i,e,n,o))};function SM(i,e,t,n){if(n)return!!(e==="innerHTML"||e==="textContent"||e in i&&Kv(e)&&Mt(t));if(e==="spellcheck"||e==="draggable"||e==="translate"||e==="form"||e==="list"&&i.tagName==="INPUT"||e==="type"&&i.tagName==="TEXTAREA")return!1;if(e==="width"||e==="height"){const s=i.tagName;if(s==="IMG"||s==="VIDEO"||s==="CANVAS"||s==="SOURCE")return!1}return Kv(e)&&kn(t)?!1:e in i}const Zu=i=>{const e=i.props["onUpdate:modelValue"]||!1;return xt(e)?t=>Ru(e,t):e};function IM(i){i.target.composing=!0}function $v(i){const e=i.target;e.composing&&(e.composing=!1,e.dispatchEvent(new Event("input")))}const nl=Symbol("_assign"),MM={created(i,{modifiers:{lazy:e,trim:t,number:n}},s){i[nl]=Zu(s);const r=n||s.props&&s.props.type==="number";ko(i,e?"change":"input",o=>{if(o.target.composing)return;let a=i.value;t&&(a=a.trim()),r&&(a=im(a)),i[nl](a)}),t&&ko(i,"change",()=>{i.value=i.value.trim()}),e||(ko(i,"compositionstart",IM),ko(i,"compositionend",$v),ko(i,"change",$v))},mounted(i,{value:e}){i.value=e==null?"":e},beforeUpdate(i,{value:e,oldValue:t,modifiers:{lazy:n,trim:s,number:r}},o){if(i[nl]=Zu(o),i.composing)return;const a=(r||i.type==="number")&&!/^0\d/.test(i.value)?im(i.value):i.value,l=e==null?"":e;a!==l&&(document.activeElement===i&&i.type!=="range"&&(n&&e===t||s&&i.value.trim()===l)||(i.value=l))}},TM={deep:!0,created(i,e,t){i[nl]=Zu(t),ko(i,"change",()=>{const n=i._modelValue,s=BM(i),r=i.checked,o=i[nl];if(xt(n)){const a=sx(n,s),l=a!==-1;if(r&&!l)o(n.concat(s));else if(!r&&l){const c=[...n];c.splice(a,1),o(c)}}else if(Md(n)){const a=new Set(n);r?a.add(s):a.delete(s),o(a)}else o(uw(i,r))})},mounted:Jv,beforeUpdate(i,e,t){i[nl]=Zu(t),Jv(i,e,t)}};function Jv(i,{value:e,oldValue:t},n){i._modelValue=e;let s;if(xt(e))s=sx(e,n.props.value)>-1;else if(Md(e))s=e.has(n.props.value);else{if(e===t)return;s=Rd(e,uw(i,!0))}i.checked!==s&&(i.checked=s)}function BM(i){return"_value"in i?i._value:i.value}function uw(i,e){const t=e?"_trueValue":"_falseValue";return t in i?i[t]:e}const RM=bi({patchProp:CM},hM);let Zv;function PM(){return Zv||(Zv=LI(RM))}const DM=(...i)=>{const e=PM().createApp(...i),{mount:t}=e;return e.mount=n=>{const s=FM(n);if(!s)return;const r=e._component;!Mt(r)&&!r.render&&!r.template&&(r.template=s.innerHTML),s.nodeType===1&&(s.textContent="");const o=t(s,!1,LM(s));return s instanceof Element&&(s.removeAttribute("v-cloak"),s.setAttribute("data-v-app","")),o},e};function LM(i){if(i instanceof SVGElement)return"svg";if(typeof MathMLElement=="function"&&i instanceof MathMLElement)return"mathml"}function FM(i){return kn(i)?document.querySelector(i):i}/*!
 * pinia v3.0.2
 * (c) 2025 Eduardo San Martin Morote
 * @license MIT
 */let dw;const Ud=i=>dw=i,fw=Symbol();function pm(i){return i&&typeof i=="object"&&Object.prototype.toString.call(i)==="[object Object]"&&typeof i.toJSON!="function"}var xc;(function(i){i.direct="direct",i.patchObject="patch object",i.patchFunction="patch function"})(xc||(xc={}));function NM(){const i=lx(!0),e=i.run(()=>cn({}));let t=[],n=[];const s=XA({install(r){Ud(s),s._a=r,r.provide(fw,s),r.config.globalProperties.$pinia=s,n.forEach(o=>t.push(o)),n=[]},use(r){return this._a?t.push(r):n.push(r),this},_p:t,_a:null,_e:i,_s:new Map,state:e});return s}const pw=()=>{};function e_(i,e,t,n=pw){i.push(e);const s=()=>{const r=i.indexOf(e);r>-1&&(i.splice(r,1),n())};return!t&&cx()&&bS(s),s}function ga(i,...e){i.slice().forEach(t=>{t(...e)})}const kM=i=>i(),t_=Symbol(),If=Symbol();function mm(i,e){i instanceof Map&&e instanceof Map?e.forEach((t,n)=>i.set(n,t)):i instanceof Set&&e instanceof Set&&e.forEach(i.add,i);for(const t in e){if(!e.hasOwnProperty(t))continue;const n=e[t],s=i[t];pm(s)&&pm(n)&&i.hasOwnProperty(t)&&!yn(n)&&!gr(n)?i[t]=mm(s,n):i[t]=n}return i}const OM=Symbol();function UM(i){return!pm(i)||!Object.prototype.hasOwnProperty.call(i,OM)}const{assign:Ur}=Object;function QM(i){return!!(yn(i)&&i.effect)}function VM(i,e,t,n){const{state:s,actions:r,getters:o}=e,a=t.state.value[i];let l;function c(){a||(t.state.value[i]=s?s():{});const h=jS(t.state.value[i]);return Ur(h,r,Object.keys(o||{}).reduce((u,d)=>(u[d]=XA(ZA(()=>{Ud(t);const f=t._s.get(i);return o[d].call(f,f)})),u),{}))}return l=mw(i,c,e,t,n,!0),l}function mw(i,e,t={},n,s,r){let o;const a=Ur({actions:{}},t),l={deep:!0};let c,h,u=[],d=[],f;const p=n.state.value[i];!r&&!p&&(n.state.value[i]={}),cn({});let A;function m(I){let x;c=h=!1,typeof I=="function"?(I(n.state.value[i]),x={type:xc.patchFunction,storeId:i,events:f}):(mm(n.state.value[i],I),x={type:xc.patchObject,payload:I,storeId:i,events:f});const w=A=Symbol();Tx().then(()=>{A===w&&(c=!0)}),h=!0,ga(u,x,n.state.value[i])}const g=r?function(){const{state:x}=t,w=x?x():{};this.$patch(P=>{Ur(P,w)})}:pw;function y(){o.stop(),u=[],d=[],n._s.delete(i)}const _=(I,x="")=>{if(t_ in I)return I[If]=x,I;const w=function(){Ud(n);const P=Array.from(arguments),z=[],H=[];function K(W){z.push(W)}function le(W){H.push(W)}ga(d,{args:P,name:w[If],store:b,after:K,onError:le});let J;try{J=I.apply(this&&this.$id===i?this:b,P)}catch(W){throw ga(H,W),W}return J instanceof Promise?J.then(W=>(ga(z,W),W)).catch(W=>(ga(H,W),Promise.reject(W))):(ga(z,J),J)};return w[t_]=!0,w[If]=x,w},v={_p:n,$id:i,$onAction:e_.bind(null,d),$patch:m,$reset:g,$subscribe(I,x={}){const w=e_(u,I,x.detached,()=>P()),P=o.run(()=>_c(()=>n.state.value[i],z=>{(x.flush==="sync"?h:c)&&I({storeId:i,type:xc.direct,events:f},z)},Ur({},l,x)));return w},$dispose:y},b=Dd(v);n._s.set(i,b);const L=(n._a&&n._a.runWithContext||kM)(()=>n._e.run(()=>(o=lx()).run(()=>e({action:_}))));for(const I in L){const x=L[I];if(yn(x)&&!QM(x)||gr(x))r||(p&&UM(x)&&(yn(x)?x.value=p[I]:mm(x,p[I])),n.state.value[i][I]=x);else if(typeof x=="function"){const w=_(x,I);L[I]=w,a.actions[I]=x}}return Ur(b,L),Ur(Qt(b),L),Object.defineProperty(b,"$state",{get:()=>n.state.value[i],set:I=>{m(x=>{Ur(x,I)})}}),n._p.forEach(I=>{Ur(b,o.run(()=>I({store:b,app:n._a,pinia:n,options:a})))}),p&&r&&t.hydrate&&t.hydrate(b.$state,p),c=!0,h=!0,b}/*! #__NO_SIDE_EFFECTS__ */function zM(i,e,t){let n;const s=typeof e=="function";n=s?t:e;function r(o,a){const l=II();return o=o||(l?vc(fw,null):null),o&&Ud(o),o=dw,o._s.has(i)||(s?mw(i,e,n,o):VM(i,n,o)),o._s.get(i)}return r.$id=i,r}function Qd(i){const e=Qt(i),t={};for(const n in e){const s=e[n];s.effect?t[n]=ZA({get:()=>i[n],set(r){i[n]=r}}):(yn(s)||gr(s))&&(t[n]=KS(i,n))}return t}/**
 * @license
 * Copyright 2010-2024 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const eg="172",ds={ROTATE:0,DOLLY:1,PAN:2},Ha={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},GM=0,n_=1,HM=2,Aw=1,gw=2,rr=3,yr=0,Ti=1,Ns=2,eo=0,il=1,i_=2,s_=3,r_=4,WM=5,Oo=100,qM=101,jM=102,XM=103,YM=104,KM=200,$M=201,JM=202,ZM=203,Am=204,gm=205,eT=206,tT=207,nT=208,iT=209,sT=210,rT=211,oT=212,aT=213,lT=214,vm=0,_m=1,ym=2,Al=3,xm=4,wm=5,bm=6,Em=7,Vd=0,cT=1,hT=2,to=0,uT=1,dT=2,fT=3,vw=4,pT=5,mT=6,AT=7,o_="attached",gT="detached",_w=300,ea=301,gl=302,ed=303,Cm=304,zd=306,lo=1e3,Hi=1001,td=1002,yi=1003,yw=1004,oc=1005,Zt=1006,Lu=1007,os=1008,Kn=1009,xw=1010,ww=1011,Hc=1012,tg=1013,ta=1014,Sn=1015,Gn=1016,ng=1017,ig=1018,vl=1020,bw=35902,Ew=1021,sg=1022,Hn=1023,Cw=1024,Sw=1025,sl=1026,_l=1027,mr=1028,rg=1029,Vo=1030,og=1031,ag=1033,Fu=33776,wc=33777,Nu=33778,bc=33779,nd=35840,Sm=35841,id=35842,Im=35843,sd=36196,rd=37492,od=37496,Wc=37808,Mm=37809,Tm=37810,Bm=37811,qc=37812,Rm=37813,Pm=37814,Dm=37815,Lm=37816,Fm=37817,Nm=37818,km=37819,Om=37820,Um=37821,Ec=36492,Qm=36494,ad=36495,Iw=36283,Vm=36284,zm=36285,Gm=36286,jc=2300,Xc=2301,Mf=2302,a_=2400,l_=2401,c_=2402,vT=2500,_T=0,Mw=1,Hm=2,yT=3200,xT=3201,vh=0,wT=1,bs="",Ft="srgb",On="srgb-linear",ld="linear",Kt="srgb",va=7680,h_=519,bT=512,ET=513,CT=514,Tw=515,ST=516,IT=517,MT=518,TT=519,Wm=35044,u_="300 es",Os=2e3,cd=2001;class ua{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});const n=this._listeners;n[e]===void 0&&(n[e]=[]),n[e].indexOf(t)===-1&&n[e].push(t)}hasEventListener(e,t){if(this._listeners===void 0)return!1;const n=this._listeners;return n[e]!==void 0&&n[e].indexOf(t)!==-1}removeEventListener(e,t){if(this._listeners===void 0)return;const s=this._listeners[e];if(s!==void 0){const r=s.indexOf(t);r!==-1&&s.splice(r,1)}}dispatchEvent(e){if(this._listeners===void 0)return;const n=this._listeners[e.type];if(n!==void 0){e.target=this;const s=n.slice(0);for(let r=0,o=s.length;r<o;r++)s[r].call(this,e);e.target=null}}}const ii=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let d_=1234567;const Cc=Math.PI/180,yl=180/Math.PI;function fs(){const i=Math.random()*4294967295|0,e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,n=Math.random()*4294967295|0;return(ii[i&255]+ii[i>>8&255]+ii[i>>16&255]+ii[i>>24&255]+"-"+ii[e&255]+ii[e>>8&255]+"-"+ii[e>>16&15|64]+ii[e>>24&255]+"-"+ii[t&63|128]+ii[t>>8&255]+"-"+ii[t>>16&255]+ii[t>>24&255]+ii[n&255]+ii[n>>8&255]+ii[n>>16&255]+ii[n>>24&255]).toLowerCase()}function It(i,e,t){return Math.max(e,Math.min(t,i))}function lg(i,e){return(i%e+e)%e}function BT(i,e,t,n,s){return n+(i-e)*(s-n)/(t-e)}function RT(i,e,t){return i!==e?(t-i)/(e-i):0}function Sc(i,e,t){return(1-t)*i+t*e}function PT(i,e,t,n){return Sc(i,e,1-Math.exp(-t*n))}function DT(i,e=1){return e-Math.abs(lg(i,e*2)-e)}function LT(i,e,t){return i<=e?0:i>=t?1:(i=(i-e)/(t-e),i*i*(3-2*i))}function FT(i,e,t){return i<=e?0:i>=t?1:(i=(i-e)/(t-e),i*i*i*(i*(i*6-15)+10))}function NT(i,e){return i+Math.floor(Math.random()*(e-i+1))}function kT(i,e){return i+Math.random()*(e-i)}function OT(i){return i*(.5-Math.random())}function UT(i){i!==void 0&&(d_=i);let e=d_+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}function QT(i){return i*Cc}function VT(i){return i*yl}function zT(i){return(i&i-1)===0&&i!==0}function GT(i){return Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))}function HT(i){return Math.pow(2,Math.floor(Math.log(i)/Math.LN2))}function WT(i,e,t,n,s){const r=Math.cos,o=Math.sin,a=r(t/2),l=o(t/2),c=r((e+n)/2),h=o((e+n)/2),u=r((e-n)/2),d=o((e-n)/2),f=r((n-e)/2),p=o((n-e)/2);switch(s){case"XYX":i.set(a*h,l*u,l*d,a*c);break;case"YZY":i.set(l*d,a*h,l*u,a*c);break;case"ZXZ":i.set(l*u,l*d,a*h,a*c);break;case"XZX":i.set(a*h,l*p,l*f,a*c);break;case"YXY":i.set(l*f,a*h,l*p,a*c);break;case"ZYZ":i.set(l*p,l*f,a*h,a*c);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+s)}}function Es(i,e){switch(e.constructor){case Float32Array:return i;case Uint32Array:return i/4294967295;case Uint16Array:return i/65535;case Uint8Array:return i/255;case Int32Array:return Math.max(i/2147483647,-1);case Int16Array:return Math.max(i/32767,-1);case Int8Array:return Math.max(i/127,-1);default:throw new Error("Invalid component type.")}}function Yt(i,e){switch(e.constructor){case Float32Array:return i;case Uint32Array:return Math.round(i*4294967295);case Uint16Array:return Math.round(i*65535);case Uint8Array:return Math.round(i*255);case Int32Array:return Math.round(i*2147483647);case Int16Array:return Math.round(i*32767);case Int8Array:return Math.round(i*127);default:throw new Error("Invalid component type.")}}const bn={DEG2RAD:Cc,RAD2DEG:yl,generateUUID:fs,clamp:It,euclideanModulo:lg,mapLinear:BT,inverseLerp:RT,lerp:Sc,damp:PT,pingpong:DT,smoothstep:LT,smootherstep:FT,randInt:NT,randFloat:kT,randFloatSpread:OT,seededRandom:UT,degToRad:QT,radToDeg:VT,isPowerOfTwo:zT,ceilPowerOfTwo:GT,floorPowerOfTwo:HT,setQuaternionFromProperEuler:WT,normalize:Yt,denormalize:Es};class Me{constructor(e=0,t=0){Me.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,n=this.y,s=e.elements;return this.x=s[0]*t+s[3]*n+s[6],this.y=s[1]*t+s[4]*n+s[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=It(this.x,e.x,t.x),this.y=It(this.y,e.y,t.y),this}clampScalar(e,t){return this.x=It(this.x,e,t),this.y=It(this.y,e,t),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(It(n,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(It(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y;return t*t+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const n=Math.cos(t),s=Math.sin(t),r=this.x-e.x,o=this.y-e.y;return this.x=r*n-o*s+e.x,this.y=r*s+o*n+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class wt{constructor(e,t,n,s,r,o,a,l,c){wt.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,t,n,s,r,o,a,l,c)}set(e,t,n,s,r,o,a,l,c){const h=this.elements;return h[0]=e,h[1]=s,h[2]=a,h[3]=t,h[4]=r,h[5]=l,h[6]=n,h[7]=o,h[8]=c,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this}extractBasis(e,t,n){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,s=t.elements,r=this.elements,o=n[0],a=n[3],l=n[6],c=n[1],h=n[4],u=n[7],d=n[2],f=n[5],p=n[8],A=s[0],m=s[3],g=s[6],y=s[1],_=s[4],v=s[7],b=s[2],T=s[5],L=s[8];return r[0]=o*A+a*y+l*b,r[3]=o*m+a*_+l*T,r[6]=o*g+a*v+l*L,r[1]=c*A+h*y+u*b,r[4]=c*m+h*_+u*T,r[7]=c*g+h*v+u*L,r[2]=d*A+f*y+p*b,r[5]=d*m+f*_+p*T,r[8]=d*g+f*v+p*L,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[1],s=e[2],r=e[3],o=e[4],a=e[5],l=e[6],c=e[7],h=e[8];return t*o*h-t*a*c-n*r*h+n*a*l+s*r*c-s*o*l}invert(){const e=this.elements,t=e[0],n=e[1],s=e[2],r=e[3],o=e[4],a=e[5],l=e[6],c=e[7],h=e[8],u=h*o-a*c,d=a*l-h*r,f=c*r-o*l,p=t*u+n*d+s*f;if(p===0)return this.set(0,0,0,0,0,0,0,0,0);const A=1/p;return e[0]=u*A,e[1]=(s*c-h*n)*A,e[2]=(a*n-s*o)*A,e[3]=d*A,e[4]=(h*t-s*l)*A,e[5]=(s*r-a*t)*A,e[6]=f*A,e[7]=(n*l-c*t)*A,e[8]=(o*t-n*r)*A,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,n,s,r,o,a){const l=Math.cos(r),c=Math.sin(r);return this.set(n*l,n*c,-n*(l*o+c*a)+o+e,-s*c,s*l,-s*(-c*o+l*a)+a+t,0,0,1),this}scale(e,t){return this.premultiply(Tf.makeScale(e,t)),this}rotate(e){return this.premultiply(Tf.makeRotation(-e)),this}translate(e,t){return this.premultiply(Tf.makeTranslation(e,t)),this}makeTranslation(e,t){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,n,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,n=e.elements;for(let s=0;s<9;s++)if(t[s]!==n[s])return!1;return!0}fromArray(e,t=0){for(let n=0;n<9;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}clone(){return new this.constructor().fromArray(this.elements)}}const Tf=new wt;function Bw(i){for(let e=i.length-1;e>=0;--e)if(i[e]>=65535)return!0;return!1}function Yc(i){return document.createElementNS("http://www.w3.org/1999/xhtml",i)}function qT(){const i=Yc("canvas");return i.style.display="block",i}const f_={};function za(i){i in f_||(f_[i]=!0,console.warn(i))}function jT(i,e,t){return new Promise(function(n,s){function r(){switch(i.clientWaitSync(e,i.SYNC_FLUSH_COMMANDS_BIT,0)){case i.WAIT_FAILED:s();break;case i.TIMEOUT_EXPIRED:setTimeout(r,t);break;default:n()}}setTimeout(r,t)})}function XT(i){const e=i.elements;e[2]=.5*e[2]+.5*e[3],e[6]=.5*e[6]+.5*e[7],e[10]=.5*e[10]+.5*e[11],e[14]=.5*e[14]+.5*e[15]}function YT(i){const e=i.elements;e[11]===-1?(e[10]=-e[10]-1,e[14]=-e[14]):(e[10]=-e[10],e[14]=-e[14]+1)}const p_=new wt().set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),m_=new wt().set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);function KT(){const i={enabled:!0,workingColorSpace:On,spaces:{},convert:function(s,r,o){return this.enabled===!1||r===o||!r||!o||(this.spaces[r].transfer===Kt&&(s.r=vr(s.r),s.g=vr(s.g),s.b=vr(s.b)),this.spaces[r].primaries!==this.spaces[o].primaries&&(s.applyMatrix3(this.spaces[r].toXYZ),s.applyMatrix3(this.spaces[o].fromXYZ)),this.spaces[o].transfer===Kt&&(s.r=rl(s.r),s.g=rl(s.g),s.b=rl(s.b))),s},fromWorkingColorSpace:function(s,r){return this.convert(s,this.workingColorSpace,r)},toWorkingColorSpace:function(s,r){return this.convert(s,r,this.workingColorSpace)},getPrimaries:function(s){return this.spaces[s].primaries},getTransfer:function(s){return s===bs?ld:this.spaces[s].transfer},getLuminanceCoefficients:function(s,r=this.workingColorSpace){return s.fromArray(this.spaces[r].luminanceCoefficients)},define:function(s){Object.assign(this.spaces,s)},_getMatrix:function(s,r,o){return s.copy(this.spaces[r].toXYZ).multiply(this.spaces[o].fromXYZ)},_getDrawingBufferColorSpace:function(s){return this.spaces[s].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(s=this.workingColorSpace){return this.spaces[s].workingColorSpaceConfig.unpackColorSpace}},e=[.64,.33,.3,.6,.15,.06],t=[.2126,.7152,.0722],n=[.3127,.329];return i.define({[On]:{primaries:e,whitePoint:n,transfer:ld,toXYZ:p_,fromXYZ:m_,luminanceCoefficients:t,workingColorSpaceConfig:{unpackColorSpace:Ft},outputColorSpaceConfig:{drawingBufferColorSpace:Ft}},[Ft]:{primaries:e,whitePoint:n,transfer:Kt,toXYZ:p_,fromXYZ:m_,luminanceCoefficients:t,outputColorSpaceConfig:{drawingBufferColorSpace:Ft}}}),i}const St=KT();function vr(i){return i<.04045?i*.0773993808:Math.pow(i*.9478672986+.0521327014,2.4)}function rl(i){return i<.0031308?i*12.92:1.055*Math.pow(i,.41666)-.055}let _a;class $T{static getDataURL(e){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{_a===void 0&&(_a=Yc("canvas")),_a.width=e.width,_a.height=e.height;const n=_a.getContext("2d");e instanceof ImageData?n.putImageData(e,0,0):n.drawImage(e,0,0,e.width,e.height),t=_a}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const t=Yc("canvas");t.width=e.width,t.height=e.height;const n=t.getContext("2d");n.drawImage(e,0,0,e.width,e.height);const s=n.getImageData(0,0,e.width,e.height),r=s.data;for(let o=0;o<r.length;o++)r[o]=vr(r[o]/255)*255;return n.putImageData(s,0,0),t}else if(e.data){const t=e.data.slice(0);for(let n=0;n<t.length;n++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[n]=Math.floor(vr(t[n]/255)*255):t[n]=vr(t[n]);return{data:t,width:e.width,height:e.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let JT=0;class Rw{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:JT++}),this.uuid=fs(),this.data=e,this.dataReady=!0,this.version=0}set needsUpdate(e){e===!0&&this.version++}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.images[this.uuid]!==void 0)return e.images[this.uuid];const n={uuid:this.uuid,url:""},s=this.data;if(s!==null){let r;if(Array.isArray(s)){r=[];for(let o=0,a=s.length;o<a;o++)s[o].isDataTexture?r.push(Bf(s[o].image)):r.push(Bf(s[o]))}else r=Bf(s);n.url=r}return t||(e.images[this.uuid]=n),n}}function Bf(i){return typeof HTMLImageElement<"u"&&i instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&i instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&i instanceof ImageBitmap?$T.getDataURL(i):i.data?{data:Array.from(i.data),width:i.width,height:i.height,type:i.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let ZT=0;class Pn extends ua{constructor(e=Pn.DEFAULT_IMAGE,t=Pn.DEFAULT_MAPPING,n=Hi,s=Hi,r=Zt,o=os,a=Hn,l=Kn,c=Pn.DEFAULT_ANISOTROPY,h=bs){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:ZT++}),this.uuid=fs(),this.name="",this.source=new Rw(e),this.mipmaps=[],this.mapping=t,this.channel=0,this.wrapS=n,this.wrapT=s,this.magFilter=r,this.minFilter=o,this.anisotropy=c,this.format=a,this.internalFormat=null,this.type=l,this.offset=new Me(0,0),this.repeat=new Me(1,1),this.center=new Me(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new wt,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=h,this.userData={},this.version=0,this.onUpdate=null,this.renderTarget=null,this.isRenderTargetTexture=!1,this.pmremVersion=0}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.renderTarget=e.renderTarget,this.isRenderTargetTexture=e.isRenderTargetTexture,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const n={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(n.userData=this.userData),t||(e.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==_w)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case lo:e.x=e.x-Math.floor(e.x);break;case Hi:e.x=e.x<0?0:1;break;case td:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case lo:e.y=e.y-Math.floor(e.y);break;case Hi:e.y=e.y<0?0:1;break;case td:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(e){e===!0&&this.pmremVersion++}}Pn.DEFAULT_IMAGE=null;Pn.DEFAULT_MAPPING=_w;Pn.DEFAULT_ANISOTROPY=1;class Ot{constructor(e=0,t=0,n=0,s=1){Ot.prototype.isVector4=!0,this.x=e,this.y=t,this.z=n,this.w=s}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,n,s){return this.x=e,this.y=t,this.z=n,this.w=s,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,n=this.y,s=this.z,r=this.w,o=e.elements;return this.x=o[0]*t+o[4]*n+o[8]*s+o[12]*r,this.y=o[1]*t+o[5]*n+o[9]*s+o[13]*r,this.z=o[2]*t+o[6]*n+o[10]*s+o[14]*r,this.w=o[3]*t+o[7]*n+o[11]*s+o[15]*r,this}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this.w/=e.w,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,n,s,r;const l=e.elements,c=l[0],h=l[4],u=l[8],d=l[1],f=l[5],p=l[9],A=l[2],m=l[6],g=l[10];if(Math.abs(h-d)<.01&&Math.abs(u-A)<.01&&Math.abs(p-m)<.01){if(Math.abs(h+d)<.1&&Math.abs(u+A)<.1&&Math.abs(p+m)<.1&&Math.abs(c+f+g-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;const _=(c+1)/2,v=(f+1)/2,b=(g+1)/2,T=(h+d)/4,L=(u+A)/4,I=(p+m)/4;return _>v&&_>b?_<.01?(n=0,s=.707106781,r=.707106781):(n=Math.sqrt(_),s=T/n,r=L/n):v>b?v<.01?(n=.707106781,s=0,r=.707106781):(s=Math.sqrt(v),n=T/s,r=I/s):b<.01?(n=.707106781,s=.707106781,r=0):(r=Math.sqrt(b),n=L/r,s=I/r),this.set(n,s,r,t),this}let y=Math.sqrt((m-p)*(m-p)+(u-A)*(u-A)+(d-h)*(d-h));return Math.abs(y)<.001&&(y=1),this.x=(m-p)/y,this.y=(u-A)/y,this.z=(d-h)/y,this.w=Math.acos((c+f+g-1)/2),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this.w=t[15],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=It(this.x,e.x,t.x),this.y=It(this.y,e.y,t.y),this.z=It(this.z,e.z,t.z),this.w=It(this.w,e.w,t.w),this}clampScalar(e,t){return this.x=It(this.x,e,t),this.y=It(this.y,e,t),this.z=It(this.z,e,t),this.w=It(this.w,e,t),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(It(n,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this.w=e.w+(t.w-e.w)*n,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class e1 extends ua{constructor(e=1,t=1,n={}){super(),this.isRenderTarget=!0,this.width=e,this.height=t,this.depth=1,this.scissor=new Ot(0,0,e,t),this.scissorTest=!1,this.viewport=new Ot(0,0,e,t);const s={width:e,height:t,depth:1};n=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:Zt,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1},n);const r=new Pn(s,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.colorSpace);r.flipY=!1,r.generateMipmaps=n.generateMipmaps,r.internalFormat=n.internalFormat,this.textures=[];const o=n.count;for(let a=0;a<o;a++)this.textures[a]=r.clone(),this.textures[a].isRenderTargetTexture=!0,this.textures[a].renderTarget=this;this.depthBuffer=n.depthBuffer,this.stencilBuffer=n.stencilBuffer,this.resolveDepthBuffer=n.resolveDepthBuffer,this.resolveStencilBuffer=n.resolveStencilBuffer,this._depthTexture=null,this.depthTexture=n.depthTexture,this.samples=n.samples}get texture(){return this.textures[0]}set texture(e){this.textures[0]=e}set depthTexture(e){this._depthTexture!==null&&(this._depthTexture.renderTarget=null),e!==null&&(e.renderTarget=this),this._depthTexture=e}get depthTexture(){return this._depthTexture}setSize(e,t,n=1){if(this.width!==e||this.height!==t||this.depth!==n){this.width=e,this.height=t,this.depth=n;for(let s=0,r=this.textures.length;s<r;s++)this.textures[s].image.width=e,this.textures[s].image.height=t,this.textures[s].image.depth=n;this.dispose()}this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return new this.constructor().copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.textures.length=0;for(let n=0,s=e.textures.length;n<s;n++)this.textures[n]=e.textures[n].clone(),this.textures[n].isRenderTargetTexture=!0,this.textures[n].renderTarget=this;const t=Object.assign({},e.texture.image);return this.texture.source=new Rw(t),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.resolveDepthBuffer=e.resolveDepthBuffer,this.resolveStencilBuffer=e.resolveStencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class na extends e1{constructor(e=1,t=1,n={}){super(e,t,n),this.isWebGLRenderTarget=!0}}class Pw extends Pn{constructor(e=null,t=1,n=1,s=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:n,depth:s},this.magFilter=yi,this.minFilter=yi,this.wrapR=Hi,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.layerUpdates=new Set}addLayerUpdate(e){this.layerUpdates.add(e)}clearLayerUpdates(){this.layerUpdates.clear()}}class Dw extends Pn{constructor(e=null,t=1,n=1,s=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:n,depth:s},this.magFilter=yi,this.minFilter=yi,this.wrapR=Hi,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class zn{constructor(e=0,t=0,n=0,s=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=n,this._w=s}static slerpFlat(e,t,n,s,r,o,a){let l=n[s+0],c=n[s+1],h=n[s+2],u=n[s+3];const d=r[o+0],f=r[o+1],p=r[o+2],A=r[o+3];if(a===0){e[t+0]=l,e[t+1]=c,e[t+2]=h,e[t+3]=u;return}if(a===1){e[t+0]=d,e[t+1]=f,e[t+2]=p,e[t+3]=A;return}if(u!==A||l!==d||c!==f||h!==p){let m=1-a;const g=l*d+c*f+h*p+u*A,y=g>=0?1:-1,_=1-g*g;if(_>Number.EPSILON){const b=Math.sqrt(_),T=Math.atan2(b,g*y);m=Math.sin(m*T)/b,a=Math.sin(a*T)/b}const v=a*y;if(l=l*m+d*v,c=c*m+f*v,h=h*m+p*v,u=u*m+A*v,m===1-a){const b=1/Math.sqrt(l*l+c*c+h*h+u*u);l*=b,c*=b,h*=b,u*=b}}e[t]=l,e[t+1]=c,e[t+2]=h,e[t+3]=u}static multiplyQuaternionsFlat(e,t,n,s,r,o){const a=n[s],l=n[s+1],c=n[s+2],h=n[s+3],u=r[o],d=r[o+1],f=r[o+2],p=r[o+3];return e[t]=a*p+h*u+l*f-c*d,e[t+1]=l*p+h*d+c*u-a*f,e[t+2]=c*p+h*f+a*d-l*u,e[t+3]=h*p-a*u-l*d-c*f,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,n,s){return this._x=e,this._y=t,this._z=n,this._w=s,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t=!0){const n=e._x,s=e._y,r=e._z,o=e._order,a=Math.cos,l=Math.sin,c=a(n/2),h=a(s/2),u=a(r/2),d=l(n/2),f=l(s/2),p=l(r/2);switch(o){case"XYZ":this._x=d*h*u+c*f*p,this._y=c*f*u-d*h*p,this._z=c*h*p+d*f*u,this._w=c*h*u-d*f*p;break;case"YXZ":this._x=d*h*u+c*f*p,this._y=c*f*u-d*h*p,this._z=c*h*p-d*f*u,this._w=c*h*u+d*f*p;break;case"ZXY":this._x=d*h*u-c*f*p,this._y=c*f*u+d*h*p,this._z=c*h*p+d*f*u,this._w=c*h*u-d*f*p;break;case"ZYX":this._x=d*h*u-c*f*p,this._y=c*f*u+d*h*p,this._z=c*h*p-d*f*u,this._w=c*h*u+d*f*p;break;case"YZX":this._x=d*h*u+c*f*p,this._y=c*f*u+d*h*p,this._z=c*h*p-d*f*u,this._w=c*h*u-d*f*p;break;case"XZY":this._x=d*h*u-c*f*p,this._y=c*f*u-d*h*p,this._z=c*h*p+d*f*u,this._w=c*h*u+d*f*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+o)}return t===!0&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const n=t/2,s=Math.sin(n);return this._x=e.x*s,this._y=e.y*s,this._z=e.z*s,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,n=t[0],s=t[4],r=t[8],o=t[1],a=t[5],l=t[9],c=t[2],h=t[6],u=t[10],d=n+a+u;if(d>0){const f=.5/Math.sqrt(d+1);this._w=.25/f,this._x=(h-l)*f,this._y=(r-c)*f,this._z=(o-s)*f}else if(n>a&&n>u){const f=2*Math.sqrt(1+n-a-u);this._w=(h-l)/f,this._x=.25*f,this._y=(s+o)/f,this._z=(r+c)/f}else if(a>u){const f=2*Math.sqrt(1+a-n-u);this._w=(r-c)/f,this._x=(s+o)/f,this._y=.25*f,this._z=(l+h)/f}else{const f=2*Math.sqrt(1+u-n-a);this._w=(o-s)/f,this._x=(r+c)/f,this._y=(l+h)/f,this._z=.25*f}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let n=e.dot(t)+1;return n<Number.EPSILON?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=n):(this._x=0,this._y=-e.z,this._z=e.y,this._w=n)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=n),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(It(this.dot(e),-1,1)))}rotateTowards(e,t){const n=this.angleTo(e);if(n===0)return this;const s=Math.min(1,t/n);return this.slerp(e,s),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const n=e._x,s=e._y,r=e._z,o=e._w,a=t._x,l=t._y,c=t._z,h=t._w;return this._x=n*h+o*a+s*c-r*l,this._y=s*h+o*l+r*a-n*c,this._z=r*h+o*c+n*l-s*a,this._w=o*h-n*a-s*l-r*c,this._onChangeCallback(),this}slerp(e,t){if(t===0)return this;if(t===1)return this.copy(e);const n=this._x,s=this._y,r=this._z,o=this._w;let a=o*e._w+n*e._x+s*e._y+r*e._z;if(a<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),a>=1)return this._w=o,this._x=n,this._y=s,this._z=r,this;const l=1-a*a;if(l<=Number.EPSILON){const f=1-t;return this._w=f*o+t*this._w,this._x=f*n+t*this._x,this._y=f*s+t*this._y,this._z=f*r+t*this._z,this.normalize(),this}const c=Math.sqrt(l),h=Math.atan2(c,a),u=Math.sin((1-t)*h)/c,d=Math.sin(t*h)/c;return this._w=o*u+this._w*d,this._x=n*u+this._x*d,this._y=s*u+this._y*d,this._z=r*u+this._z*d,this._onChangeCallback(),this}slerpQuaternions(e,t,n){return this.copy(e).slerp(t,n)}random(){const e=2*Math.PI*Math.random(),t=2*Math.PI*Math.random(),n=Math.random(),s=Math.sqrt(1-n),r=Math.sqrt(n);return this.set(s*Math.sin(e),s*Math.cos(e),r*Math.sin(t),r*Math.cos(t))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class he{constructor(e=0,t=0,n=0){he.prototype.isVector3=!0,this.x=e,this.y=t,this.z=n}set(e,t,n){return n===void 0&&(n=this.z),this.x=e,this.y=t,this.z=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(A_.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(A_.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,n=this.y,s=this.z,r=e.elements;return this.x=r[0]*t+r[3]*n+r[6]*s,this.y=r[1]*t+r[4]*n+r[7]*s,this.z=r[2]*t+r[5]*n+r[8]*s,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,n=this.y,s=this.z,r=e.elements,o=1/(r[3]*t+r[7]*n+r[11]*s+r[15]);return this.x=(r[0]*t+r[4]*n+r[8]*s+r[12])*o,this.y=(r[1]*t+r[5]*n+r[9]*s+r[13])*o,this.z=(r[2]*t+r[6]*n+r[10]*s+r[14])*o,this}applyQuaternion(e){const t=this.x,n=this.y,s=this.z,r=e.x,o=e.y,a=e.z,l=e.w,c=2*(o*s-a*n),h=2*(a*t-r*s),u=2*(r*n-o*t);return this.x=t+l*c+o*u-a*h,this.y=n+l*h+a*c-r*u,this.z=s+l*u+r*h-o*c,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,n=this.y,s=this.z,r=e.elements;return this.x=r[0]*t+r[4]*n+r[8]*s,this.y=r[1]*t+r[5]*n+r[9]*s,this.z=r[2]*t+r[6]*n+r[10]*s,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=It(this.x,e.x,t.x),this.y=It(this.y,e.y,t.y),this.z=It(this.z,e.z,t.z),this}clampScalar(e,t){return this.x=It(this.x,e,t),this.y=It(this.y,e,t),this.z=It(this.z,e,t),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(It(n,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const n=e.x,s=e.y,r=e.z,o=t.x,a=t.y,l=t.z;return this.x=s*l-r*a,this.y=r*o-n*l,this.z=n*a-s*o,this}projectOnVector(e){const t=e.lengthSq();if(t===0)return this.set(0,0,0);const n=e.dot(this)/t;return this.copy(e).multiplyScalar(n)}projectOnPlane(e){return Rf.copy(this).projectOnVector(e),this.sub(Rf)}reflect(e){return this.sub(Rf.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(It(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y,s=this.z-e.z;return t*t+n*n+s*s}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,n){const s=Math.sin(t)*e;return this.x=s*Math.sin(n),this.y=Math.cos(t)*e,this.z=s*Math.cos(n),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,n){return this.x=e*Math.sin(t),this.y=n,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),s=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=s,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,t*4)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,t*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=Math.random()*Math.PI*2,t=Math.random()*2-1,n=Math.sqrt(1-t*t);return this.x=n*Math.cos(e),this.y=t,this.z=n*Math.sin(e),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const Rf=new he,A_=new zn;class ps{constructor(e=new he(1/0,1/0,1/0),t=new he(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t+=3)this.expandByPoint(As.fromArray(e,t));return this}setFromBufferAttribute(e){this.makeEmpty();for(let t=0,n=e.count;t<n;t++)this.expandByPoint(As.fromBufferAttribute(e,t));return this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=As.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);const n=e.geometry;if(n!==void 0){const r=n.getAttribute("position");if(t===!0&&r!==void 0&&e.isInstancedMesh!==!0)for(let o=0,a=r.count;o<a;o++)e.isMesh===!0?e.getVertexPosition(o,As):As.fromBufferAttribute(r,o),As.applyMatrix4(e.matrixWorld),this.expandByPoint(As);else e.boundingBox!==void 0?(e.boundingBox===null&&e.computeBoundingBox(),Uh.copy(e.boundingBox)):(n.boundingBox===null&&n.computeBoundingBox(),Uh.copy(n.boundingBox)),Uh.applyMatrix4(e.matrixWorld),this.union(Uh)}const s=e.children;for(let r=0,o=s.length;r<o;r++)this.expandByObject(s[r],t);return this}containsPoint(e){return e.x>=this.min.x&&e.x<=this.max.x&&e.y>=this.min.y&&e.y<=this.max.y&&e.z>=this.min.z&&e.z<=this.max.z}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return e.max.x>=this.min.x&&e.min.x<=this.max.x&&e.max.y>=this.min.y&&e.min.y<=this.max.y&&e.max.z>=this.min.z&&e.min.z<=this.max.z}intersectsSphere(e){return this.clampPoint(e.center,As),As.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,n;return e.normal.x>0?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=-e.constant&&n>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(Gl),Qh.subVectors(this.max,Gl),ya.subVectors(e.a,Gl),xa.subVectors(e.b,Gl),wa.subVectors(e.c,Gl),Ir.subVectors(xa,ya),Mr.subVectors(wa,xa),wo.subVectors(ya,wa);let t=[0,-Ir.z,Ir.y,0,-Mr.z,Mr.y,0,-wo.z,wo.y,Ir.z,0,-Ir.x,Mr.z,0,-Mr.x,wo.z,0,-wo.x,-Ir.y,Ir.x,0,-Mr.y,Mr.x,0,-wo.y,wo.x,0];return!Pf(t,ya,xa,wa,Qh)||(t=[1,0,0,0,1,0,0,0,1],!Pf(t,ya,xa,wa,Qh))?!1:(Vh.crossVectors(Ir,Mr),t=[Vh.x,Vh.y,Vh.z],Pf(t,ya,xa,wa,Qh))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,As).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=this.getSize(As).length()*.5),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(Js[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),Js[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),Js[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),Js[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),Js[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),Js[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),Js[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),Js[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(Js),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const Js=[new he,new he,new he,new he,new he,new he,new he,new he],As=new he,Uh=new ps,ya=new he,xa=new he,wa=new he,Ir=new he,Mr=new he,wo=new he,Gl=new he,Qh=new he,Vh=new he,bo=new he;function Pf(i,e,t,n,s){for(let r=0,o=i.length-3;r<=o;r+=3){bo.fromArray(i,r);const a=s.x*Math.abs(bo.x)+s.y*Math.abs(bo.y)+s.z*Math.abs(bo.z),l=e.dot(bo),c=t.dot(bo),h=n.dot(bo);if(Math.max(-Math.max(l,c,h),Math.min(l,c,h))>a)return!1}return!0}const t1=new ps,Hl=new he,Df=new he;class Xs{constructor(e=new he,t=-1){this.isSphere=!0,this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const n=this.center;t!==void 0?n.copy(t):t1.setFromPoints(e).getCenter(n);let s=0;for(let r=0,o=e.length;r<o;r++)s=Math.max(s,n.distanceToSquared(e[r]));return this.radius=Math.sqrt(s),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const n=this.center.distanceToSquared(e);return t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;Hl.subVectors(e,this.center);const t=Hl.lengthSq();if(t>this.radius*this.radius){const n=Math.sqrt(t),s=(n-this.radius)*.5;this.center.addScaledVector(Hl,s/n),this.radius+=s}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(this.center.equals(e.center)===!0?this.radius=Math.max(this.radius,e.radius):(Df.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(Hl.copy(e.center).add(Df)),this.expandByPoint(Hl.copy(e.center).sub(Df))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}}const Zs=new he,Lf=new he,zh=new he,Tr=new he,Ff=new he,Gh=new he,Nf=new he;class _h{constructor(e=new he,t=new he(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,Zs)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const n=t.dot(this.direction);return n<0?t.copy(this.origin):t.copy(this.origin).addScaledVector(this.direction,n)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=Zs.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(Zs.copy(this.origin).addScaledVector(this.direction,t),Zs.distanceToSquared(e))}distanceSqToSegment(e,t,n,s){Lf.copy(e).add(t).multiplyScalar(.5),zh.copy(t).sub(e).normalize(),Tr.copy(this.origin).sub(Lf);const r=e.distanceTo(t)*.5,o=-this.direction.dot(zh),a=Tr.dot(this.direction),l=-Tr.dot(zh),c=Tr.lengthSq(),h=Math.abs(1-o*o);let u,d,f,p;if(h>0)if(u=o*l-a,d=o*a-l,p=r*h,u>=0)if(d>=-p)if(d<=p){const A=1/h;u*=A,d*=A,f=u*(u+o*d+2*a)+d*(o*u+d+2*l)+c}else d=r,u=Math.max(0,-(o*d+a)),f=-u*u+d*(d+2*l)+c;else d=-r,u=Math.max(0,-(o*d+a)),f=-u*u+d*(d+2*l)+c;else d<=-p?(u=Math.max(0,-(-o*r+a)),d=u>0?-r:Math.min(Math.max(-r,-l),r),f=-u*u+d*(d+2*l)+c):d<=p?(u=0,d=Math.min(Math.max(-r,-l),r),f=d*(d+2*l)+c):(u=Math.max(0,-(o*r+a)),d=u>0?r:Math.min(Math.max(-r,-l),r),f=-u*u+d*(d+2*l)+c);else d=o>0?-r:r,u=Math.max(0,-(o*d+a)),f=-u*u+d*(d+2*l)+c;return n&&n.copy(this.origin).addScaledVector(this.direction,u),s&&s.copy(Lf).addScaledVector(zh,d),f}intersectSphere(e,t){Zs.subVectors(e.center,this.origin);const n=Zs.dot(this.direction),s=Zs.dot(Zs)-n*n,r=e.radius*e.radius;if(s>r)return null;const o=Math.sqrt(r-s),a=n-o,l=n+o;return l<0?null:a<0?this.at(l,t):this.at(a,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(t===0)return e.distanceToPoint(this.origin)===0?0:null;const n=-(this.origin.dot(e.normal)+e.constant)/t;return n>=0?n:null}intersectPlane(e,t){const n=this.distanceToPlane(e);return n===null?null:this.at(n,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return t===0||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let n,s,r,o,a,l;const c=1/this.direction.x,h=1/this.direction.y,u=1/this.direction.z,d=this.origin;return c>=0?(n=(e.min.x-d.x)*c,s=(e.max.x-d.x)*c):(n=(e.max.x-d.x)*c,s=(e.min.x-d.x)*c),h>=0?(r=(e.min.y-d.y)*h,o=(e.max.y-d.y)*h):(r=(e.max.y-d.y)*h,o=(e.min.y-d.y)*h),n>o||r>s||((r>n||isNaN(n))&&(n=r),(o<s||isNaN(s))&&(s=o),u>=0?(a=(e.min.z-d.z)*u,l=(e.max.z-d.z)*u):(a=(e.max.z-d.z)*u,l=(e.min.z-d.z)*u),n>l||a>s)||((a>n||n!==n)&&(n=a),(l<s||s!==s)&&(s=l),s<0)?null:this.at(n>=0?n:s,t)}intersectsBox(e){return this.intersectBox(e,Zs)!==null}intersectTriangle(e,t,n,s,r){Ff.subVectors(t,e),Gh.subVectors(n,e),Nf.crossVectors(Ff,Gh);let o=this.direction.dot(Nf),a;if(o>0){if(s)return null;a=1}else if(o<0)a=-1,o=-o;else return null;Tr.subVectors(this.origin,e);const l=a*this.direction.dot(Gh.crossVectors(Tr,Gh));if(l<0)return null;const c=a*this.direction.dot(Ff.cross(Tr));if(c<0||l+c>o)return null;const h=-a*Tr.dot(Nf);return h<0?null:this.at(h/o,r)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class pt{constructor(e,t,n,s,r,o,a,l,c,h,u,d,f,p,A,m){pt.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e!==void 0&&this.set(e,t,n,s,r,o,a,l,c,h,u,d,f,p,A,m)}set(e,t,n,s,r,o,a,l,c,h,u,d,f,p,A,m){const g=this.elements;return g[0]=e,g[4]=t,g[8]=n,g[12]=s,g[1]=r,g[5]=o,g[9]=a,g[13]=l,g[2]=c,g[6]=h,g[10]=u,g[14]=d,g[3]=f,g[7]=p,g[11]=A,g[15]=m,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new pt().fromArray(this.elements)}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this}copyPosition(e){const t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,n){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,n=e.elements,s=1/ba.setFromMatrixColumn(e,0).length(),r=1/ba.setFromMatrixColumn(e,1).length(),o=1/ba.setFromMatrixColumn(e,2).length();return t[0]=n[0]*s,t[1]=n[1]*s,t[2]=n[2]*s,t[3]=0,t[4]=n[4]*r,t[5]=n[5]*r,t[6]=n[6]*r,t[7]=0,t[8]=n[8]*o,t[9]=n[9]*o,t[10]=n[10]*o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,n=e.x,s=e.y,r=e.z,o=Math.cos(n),a=Math.sin(n),l=Math.cos(s),c=Math.sin(s),h=Math.cos(r),u=Math.sin(r);if(e.order==="XYZ"){const d=o*h,f=o*u,p=a*h,A=a*u;t[0]=l*h,t[4]=-l*u,t[8]=c,t[1]=f+p*c,t[5]=d-A*c,t[9]=-a*l,t[2]=A-d*c,t[6]=p+f*c,t[10]=o*l}else if(e.order==="YXZ"){const d=l*h,f=l*u,p=c*h,A=c*u;t[0]=d+A*a,t[4]=p*a-f,t[8]=o*c,t[1]=o*u,t[5]=o*h,t[9]=-a,t[2]=f*a-p,t[6]=A+d*a,t[10]=o*l}else if(e.order==="ZXY"){const d=l*h,f=l*u,p=c*h,A=c*u;t[0]=d-A*a,t[4]=-o*u,t[8]=p+f*a,t[1]=f+p*a,t[5]=o*h,t[9]=A-d*a,t[2]=-o*c,t[6]=a,t[10]=o*l}else if(e.order==="ZYX"){const d=o*h,f=o*u,p=a*h,A=a*u;t[0]=l*h,t[4]=p*c-f,t[8]=d*c+A,t[1]=l*u,t[5]=A*c+d,t[9]=f*c-p,t[2]=-c,t[6]=a*l,t[10]=o*l}else if(e.order==="YZX"){const d=o*l,f=o*c,p=a*l,A=a*c;t[0]=l*h,t[4]=A-d*u,t[8]=p*u+f,t[1]=u,t[5]=o*h,t[9]=-a*h,t[2]=-c*h,t[6]=f*u+p,t[10]=d-A*u}else if(e.order==="XZY"){const d=o*l,f=o*c,p=a*l,A=a*c;t[0]=l*h,t[4]=-u,t[8]=c*h,t[1]=d*u+A,t[5]=o*h,t[9]=f*u-p,t[2]=p*u-f,t[6]=a*h,t[10]=A*u+d}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(n1,e,i1)}lookAt(e,t,n){const s=this.elements;return Ni.subVectors(e,t),Ni.lengthSq()===0&&(Ni.z=1),Ni.normalize(),Br.crossVectors(n,Ni),Br.lengthSq()===0&&(Math.abs(n.z)===1?Ni.x+=1e-4:Ni.z+=1e-4,Ni.normalize(),Br.crossVectors(n,Ni)),Br.normalize(),Hh.crossVectors(Ni,Br),s[0]=Br.x,s[4]=Hh.x,s[8]=Ni.x,s[1]=Br.y,s[5]=Hh.y,s[9]=Ni.y,s[2]=Br.z,s[6]=Hh.z,s[10]=Ni.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,s=t.elements,r=this.elements,o=n[0],a=n[4],l=n[8],c=n[12],h=n[1],u=n[5],d=n[9],f=n[13],p=n[2],A=n[6],m=n[10],g=n[14],y=n[3],_=n[7],v=n[11],b=n[15],T=s[0],L=s[4],I=s[8],x=s[12],w=s[1],P=s[5],z=s[9],H=s[13],K=s[2],le=s[6],J=s[10],W=s[14],O=s[3],fe=s[7],ue=s[11],ee=s[15];return r[0]=o*T+a*w+l*K+c*O,r[4]=o*L+a*P+l*le+c*fe,r[8]=o*I+a*z+l*J+c*ue,r[12]=o*x+a*H+l*W+c*ee,r[1]=h*T+u*w+d*K+f*O,r[5]=h*L+u*P+d*le+f*fe,r[9]=h*I+u*z+d*J+f*ue,r[13]=h*x+u*H+d*W+f*ee,r[2]=p*T+A*w+m*K+g*O,r[6]=p*L+A*P+m*le+g*fe,r[10]=p*I+A*z+m*J+g*ue,r[14]=p*x+A*H+m*W+g*ee,r[3]=y*T+_*w+v*K+b*O,r[7]=y*L+_*P+v*le+b*fe,r[11]=y*I+_*z+v*J+b*ue,r[15]=y*x+_*H+v*W+b*ee,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[4],s=e[8],r=e[12],o=e[1],a=e[5],l=e[9],c=e[13],h=e[2],u=e[6],d=e[10],f=e[14],p=e[3],A=e[7],m=e[11],g=e[15];return p*(+r*l*u-s*c*u-r*a*d+n*c*d+s*a*f-n*l*f)+A*(+t*l*f-t*c*d+r*o*d-s*o*f+s*c*h-r*l*h)+m*(+t*c*u-t*a*f-r*o*u+n*o*f+r*a*h-n*c*h)+g*(-s*a*h-t*l*u+t*a*d+s*o*u-n*o*d+n*l*h)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,n){const s=this.elements;return e.isVector3?(s[12]=e.x,s[13]=e.y,s[14]=e.z):(s[12]=e,s[13]=t,s[14]=n),this}invert(){const e=this.elements,t=e[0],n=e[1],s=e[2],r=e[3],o=e[4],a=e[5],l=e[6],c=e[7],h=e[8],u=e[9],d=e[10],f=e[11],p=e[12],A=e[13],m=e[14],g=e[15],y=u*m*c-A*d*c+A*l*f-a*m*f-u*l*g+a*d*g,_=p*d*c-h*m*c-p*l*f+o*m*f+h*l*g-o*d*g,v=h*A*c-p*u*c+p*a*f-o*A*f-h*a*g+o*u*g,b=p*u*l-h*A*l-p*a*d+o*A*d+h*a*m-o*u*m,T=t*y+n*_+s*v+r*b;if(T===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const L=1/T;return e[0]=y*L,e[1]=(A*d*r-u*m*r-A*s*f+n*m*f+u*s*g-n*d*g)*L,e[2]=(a*m*r-A*l*r+A*s*c-n*m*c-a*s*g+n*l*g)*L,e[3]=(u*l*r-a*d*r-u*s*c+n*d*c+a*s*f-n*l*f)*L,e[4]=_*L,e[5]=(h*m*r-p*d*r+p*s*f-t*m*f-h*s*g+t*d*g)*L,e[6]=(p*l*r-o*m*r-p*s*c+t*m*c+o*s*g-t*l*g)*L,e[7]=(o*d*r-h*l*r+h*s*c-t*d*c-o*s*f+t*l*f)*L,e[8]=v*L,e[9]=(p*u*r-h*A*r-p*n*f+t*A*f+h*n*g-t*u*g)*L,e[10]=(o*A*r-p*a*r+p*n*c-t*A*c-o*n*g+t*a*g)*L,e[11]=(h*a*r-o*u*r-h*n*c+t*u*c+o*n*f-t*a*f)*L,e[12]=b*L,e[13]=(h*A*s-p*u*s+p*n*d-t*A*d-h*n*m+t*u*m)*L,e[14]=(p*a*s-o*A*s-p*n*l+t*A*l+o*n*m-t*a*m)*L,e[15]=(o*u*s-h*a*s+h*n*l-t*u*l-o*n*d+t*a*d)*L,this}scale(e){const t=this.elements,n=e.x,s=e.y,r=e.z;return t[0]*=n,t[4]*=s,t[8]*=r,t[1]*=n,t[5]*=s,t[9]*=r,t[2]*=n,t[6]*=s,t[10]*=r,t[3]*=n,t[7]*=s,t[11]*=r,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],s=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,n,s))}makeTranslation(e,t,n){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const n=Math.cos(t),s=Math.sin(t),r=1-n,o=e.x,a=e.y,l=e.z,c=r*o,h=r*a;return this.set(c*o+n,c*a-s*l,c*l+s*a,0,c*a+s*l,h*a+n,h*l-s*o,0,c*l-s*a,h*l+s*o,r*l*l+n,0,0,0,0,1),this}makeScale(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this}makeShear(e,t,n,s,r,o){return this.set(1,n,r,0,e,1,o,0,t,s,1,0,0,0,0,1),this}compose(e,t,n){const s=this.elements,r=t._x,o=t._y,a=t._z,l=t._w,c=r+r,h=o+o,u=a+a,d=r*c,f=r*h,p=r*u,A=o*h,m=o*u,g=a*u,y=l*c,_=l*h,v=l*u,b=n.x,T=n.y,L=n.z;return s[0]=(1-(A+g))*b,s[1]=(f+v)*b,s[2]=(p-_)*b,s[3]=0,s[4]=(f-v)*T,s[5]=(1-(d+g))*T,s[6]=(m+y)*T,s[7]=0,s[8]=(p+_)*L,s[9]=(m-y)*L,s[10]=(1-(d+A))*L,s[11]=0,s[12]=e.x,s[13]=e.y,s[14]=e.z,s[15]=1,this}decompose(e,t,n){const s=this.elements;let r=ba.set(s[0],s[1],s[2]).length();const o=ba.set(s[4],s[5],s[6]).length(),a=ba.set(s[8],s[9],s[10]).length();this.determinant()<0&&(r=-r),e.x=s[12],e.y=s[13],e.z=s[14],gs.copy(this);const c=1/r,h=1/o,u=1/a;return gs.elements[0]*=c,gs.elements[1]*=c,gs.elements[2]*=c,gs.elements[4]*=h,gs.elements[5]*=h,gs.elements[6]*=h,gs.elements[8]*=u,gs.elements[9]*=u,gs.elements[10]*=u,t.setFromRotationMatrix(gs),n.x=r,n.y=o,n.z=a,this}makePerspective(e,t,n,s,r,o,a=Os){const l=this.elements,c=2*r/(t-e),h=2*r/(n-s),u=(t+e)/(t-e),d=(n+s)/(n-s);let f,p;if(a===Os)f=-(o+r)/(o-r),p=-2*o*r/(o-r);else if(a===cd)f=-o/(o-r),p=-o*r/(o-r);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+a);return l[0]=c,l[4]=0,l[8]=u,l[12]=0,l[1]=0,l[5]=h,l[9]=d,l[13]=0,l[2]=0,l[6]=0,l[10]=f,l[14]=p,l[3]=0,l[7]=0,l[11]=-1,l[15]=0,this}makeOrthographic(e,t,n,s,r,o,a=Os){const l=this.elements,c=1/(t-e),h=1/(n-s),u=1/(o-r),d=(t+e)*c,f=(n+s)*h;let p,A;if(a===Os)p=(o+r)*u,A=-2*u;else if(a===cd)p=r*u,A=-1*u;else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+a);return l[0]=2*c,l[4]=0,l[8]=0,l[12]=-d,l[1]=0,l[5]=2*h,l[9]=0,l[13]=-f,l[2]=0,l[6]=0,l[10]=A,l[14]=-p,l[3]=0,l[7]=0,l[11]=0,l[15]=1,this}equals(e){const t=this.elements,n=e.elements;for(let s=0;s<16;s++)if(t[s]!==n[s])return!1;return!0}fromArray(e,t=0){for(let n=0;n<16;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}}const ba=new he,gs=new pt,n1=new he(0,0,0),i1=new he(1,1,1),Br=new he,Hh=new he,Ni=new he,g_=new pt,v_=new zn;class Rn{constructor(e=0,t=0,n=0,s=Rn.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=t,this._z=n,this._order=s}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,n,s=this._order){return this._x=e,this._y=t,this._z=n,this._order=s,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,n=!0){const s=e.elements,r=s[0],o=s[4],a=s[8],l=s[1],c=s[5],h=s[9],u=s[2],d=s[6],f=s[10];switch(t){case"XYZ":this._y=Math.asin(It(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-h,f),this._z=Math.atan2(-o,r)):(this._x=Math.atan2(d,c),this._z=0);break;case"YXZ":this._x=Math.asin(-It(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(a,f),this._z=Math.atan2(l,c)):(this._y=Math.atan2(-u,r),this._z=0);break;case"ZXY":this._x=Math.asin(It(d,-1,1)),Math.abs(d)<.9999999?(this._y=Math.atan2(-u,f),this._z=Math.atan2(-o,c)):(this._y=0,this._z=Math.atan2(l,r));break;case"ZYX":this._y=Math.asin(-It(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(d,f),this._z=Math.atan2(l,r)):(this._x=0,this._z=Math.atan2(-o,c));break;case"YZX":this._z=Math.asin(It(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-h,c),this._y=Math.atan2(-u,r)):(this._x=0,this._y=Math.atan2(a,f));break;case"XZY":this._z=Math.asin(-It(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(d,c),this._y=Math.atan2(a,r)):(this._x=Math.atan2(-h,f),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,n===!0&&this._onChangeCallback(),this}setFromQuaternion(e,t,n){return g_.makeRotationFromQuaternion(e),this.setFromRotationMatrix(g_,t,n)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return v_.setFromEuler(this),this.setFromQuaternion(v_,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}Rn.DEFAULT_ORDER="XYZ";class Lw{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}}let s1=0;const __=new he,Ea=new zn,er=new pt,Wh=new he,Wl=new he,r1=new he,o1=new zn,y_=new he(1,0,0),x_=new he(0,1,0),w_=new he(0,0,1),b_={type:"added"},a1={type:"removed"},Ca={type:"childadded",child:null},kf={type:"childremoved",child:null};class en extends ua{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:s1++}),this.uuid=fs(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=en.DEFAULT_UP.clone();const e=new he,t=new Rn,n=new zn,s=new he(1,1,1);function r(){n.setFromEuler(t,!1)}function o(){t.setFromQuaternion(n,void 0,!1)}t._onChange(r),n._onChange(o),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:s},modelViewMatrix:{value:new pt},normalMatrix:{value:new wt}}),this.matrix=new pt,this.matrixWorld=new pt,this.matrixAutoUpdate=en.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=en.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new Lw,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return Ea.setFromAxisAngle(e,t),this.quaternion.multiply(Ea),this}rotateOnWorldAxis(e,t){return Ea.setFromAxisAngle(e,t),this.quaternion.premultiply(Ea),this}rotateX(e){return this.rotateOnAxis(y_,e)}rotateY(e){return this.rotateOnAxis(x_,e)}rotateZ(e){return this.rotateOnAxis(w_,e)}translateOnAxis(e,t){return __.copy(e).applyQuaternion(this.quaternion),this.position.add(__.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(y_,e)}translateY(e){return this.translateOnAxis(x_,e)}translateZ(e){return this.translateOnAxis(w_,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(er.copy(this.matrixWorld).invert())}lookAt(e,t,n){e.isVector3?Wh.copy(e):Wh.set(e,t,n);const s=this.parent;this.updateWorldMatrix(!0,!1),Wl.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?er.lookAt(Wl,Wh,this.up):er.lookAt(Wh,Wl,this.up),this.quaternion.setFromRotationMatrix(er),s&&(er.extractRotation(s.matrixWorld),Ea.setFromRotationMatrix(er),this.quaternion.premultiply(Ea.invert()))}add(e){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.removeFromParent(),e.parent=this,this.children.push(e),e.dispatchEvent(b_),Ca.child=e,this.dispatchEvent(Ca),Ca.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let n=0;n<arguments.length;n++)this.remove(arguments[n]);return this}const t=this.children.indexOf(e);return t!==-1&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(a1),kf.child=e,this.dispatchEvent(kf),kf.child=null),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),er.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),er.multiply(e.parent.matrixWorld)),e.applyMatrix4(er),e.removeFromParent(),e.parent=this,this.children.push(e),e.updateWorldMatrix(!1,!0),e.dispatchEvent(b_),Ca.child=e,this.dispatchEvent(Ca),Ca.child=null,this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let n=0,s=this.children.length;n<s;n++){const o=this.children[n].getObjectByProperty(e,t);if(o!==void 0)return o}}getObjectsByProperty(e,t,n=[]){this[e]===t&&n.push(this);const s=this.children;for(let r=0,o=s.length;r<o;r++)s[r].getObjectsByProperty(e,t,n);return n}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Wl,e,r1),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Wl,o1,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let n=0,s=t.length;n<s;n++)t[n].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const t=this.children;for(let n=0,s=t.length;n<s;n++)t[n].traverseVisible(e)}traverseAncestors(e){const t=this.parent;t!==null&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let n=0,s=t.length;n<s;n++)t[n].updateMatrixWorld(e)}updateWorldMatrix(e,t){const n=this.parent;if(e===!0&&n!==null&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),t===!0){const s=this.children;for(let r=0,o=s.length;r<o;r++)s[r].updateWorldMatrix(!1,!0)}}toJSON(e){const t=e===void 0||typeof e=="string",n={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},n.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const s={};s.uuid=this.uuid,s.type=this.type,this.name!==""&&(s.name=this.name),this.castShadow===!0&&(s.castShadow=!0),this.receiveShadow===!0&&(s.receiveShadow=!0),this.visible===!1&&(s.visible=!1),this.frustumCulled===!1&&(s.frustumCulled=!1),this.renderOrder!==0&&(s.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(s.userData=this.userData),s.layers=this.layers.mask,s.matrix=this.matrix.toArray(),s.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(s.matrixAutoUpdate=!1),this.isInstancedMesh&&(s.type="InstancedMesh",s.count=this.count,s.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(s.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(s.type="BatchedMesh",s.perObjectFrustumCulled=this.perObjectFrustumCulled,s.sortObjects=this.sortObjects,s.drawRanges=this._drawRanges,s.reservedRanges=this._reservedRanges,s.visibility=this._visibility,s.active=this._active,s.bounds=this._bounds.map(a=>({boxInitialized:a.boxInitialized,boxMin:a.box.min.toArray(),boxMax:a.box.max.toArray(),sphereInitialized:a.sphereInitialized,sphereRadius:a.sphere.radius,sphereCenter:a.sphere.center.toArray()})),s.maxInstanceCount=this._maxInstanceCount,s.maxVertexCount=this._maxVertexCount,s.maxIndexCount=this._maxIndexCount,s.geometryInitialized=this._geometryInitialized,s.geometryCount=this._geometryCount,s.matricesTexture=this._matricesTexture.toJSON(e),this._colorsTexture!==null&&(s.colorsTexture=this._colorsTexture.toJSON(e)),this.boundingSphere!==null&&(s.boundingSphere={center:s.boundingSphere.center.toArray(),radius:s.boundingSphere.radius}),this.boundingBox!==null&&(s.boundingBox={min:s.boundingBox.min.toArray(),max:s.boundingBox.max.toArray()}));function r(a,l){return a[l.uuid]===void 0&&(a[l.uuid]=l.toJSON(e)),l.uuid}if(this.isScene)this.background&&(this.background.isColor?s.background=this.background.toJSON():this.background.isTexture&&(s.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(s.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){s.geometry=r(e.geometries,this.geometry);const a=this.geometry.parameters;if(a!==void 0&&a.shapes!==void 0){const l=a.shapes;if(Array.isArray(l))for(let c=0,h=l.length;c<h;c++){const u=l[c];r(e.shapes,u)}else r(e.shapes,l)}}if(this.isSkinnedMesh&&(s.bindMode=this.bindMode,s.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(r(e.skeletons,this.skeleton),s.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const a=[];for(let l=0,c=this.material.length;l<c;l++)a.push(r(e.materials,this.material[l]));s.material=a}else s.material=r(e.materials,this.material);if(this.children.length>0){s.children=[];for(let a=0;a<this.children.length;a++)s.children.push(this.children[a].toJSON(e).object)}if(this.animations.length>0){s.animations=[];for(let a=0;a<this.animations.length;a++){const l=this.animations[a];s.animations.push(r(e.animations,l))}}if(t){const a=o(e.geometries),l=o(e.materials),c=o(e.textures),h=o(e.images),u=o(e.shapes),d=o(e.skeletons),f=o(e.animations),p=o(e.nodes);a.length>0&&(n.geometries=a),l.length>0&&(n.materials=l),c.length>0&&(n.textures=c),h.length>0&&(n.images=h),u.length>0&&(n.shapes=u),d.length>0&&(n.skeletons=d),f.length>0&&(n.animations=f),p.length>0&&(n.nodes=p)}return n.object=s,n;function o(a){const l=[];for(const c in a){const h=a[c];delete h.metadata,l.push(h)}return l}}clone(e){return new this.constructor().copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),t===!0)for(let n=0;n<e.children.length;n++){const s=e.children[n];this.add(s.clone())}return this}}en.DEFAULT_UP=new he(0,1,0);en.DEFAULT_MATRIX_AUTO_UPDATE=!0;en.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const vs=new he,tr=new he,Of=new he,nr=new he,Sa=new he,Ia=new he,E_=new he,Uf=new he,Qf=new he,Vf=new he,zf=new Ot,Gf=new Ot,Hf=new Ot;class Cs{constructor(e=new he,t=new he,n=new he){this.a=e,this.b=t,this.c=n}static getNormal(e,t,n,s){s.subVectors(n,t),vs.subVectors(e,t),s.cross(vs);const r=s.lengthSq();return r>0?s.multiplyScalar(1/Math.sqrt(r)):s.set(0,0,0)}static getBarycoord(e,t,n,s,r){vs.subVectors(s,t),tr.subVectors(n,t),Of.subVectors(e,t);const o=vs.dot(vs),a=vs.dot(tr),l=vs.dot(Of),c=tr.dot(tr),h=tr.dot(Of),u=o*c-a*a;if(u===0)return r.set(0,0,0),null;const d=1/u,f=(c*l-a*h)*d,p=(o*h-a*l)*d;return r.set(1-f-p,p,f)}static containsPoint(e,t,n,s){return this.getBarycoord(e,t,n,s,nr)===null?!1:nr.x>=0&&nr.y>=0&&nr.x+nr.y<=1}static getInterpolation(e,t,n,s,r,o,a,l){return this.getBarycoord(e,t,n,s,nr)===null?(l.x=0,l.y=0,"z"in l&&(l.z=0),"w"in l&&(l.w=0),null):(l.setScalar(0),l.addScaledVector(r,nr.x),l.addScaledVector(o,nr.y),l.addScaledVector(a,nr.z),l)}static getInterpolatedAttribute(e,t,n,s,r,o){return zf.setScalar(0),Gf.setScalar(0),Hf.setScalar(0),zf.fromBufferAttribute(e,t),Gf.fromBufferAttribute(e,n),Hf.fromBufferAttribute(e,s),o.setScalar(0),o.addScaledVector(zf,r.x),o.addScaledVector(Gf,r.y),o.addScaledVector(Hf,r.z),o}static isFrontFacing(e,t,n,s){return vs.subVectors(n,t),tr.subVectors(e,t),vs.cross(tr).dot(s)<0}set(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this}setFromPointsAndIndices(e,t,n,s){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[s]),this}setFromAttributeAndIndices(e,t,n,s){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,n),this.c.fromBufferAttribute(e,s),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return vs.subVectors(this.c,this.b),tr.subVectors(this.a,this.b),vs.cross(tr).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return Cs.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return Cs.getBarycoord(e,this.a,this.b,this.c,t)}getInterpolation(e,t,n,s,r){return Cs.getInterpolation(e,this.a,this.b,this.c,t,n,s,r)}containsPoint(e){return Cs.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return Cs.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const n=this.a,s=this.b,r=this.c;let o,a;Sa.subVectors(s,n),Ia.subVectors(r,n),Uf.subVectors(e,n);const l=Sa.dot(Uf),c=Ia.dot(Uf);if(l<=0&&c<=0)return t.copy(n);Qf.subVectors(e,s);const h=Sa.dot(Qf),u=Ia.dot(Qf);if(h>=0&&u<=h)return t.copy(s);const d=l*u-h*c;if(d<=0&&l>=0&&h<=0)return o=l/(l-h),t.copy(n).addScaledVector(Sa,o);Vf.subVectors(e,r);const f=Sa.dot(Vf),p=Ia.dot(Vf);if(p>=0&&f<=p)return t.copy(r);const A=f*c-l*p;if(A<=0&&c>=0&&p<=0)return a=c/(c-p),t.copy(n).addScaledVector(Ia,a);const m=h*p-f*u;if(m<=0&&u-h>=0&&f-p>=0)return E_.subVectors(r,s),a=(u-h)/(u-h+(f-p)),t.copy(s).addScaledVector(E_,a);const g=1/(m+A+d);return o=A*g,a=d*g,t.copy(n).addScaledVector(Sa,o).addScaledVector(Ia,a)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}const Fw={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Rr={h:0,s:0,l:0},qh={h:0,s:0,l:0};function Wf(i,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?i+(e-i)*6*t:t<1/2?e:t<2/3?i+(e-i)*6*(2/3-t):i}class at{constructor(e,t,n){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,t,n)}set(e,t,n){if(t===void 0&&n===void 0){const s=e;s&&s.isColor?this.copy(s):typeof s=="number"?this.setHex(s):typeof s=="string"&&this.setStyle(s)}else this.setRGB(e,t,n);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=Ft){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,St.toWorkingColorSpace(this,t),this}setRGB(e,t,n,s=St.workingColorSpace){return this.r=e,this.g=t,this.b=n,St.toWorkingColorSpace(this,s),this}setHSL(e,t,n,s=St.workingColorSpace){if(e=lg(e,1),t=It(t,0,1),n=It(n,0,1),t===0)this.r=this.g=this.b=n;else{const r=n<=.5?n*(1+t):n+t-n*t,o=2*n-r;this.r=Wf(o,r,e+1/3),this.g=Wf(o,r,e),this.b=Wf(o,r,e-1/3)}return St.toWorkingColorSpace(this,s),this}setStyle(e,t=Ft){function n(r){r!==void 0&&parseFloat(r)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let s;if(s=/^(\w+)\(([^\)]*)\)/.exec(e)){let r;const o=s[1],a=s[2];switch(o){case"rgb":case"rgba":if(r=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return n(r[4]),this.setRGB(Math.min(255,parseInt(r[1],10))/255,Math.min(255,parseInt(r[2],10))/255,Math.min(255,parseInt(r[3],10))/255,t);if(r=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return n(r[4]),this.setRGB(Math.min(100,parseInt(r[1],10))/100,Math.min(100,parseInt(r[2],10))/100,Math.min(100,parseInt(r[3],10))/100,t);break;case"hsl":case"hsla":if(r=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return n(r[4]),this.setHSL(parseFloat(r[1])/360,parseFloat(r[2])/100,parseFloat(r[3])/100,t);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(s=/^\#([A-Fa-f\d]+)$/.exec(e)){const r=s[1],o=r.length;if(o===3)return this.setRGB(parseInt(r.charAt(0),16)/15,parseInt(r.charAt(1),16)/15,parseInt(r.charAt(2),16)/15,t);if(o===6)return this.setHex(parseInt(r,16),t);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,t);return this}setColorName(e,t=Ft){const n=Fw[e.toLowerCase()];return n!==void 0?this.setHex(n,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=vr(e.r),this.g=vr(e.g),this.b=vr(e.b),this}copyLinearToSRGB(e){return this.r=rl(e.r),this.g=rl(e.g),this.b=rl(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=Ft){return St.fromWorkingColorSpace(si.copy(this),e),Math.round(It(si.r*255,0,255))*65536+Math.round(It(si.g*255,0,255))*256+Math.round(It(si.b*255,0,255))}getHexString(e=Ft){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=St.workingColorSpace){St.fromWorkingColorSpace(si.copy(this),t);const n=si.r,s=si.g,r=si.b,o=Math.max(n,s,r),a=Math.min(n,s,r);let l,c;const h=(a+o)/2;if(a===o)l=0,c=0;else{const u=o-a;switch(c=h<=.5?u/(o+a):u/(2-o-a),o){case n:l=(s-r)/u+(s<r?6:0);break;case s:l=(r-n)/u+2;break;case r:l=(n-s)/u+4;break}l/=6}return e.h=l,e.s=c,e.l=h,e}getRGB(e,t=St.workingColorSpace){return St.fromWorkingColorSpace(si.copy(this),t),e.r=si.r,e.g=si.g,e.b=si.b,e}getStyle(e=Ft){St.fromWorkingColorSpace(si.copy(this),e);const t=si.r,n=si.g,s=si.b;return e!==Ft?"color(".concat(e," ").concat(t.toFixed(3)," ").concat(n.toFixed(3)," ").concat(s.toFixed(3),")"):"rgb(".concat(Math.round(t*255),",").concat(Math.round(n*255),",").concat(Math.round(s*255),")")}offsetHSL(e,t,n){return this.getHSL(Rr),this.setHSL(Rr.h+e,Rr.s+t,Rr.l+n)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,n){return this.r=e.r+(t.r-e.r)*n,this.g=e.g+(t.g-e.g)*n,this.b=e.b+(t.b-e.b)*n,this}lerpHSL(e,t){this.getHSL(Rr),e.getHSL(qh);const n=Sc(Rr.h,qh.h,t),s=Sc(Rr.s,qh.s,t),r=Sc(Rr.l,qh.l,t);return this.setHSL(n,s,r),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const t=this.r,n=this.g,s=this.b,r=e.elements;return this.r=r[0]*t+r[3]*n+r[6]*s,this.g=r[1]*t+r[4]*n+r[7]*s,this.b=r[2]*t+r[5]*n+r[8]*s,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const si=new at;at.NAMES=Fw;let l1=0;class xi extends ua{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:l1++}),this.uuid=fs(),this.name="",this.type="Material",this.blending=il,this.side=yr,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=Am,this.blendDst=gm,this.blendEquation=Oo,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new at(0,0,0),this.blendAlpha=0,this.depthFunc=Al,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=h_,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=va,this.stencilZFail=va,this.stencilZPass=va,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(const t in e){const n=e[t];if(n===void 0){console.warn("THREE.Material: parameter '".concat(t,"' has value of undefined."));continue}const s=this[t];if(s===void 0){console.warn("THREE.Material: '".concat(t,"' is not a property of THREE.").concat(this.type,"."));continue}s&&s.isColor?s.set(n):s&&s.isVector3&&n&&n.isVector3?s.copy(n):this[t]=n}}toJSON(e){const t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{}});const n={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};n.uuid=this.uuid,n.type=this.type,this.name!==""&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),this.roughness!==void 0&&(n.roughness=this.roughness),this.metalness!==void 0&&(n.metalness=this.metalness),this.sheen!==void 0&&(n.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(n.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(n.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity!==void 0&&this.emissiveIntensity!==1&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(n.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(n.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(n.shininess=this.shininess),this.clearcoat!==void 0&&(n.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.dispersion!==void 0&&(n.dispersion=this.dispersion),this.iridescence!==void 0&&(n.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(n.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(n.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(n.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(n.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.anisotropy!==void 0&&(n.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(n.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(n.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(e).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(e).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(n.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(n.combine=this.combine)),this.envMapRotation!==void 0&&(n.envMapRotation=this.envMapRotation.toArray()),this.envMapIntensity!==void 0&&(n.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(n.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(n.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(n.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(n.size=this.size),this.shadowSide!==null&&(n.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(n.sizeAttenuation=this.sizeAttenuation),this.blending!==il&&(n.blending=this.blending),this.side!==yr&&(n.side=this.side),this.vertexColors===!0&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),this.transparent===!0&&(n.transparent=!0),this.blendSrc!==Am&&(n.blendSrc=this.blendSrc),this.blendDst!==gm&&(n.blendDst=this.blendDst),this.blendEquation!==Oo&&(n.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(n.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(n.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(n.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(n.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(n.blendAlpha=this.blendAlpha),this.depthFunc!==Al&&(n.depthFunc=this.depthFunc),this.depthTest===!1&&(n.depthTest=this.depthTest),this.depthWrite===!1&&(n.depthWrite=this.depthWrite),this.colorWrite===!1&&(n.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(n.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==h_&&(n.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(n.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(n.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==va&&(n.stencilFail=this.stencilFail),this.stencilZFail!==va&&(n.stencilZFail=this.stencilZFail),this.stencilZPass!==va&&(n.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(n.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(n.rotation=this.rotation),this.polygonOffset===!0&&(n.polygonOffset=!0),this.polygonOffsetFactor!==0&&(n.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(n.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(n.linewidth=this.linewidth),this.dashSize!==void 0&&(n.dashSize=this.dashSize),this.gapSize!==void 0&&(n.gapSize=this.gapSize),this.scale!==void 0&&(n.scale=this.scale),this.dithering===!0&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),this.alphaHash===!0&&(n.alphaHash=!0),this.alphaToCoverage===!0&&(n.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(n.premultipliedAlpha=!0),this.forceSinglePass===!0&&(n.forceSinglePass=!0),this.wireframe===!0&&(n.wireframe=!0),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(n.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(n.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(n.flatShading=!0),this.visible===!1&&(n.visible=!1),this.toneMapped===!1&&(n.toneMapped=!1),this.fog===!1&&(n.fog=!1),Object.keys(this.userData).length>0&&(n.userData=this.userData);function s(r){const o=[];for(const a in r){const l=r[a];delete l.metadata,o.push(l)}return o}if(t){const r=s(e.textures),o=s(e.images);r.length>0&&(n.textures=r),o.length>0&&(n.images=o)}return n}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.blendColor.copy(e.blendColor),this.blendAlpha=e.blendAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let n=null;if(t!==null){const s=t.length;n=new Array(s);for(let r=0;r!==s;++r)n[r]=t[r].clone()}return this.clippingPlanes=n,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}onBuild(){console.warn("Material: onBuild() has been removed.")}}class zo extends xi{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new at(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Rn,this.combine=Vd,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const pr=c1();function c1(){const i=new ArrayBuffer(4),e=new Float32Array(i),t=new Uint32Array(i),n=new Uint32Array(512),s=new Uint32Array(512);for(let l=0;l<256;++l){const c=l-127;c<-27?(n[l]=0,n[l|256]=32768,s[l]=24,s[l|256]=24):c<-14?(n[l]=1024>>-c-14,n[l|256]=1024>>-c-14|32768,s[l]=-c-1,s[l|256]=-c-1):c<=15?(n[l]=c+15<<10,n[l|256]=c+15<<10|32768,s[l]=13,s[l|256]=13):c<128?(n[l]=31744,n[l|256]=64512,s[l]=24,s[l|256]=24):(n[l]=31744,n[l|256]=64512,s[l]=13,s[l|256]=13)}const r=new Uint32Array(2048),o=new Uint32Array(64),a=new Uint32Array(64);for(let l=1;l<1024;++l){let c=l<<13,h=0;for(;!(c&8388608);)c<<=1,h-=8388608;c&=-8388609,h+=947912704,r[l]=c|h}for(let l=1024;l<2048;++l)r[l]=939524096+(l-1024<<13);for(let l=1;l<31;++l)o[l]=l<<23;o[31]=1199570944,o[32]=2147483648;for(let l=33;l<63;++l)o[l]=2147483648+(l-32<<23);o[63]=3347054592;for(let l=1;l<64;++l)l!==32&&(a[l]=1024);return{floatView:e,uint32View:t,baseTable:n,shiftTable:s,mantissaTable:r,exponentTable:o,offsetTable:a}}function h1(i){Math.abs(i)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),i=It(i,-65504,65504),pr.floatView[0]=i;const e=pr.uint32View[0],t=e>>23&511;return pr.baseTable[t]+((e&8388607)>>pr.shiftTable[t])}function u1(i){const e=i>>10;return pr.uint32View[0]=pr.mantissaTable[pr.offsetTable[e]+(i&1023)]+pr.exponentTable[e],pr.floatView[0]}const Wa={toHalfFloat:h1,fromHalfFloat:u1},Dn=new he,jh=new Me;class Zn{constructor(e,t,n=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=t,this.count=e!==void 0?e.length/t:0,this.normalized=n,this.usage=Wm,this.updateRanges=[],this.gpuType=Sn,this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,t,n){e*=this.itemSize,n*=t.itemSize;for(let s=0,r=this.itemSize;s<r;s++)this.array[e+s]=t.array[n+s];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(this.itemSize===2)for(let t=0,n=this.count;t<n;t++)jh.fromBufferAttribute(this,t),jh.applyMatrix3(e),this.setXY(t,jh.x,jh.y);else if(this.itemSize===3)for(let t=0,n=this.count;t<n;t++)Dn.fromBufferAttribute(this,t),Dn.applyMatrix3(e),this.setXYZ(t,Dn.x,Dn.y,Dn.z);return this}applyMatrix4(e){for(let t=0,n=this.count;t<n;t++)Dn.fromBufferAttribute(this,t),Dn.applyMatrix4(e),this.setXYZ(t,Dn.x,Dn.y,Dn.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)Dn.fromBufferAttribute(this,t),Dn.applyNormalMatrix(e),this.setXYZ(t,Dn.x,Dn.y,Dn.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)Dn.fromBufferAttribute(this,t),Dn.transformDirection(e),this.setXYZ(t,Dn.x,Dn.y,Dn.z);return this}set(e,t=0){return this.array.set(e,t),this}getComponent(e,t){let n=this.array[e*this.itemSize+t];return this.normalized&&(n=Es(n,this.array)),n}setComponent(e,t,n){return this.normalized&&(n=Yt(n,this.array)),this.array[e*this.itemSize+t]=n,this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=Es(t,this.array)),t}setX(e,t){return this.normalized&&(t=Yt(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=Es(t,this.array)),t}setY(e,t){return this.normalized&&(t=Yt(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=Es(t,this.array)),t}setZ(e,t){return this.normalized&&(t=Yt(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=Es(t,this.array)),t}setW(e,t){return this.normalized&&(t=Yt(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,n){return e*=this.itemSize,this.normalized&&(t=Yt(t,this.array),n=Yt(n,this.array)),this.array[e+0]=t,this.array[e+1]=n,this}setXYZ(e,t,n,s){return e*=this.itemSize,this.normalized&&(t=Yt(t,this.array),n=Yt(n,this.array),s=Yt(s,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=s,this}setXYZW(e,t,n,s,r){return e*=this.itemSize,this.normalized&&(t=Yt(t,this.array),n=Yt(n,this.array),s=Yt(s,this.array),r=Yt(r,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=s,this.array[e+3]=r,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==Wm&&(e.usage=this.usage),e}}class cg extends Zn{constructor(e,t,n){super(new Uint16Array(e),t,n)}}class Nw extends Zn{constructor(e,t,n){super(new Uint32Array(e),t,n)}}class jt extends Zn{constructor(e,t,n){super(new Float32Array(e),t,n)}}let d1=0;const Zi=new pt,qf=new en,Ma=new he,ki=new ps,ql=new ps,Xn=new he;class Nn extends ua{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:d1++}),this.uuid=fs(),this.name="",this.type="BufferGeometry",this.index=null,this.indirect=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(Bw(e)?Nw:cg)(e,1):this.index=e,this}setIndirect(e){return this.indirect=e,this}getIndirect(){return this.indirect}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,t,n=0){this.groups.push({start:e,count:t,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;t!==void 0&&(t.applyMatrix4(e),t.needsUpdate=!0);const n=this.attributes.normal;if(n!==void 0){const r=new wt().getNormalMatrix(e);n.applyNormalMatrix(r),n.needsUpdate=!0}const s=this.attributes.tangent;return s!==void 0&&(s.transformDirection(e),s.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return Zi.makeRotationFromQuaternion(e),this.applyMatrix4(Zi),this}rotateX(e){return Zi.makeRotationX(e),this.applyMatrix4(Zi),this}rotateY(e){return Zi.makeRotationY(e),this.applyMatrix4(Zi),this}rotateZ(e){return Zi.makeRotationZ(e),this.applyMatrix4(Zi),this}translate(e,t,n){return Zi.makeTranslation(e,t,n),this.applyMatrix4(Zi),this}scale(e,t,n){return Zi.makeScale(e,t,n),this.applyMatrix4(Zi),this}lookAt(e){return qf.lookAt(e),qf.updateMatrix(),this.applyMatrix4(qf.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Ma).negate(),this.translate(Ma.x,Ma.y,Ma.z),this}setFromPoints(e){const t=this.getAttribute("position");if(t===void 0){const n=[];for(let s=0,r=e.length;s<r;s++){const o=e[s];n.push(o.x,o.y,o.z||0)}this.setAttribute("position",new jt(n,3))}else{const n=Math.min(e.length,t.count);for(let s=0;s<n;s++){const r=e[s];t.setXYZ(s,r.x,r.y,r.z||0)}e.length>t.count&&console.warn("THREE.BufferGeometry: Buffer size too small for points data. Use .dispose() and create a new geometry."),t.needsUpdate=!0}return this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new ps);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),this.boundingBox.set(new he(-1/0,-1/0,-1/0),new he(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),t)for(let n=0,s=t.length;n<s;n++){const r=t[n];ki.setFromBufferAttribute(r),this.morphTargetsRelative?(Xn.addVectors(this.boundingBox.min,ki.min),this.boundingBox.expandByPoint(Xn),Xn.addVectors(this.boundingBox.max,ki.max),this.boundingBox.expandByPoint(Xn)):(this.boundingBox.expandByPoint(ki.min),this.boundingBox.expandByPoint(ki.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Xs);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),this.boundingSphere.set(new he,1/0);return}if(e){const n=this.boundingSphere.center;if(ki.setFromBufferAttribute(e),t)for(let r=0,o=t.length;r<o;r++){const a=t[r];ql.setFromBufferAttribute(a),this.morphTargetsRelative?(Xn.addVectors(ki.min,ql.min),ki.expandByPoint(Xn),Xn.addVectors(ki.max,ql.max),ki.expandByPoint(Xn)):(ki.expandByPoint(ql.min),ki.expandByPoint(ql.max))}ki.getCenter(n);let s=0;for(let r=0,o=e.count;r<o;r++)Xn.fromBufferAttribute(e,r),s=Math.max(s,n.distanceToSquared(Xn));if(t)for(let r=0,o=t.length;r<o;r++){const a=t[r],l=this.morphTargetsRelative;for(let c=0,h=a.count;c<h;c++)Xn.fromBufferAttribute(a,c),l&&(Ma.fromBufferAttribute(e,c),Xn.add(Ma)),s=Math.max(s,n.distanceToSquared(Xn))}this.boundingSphere.radius=Math.sqrt(s),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(e===null||t.position===void 0||t.normal===void 0||t.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const n=t.position,s=t.normal,r=t.uv;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new Zn(new Float32Array(4*n.count),4));const o=this.getAttribute("tangent"),a=[],l=[];for(let I=0;I<n.count;I++)a[I]=new he,l[I]=new he;const c=new he,h=new he,u=new he,d=new Me,f=new Me,p=new Me,A=new he,m=new he;function g(I,x,w){c.fromBufferAttribute(n,I),h.fromBufferAttribute(n,x),u.fromBufferAttribute(n,w),d.fromBufferAttribute(r,I),f.fromBufferAttribute(r,x),p.fromBufferAttribute(r,w),h.sub(c),u.sub(c),f.sub(d),p.sub(d);const P=1/(f.x*p.y-p.x*f.y);isFinite(P)&&(A.copy(h).multiplyScalar(p.y).addScaledVector(u,-f.y).multiplyScalar(P),m.copy(u).multiplyScalar(f.x).addScaledVector(h,-p.x).multiplyScalar(P),a[I].add(A),a[x].add(A),a[w].add(A),l[I].add(m),l[x].add(m),l[w].add(m))}let y=this.groups;y.length===0&&(y=[{start:0,count:e.count}]);for(let I=0,x=y.length;I<x;++I){const w=y[I],P=w.start,z=w.count;for(let H=P,K=P+z;H<K;H+=3)g(e.getX(H+0),e.getX(H+1),e.getX(H+2))}const _=new he,v=new he,b=new he,T=new he;function L(I){b.fromBufferAttribute(s,I),T.copy(b);const x=a[I];_.copy(x),_.sub(b.multiplyScalar(b.dot(x))).normalize(),v.crossVectors(T,x);const P=v.dot(l[I])<0?-1:1;o.setXYZW(I,_.x,_.y,_.z,P)}for(let I=0,x=y.length;I<x;++I){const w=y[I],P=w.start,z=w.count;for(let H=P,K=P+z;H<K;H+=3)L(e.getX(H+0)),L(e.getX(H+1)),L(e.getX(H+2))}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(t!==void 0){let n=this.getAttribute("normal");if(n===void 0)n=new Zn(new Float32Array(t.count*3),3),this.setAttribute("normal",n);else for(let d=0,f=n.count;d<f;d++)n.setXYZ(d,0,0,0);const s=new he,r=new he,o=new he,a=new he,l=new he,c=new he,h=new he,u=new he;if(e)for(let d=0,f=e.count;d<f;d+=3){const p=e.getX(d+0),A=e.getX(d+1),m=e.getX(d+2);s.fromBufferAttribute(t,p),r.fromBufferAttribute(t,A),o.fromBufferAttribute(t,m),h.subVectors(o,r),u.subVectors(s,r),h.cross(u),a.fromBufferAttribute(n,p),l.fromBufferAttribute(n,A),c.fromBufferAttribute(n,m),a.add(h),l.add(h),c.add(h),n.setXYZ(p,a.x,a.y,a.z),n.setXYZ(A,l.x,l.y,l.z),n.setXYZ(m,c.x,c.y,c.z)}else for(let d=0,f=t.count;d<f;d+=3)s.fromBufferAttribute(t,d+0),r.fromBufferAttribute(t,d+1),o.fromBufferAttribute(t,d+2),h.subVectors(o,r),u.subVectors(s,r),h.cross(u),n.setXYZ(d+0,h.x,h.y,h.z),n.setXYZ(d+1,h.x,h.y,h.z),n.setXYZ(d+2,h.x,h.y,h.z);this.normalizeNormals(),n.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let t=0,n=e.count;t<n;t++)Xn.fromBufferAttribute(e,t),Xn.normalize(),e.setXYZ(t,Xn.x,Xn.y,Xn.z)}toNonIndexed(){function e(a,l){const c=a.array,h=a.itemSize,u=a.normalized,d=new c.constructor(l.length*h);let f=0,p=0;for(let A=0,m=l.length;A<m;A++){a.isInterleavedBufferAttribute?f=l[A]*a.data.stride+a.offset:f=l[A]*h;for(let g=0;g<h;g++)d[p++]=c[f++]}return new Zn(d,h,u)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new Nn,n=this.index.array,s=this.attributes;for(const a in s){const l=s[a],c=e(l,n);t.setAttribute(a,c)}const r=this.morphAttributes;for(const a in r){const l=[],c=r[a];for(let h=0,u=c.length;h<u;h++){const d=c[h],f=e(d,n);l.push(f)}t.morphAttributes[a]=l}t.morphTargetsRelative=this.morphTargetsRelative;const o=this.groups;for(let a=0,l=o.length;a<l;a++){const c=o[a];t.addGroup(c.start,c.count,c.materialIndex)}return t}toJSON(){const e={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){const l=this.parameters;for(const c in l)l[c]!==void 0&&(e[c]=l[c]);return e}e.data={attributes:{}};const t=this.index;t!==null&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const n=this.attributes;for(const l in n){const c=n[l];e.data.attributes[l]=c.toJSON(e.data)}const s={};let r=!1;for(const l in this.morphAttributes){const c=this.morphAttributes[l],h=[];for(let u=0,d=c.length;u<d;u++){const f=c[u];h.push(f.toJSON(e.data))}h.length>0&&(s[l]=h,r=!0)}r&&(e.data.morphAttributes=s,e.data.morphTargetsRelative=this.morphTargetsRelative);const o=this.groups;o.length>0&&(e.data.groups=JSON.parse(JSON.stringify(o)));const a=this.boundingSphere;return a!==null&&(e.data.boundingSphere={center:a.center.toArray(),radius:a.radius}),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const n=e.index;n!==null&&this.setIndex(n.clone(t));const s=e.attributes;for(const c in s){const h=s[c];this.setAttribute(c,h.clone(t))}const r=e.morphAttributes;for(const c in r){const h=[],u=r[c];for(let d=0,f=u.length;d<f;d++)h.push(u[d].clone(t));this.morphAttributes[c]=h}this.morphTargetsRelative=e.morphTargetsRelative;const o=e.groups;for(let c=0,h=o.length;c<h;c++){const u=o[c];this.addGroup(u.start,u.count,u.materialIndex)}const a=e.boundingBox;a!==null&&(this.boundingBox=a.clone());const l=e.boundingSphere;return l!==null&&(this.boundingSphere=l.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const C_=new pt,Eo=new _h,Xh=new Xs,S_=new he,Yh=new he,Kh=new he,$h=new he,jf=new he,Jh=new he,I_=new he,Zh=new he;class $n extends en{constructor(e=new Nn,t=new zo){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){const t=this.geometry.morphAttributes,n=Object.keys(t);if(n.length>0){const s=t[n[0]];if(s!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,o=s.length;r<o;r++){const a=s[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=r}}}}getVertexPosition(e,t){const n=this.geometry,s=n.attributes.position,r=n.morphAttributes.position,o=n.morphTargetsRelative;t.fromBufferAttribute(s,e);const a=this.morphTargetInfluences;if(r&&a){Jh.set(0,0,0);for(let l=0,c=r.length;l<c;l++){const h=a[l],u=r[l];h!==0&&(jf.fromBufferAttribute(u,e),o?Jh.addScaledVector(jf,h):Jh.addScaledVector(jf.sub(t),h))}t.add(Jh)}return t}raycast(e,t){const n=this.geometry,s=this.material,r=this.matrixWorld;s!==void 0&&(n.boundingSphere===null&&n.computeBoundingSphere(),Xh.copy(n.boundingSphere),Xh.applyMatrix4(r),Eo.copy(e.ray).recast(e.near),!(Xh.containsPoint(Eo.origin)===!1&&(Eo.intersectSphere(Xh,S_)===null||Eo.origin.distanceToSquared(S_)>(e.far-e.near)**2))&&(C_.copy(r).invert(),Eo.copy(e.ray).applyMatrix4(C_),!(n.boundingBox!==null&&Eo.intersectsBox(n.boundingBox)===!1)&&this._computeIntersections(e,t,Eo)))}_computeIntersections(e,t,n){let s;const r=this.geometry,o=this.material,a=r.index,l=r.attributes.position,c=r.attributes.uv,h=r.attributes.uv1,u=r.attributes.normal,d=r.groups,f=r.drawRange;if(a!==null)if(Array.isArray(o))for(let p=0,A=d.length;p<A;p++){const m=d[p],g=o[m.materialIndex],y=Math.max(m.start,f.start),_=Math.min(a.count,Math.min(m.start+m.count,f.start+f.count));for(let v=y,b=_;v<b;v+=3){const T=a.getX(v),L=a.getX(v+1),I=a.getX(v+2);s=eu(this,g,e,n,c,h,u,T,L,I),s&&(s.faceIndex=Math.floor(v/3),s.face.materialIndex=m.materialIndex,t.push(s))}}else{const p=Math.max(0,f.start),A=Math.min(a.count,f.start+f.count);for(let m=p,g=A;m<g;m+=3){const y=a.getX(m),_=a.getX(m+1),v=a.getX(m+2);s=eu(this,o,e,n,c,h,u,y,_,v),s&&(s.faceIndex=Math.floor(m/3),t.push(s))}}else if(l!==void 0)if(Array.isArray(o))for(let p=0,A=d.length;p<A;p++){const m=d[p],g=o[m.materialIndex],y=Math.max(m.start,f.start),_=Math.min(l.count,Math.min(m.start+m.count,f.start+f.count));for(let v=y,b=_;v<b;v+=3){const T=v,L=v+1,I=v+2;s=eu(this,g,e,n,c,h,u,T,L,I),s&&(s.faceIndex=Math.floor(v/3),s.face.materialIndex=m.materialIndex,t.push(s))}}else{const p=Math.max(0,f.start),A=Math.min(l.count,f.start+f.count);for(let m=p,g=A;m<g;m+=3){const y=m,_=m+1,v=m+2;s=eu(this,o,e,n,c,h,u,y,_,v),s&&(s.faceIndex=Math.floor(m/3),t.push(s))}}}}function f1(i,e,t,n,s,r,o,a){let l;if(e.side===Ti?l=n.intersectTriangle(o,r,s,!0,a):l=n.intersectTriangle(s,r,o,e.side===yr,a),l===null)return null;Zh.copy(a),Zh.applyMatrix4(i.matrixWorld);const c=t.ray.origin.distanceTo(Zh);return c<t.near||c>t.far?null:{distance:c,point:Zh.clone(),object:i}}function eu(i,e,t,n,s,r,o,a,l,c){i.getVertexPosition(a,Yh),i.getVertexPosition(l,Kh),i.getVertexPosition(c,$h);const h=f1(i,e,t,n,Yh,Kh,$h,I_);if(h){const u=new he;Cs.getBarycoord(I_,Yh,Kh,$h,u),s&&(h.uv=Cs.getInterpolatedAttribute(s,a,l,c,u,new Me)),r&&(h.uv1=Cs.getInterpolatedAttribute(r,a,l,c,u,new Me)),o&&(h.normal=Cs.getInterpolatedAttribute(o,a,l,c,u,new he),h.normal.dot(n.direction)>0&&h.normal.multiplyScalar(-1));const d={a,b:l,c,normal:new he,materialIndex:0};Cs.getNormal(Yh,Kh,$h,d.normal),h.face=d,h.barycoord=u}return h}class yh extends Nn{constructor(e=1,t=1,n=1,s=1,r=1,o=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:n,widthSegments:s,heightSegments:r,depthSegments:o};const a=this;s=Math.floor(s),r=Math.floor(r),o=Math.floor(o);const l=[],c=[],h=[],u=[];let d=0,f=0;p("z","y","x",-1,-1,n,t,e,o,r,0),p("z","y","x",1,-1,n,t,-e,o,r,1),p("x","z","y",1,1,e,n,t,s,o,2),p("x","z","y",1,-1,e,n,-t,s,o,3),p("x","y","z",1,-1,e,t,n,s,r,4),p("x","y","z",-1,-1,e,t,-n,s,r,5),this.setIndex(l),this.setAttribute("position",new jt(c,3)),this.setAttribute("normal",new jt(h,3)),this.setAttribute("uv",new jt(u,2));function p(A,m,g,y,_,v,b,T,L,I,x){const w=v/L,P=b/I,z=v/2,H=b/2,K=T/2,le=L+1,J=I+1;let W=0,O=0;const fe=new he;for(let ue=0;ue<J;ue++){const ee=ue*P-H;for(let de=0;de<le;de++){const ae=de*w-z;fe[A]=ae*y,fe[m]=ee*_,fe[g]=K,c.push(fe.x,fe.y,fe.z),fe[A]=0,fe[m]=0,fe[g]=T>0?1:-1,h.push(fe.x,fe.y,fe.z),u.push(de/L),u.push(1-ue/I),W+=1}}for(let ue=0;ue<I;ue++)for(let ee=0;ee<L;ee++){const de=d+ee+le*ue,ae=d+ee+le*(ue+1),R=d+(ee+1)+le*(ue+1),M=d+(ee+1)+le*ue;l.push(de,ae,M),l.push(ae,R,M),O+=6}a.addGroup(f,O,x),f+=O,d+=W}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new yh(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function xl(i){const e={};for(const t in i){e[t]={};for(const n in i[t]){const s=i[t][n];s&&(s.isColor||s.isMatrix3||s.isMatrix4||s.isVector2||s.isVector3||s.isVector4||s.isTexture||s.isQuaternion)?s.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),e[t][n]=null):e[t][n]=s.clone():Array.isArray(s)?e[t][n]=s.slice():e[t][n]=s}}return e}function mi(i){const e={};for(let t=0;t<i.length;t++){const n=xl(i[t]);for(const s in n)e[s]=n[s]}return e}function p1(i){const e=[];for(let t=0;t<i.length;t++)e.push(i[t].clone());return e}function kw(i){const e=i.getRenderTarget();return e===null?i.outputColorSpace:e.isXRRenderTarget===!0?e.texture.colorSpace:St.workingColorSpace}const m1={clone:xl,merge:mi};var A1="void main() {\n	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",g1="void main() {\n	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}";class co extends xi{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=A1,this.fragmentShader=g1,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=xl(e.uniforms),this.uniformsGroups=p1(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const s in this.uniforms){const o=this.uniforms[s].value;o&&o.isTexture?t.uniforms[s]={type:"t",value:o.toJSON(e).uuid}:o&&o.isColor?t.uniforms[s]={type:"c",value:o.getHex()}:o&&o.isVector2?t.uniforms[s]={type:"v2",value:o.toArray()}:o&&o.isVector3?t.uniforms[s]={type:"v3",value:o.toArray()}:o&&o.isVector4?t.uniforms[s]={type:"v4",value:o.toArray()}:o&&o.isMatrix3?t.uniforms[s]={type:"m3",value:o.toArray()}:o&&o.isMatrix4?t.uniforms[s]={type:"m4",value:o.toArray()}:t.uniforms[s]={value:o}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t.lights=this.lights,t.clipping=this.clipping;const n={};for(const s in this.extensions)this.extensions[s]===!0&&(n[s]=!0);return Object.keys(n).length>0&&(t.extensions=n),t}}let hg=class extends en{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new pt,this.projectionMatrix=new pt,this.projectionMatrixInverse=new pt,this.coordinateSystem=Os}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}};const Pr=new he,M_=new Me,T_=new Me;class ai extends hg{constructor(e=50,t=1,n=.1,s=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=n,this.far=s,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=yl*2*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(Cc*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return yl*2*Math.atan(Math.tan(Cc*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(e,t,n){Pr.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),t.set(Pr.x,Pr.y).multiplyScalar(-e/Pr.z),Pr.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),n.set(Pr.x,Pr.y).multiplyScalar(-e/Pr.z)}getViewSize(e,t){return this.getViewBounds(e,M_,T_),t.subVectors(T_,M_)}setViewOffset(e,t,n,s,r,o){this.aspect=e/t,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=s,this.view.width=r,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(Cc*.5*this.fov)/this.zoom,n=2*t,s=this.aspect*n,r=-.5*s;const o=this.view;if(this.view!==null&&this.view.enabled){const l=o.fullWidth,c=o.fullHeight;r+=o.offsetX*s/l,t-=o.offsetY*n/c,s*=o.width/l,n*=o.height/c}const a=this.filmOffset;a!==0&&(r+=e*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(r,r+s,t,t-n,e,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,this.view!==null&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}const Ta=-90,Ba=1;class v1 extends en{constructor(e,t,n){super(),this.type="CubeCamera",this.renderTarget=n,this.coordinateSystem=null,this.activeMipmapLevel=0;const s=new ai(Ta,Ba,e,t);s.layers=this.layers,this.add(s);const r=new ai(Ta,Ba,e,t);r.layers=this.layers,this.add(r);const o=new ai(Ta,Ba,e,t);o.layers=this.layers,this.add(o);const a=new ai(Ta,Ba,e,t);a.layers=this.layers,this.add(a);const l=new ai(Ta,Ba,e,t);l.layers=this.layers,this.add(l);const c=new ai(Ta,Ba,e,t);c.layers=this.layers,this.add(c)}updateCoordinateSystem(){const e=this.coordinateSystem,t=this.children.concat(),[n,s,r,o,a,l]=t;for(const c of t)this.remove(c);if(e===Os)n.up.set(0,1,0),n.lookAt(1,0,0),s.up.set(0,1,0),s.lookAt(-1,0,0),r.up.set(0,0,-1),r.lookAt(0,1,0),o.up.set(0,0,1),o.lookAt(0,-1,0),a.up.set(0,1,0),a.lookAt(0,0,1),l.up.set(0,1,0),l.lookAt(0,0,-1);else if(e===cd)n.up.set(0,-1,0),n.lookAt(-1,0,0),s.up.set(0,-1,0),s.lookAt(1,0,0),r.up.set(0,0,1),r.lookAt(0,1,0),o.up.set(0,0,-1),o.lookAt(0,-1,0),a.up.set(0,-1,0),a.lookAt(0,0,1),l.up.set(0,-1,0),l.lookAt(0,0,-1);else throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);for(const c of t)this.add(c),c.updateMatrixWorld()}update(e,t){this.parent===null&&this.updateMatrixWorld();const{renderTarget:n,activeMipmapLevel:s}=this;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());const[r,o,a,l,c,h]=this.children,u=e.getRenderTarget(),d=e.getActiveCubeFace(),f=e.getActiveMipmapLevel(),p=e.xr.enabled;e.xr.enabled=!1;const A=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,e.setRenderTarget(n,0,s),e.render(t,r),e.setRenderTarget(n,1,s),e.render(t,o),e.setRenderTarget(n,2,s),e.render(t,a),e.setRenderTarget(n,3,s),e.render(t,l),e.setRenderTarget(n,4,s),e.render(t,c),n.texture.generateMipmaps=A,e.setRenderTarget(n,5,s),e.render(t,h),e.setRenderTarget(u,d,f),e.xr.enabled=p,n.texture.needsPMREMUpdate=!0}}class ug extends Pn{constructor(e,t,n,s,r,o,a,l,c,h){e=e!==void 0?e:[],t=t!==void 0?t:ea,super(e,t,n,s,r,o,a,l,c,h),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class _1 extends na{constructor(e=1,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;const n={width:e,height:e,depth:1},s=[n,n,n,n,n,n];this.texture=new ug(s,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=t.generateMipmaps!==void 0?t.generateMipmaps:!1,this.texture.minFilter=t.minFilter!==void 0?t.minFilter:Zt}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const n={uniforms:{tEquirect:{value:null}},vertexShader:"\n\n				varying vec3 vWorldDirection;\n\n				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n				}\n\n				void main() {\n\n					vWorldDirection = transformDirection( position, modelMatrix );\n\n					#include <begin_vertex>\n					#include <project_vertex>\n\n				}\n			",fragmentShader:"\n\n				uniform sampler2D tEquirect;\n\n				varying vec3 vWorldDirection;\n\n				#include <common>\n\n				void main() {\n\n					vec3 direction = normalize( vWorldDirection );\n\n					vec2 sampleUV = equirectUv( direction );\n\n					gl_FragColor = texture2D( tEquirect, sampleUV );\n\n				}\n			"},s=new yh(5,5,5),r=new co({name:"CubemapFromEquirect",uniforms:xl(n.uniforms),vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,side:Ti,blending:eo});r.uniforms.tEquirect.value=t;const o=new $n(s,r),a=t.minFilter;return t.minFilter===os&&(t.minFilter=Zt),new v1(1,10,this).update(e,o),t.minFilter=a,o.geometry.dispose(),o.material.dispose(),this}clear(e,t,n,s){const r=e.getRenderTarget();for(let o=0;o<6;o++)e.setRenderTarget(this,o),e.clear(t,n,s);e.setRenderTarget(r)}}class y1 extends en{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new Rn,this.environmentIntensity=1,this.environmentRotation=new Rn,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,this.backgroundRotation.copy(e.backgroundRotation),this.environmentIntensity=e.environmentIntensity,this.environmentRotation.copy(e.environmentRotation),e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return this.fog!==null&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(t.object.backgroundIntensity=this.backgroundIntensity),t.object.backgroundRotation=this.backgroundRotation.toArray(),this.environmentIntensity!==1&&(t.object.environmentIntensity=this.environmentIntensity),t.object.environmentRotation=this.environmentRotation.toArray(),t}}class x1{constructor(e,t){this.isInterleavedBuffer=!0,this.array=e,this.stride=t,this.count=e!==void 0?e.length/t:0,this.usage=Wm,this.updateRanges=[],this.version=0,this.uuid=fs()}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,n){e*=this.stride,n*=t.stride;for(let s=0,r=this.stride;s<r;s++)this.array[e+s]=t.array[n+s];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=fs()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),n=new this.constructor(t,this.stride);return n.setUsage(this.usage),n}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=fs()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const di=new he;class dg{constructor(e,t,n,s=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=t,this.offset=n,this.normalized=s}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,n=this.data.count;t<n;t++)di.fromBufferAttribute(this,t),di.applyMatrix4(e),this.setXYZ(t,di.x,di.y,di.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)di.fromBufferAttribute(this,t),di.applyNormalMatrix(e),this.setXYZ(t,di.x,di.y,di.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)di.fromBufferAttribute(this,t),di.transformDirection(e),this.setXYZ(t,di.x,di.y,di.z);return this}getComponent(e,t){let n=this.array[e*this.data.stride+this.offset+t];return this.normalized&&(n=Es(n,this.array)),n}setComponent(e,t,n){return this.normalized&&(n=Yt(n,this.array)),this.data.array[e*this.data.stride+this.offset+t]=n,this}setX(e,t){return this.normalized&&(t=Yt(t,this.array)),this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.normalized&&(t=Yt(t,this.array)),this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.normalized&&(t=Yt(t,this.array)),this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.normalized&&(t=Yt(t,this.array)),this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){let t=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(t=Es(t,this.array)),t}getY(e){let t=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(t=Es(t,this.array)),t}getZ(e){let t=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(t=Es(t,this.array)),t}getW(e){let t=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(t=Es(t,this.array)),t}setXY(e,t,n){return e=e*this.data.stride+this.offset,this.normalized&&(t=Yt(t,this.array),n=Yt(n,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this}setXYZ(e,t,n,s){return e=e*this.data.stride+this.offset,this.normalized&&(t=Yt(t,this.array),n=Yt(n,this.array),s=Yt(s,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=s,this}setXYZW(e,t,n,s,r){return e=e*this.data.stride+this.offset,this.normalized&&(t=Yt(t,this.array),n=Yt(n,this.array),s=Yt(s,this.array),r=Yt(r,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=s,this.data.array[e+3]=r,this}clone(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let n=0;n<this.count;n++){const s=n*this.data.stride+this.offset;for(let r=0;r<this.itemSize;r++)t.push(this.data.array[s+r])}return new Zn(new this.array.constructor(t),this.itemSize,this.normalized)}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new dg(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let n=0;n<this.count;n++){const s=n*this.data.stride+this.offset;for(let r=0;r<this.itemSize;r++)t.push(this.data.array[s+r])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}const B_=new he,R_=new Ot,P_=new Ot,w1=new he,D_=new pt,tu=new he,Xf=new Xs,L_=new pt,Yf=new _h;class Ow extends $n{constructor(e,t){super(e,t),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode=o_,this.bindMatrix=new pt,this.bindMatrixInverse=new pt,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const e=this.geometry;this.boundingBox===null&&(this.boundingBox=new ps),this.boundingBox.makeEmpty();const t=e.getAttribute("position");for(let n=0;n<t.count;n++)this.getVertexPosition(n,tu),this.boundingBox.expandByPoint(tu)}computeBoundingSphere(){const e=this.geometry;this.boundingSphere===null&&(this.boundingSphere=new Xs),this.boundingSphere.makeEmpty();const t=e.getAttribute("position");for(let n=0;n<t.count;n++)this.getVertexPosition(n,tu),this.boundingSphere.expandByPoint(tu)}copy(e,t){return super.copy(e,t),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}raycast(e,t){const n=this.material,s=this.matrixWorld;n!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),Xf.copy(this.boundingSphere),Xf.applyMatrix4(s),e.ray.intersectsSphere(Xf)!==!1&&(L_.copy(s).invert(),Yf.copy(e.ray).applyMatrix4(L_),!(this.boundingBox!==null&&Yf.intersectsBox(this.boundingBox)===!1)&&this._computeIntersections(e,t,Yf)))}getVertexPosition(e,t){return super.getVertexPosition(e,t),this.applyBoneTransform(e,t),t}bind(e,t){this.skeleton=e,t===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const e=new Ot,t=this.geometry.attributes.skinWeight;for(let n=0,s=t.count;n<s;n++){e.fromBufferAttribute(t,n);const r=1/e.manhattanLength();r!==1/0?e.multiplyScalar(r):e.set(1,0,0,0),t.setXYZW(n,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.bindMode===o_?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode===gT?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(e,t){const n=this.skeleton,s=this.geometry;R_.fromBufferAttribute(s.attributes.skinIndex,e),P_.fromBufferAttribute(s.attributes.skinWeight,e),B_.copy(t).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let r=0;r<4;r++){const o=P_.getComponent(r);if(o!==0){const a=R_.getComponent(r);D_.multiplyMatrices(n.bones[a].matrixWorld,n.boneInverses[a]),t.addScaledVector(w1.copy(B_).applyMatrix4(D_),o)}}return t.applyMatrix4(this.bindMatrixInverse)}}class hd extends en{constructor(){super(),this.isBone=!0,this.type="Bone"}}class Gd extends Pn{constructor(e=null,t=1,n=1,s,r,o,a,l,c=yi,h=yi,u,d){super(null,o,a,l,c,h,s,r,u,d),this.isDataTexture=!0,this.image={data:e,width:t,height:n},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const F_=new pt,b1=new pt;class Hd{constructor(e=[],t=[]){this.uuid=fs(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.init()}init(){const e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(e.length*16),t.length===0)this.calculateInverses();else if(e.length!==t.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let n=0,s=this.bones.length;n<s;n++)this.boneInverses.push(new pt)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,t=this.bones.length;e<t;e++){const n=new pt;this.bones[e]&&n.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(n)}}pose(){for(let e=0,t=this.bones.length;e<t;e++){const n=this.bones[e];n&&n.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){const n=this.bones[e];n&&(n.parent&&n.parent.isBone?(n.matrix.copy(n.parent.matrixWorld).invert(),n.matrix.multiply(n.matrixWorld)):n.matrix.copy(n.matrixWorld),n.matrix.decompose(n.position,n.quaternion,n.scale))}}update(){const e=this.bones,t=this.boneInverses,n=this.boneMatrices,s=this.boneTexture;for(let r=0,o=e.length;r<o;r++){const a=e[r]?e[r].matrixWorld:b1;F_.multiplyMatrices(a,t[r]),F_.toArray(n,r*16)}s!==null&&(s.needsUpdate=!0)}clone(){return new Hd(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(this.bones.length*4);e=Math.ceil(e/4)*4,e=Math.max(e,4);const t=new Float32Array(e*e*4);t.set(this.boneMatrices);const n=new Gd(t,e,e,Hn,Sn);return n.needsUpdate=!0,this.boneMatrices=t,this.boneTexture=n,this}getBoneByName(e){for(let t=0,n=this.bones.length;t<n;t++){const s=this.bones[t];if(s.name===e)return s}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,t){this.uuid=e.uuid;for(let n=0,s=e.bones.length;n<s;n++){const r=e.bones[n];let o=t[r];o===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",r),o=new hd),this.bones.push(o),this.boneInverses.push(new pt().fromArray(e.boneInverses[n]))}return this.init(),this}toJSON(){const e={metadata:{version:4.6,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;const t=this.bones,n=this.boneInverses;for(let s=0,r=t.length;s<r;s++){const o=t[s];e.bones.push(o.uuid);const a=n[s];e.boneInverses.push(a.toArray())}return e}}class qm extends Zn{constructor(e,t,n,s=1){super(e,t,n),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=s}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}const Ra=new pt,N_=new pt,nu=[],k_=new ps,E1=new pt,jl=new $n,Xl=new Xs;class C1 extends $n{constructor(e,t,n){super(e,t),this.isInstancedMesh=!0,this.instanceMatrix=new qm(new Float32Array(n*16),16),this.instanceColor=null,this.morphTexture=null,this.count=n,this.boundingBox=null,this.boundingSphere=null;for(let s=0;s<n;s++)this.setMatrixAt(s,E1)}computeBoundingBox(){const e=this.geometry,t=this.count;this.boundingBox===null&&(this.boundingBox=new ps),e.boundingBox===null&&e.computeBoundingBox(),this.boundingBox.makeEmpty();for(let n=0;n<t;n++)this.getMatrixAt(n,Ra),k_.copy(e.boundingBox).applyMatrix4(Ra),this.boundingBox.union(k_)}computeBoundingSphere(){const e=this.geometry,t=this.count;this.boundingSphere===null&&(this.boundingSphere=new Xs),e.boundingSphere===null&&e.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let n=0;n<t;n++)this.getMatrixAt(n,Ra),Xl.copy(e.boundingSphere).applyMatrix4(Ra),this.boundingSphere.union(Xl)}copy(e,t){return super.copy(e,t),this.instanceMatrix.copy(e.instanceMatrix),e.morphTexture!==null&&(this.morphTexture=e.morphTexture.clone()),e.instanceColor!==null&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}getColorAt(e,t){t.fromArray(this.instanceColor.array,e*3)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,e*16)}getMorphAt(e,t){const n=t.morphTargetInfluences,s=this.morphTexture.source.data.data,r=n.length+1,o=e*r+1;for(let a=0;a<n.length;a++)n[a]=s[o+a]}raycast(e,t){const n=this.matrixWorld,s=this.count;if(jl.geometry=this.geometry,jl.material=this.material,jl.material!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),Xl.copy(this.boundingSphere),Xl.applyMatrix4(n),e.ray.intersectsSphere(Xl)!==!1))for(let r=0;r<s;r++){this.getMatrixAt(r,Ra),N_.multiplyMatrices(n,Ra),jl.matrixWorld=N_,jl.raycast(e,nu);for(let o=0,a=nu.length;o<a;o++){const l=nu[o];l.instanceId=r,l.object=this,t.push(l)}nu.length=0}}setColorAt(e,t){this.instanceColor===null&&(this.instanceColor=new qm(new Float32Array(this.instanceMatrix.count*3).fill(1),3)),t.toArray(this.instanceColor.array,e*3)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,e*16)}setMorphAt(e,t){const n=t.morphTargetInfluences,s=n.length+1;this.morphTexture===null&&(this.morphTexture=new Gd(new Float32Array(s*this.count),s,this.count,mr,Sn));const r=this.morphTexture.source.data.data;let o=0;for(let c=0;c<n.length;c++)o+=n[c];const a=this.geometry.morphTargetsRelative?1:1-o,l=s*e;r[l]=a,r.set(n,l+1)}updateMorphTargets(){}dispose(){return this.dispatchEvent({type:"dispose"}),this.morphTexture!==null&&(this.morphTexture.dispose(),this.morphTexture=null),this}}const Kf=new he,S1=new he,I1=new wt;class Wr{constructor(e=new he(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,n,s){return this.normal.set(e,t,n),this.constant=s,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,n){const s=Kf.subVectors(n,t).cross(S1.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(s,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,t){const n=e.delta(Kf),s=this.normal.dot(n);if(s===0)return this.distanceToPoint(e.start)===0?t.copy(e.start):null;const r=-(e.start.dot(this.normal)+this.constant)/s;return r<0||r>1?null:t.copy(e.start).addScaledVector(n,r)}intersectsLine(e){const t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const n=t||I1.getNormalMatrix(e),s=this.coplanarPoint(Kf).applyMatrix4(e),r=this.normal.applyMatrix3(n).normalize();return this.constant=-s.dot(r),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}}const Co=new Xs,iu=new he;class fg{constructor(e=new Wr,t=new Wr,n=new Wr,s=new Wr,r=new Wr,o=new Wr){this.planes=[e,t,n,s,r,o]}set(e,t,n,s,r,o){const a=this.planes;return a[0].copy(e),a[1].copy(t),a[2].copy(n),a[3].copy(s),a[4].copy(r),a[5].copy(o),this}copy(e){const t=this.planes;for(let n=0;n<6;n++)t[n].copy(e.planes[n]);return this}setFromProjectionMatrix(e,t=Os){const n=this.planes,s=e.elements,r=s[0],o=s[1],a=s[2],l=s[3],c=s[4],h=s[5],u=s[6],d=s[7],f=s[8],p=s[9],A=s[10],m=s[11],g=s[12],y=s[13],_=s[14],v=s[15];if(n[0].setComponents(l-r,d-c,m-f,v-g).normalize(),n[1].setComponents(l+r,d+c,m+f,v+g).normalize(),n[2].setComponents(l+o,d+h,m+p,v+y).normalize(),n[3].setComponents(l-o,d-h,m-p,v-y).normalize(),n[4].setComponents(l-a,d-u,m-A,v-_).normalize(),t===Os)n[5].setComponents(l+a,d+u,m+A,v+_).normalize();else if(t===cd)n[5].setComponents(a,u,A,_).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+t);return this}intersectsObject(e){if(e.boundingSphere!==void 0)e.boundingSphere===null&&e.computeBoundingSphere(),Co.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const t=e.geometry;t.boundingSphere===null&&t.computeBoundingSphere(),Co.copy(t.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(Co)}intersectsSprite(e){return Co.center.set(0,0,0),Co.radius=.7071067811865476,Co.applyMatrix4(e.matrixWorld),this.intersectsSphere(Co)}intersectsSphere(e){const t=this.planes,n=e.center,s=-e.radius;for(let r=0;r<6;r++)if(t[r].distanceToPoint(n)<s)return!1;return!0}intersectsBox(e){const t=this.planes;for(let n=0;n<6;n++){const s=t[n];if(iu.x=s.normal.x>0?e.max.x:e.min.x,iu.y=s.normal.y>0?e.max.y:e.min.y,iu.z=s.normal.z>0?e.max.z:e.min.z,s.distanceToPoint(iu)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let n=0;n<6;n++)if(t[n].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}class no extends xi{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new at(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}const ud=new he,dd=new he,O_=new pt,Yl=new _h,su=new Xs,$f=new he,U_=new he;class Wd extends en{constructor(e=new Nn,t=new no){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(e.index===null){const t=e.attributes.position,n=[0];for(let s=1,r=t.count;s<r;s++)ud.fromBufferAttribute(t,s-1),dd.fromBufferAttribute(t,s),n[s]=n[s-1],n[s]+=ud.distanceTo(dd);e.setAttribute("lineDistance",new jt(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,t){const n=this.geometry,s=this.matrixWorld,r=e.params.Line.threshold,o=n.drawRange;if(n.boundingSphere===null&&n.computeBoundingSphere(),su.copy(n.boundingSphere),su.applyMatrix4(s),su.radius+=r,e.ray.intersectsSphere(su)===!1)return;O_.copy(s).invert(),Yl.copy(e.ray).applyMatrix4(O_);const a=r/((this.scale.x+this.scale.y+this.scale.z)/3),l=a*a,c=this.isLineSegments?2:1,h=n.index,d=n.attributes.position;if(h!==null){const f=Math.max(0,o.start),p=Math.min(h.count,o.start+o.count);for(let A=f,m=p-1;A<m;A+=c){const g=h.getX(A),y=h.getX(A+1),_=ru(this,e,Yl,l,g,y);_&&t.push(_)}if(this.isLineLoop){const A=h.getX(p-1),m=h.getX(f),g=ru(this,e,Yl,l,A,m);g&&t.push(g)}}else{const f=Math.max(0,o.start),p=Math.min(d.count,o.start+o.count);for(let A=f,m=p-1;A<m;A+=c){const g=ru(this,e,Yl,l,A,A+1);g&&t.push(g)}if(this.isLineLoop){const A=ru(this,e,Yl,l,p-1,f);A&&t.push(A)}}}updateMorphTargets(){const t=this.geometry.morphAttributes,n=Object.keys(t);if(n.length>0){const s=t[n[0]];if(s!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,o=s.length;r<o;r++){const a=s[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=r}}}}}function ru(i,e,t,n,s,r){const o=i.geometry.attributes.position;if(ud.fromBufferAttribute(o,s),dd.fromBufferAttribute(o,r),t.distanceSqToSegment(ud,dd,$f,U_)>n)return;$f.applyMatrix4(i.matrixWorld);const l=e.ray.origin.distanceTo($f);if(!(l<e.near||l>e.far))return{distance:l,point:U_.clone().applyMatrix4(i.matrixWorld),index:s,face:null,faceIndex:null,barycoord:null,object:i}}const Q_=new he,V_=new he;class Kc extends Wd{constructor(e,t){super(e,t),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(e.index===null){const t=e.attributes.position,n=[];for(let s=0,r=t.count;s<r;s+=2)Q_.fromBufferAttribute(t,s),V_.fromBufferAttribute(t,s+1),n[s]=s===0?0:n[s-1],n[s+1]=n[s]+Q_.distanceTo(V_);e.setAttribute("lineDistance",new jt(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class M1 extends Wd{constructor(e,t){super(e,t),this.isLineLoop=!0,this.type="LineLoop"}}class qa extends xi{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new at(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}const z_=new pt,jm=new _h,ou=new Xs,au=new he;class ku extends en{constructor(e=new Nn,t=new qa){super(),this.isPoints=!0,this.type="Points",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}raycast(e,t){const n=this.geometry,s=this.matrixWorld,r=e.params.Points.threshold,o=n.drawRange;if(n.boundingSphere===null&&n.computeBoundingSphere(),ou.copy(n.boundingSphere),ou.applyMatrix4(s),ou.radius+=r,e.ray.intersectsSphere(ou)===!1)return;z_.copy(s).invert(),jm.copy(e.ray).applyMatrix4(z_);const a=r/((this.scale.x+this.scale.y+this.scale.z)/3),l=a*a,c=n.index,u=n.attributes.position;if(c!==null){const d=Math.max(0,o.start),f=Math.min(c.count,o.start+o.count);for(let p=d,A=f;p<A;p++){const m=c.getX(p);au.fromBufferAttribute(u,m),G_(au,m,l,s,e,t,this)}}else{const d=Math.max(0,o.start),f=Math.min(u.count,o.start+o.count);for(let p=d,A=f;p<A;p++)au.fromBufferAttribute(u,p),G_(au,p,l,s,e,t,this)}}updateMorphTargets(){const t=this.geometry.morphAttributes,n=Object.keys(t);if(n.length>0){const s=t[n[0]];if(s!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,o=s.length;r<o;r++){const a=s[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=r}}}}}function G_(i,e,t,n,s,r,o){const a=jm.distanceSqToPoint(i);if(a<t){const l=new he;jm.closestPointToPoint(i,l),l.applyMatrix4(n);const c=s.ray.origin.distanceTo(l);if(c<s.near||c>s.far)return;r.push({distance:c,distanceToRay:Math.sqrt(a),point:l,index:e,face:null,faceIndex:null,barycoord:null,object:o})}}class Wi extends en{constructor(){super(),this.isGroup=!0,this.type="Group"}}class T1 extends Pn{constructor(e,t,n,s,r,o,a,l,c){super(e,t,n,s,r,o,a,l,c),this.isVideoTexture=!0,this.minFilter=o!==void 0?o:Zt,this.magFilter=r!==void 0?r:Zt,this.generateMipmaps=!1;const h=this;function u(){h.needsUpdate=!0,e.requestVideoFrameCallback(u)}"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback(u)}clone(){return new this.constructor(this.image).copy(this)}update(){const e=this.image;"requestVideoFrameCallback"in e===!1&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}class qd extends Pn{constructor(e,t,n,s,r,o,a,l,c,h,u,d){super(null,o,a,l,c,h,s,r,u,d),this.isCompressedTexture=!0,this.image={width:t,height:n},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}}class B1 extends qd{constructor(e,t,n,s,r,o){super(e,t,n,r,o),this.isCompressedArrayTexture=!0,this.image.depth=s,this.wrapR=Hi,this.layerUpdates=new Set}addLayerUpdate(e){this.layerUpdates.add(e)}clearLayerUpdates(){this.layerUpdates.clear()}}class R1 extends qd{constructor(e,t,n){super(void 0,e[0].width,e[0].height,t,n,ea),this.isCompressedCubeTexture=!0,this.isCubeTexture=!0,this.image=e}}class Uw extends Pn{constructor(e,t,n,s,r,o,a,l,c,h=sl){if(h!==sl&&h!==_l)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");n===void 0&&h===sl&&(n=ta),n===void 0&&h===_l&&(n=vl),super(null,s,r,o,a,l,h,n,c),this.isDepthTexture=!0,this.image={width:e,height:t},this.magFilter=a!==void 0?a:yi,this.minFilter=l!==void 0?l:yi,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.compareFunction=e.compareFunction,this}toJSON(e){const t=super.toJSON(e);return this.compareFunction!==null&&(t.compareFunction=this.compareFunction),t}}class Is{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(e,t){const n=this.getUtoTmapping(e);return this.getPoint(n,t)}getPoints(e=5){const t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return t}getSpacedPoints(e=5){const t=[];for(let n=0;n<=e;n++)t.push(this.getPointAt(n/e));return t}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const t=[];let n,s=this.getPoint(0),r=0;t.push(0);for(let o=1;o<=e;o++)n=this.getPoint(o/e),r+=n.distanceTo(s),t.push(r),s=n;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t){const n=this.getLengths();let s=0;const r=n.length;let o;t?o=t:o=e*n[r-1];let a=0,l=r-1,c;for(;a<=l;)if(s=Math.floor(a+(l-a)/2),c=n[s]-o,c<0)a=s+1;else if(c>0)l=s-1;else{l=s;break}if(s=l,n[s]===o)return s/(r-1);const h=n[s],d=n[s+1]-h,f=(o-h)/d;return(s+f)/(r-1)}getTangent(e,t){let s=e-1e-4,r=e+1e-4;s<0&&(s=0),r>1&&(r=1);const o=this.getPoint(s),a=this.getPoint(r),l=t||(o.isVector2?new Me:new he);return l.copy(a).sub(o).normalize(),l}getTangentAt(e,t){const n=this.getUtoTmapping(e);return this.getTangent(n,t)}computeFrenetFrames(e,t){const n=new he,s=[],r=[],o=[],a=new he,l=new pt;for(let f=0;f<=e;f++){const p=f/e;s[f]=this.getTangentAt(p,new he)}r[0]=new he,o[0]=new he;let c=Number.MAX_VALUE;const h=Math.abs(s[0].x),u=Math.abs(s[0].y),d=Math.abs(s[0].z);h<=c&&(c=h,n.set(1,0,0)),u<=c&&(c=u,n.set(0,1,0)),d<=c&&n.set(0,0,1),a.crossVectors(s[0],n).normalize(),r[0].crossVectors(s[0],a),o[0].crossVectors(s[0],r[0]);for(let f=1;f<=e;f++){if(r[f]=r[f-1].clone(),o[f]=o[f-1].clone(),a.crossVectors(s[f-1],s[f]),a.length()>Number.EPSILON){a.normalize();const p=Math.acos(It(s[f-1].dot(s[f]),-1,1));r[f].applyMatrix4(l.makeRotationAxis(a,p))}o[f].crossVectors(s[f],r[f])}if(t===!0){let f=Math.acos(It(r[0].dot(r[e]),-1,1));f/=e,s[0].dot(a.crossVectors(r[0],r[e]))>0&&(f=-f);for(let p=1;p<=e;p++)r[p].applyMatrix4(l.makeRotationAxis(s[p],f*p)),o[p].crossVectors(s[p],r[p])}return{tangents:s,normals:r,binormals:o}}clone(){return new this.constructor().copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.6,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class pg extends Is{constructor(e=0,t=0,n=1,s=1,r=0,o=Math.PI*2,a=!1,l=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=n,this.yRadius=s,this.aStartAngle=r,this.aEndAngle=o,this.aClockwise=a,this.aRotation=l}getPoint(e,t=new Me){const n=t,s=Math.PI*2;let r=this.aEndAngle-this.aStartAngle;const o=Math.abs(r)<Number.EPSILON;for(;r<0;)r+=s;for(;r>s;)r-=s;r<Number.EPSILON&&(o?r=0:r=s),this.aClockwise===!0&&!o&&(r===s?r=-s:r=r-s);const a=this.aStartAngle+e*r;let l=this.aX+this.xRadius*Math.cos(a),c=this.aY+this.yRadius*Math.sin(a);if(this.aRotation!==0){const h=Math.cos(this.aRotation),u=Math.sin(this.aRotation),d=l-this.aX,f=c-this.aY;l=d*h-f*u+this.aX,c=d*u+f*h+this.aY}return n.set(l,c)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){const e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}class P1 extends pg{constructor(e,t,n,s,r,o){super(e,t,n,n,s,r,o),this.isArcCurve=!0,this.type="ArcCurve"}}function mg(){let i=0,e=0,t=0,n=0;function s(r,o,a,l){i=r,e=a,t=-3*r+3*o-2*a-l,n=2*r-2*o+a+l}return{initCatmullRom:function(r,o,a,l,c){s(o,a,c*(a-r),c*(l-o))},initNonuniformCatmullRom:function(r,o,a,l,c,h,u){let d=(o-r)/c-(a-r)/(c+h)+(a-o)/h,f=(a-o)/h-(l-o)/(h+u)+(l-a)/u;d*=h,f*=h,s(o,a,d,f)},calc:function(r){const o=r*r,a=o*r;return i+e*r+t*o+n*a}}}const lu=new he,Jf=new mg,Zf=new mg,ep=new mg;class D1 extends Is{constructor(e=[],t=!1,n="centripetal",s=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=n,this.tension=s}getPoint(e,t=new he){const n=t,s=this.points,r=s.length,o=(r-(this.closed?0:1))*e;let a=Math.floor(o),l=o-a;this.closed?a+=a>0?0:(Math.floor(Math.abs(a)/r)+1)*r:l===0&&a===r-1&&(a=r-2,l=1);let c,h;this.closed||a>0?c=s[(a-1)%r]:(lu.subVectors(s[0],s[1]).add(s[0]),c=lu);const u=s[a%r],d=s[(a+1)%r];if(this.closed||a+2<r?h=s[(a+2)%r]:(lu.subVectors(s[r-1],s[r-2]).add(s[r-1]),h=lu),this.curveType==="centripetal"||this.curveType==="chordal"){const f=this.curveType==="chordal"?.5:.25;let p=Math.pow(c.distanceToSquared(u),f),A=Math.pow(u.distanceToSquared(d),f),m=Math.pow(d.distanceToSquared(h),f);A<1e-4&&(A=1),p<1e-4&&(p=A),m<1e-4&&(m=A),Jf.initNonuniformCatmullRom(c.x,u.x,d.x,h.x,p,A,m),Zf.initNonuniformCatmullRom(c.y,u.y,d.y,h.y,p,A,m),ep.initNonuniformCatmullRom(c.z,u.z,d.z,h.z,p,A,m)}else this.curveType==="catmullrom"&&(Jf.initCatmullRom(c.x,u.x,d.x,h.x,this.tension),Zf.initCatmullRom(c.y,u.y,d.y,h.y,this.tension),ep.initCatmullRom(c.z,u.z,d.z,h.z,this.tension));return n.set(Jf.calc(l),Zf.calc(l),ep.calc(l)),n}copy(e){super.copy(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const s=e.points[t];this.points.push(s.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,n=this.points.length;t<n;t++){const s=this.points[t];e.points.push(s.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const s=e.points[t];this.points.push(new he().fromArray(s))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}}function H_(i,e,t,n,s){const r=(n-e)*.5,o=(s-t)*.5,a=i*i,l=i*a;return(2*t-2*n+r+o)*l+(-3*t+3*n-2*r-o)*a+r*i+t}function L1(i,e){const t=1-i;return t*t*e}function F1(i,e){return 2*(1-i)*i*e}function N1(i,e){return i*i*e}function Ic(i,e,t,n){return L1(i,e)+F1(i,t)+N1(i,n)}function k1(i,e){const t=1-i;return t*t*t*e}function O1(i,e){const t=1-i;return 3*t*t*i*e}function U1(i,e){return 3*(1-i)*i*i*e}function Q1(i,e){return i*i*i*e}function Mc(i,e,t,n,s){return k1(i,e)+O1(i,t)+U1(i,n)+Q1(i,s)}class Qw extends Is{constructor(e=new Me,t=new Me,n=new Me,s=new Me){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=n,this.v3=s}getPoint(e,t=new Me){const n=t,s=this.v0,r=this.v1,o=this.v2,a=this.v3;return n.set(Mc(e,s.x,r.x,o.x,a.x),Mc(e,s.y,r.y,o.y,a.y)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class V1 extends Is{constructor(e=new he,t=new he,n=new he,s=new he){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=n,this.v3=s}getPoint(e,t=new he){const n=t,s=this.v0,r=this.v1,o=this.v2,a=this.v3;return n.set(Mc(e,s.x,r.x,o.x,a.x),Mc(e,s.y,r.y,o.y,a.y),Mc(e,s.z,r.z,o.z,a.z)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class Vw extends Is{constructor(e=new Me,t=new Me){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=e,this.v2=t}getPoint(e,t=new Me){const n=t;return e===1?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t=new Me){return t.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class z1 extends Is{constructor(e=new he,t=new he){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=e,this.v2=t}getPoint(e,t=new he){const n=t;return e===1?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t=new he){return t.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class zw extends Is{constructor(e=new Me,t=new Me,n=new Me){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=n}getPoint(e,t=new Me){const n=t,s=this.v0,r=this.v1,o=this.v2;return n.set(Ic(e,s.x,r.x,o.x),Ic(e,s.y,r.y,o.y)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class G1 extends Is{constructor(e=new he,t=new he,n=new he){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=n}getPoint(e,t=new he){const n=t,s=this.v0,r=this.v1,o=this.v2;return n.set(Ic(e,s.x,r.x,o.x),Ic(e,s.y,r.y,o.y),Ic(e,s.z,r.z,o.z)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class Gw extends Is{constructor(e=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=e}getPoint(e,t=new Me){const n=t,s=this.points,r=(s.length-1)*e,o=Math.floor(r),a=r-o,l=s[o===0?o:o-1],c=s[o],h=s[o>s.length-2?s.length-1:o+1],u=s[o>s.length-3?s.length-1:o+2];return n.set(H_(a,l.x,c.x,h.x,u.x),H_(a,l.y,c.y,h.y,u.y)),n}copy(e){super.copy(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const s=e.points[t];this.points.push(s.clone())}return this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,n=this.points.length;t<n;t++){const s=this.points[t];e.points.push(s.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const s=e.points[t];this.points.push(new Me().fromArray(s))}return this}}var Xm=Object.freeze({__proto__:null,ArcCurve:P1,CatmullRomCurve3:D1,CubicBezierCurve:Qw,CubicBezierCurve3:V1,EllipseCurve:pg,LineCurve:Vw,LineCurve3:z1,QuadraticBezierCurve:zw,QuadraticBezierCurve3:G1,SplineCurve:Gw});class H1 extends Is{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){const e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);if(!e.equals(t)){const n=e.isVector2===!0?"LineCurve":"LineCurve3";this.curves.push(new Xm[n](t,e))}return this}getPoint(e,t){const n=e*this.getLength(),s=this.getCurveLengths();let r=0;for(;r<s.length;){if(s[r]>=n){const o=s[r]-n,a=this.curves[r],l=a.getLength(),c=l===0?0:1-o/l;return a.getPointAt(c,t)}r++}return null}getLength(){const e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const e=[];let t=0;for(let n=0,s=this.curves.length;n<s;n++)t+=this.curves[n].getLength(),e.push(t);return this.cacheLengths=e,e}getSpacedPoints(e=40){const t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return this.autoClose&&t.push(t[0]),t}getPoints(e=12){const t=[];let n;for(let s=0,r=this.curves;s<r.length;s++){const o=r[s],a=o.isEllipseCurve?e*2:o.isLineCurve||o.isLineCurve3?1:o.isSplineCurve?e*o.points.length:e,l=o.getPoints(a);for(let c=0;c<l.length;c++){const h=l[c];n&&n.equals(h)||(t.push(h),n=h)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t}copy(e){super.copy(e),this.curves=[];for(let t=0,n=e.curves.length;t<n;t++){const s=e.curves[t];this.curves.push(s.clone())}return this.autoClose=e.autoClose,this}toJSON(){const e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let t=0,n=this.curves.length;t<n;t++){const s=this.curves[t];e.curves.push(s.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let t=0,n=e.curves.length;t<n;t++){const s=e.curves[t];this.curves.push(new Xm[s.type]().fromJSON(s))}return this}}class ol extends H1{constructor(e){super(),this.type="Path",this.currentPoint=new Me,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let t=1,n=e.length;t<n;t++)this.lineTo(e[t].x,e[t].y);return this}moveTo(e,t){return this.currentPoint.set(e,t),this}lineTo(e,t){const n=new Vw(this.currentPoint.clone(),new Me(e,t));return this.curves.push(n),this.currentPoint.set(e,t),this}quadraticCurveTo(e,t,n,s){const r=new zw(this.currentPoint.clone(),new Me(e,t),new Me(n,s));return this.curves.push(r),this.currentPoint.set(n,s),this}bezierCurveTo(e,t,n,s,r,o){const a=new Qw(this.currentPoint.clone(),new Me(e,t),new Me(n,s),new Me(r,o));return this.curves.push(a),this.currentPoint.set(r,o),this}splineThru(e){const t=[this.currentPoint.clone()].concat(e),n=new Gw(t);return this.curves.push(n),this.currentPoint.copy(e[e.length-1]),this}arc(e,t,n,s,r,o){const a=this.currentPoint.x,l=this.currentPoint.y;return this.absarc(e+a,t+l,n,s,r,o),this}absarc(e,t,n,s,r,o){return this.absellipse(e,t,n,n,s,r,o),this}ellipse(e,t,n,s,r,o,a,l){const c=this.currentPoint.x,h=this.currentPoint.y;return this.absellipse(e+c,t+h,n,s,r,o,a,l),this}absellipse(e,t,n,s,r,o,a,l){const c=new pg(e,t,n,s,r,o,a,l);if(this.curves.length>0){const u=c.getPoint(0);u.equals(this.currentPoint)||this.lineTo(u.x,u.y)}this.curves.push(c);const h=c.getPoint(1);return this.currentPoint.copy(h),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){const e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}}class Tc extends ol{constructor(e){super(e),this.uuid=fs(),this.type="Shape",this.holes=[]}getPointsHoles(e){const t=[];for(let n=0,s=this.holes.length;n<s;n++)t[n]=this.holes[n].getPoints(e);return t}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let t=0,n=e.holes.length;t<n;t++){const s=e.holes[t];this.holes.push(s.clone())}return this}toJSON(){const e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let t=0,n=this.holes.length;t<n;t++){const s=this.holes[t];e.holes.push(s.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let t=0,n=e.holes.length;t<n;t++){const s=e.holes[t];this.holes.push(new ol().fromJSON(s))}return this}}const W1={triangulate:function(i,e,t=2){const n=e&&e.length,s=n?e[0]*t:i.length;let r=Hw(i,0,s,t,!0);const o=[];if(!r||r.next===r.prev)return o;let a,l,c,h,u,d,f;if(n&&(r=K1(i,e,r,t)),i.length>80*t){a=c=i[0],l=h=i[1];for(let p=t;p<s;p+=t)u=i[p],d=i[p+1],u<a&&(a=u),d<l&&(l=d),u>c&&(c=u),d>h&&(h=d);f=Math.max(c-a,h-l),f=f!==0?32767/f:0}return $c(r,o,t,a,l,f,0),o}};function Hw(i,e,t,n,s){let r,o;if(s===aB(i,e,t,n)>0)for(r=e;r<t;r+=n)o=W_(r,i[r],i[r+1],o);else for(r=t-n;r>=e;r-=n)o=W_(r,i[r],i[r+1],o);return o&&jd(o,o.next)&&(Zc(o),o=o.next),o}function ia(i,e){if(!i)return i;e||(e=i);let t=i,n;do if(n=!1,!t.steiner&&(jd(t,t.next)||vn(t.prev,t,t.next)===0)){if(Zc(t),t=e=t.prev,t===t.next)break;n=!0}else t=t.next;while(n||t!==e);return e}function $c(i,e,t,n,s,r,o){if(!i)return;!o&&r&&tB(i,n,s,r);let a=i,l,c;for(;i.prev!==i.next;){if(l=i.prev,c=i.next,r?j1(i,n,s,r):q1(i)){e.push(l.i/t|0),e.push(i.i/t|0),e.push(c.i/t|0),Zc(i),i=c.next,a=c.next;continue}if(i=c,i===a){o?o===1?(i=X1(ia(i),e,t),$c(i,e,t,n,s,r,2)):o===2&&Y1(i,e,t,n,s,r):$c(ia(i),e,t,n,s,r,1);break}}}function q1(i){const e=i.prev,t=i,n=i.next;if(vn(e,t,n)>=0)return!1;const s=e.x,r=t.x,o=n.x,a=e.y,l=t.y,c=n.y,h=s<r?s<o?s:o:r<o?r:o,u=a<l?a<c?a:c:l<c?l:c,d=s>r?s>o?s:o:r>o?r:o,f=a>l?a>c?a:c:l>c?l:c;let p=n.next;for(;p!==e;){if(p.x>=h&&p.x<=d&&p.y>=u&&p.y<=f&&ja(s,a,r,l,o,c,p.x,p.y)&&vn(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function j1(i,e,t,n){const s=i.prev,r=i,o=i.next;if(vn(s,r,o)>=0)return!1;const a=s.x,l=r.x,c=o.x,h=s.y,u=r.y,d=o.y,f=a<l?a<c?a:c:l<c?l:c,p=h<u?h<d?h:d:u<d?u:d,A=a>l?a>c?a:c:l>c?l:c,m=h>u?h>d?h:d:u>d?u:d,g=Ym(f,p,e,t,n),y=Ym(A,m,e,t,n);let _=i.prevZ,v=i.nextZ;for(;_&&_.z>=g&&v&&v.z<=y;){if(_.x>=f&&_.x<=A&&_.y>=p&&_.y<=m&&_!==s&&_!==o&&ja(a,h,l,u,c,d,_.x,_.y)&&vn(_.prev,_,_.next)>=0||(_=_.prevZ,v.x>=f&&v.x<=A&&v.y>=p&&v.y<=m&&v!==s&&v!==o&&ja(a,h,l,u,c,d,v.x,v.y)&&vn(v.prev,v,v.next)>=0))return!1;v=v.nextZ}for(;_&&_.z>=g;){if(_.x>=f&&_.x<=A&&_.y>=p&&_.y<=m&&_!==s&&_!==o&&ja(a,h,l,u,c,d,_.x,_.y)&&vn(_.prev,_,_.next)>=0)return!1;_=_.prevZ}for(;v&&v.z<=y;){if(v.x>=f&&v.x<=A&&v.y>=p&&v.y<=m&&v!==s&&v!==o&&ja(a,h,l,u,c,d,v.x,v.y)&&vn(v.prev,v,v.next)>=0)return!1;v=v.nextZ}return!0}function X1(i,e,t){let n=i;do{const s=n.prev,r=n.next.next;!jd(s,r)&&Ww(s,n,n.next,r)&&Jc(s,r)&&Jc(r,s)&&(e.push(s.i/t|0),e.push(n.i/t|0),e.push(r.i/t|0),Zc(n),Zc(n.next),n=i=r),n=n.next}while(n!==i);return ia(n)}function Y1(i,e,t,n,s,r){let o=i;do{let a=o.next.next;for(;a!==o.prev;){if(o.i!==a.i&&sB(o,a)){let l=qw(o,a);o=ia(o,o.next),l=ia(l,l.next),$c(o,e,t,n,s,r,0),$c(l,e,t,n,s,r,0);return}a=a.next}o=o.next}while(o!==i)}function K1(i,e,t,n){const s=[];let r,o,a,l,c;for(r=0,o=e.length;r<o;r++)a=e[r]*n,l=r<o-1?e[r+1]*n:i.length,c=Hw(i,a,l,n,!1),c===c.next&&(c.steiner=!0),s.push(iB(c));for(s.sort($1),r=0;r<s.length;r++)t=J1(s[r],t);return t}function $1(i,e){return i.x-e.x}function J1(i,e){const t=Z1(i,e);if(!t)return e;const n=qw(t,i);return ia(n,n.next),ia(t,t.next)}function Z1(i,e){let t=e,n=-1/0,s;const r=i.x,o=i.y;do{if(o<=t.y&&o>=t.next.y&&t.next.y!==t.y){const d=t.x+(o-t.y)*(t.next.x-t.x)/(t.next.y-t.y);if(d<=r&&d>n&&(n=d,s=t.x<t.next.x?t:t.next,d===r))return s}t=t.next}while(t!==e);if(!s)return null;const a=s,l=s.x,c=s.y;let h=1/0,u;t=s;do r>=t.x&&t.x>=l&&r!==t.x&&ja(o<c?r:n,o,l,c,o<c?n:r,o,t.x,t.y)&&(u=Math.abs(o-t.y)/(r-t.x),Jc(t,i)&&(u<h||u===h&&(t.x>s.x||t.x===s.x&&eB(s,t)))&&(s=t,h=u)),t=t.next;while(t!==a);return s}function eB(i,e){return vn(i.prev,i,e.prev)<0&&vn(e.next,i,i.next)<0}function tB(i,e,t,n){let s=i;do s.z===0&&(s.z=Ym(s.x,s.y,e,t,n)),s.prevZ=s.prev,s.nextZ=s.next,s=s.next;while(s!==i);s.prevZ.nextZ=null,s.prevZ=null,nB(s)}function nB(i){let e,t,n,s,r,o,a,l,c=1;do{for(t=i,i=null,r=null,o=0;t;){for(o++,n=t,a=0,e=0;e<c&&(a++,n=n.nextZ,!!n);e++);for(l=c;a>0||l>0&&n;)a!==0&&(l===0||!n||t.z<=n.z)?(s=t,t=t.nextZ,a--):(s=n,n=n.nextZ,l--),r?r.nextZ=s:i=s,s.prevZ=r,r=s;t=n}r.nextZ=null,c*=2}while(o>1);return i}function Ym(i,e,t,n,s){return i=(i-t)*s|0,e=(e-n)*s|0,i=(i|i<<8)&16711935,i=(i|i<<4)&252645135,i=(i|i<<2)&858993459,i=(i|i<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,i|e<<1}function iB(i){let e=i,t=i;do(e.x<t.x||e.x===t.x&&e.y<t.y)&&(t=e),e=e.next;while(e!==i);return t}function ja(i,e,t,n,s,r,o,a){return(s-o)*(e-a)>=(i-o)*(r-a)&&(i-o)*(n-a)>=(t-o)*(e-a)&&(t-o)*(r-a)>=(s-o)*(n-a)}function sB(i,e){return i.next.i!==e.i&&i.prev.i!==e.i&&!rB(i,e)&&(Jc(i,e)&&Jc(e,i)&&oB(i,e)&&(vn(i.prev,i,e.prev)||vn(i,e.prev,e))||jd(i,e)&&vn(i.prev,i,i.next)>0&&vn(e.prev,e,e.next)>0)}function vn(i,e,t){return(e.y-i.y)*(t.x-e.x)-(e.x-i.x)*(t.y-e.y)}function jd(i,e){return i.x===e.x&&i.y===e.y}function Ww(i,e,t,n){const s=hu(vn(i,e,t)),r=hu(vn(i,e,n)),o=hu(vn(t,n,i)),a=hu(vn(t,n,e));return!!(s!==r&&o!==a||s===0&&cu(i,t,e)||r===0&&cu(i,n,e)||o===0&&cu(t,i,n)||a===0&&cu(t,e,n))}function cu(i,e,t){return e.x<=Math.max(i.x,t.x)&&e.x>=Math.min(i.x,t.x)&&e.y<=Math.max(i.y,t.y)&&e.y>=Math.min(i.y,t.y)}function hu(i){return i>0?1:i<0?-1:0}function rB(i,e){let t=i;do{if(t.i!==i.i&&t.next.i!==i.i&&t.i!==e.i&&t.next.i!==e.i&&Ww(t,t.next,i,e))return!0;t=t.next}while(t!==i);return!1}function Jc(i,e){return vn(i.prev,i,i.next)<0?vn(i,e,i.next)>=0&&vn(i,i.prev,e)>=0:vn(i,e,i.prev)<0||vn(i,i.next,e)<0}function oB(i,e){let t=i,n=!1;const s=(i.x+e.x)/2,r=(i.y+e.y)/2;do t.y>r!=t.next.y>r&&t.next.y!==t.y&&s<(t.next.x-t.x)*(r-t.y)/(t.next.y-t.y)+t.x&&(n=!n),t=t.next;while(t!==i);return n}function qw(i,e){const t=new Km(i.i,i.x,i.y),n=new Km(e.i,e.x,e.y),s=i.next,r=e.prev;return i.next=e,e.prev=i,t.next=s,s.prev=t,n.next=t,t.prev=n,r.next=n,n.prev=r,n}function W_(i,e,t,n){const s=new Km(i,e,t);return n?(s.next=n.next,s.prev=n,n.next.prev=s,n.next=s):(s.prev=s,s.next=s),s}function Zc(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function Km(i,e,t){this.i=i,this.x=e,this.y=t,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function aB(i,e,t,n){let s=0;for(let r=e,o=t-n;r<t;r+=n)s+=(i[o]-i[r])*(i[r+1]+i[o+1]),o=r;return s}class io{static area(e){const t=e.length;let n=0;for(let s=t-1,r=0;r<t;s=r++)n+=e[s].x*e[r].y-e[r].x*e[s].y;return n*.5}static isClockWise(e){return io.area(e)<0}static triangulateShape(e,t){const n=[],s=[],r=[];q_(e),j_(n,e);let o=e.length;t.forEach(q_);for(let l=0;l<t.length;l++)s.push(o),o+=t[l].length,j_(n,t[l]);const a=W1.triangulate(n,s);for(let l=0;l<a.length;l+=3)r.push(a.slice(l,l+3));return r}}function q_(i){const e=i.length;e>2&&i[e-1].equals(i[0])&&i.pop()}function j_(i,e){for(let t=0;t<e.length;t++)i.push(e[t].x),i.push(e[t].y)}class Ag extends Nn{constructor(e=new Tc([new Me(.5,.5),new Me(-.5,.5),new Me(-.5,-.5),new Me(.5,-.5)]),t={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},e=Array.isArray(e)?e:[e];const n=this,s=[],r=[];for(let a=0,l=e.length;a<l;a++){const c=e[a];o(c)}this.setAttribute("position",new jt(s,3)),this.setAttribute("uv",new jt(r,2)),this.computeVertexNormals();function o(a){const l=[],c=t.curveSegments!==void 0?t.curveSegments:12,h=t.steps!==void 0?t.steps:1,u=t.depth!==void 0?t.depth:1;let d=t.bevelEnabled!==void 0?t.bevelEnabled:!0,f=t.bevelThickness!==void 0?t.bevelThickness:.2,p=t.bevelSize!==void 0?t.bevelSize:f-.1,A=t.bevelOffset!==void 0?t.bevelOffset:0,m=t.bevelSegments!==void 0?t.bevelSegments:3;const g=t.extrudePath,y=t.UVGenerator!==void 0?t.UVGenerator:lB;let _,v=!1,b,T,L,I;g&&(_=g.getSpacedPoints(h),v=!0,d=!1,b=g.computeFrenetFrames(h,!1),T=new he,L=new he,I=new he),d||(m=0,f=0,p=0,A=0);const x=a.extractPoints(c);let w=x.shape;const P=x.holes;if(!io.isClockWise(w)){w=w.reverse();for(let F=0,Q=P.length;F<Q;F++){const E=P[F];io.isClockWise(E)&&(P[F]=E.reverse())}}const H=io.triangulateShape(w,P),K=w;for(let F=0,Q=P.length;F<Q;F++){const E=P[F];w=w.concat(E)}function le(F,Q,E){return Q||console.error("THREE.ExtrudeGeometry: vec does not exist"),F.clone().addScaledVector(Q,E)}const J=w.length,W=H.length;function O(F,Q,E){let j,q,ce;const G=F.x-Q.x,V=F.y-Q.y,re=E.x-F.x,k=E.y-F.y,N=G*G+V*V,oe=G*k-V*re;if(Math.abs(oe)>Number.EPSILON){const pe=Math.sqrt(N),ve=Math.sqrt(re*re+k*k),xe=Q.x-V/pe,Pe=Q.y+G/pe,Te=E.x-k/ve,Qe=E.y+re/ve,lt=((Te-xe)*k-(Qe-Pe)*re)/(G*k-V*re);j=xe+G*lt-F.x,q=Pe+V*lt-F.y;const Ne=j*j+q*q;if(Ne<=2)return new Me(j,q);ce=Math.sqrt(Ne/2)}else{let pe=!1;G>Number.EPSILON?re>Number.EPSILON&&(pe=!0):G<-Number.EPSILON?re<-Number.EPSILON&&(pe=!0):Math.sign(V)===Math.sign(k)&&(pe=!0),pe?(j=-V,q=G,ce=Math.sqrt(N)):(j=G,q=V,ce=Math.sqrt(N/2))}return new Me(j/ce,q/ce)}const fe=[];for(let F=0,Q=K.length,E=Q-1,j=F+1;F<Q;F++,E++,j++)E===Q&&(E=0),j===Q&&(j=0),fe[F]=O(K[F],K[E],K[j]);const ue=[];let ee,de=fe.concat();for(let F=0,Q=P.length;F<Q;F++){const E=P[F];ee=[];for(let j=0,q=E.length,ce=q-1,G=j+1;j<q;j++,ce++,G++)ce===q&&(ce=0),G===q&&(G=0),ee[j]=O(E[j],E[ce],E[G]);ue.push(ee),de=de.concat(ee)}for(let F=0;F<m;F++){const Q=F/m,E=f*Math.cos(Q*Math.PI/2),j=p*Math.sin(Q*Math.PI/2)+A;for(let q=0,ce=K.length;q<ce;q++){const G=le(K[q],fe[q],j);D(G.x,G.y,-E)}for(let q=0,ce=P.length;q<ce;q++){const G=P[q];ee=ue[q];for(let V=0,re=G.length;V<re;V++){const k=le(G[V],ee[V],j);D(k.x,k.y,-E)}}}const ae=p+A;for(let F=0;F<J;F++){const Q=d?le(w[F],de[F],ae):w[F];v?(L.copy(b.normals[0]).multiplyScalar(Q.x),T.copy(b.binormals[0]).multiplyScalar(Q.y),I.copy(_[0]).add(L).add(T),D(I.x,I.y,I.z)):D(Q.x,Q.y,0)}for(let F=1;F<=h;F++)for(let Q=0;Q<J;Q++){const E=d?le(w[Q],de[Q],ae):w[Q];v?(L.copy(b.normals[F]).multiplyScalar(E.x),T.copy(b.binormals[F]).multiplyScalar(E.y),I.copy(_[F]).add(L).add(T),D(I.x,I.y,I.z)):D(E.x,E.y,u/h*F)}for(let F=m-1;F>=0;F--){const Q=F/m,E=f*Math.cos(Q*Math.PI/2),j=p*Math.sin(Q*Math.PI/2)+A;for(let q=0,ce=K.length;q<ce;q++){const G=le(K[q],fe[q],j);D(G.x,G.y,u+E)}for(let q=0,ce=P.length;q<ce;q++){const G=P[q];ee=ue[q];for(let V=0,re=G.length;V<re;V++){const k=le(G[V],ee[V],j);v?D(k.x,k.y+_[h-1].y,_[h-1].x+E):D(k.x,k.y,u+E)}}}R(),M();function R(){const F=s.length/3;if(d){let Q=0,E=J*Q;for(let j=0;j<W;j++){const q=H[j];te(q[2]+E,q[1]+E,q[0]+E)}Q=h+m*2,E=J*Q;for(let j=0;j<W;j++){const q=H[j];te(q[0]+E,q[1]+E,q[2]+E)}}else{for(let Q=0;Q<W;Q++){const E=H[Q];te(E[2],E[1],E[0])}for(let Q=0;Q<W;Q++){const E=H[Q];te(E[0]+J*h,E[1]+J*h,E[2]+J*h)}}n.addGroup(F,s.length/3-F,0)}function M(){const F=s.length/3;let Q=0;B(K,Q),Q+=K.length;for(let E=0,j=P.length;E<j;E++){const q=P[E];B(q,Q),Q+=q.length}n.addGroup(F,s.length/3-F,1)}function B(F,Q){let E=F.length;for(;--E>=0;){const j=E;let q=E-1;q<0&&(q=F.length-1);for(let ce=0,G=h+m*2;ce<G;ce++){const V=J*ce,re=J*(ce+1),k=Q+j+V,N=Q+q+V,oe=Q+q+re,pe=Q+j+re;ie(k,N,oe,pe)}}}function D(F,Q,E){l.push(F),l.push(Q),l.push(E)}function te(F,Q,E){Z(F),Z(Q),Z(E);const j=s.length/3,q=y.generateTopUV(n,s,j-3,j-2,j-1);me(q[0]),me(q[1]),me(q[2])}function ie(F,Q,E,j){Z(F),Z(Q),Z(j),Z(Q),Z(E),Z(j);const q=s.length/3,ce=y.generateSideWallUV(n,s,q-6,q-3,q-2,q-1);me(ce[0]),me(ce[1]),me(ce[3]),me(ce[1]),me(ce[2]),me(ce[3])}function Z(F){s.push(l[F*3+0]),s.push(l[F*3+1]),s.push(l[F*3+2])}function me(F){r.push(F.x),r.push(F.y)}}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON(),t=this.parameters.shapes,n=this.parameters.options;return cB(t,n,e)}static fromJSON(e,t){const n=[];for(let r=0,o=e.shapes.length;r<o;r++){const a=t[e.shapes[r]];n.push(a)}const s=e.options.extrudePath;return s!==void 0&&(e.options.extrudePath=new Xm[s.type]().fromJSON(s)),new Ag(n,e.options)}}const lB={generateTopUV:function(i,e,t,n,s){const r=e[t*3],o=e[t*3+1],a=e[n*3],l=e[n*3+1],c=e[s*3],h=e[s*3+1];return[new Me(r,o),new Me(a,l),new Me(c,h)]},generateSideWallUV:function(i,e,t,n,s,r){const o=e[t*3],a=e[t*3+1],l=e[t*3+2],c=e[n*3],h=e[n*3+1],u=e[n*3+2],d=e[s*3],f=e[s*3+1],p=e[s*3+2],A=e[r*3],m=e[r*3+1],g=e[r*3+2];return Math.abs(a-h)<Math.abs(o-c)?[new Me(o,1-l),new Me(c,1-u),new Me(d,1-p),new Me(A,1-g)]:[new Me(a,1-l),new Me(h,1-u),new Me(f,1-p),new Me(m,1-g)]}};function cB(i,e,t){if(t.shapes=[],Array.isArray(i))for(let n=0,s=i.length;n<s;n++){const r=i[n];t.shapes.push(r.uuid)}else t.shapes.push(i.uuid);return t.options=Object.assign({},e),e.extrudePath!==void 0&&(t.options.extrudePath=e.extrudePath.toJSON()),t}class Xd extends Nn{constructor(e=1,t=1,n=1,s=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:s};const r=e/2,o=t/2,a=Math.floor(n),l=Math.floor(s),c=a+1,h=l+1,u=e/a,d=t/l,f=[],p=[],A=[],m=[];for(let g=0;g<h;g++){const y=g*d-o;for(let _=0;_<c;_++){const v=_*u-r;p.push(v,-y,0),A.push(0,0,1),m.push(_/a),m.push(1-g/l)}}for(let g=0;g<l;g++)for(let y=0;y<a;y++){const _=y+c*g,v=y+c*(g+1),b=y+1+c*(g+1),T=y+1+c*g;f.push(_,v,T),f.push(v,b,T)}this.setIndex(f),this.setAttribute("position",new jt(p,3)),this.setAttribute("normal",new jt(A,3)),this.setAttribute("uv",new jt(m,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Xd(e.width,e.height,e.widthSegments,e.heightSegments)}}class gg extends xi{constructor(e){super(),this.isMeshStandardMaterial=!0,this.type="MeshStandardMaterial",this.defines={STANDARD:""},this.color=new at(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new at(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=vh,this.normalScale=new Me(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Rn,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class Ys extends gg{constructor(e){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Me(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return It(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(t){this.ior=(1+.4*t)/(1-.4*t)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new at(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new at(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new at(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._dispersion=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(e)}get anisotropy(){return this._anisotropy}set anisotropy(e){this._anisotropy>0!=e>0&&this.version++,this._anisotropy=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get iridescence(){return this._iridescence}set iridescence(e){this._iridescence>0!=e>0&&this.version++,this._iridescence=e}get dispersion(){return this._dispersion}set dispersion(e){this._dispersion>0!=e>0&&this.version++,this._dispersion=e}get sheen(){return this._sheen}set sheen(e){this._sheen>0!=e>0&&this.version++,this._sheen=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=e.anisotropy,this.anisotropyRotation=e.anisotropyRotation,this.anisotropyMap=e.anisotropyMap,this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.dispersion=e.dispersion,this.ior=e.ior,this.iridescence=e.iridescence,this.iridescenceMap=e.iridescenceMap,this.iridescenceIOR=e.iridescenceIOR,this.iridescenceThicknessRange=[...e.iridescenceThicknessRange],this.iridescenceThicknessMap=e.iridescenceThicknessMap,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}class Ou extends xi{constructor(e){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new at(16777215),this.specular=new at(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new at(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=vh,this.normalScale=new Me(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Rn,this.combine=Vd,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class hB extends xi{constructor(e){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new at(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new at(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=vh,this.normalScale=new Me(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Rn,this.combine=Vd,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class uB extends xi{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=yT,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class dB extends xi{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}class fB extends xi{constructor(e){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new at(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=vh,this.normalScale=new Me(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.flatShading=e.flatShading,this.fog=e.fog,this}}function uu(i,e,t){return!i||!t&&i.constructor===e?i:typeof e.BYTES_PER_ELEMENT=="number"?new e(i):Array.prototype.slice.call(i)}function pB(i){return ArrayBuffer.isView(i)&&!(i instanceof DataView)}function mB(i){function e(s,r){return i[s]-i[r]}const t=i.length,n=new Array(t);for(let s=0;s!==t;++s)n[s]=s;return n.sort(e),n}function X_(i,e,t){const n=i.length,s=new i.constructor(n);for(let r=0,o=0;o!==n;++r){const a=t[r]*e;for(let l=0;l!==e;++l)s[o++]=i[a+l]}return s}function jw(i,e,t,n){let s=1,r=i[0];for(;r!==void 0&&r[n]===void 0;)r=i[s++];if(r===void 0)return;let o=r[n];if(o!==void 0)if(Array.isArray(o))do o=r[n],o!==void 0&&(e.push(r.time),t.push.apply(t,o)),r=i[s++];while(r!==void 0);else if(o.toArray!==void 0)do o=r[n],o!==void 0&&(e.push(r.time),o.toArray(t,t.length)),r=i[s++];while(r!==void 0);else do o=r[n],o!==void 0&&(e.push(r.time),t.push(o)),r=i[s++];while(r!==void 0)}class xh{constructor(e,t,n,s){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=s!==void 0?s:new t.constructor(n),this.sampleValues=t,this.valueSize=n,this.settings=null,this.DefaultSettings_={}}evaluate(e){const t=this.parameterPositions;let n=this._cachedIndex,s=t[n],r=t[n-1];n:{e:{let o;t:{i:if(!(e<s)){for(let a=n+2;;){if(s===void 0){if(e<r)break i;return n=t.length,this._cachedIndex=n,this.copySampleValue_(n-1)}if(n===a)break;if(r=s,s=t[++n],e<s)break e}o=t.length;break t}if(!(e>=r)){const a=t[1];e<a&&(n=2,r=a);for(let l=n-2;;){if(r===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(n===l)break;if(s=r,r=t[--n-1],e>=r)break e}o=n,n=0;break t}break n}for(;n<o;){const a=n+o>>>1;e<t[a]?o=a:n=a+1}if(s=t[n],r=t[n-1],r===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(s===void 0)return n=t.length,this._cachedIndex=n,this.copySampleValue_(n-1)}this._cachedIndex=n,this.intervalChanged_(n,r,s)}return this.interpolate_(n,r,e,s)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const t=this.resultBuffer,n=this.sampleValues,s=this.valueSize,r=e*s;for(let o=0;o!==s;++o)t[o]=n[r+o];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class AB extends xh{constructor(e,t,n,s){super(e,t,n,s),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:a_,endingEnd:a_}}intervalChanged_(e,t,n){const s=this.parameterPositions;let r=e-2,o=e+1,a=s[r],l=s[o];if(a===void 0)switch(this.getSettings_().endingStart){case l_:r=e,a=2*t-n;break;case c_:r=s.length-2,a=t+s[r]-s[r+1];break;default:r=e,a=n}if(l===void 0)switch(this.getSettings_().endingEnd){case l_:o=e,l=2*n-t;break;case c_:o=1,l=n+s[1]-s[0];break;default:o=e-1,l=t}const c=(n-t)*.5,h=this.valueSize;this._weightPrev=c/(t-a),this._weightNext=c/(l-n),this._offsetPrev=r*h,this._offsetNext=o*h}interpolate_(e,t,n,s){const r=this.resultBuffer,o=this.sampleValues,a=this.valueSize,l=e*a,c=l-a,h=this._offsetPrev,u=this._offsetNext,d=this._weightPrev,f=this._weightNext,p=(n-t)/(s-t),A=p*p,m=A*p,g=-d*m+2*d*A-d*p,y=(1+d)*m+(-1.5-2*d)*A+(-.5+d)*p+1,_=(-1-f)*m+(1.5+f)*A+.5*p,v=f*m-f*A;for(let b=0;b!==a;++b)r[b]=g*o[h+b]+y*o[c+b]+_*o[l+b]+v*o[u+b];return r}}class gB extends xh{constructor(e,t,n,s){super(e,t,n,s)}interpolate_(e,t,n,s){const r=this.resultBuffer,o=this.sampleValues,a=this.valueSize,l=e*a,c=l-a,h=(n-t)/(s-t),u=1-h;for(let d=0;d!==a;++d)r[d]=o[c+d]*u+o[l+d]*h;return r}}class vB extends xh{constructor(e,t,n,s){super(e,t,n,s)}interpolate_(e){return this.copySampleValue_(e-1)}}class Ks{constructor(e,t,n,s){if(e===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(t===void 0||t.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=uu(t,this.TimeBufferType),this.values=uu(n,this.ValueBufferType),this.setInterpolation(s||this.DefaultInterpolation)}static toJSON(e){const t=e.constructor;let n;if(t.toJSON!==this.toJSON)n=t.toJSON(e);else{n={name:e.name,times:uu(e.times,Array),values:uu(e.values,Array)};const s=e.getInterpolation();s!==e.DefaultInterpolation&&(n.interpolation=s)}return n.type=e.ValueTypeName,n}InterpolantFactoryMethodDiscrete(e){return new vB(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new gB(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new AB(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case jc:t=this.InterpolantFactoryMethodDiscrete;break;case Xc:t=this.InterpolantFactoryMethodLinear;break;case Mf:t=this.InterpolantFactoryMethodSmooth;break}if(t===void 0){const n="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(e!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(n);return console.warn("THREE.KeyframeTrack:",n),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return jc;case this.InterpolantFactoryMethodLinear:return Xc;case this.InterpolantFactoryMethodSmooth:return Mf}}getValueSize(){return this.values.length/this.times.length}shift(e){if(e!==0){const t=this.times;for(let n=0,s=t.length;n!==s;++n)t[n]+=e}return this}scale(e){if(e!==1){const t=this.times;for(let n=0,s=t.length;n!==s;++n)t[n]*=e}return this}trim(e,t){const n=this.times,s=n.length;let r=0,o=s-1;for(;r!==s&&n[r]<e;)++r;for(;o!==-1&&n[o]>t;)--o;if(++o,r!==0||o!==s){r>=o&&(o=Math.max(o,1),r=o-1);const a=this.getValueSize();this.times=n.slice(r,o),this.values=this.values.slice(r*a,o*a)}return this}validate(){let e=!0;const t=this.getValueSize();t-Math.floor(t)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const n=this.times,s=this.values,r=n.length;r===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let o=null;for(let a=0;a!==r;a++){const l=n[a];if(typeof l=="number"&&isNaN(l)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,a,l),e=!1;break}if(o!==null&&o>l){console.error("THREE.KeyframeTrack: Out of order keys.",this,a,l,o),e=!1;break}o=l}if(s!==void 0&&pB(s))for(let a=0,l=s.length;a!==l;++a){const c=s[a];if(isNaN(c)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,a,c),e=!1;break}}return e}optimize(){const e=this.times.slice(),t=this.values.slice(),n=this.getValueSize(),s=this.getInterpolation()===Mf,r=e.length-1;let o=1;for(let a=1;a<r;++a){let l=!1;const c=e[a],h=e[a+1];if(c!==h&&(a!==1||c!==e[0]))if(s)l=!0;else{const u=a*n,d=u-n,f=u+n;for(let p=0;p!==n;++p){const A=t[u+p];if(A!==t[d+p]||A!==t[f+p]){l=!0;break}}}if(l){if(a!==o){e[o]=e[a];const u=a*n,d=o*n;for(let f=0;f!==n;++f)t[d+f]=t[u+f]}++o}}if(r>0){e[o]=e[r];for(let a=r*n,l=o*n,c=0;c!==n;++c)t[l+c]=t[a+c];++o}return o!==e.length?(this.times=e.slice(0,o),this.values=t.slice(0,o*n)):(this.times=e,this.values=t),this}clone(){const e=this.times.slice(),t=this.values.slice(),n=this.constructor,s=new n(this.name,e,t);return s.createInterpolant=this.createInterpolant,s}}Ks.prototype.TimeBufferType=Float32Array;Ks.prototype.ValueBufferType=Float32Array;Ks.prototype.DefaultInterpolation=Xc;class Pl extends Ks{constructor(e,t,n){super(e,t,n)}}Pl.prototype.ValueTypeName="bool";Pl.prototype.ValueBufferType=Array;Pl.prototype.DefaultInterpolation=jc;Pl.prototype.InterpolantFactoryMethodLinear=void 0;Pl.prototype.InterpolantFactoryMethodSmooth=void 0;class Xw extends Ks{}Xw.prototype.ValueTypeName="color";class sa extends Ks{}sa.prototype.ValueTypeName="number";class _B extends xh{constructor(e,t,n,s){super(e,t,n,s)}interpolate_(e,t,n,s){const r=this.resultBuffer,o=this.sampleValues,a=this.valueSize,l=(n-t)/(s-t);let c=e*a;for(let h=c+a;c!==h;c+=4)zn.slerpFlat(r,0,o,c-a,o,c,l);return r}}class ho extends Ks{InterpolantFactoryMethodLinear(e){return new _B(this.times,this.values,this.getValueSize(),e)}}ho.prototype.ValueTypeName="quaternion";ho.prototype.InterpolantFactoryMethodSmooth=void 0;class Dl extends Ks{constructor(e,t,n){super(e,t,n)}}Dl.prototype.ValueTypeName="string";Dl.prototype.ValueBufferType=Array;Dl.prototype.DefaultInterpolation=jc;Dl.prototype.InterpolantFactoryMethodLinear=void 0;Dl.prototype.InterpolantFactoryMethodSmooth=void 0;class ra extends Ks{}ra.prototype.ValueTypeName="vector";class Yw{constructor(e="",t=-1,n=[],s=vT){this.name=e,this.tracks=n,this.duration=t,this.blendMode=s,this.uuid=fs(),this.duration<0&&this.resetDuration()}static parse(e){const t=[],n=e.tracks,s=1/(e.fps||1);for(let o=0,a=n.length;o!==a;++o)t.push(xB(n[o]).scale(s));const r=new this(e.name,e.duration,t,e.blendMode);return r.uuid=e.uuid,r}static toJSON(e){const t=[],n=e.tracks,s={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode};for(let r=0,o=n.length;r!==o;++r)t.push(Ks.toJSON(n[r]));return s}static CreateFromMorphTargetSequence(e,t,n,s){const r=t.length,o=[];for(let a=0;a<r;a++){let l=[],c=[];l.push((a+r-1)%r,a,(a+1)%r),c.push(0,1,0);const h=mB(l);l=X_(l,1,h),c=X_(c,1,h),!s&&l[0]===0&&(l.push(r),c.push(c[0])),o.push(new sa(".morphTargetInfluences["+t[a].name+"]",l,c).scale(1/n))}return new this(e,-1,o)}static findByName(e,t){let n=e;if(!Array.isArray(e)){const s=e;n=s.geometry&&s.geometry.animations||s.animations}for(let s=0;s<n.length;s++)if(n[s].name===t)return n[s];return null}static CreateClipsFromMorphTargetSequences(e,t,n){const s={},r=/^([\w-]*?)([\d]+)$/;for(let a=0,l=e.length;a<l;a++){const c=e[a],h=c.name.match(r);if(h&&h.length>1){const u=h[1];let d=s[u];d||(s[u]=d=[]),d.push(c)}}const o=[];for(const a in s)o.push(this.CreateFromMorphTargetSequence(a,s[a],t,n));return o}static parseAnimation(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const n=function(u,d,f,p,A){if(f.length!==0){const m=[],g=[];jw(f,m,g,p),m.length!==0&&A.push(new u(d,m,g))}},s=[],r=e.name||"default",o=e.fps||30,a=e.blendMode;let l=e.length||-1;const c=e.hierarchy||[];for(let u=0;u<c.length;u++){const d=c[u].keys;if(!(!d||d.length===0))if(d[0].morphTargets){const f={};let p;for(p=0;p<d.length;p++)if(d[p].morphTargets)for(let A=0;A<d[p].morphTargets.length;A++)f[d[p].morphTargets[A]]=-1;for(const A in f){const m=[],g=[];for(let y=0;y!==d[p].morphTargets.length;++y){const _=d[p];m.push(_.time),g.push(_.morphTarget===A?1:0)}s.push(new sa(".morphTargetInfluence["+A+"]",m,g))}l=f.length*o}else{const f=".bones["+t[u].name+"]";n(ra,f+".position",d,"pos",s),n(ho,f+".quaternion",d,"rot",s),n(ra,f+".scale",d,"scl",s)}}return s.length===0?null:new this(r,l,s,a)}resetDuration(){const e=this.tracks;let t=0;for(let n=0,s=e.length;n!==s;++n){const r=this.tracks[n];t=Math.max(t,r.times[r.times.length-1])}return this.duration=t,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function yB(i){switch(i.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return sa;case"vector":case"vector2":case"vector3":case"vector4":return ra;case"color":return Xw;case"quaternion":return ho;case"bool":case"boolean":return Pl;case"string":return Dl}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+i)}function xB(i){if(i.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=yB(i.type);if(i.times===void 0){const t=[],n=[];jw(i.keys,t,n,"value"),i.times=t,i.values=n}return e.parse!==void 0?e.parse(i):new e(i.name,i.times,i.values,i.interpolation)}const Xr={enabled:!1,files:{},add:function(i,e){this.enabled!==!1&&(this.files[i]=e)},get:function(i){if(this.enabled!==!1)return this.files[i]},remove:function(i){delete this.files[i]},clear:function(){this.files={}}};class wB{constructor(e,t,n){const s=this;let r=!1,o=0,a=0,l;const c=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=n,this.itemStart=function(h){a++,r===!1&&s.onStart!==void 0&&s.onStart(h,o,a),r=!0},this.itemEnd=function(h){o++,s.onProgress!==void 0&&s.onProgress(h,o,a),o===a&&(r=!1,s.onLoad!==void 0&&s.onLoad())},this.itemError=function(h){s.onError!==void 0&&s.onError(h)},this.resolveURL=function(h){return l?l(h):h},this.setURLModifier=function(h){return l=h,this},this.addHandler=function(h,u){return c.push(h,u),this},this.removeHandler=function(h){const u=c.indexOf(h);return u!==-1&&c.splice(u,2),this},this.getHandler=function(h){for(let u=0,d=c.length;u<d;u+=2){const f=c[u],p=c[u+1];if(f.global&&(f.lastIndex=0),f.test(h))return p}return null}}}const bB=new wB;class ni{constructor(e){this.manager=e!==void 0?e:bB,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){const n=this;return new Promise(function(s,r){n.load(e,s,t,r)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}ni.DEFAULT_MATERIAL_NAME="__DEFAULT";const ir={};class EB extends Error{constructor(e,t){super(e),this.response=t}}class ji extends ni{constructor(e){super(e)}load(e,t,n,s){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const r=Xr.get(e);if(r!==void 0)return this.manager.itemStart(e),setTimeout(()=>{t&&t(r),this.manager.itemEnd(e)},0),r;if(ir[e]!==void 0){ir[e].push({onLoad:t,onProgress:n,onError:s});return}ir[e]=[],ir[e].push({onLoad:t,onProgress:n,onError:s});const o=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),a=this.mimeType,l=this.responseType;fetch(o).then(c=>{if(c.status===200||c.status===0){if(c.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||c.body===void 0||c.body.getReader===void 0)return c;const h=ir[e],u=c.body.getReader(),d=c.headers.get("X-File-Size")||c.headers.get("Content-Length"),f=d?parseInt(d):0,p=f!==0;let A=0;const m=new ReadableStream({start(g){y();function y(){u.read().then(({done:_,value:v})=>{if(_)g.close();else{A+=v.byteLength;const b=new ProgressEvent("progress",{lengthComputable:p,loaded:A,total:f});for(let T=0,L=h.length;T<L;T++){const I=h[T];I.onProgress&&I.onProgress(b)}g.enqueue(v),y()}},_=>{g.error(_)})}}});return new Response(m)}else throw new EB('fetch for "'.concat(c.url,'" responded with ').concat(c.status,": ").concat(c.statusText),c)}).then(c=>{switch(l){case"arraybuffer":return c.arrayBuffer();case"blob":return c.blob();case"document":return c.text().then(h=>new DOMParser().parseFromString(h,a));case"json":return c.json();default:if(a===void 0)return c.text();{const u=/charset="?([^;"\s]*)"?/i.exec(a),d=u&&u[1]?u[1].toLowerCase():void 0,f=new TextDecoder(d);return c.arrayBuffer().then(p=>f.decode(p))}}}).then(c=>{Xr.add(e,c);const h=ir[e];delete ir[e];for(let u=0,d=h.length;u<d;u++){const f=h[u];f.onLoad&&f.onLoad(c)}}).catch(c=>{const h=ir[e];if(h===void 0)throw this.manager.itemError(e),c;delete ir[e];for(let u=0,d=h.length;u<d;u++){const f=h[u];f.onError&&f.onError(c)}this.manager.itemError(e)}).finally(()=>{this.manager.itemEnd(e)}),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}}class Kw extends ni{constructor(e){super(e)}load(e,t,n,s){this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const r=this,o=Xr.get(e);if(o!==void 0)return r.manager.itemStart(e),setTimeout(function(){t&&t(o),r.manager.itemEnd(e)},0),o;const a=Yc("img");function l(){h(),Xr.add(e,this),t&&t(this),r.manager.itemEnd(e)}function c(u){h(),s&&s(u),r.manager.itemError(e),r.manager.itemEnd(e)}function h(){a.removeEventListener("load",l,!1),a.removeEventListener("error",c,!1)}return a.addEventListener("load",l,!1),a.addEventListener("error",c,!1),e.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(a.crossOrigin=this.crossOrigin),r.manager.itemStart(e),a.src=e,a}}class CB extends ni{constructor(e){super(e)}load(e,t,n,s){const r=new ug;r.colorSpace=Ft;const o=new Kw(this.manager);o.setCrossOrigin(this.crossOrigin),o.setPath(this.path);let a=0;function l(c){o.load(e[c],function(h){r.images[c]=h,a++,a===6&&(r.needsUpdate=!0,t&&t(r))},void 0,s)}for(let c=0;c<e.length;++c)l(c);return r}}class $w extends ni{constructor(e){super(e)}load(e,t,n,s){const r=this,o=new Gd,a=new ji(this.manager);return a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setPath(this.path),a.setWithCredentials(r.withCredentials),a.load(e,function(l){let c;try{c=r.parse(l)}catch(h){if(s!==void 0)s(h);else{console.error(h);return}}c.image!==void 0?o.image=c.image:c.data!==void 0&&(o.image.width=c.width,o.image.height=c.height,o.image.data=c.data),o.wrapS=c.wrapS!==void 0?c.wrapS:Hi,o.wrapT=c.wrapT!==void 0?c.wrapT:Hi,o.magFilter=c.magFilter!==void 0?c.magFilter:Zt,o.minFilter=c.minFilter!==void 0?c.minFilter:Zt,o.anisotropy=c.anisotropy!==void 0?c.anisotropy:1,c.colorSpace!==void 0&&(o.colorSpace=c.colorSpace),c.flipY!==void 0&&(o.flipY=c.flipY),c.format!==void 0&&(o.format=c.format),c.type!==void 0&&(o.type=c.type),c.mipmaps!==void 0&&(o.mipmaps=c.mipmaps,o.minFilter=os),c.mipmapCount===1&&(o.minFilter=Zt),c.generateMipmaps!==void 0&&(o.generateMipmaps=c.generateMipmaps),o.needsUpdate=!0,t&&t(o,c)},n,s),o}}class vg extends ni{constructor(e){super(e)}load(e,t,n,s){const r=new Pn,o=new Kw(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),o.load(e,function(a){r.image=a,r.needsUpdate=!0,t!==void 0&&t(r)},n,s),r}}class Yd extends en{constructor(e,t=1){super(),this.isLight=!0,this.type="Light",this.color=new at(e),this.intensity=t}dispose(){}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,this.groundColor!==void 0&&(t.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(t.object.distance=this.distance),this.angle!==void 0&&(t.object.angle=this.angle),this.decay!==void 0&&(t.object.decay=this.decay),this.penumbra!==void 0&&(t.object.penumbra=this.penumbra),this.shadow!==void 0&&(t.object.shadow=this.shadow.toJSON()),this.target!==void 0&&(t.object.target=this.target.uuid),t}}const tp=new pt,Y_=new he,K_=new he;class _g{constructor(e){this.camera=e,this.intensity=1,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new Me(512,512),this.map=null,this.mapPass=null,this.matrix=new pt,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new fg,this._frameExtents=new Me(1,1),this._viewportCount=1,this._viewports=[new Ot(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,n=this.matrix;Y_.setFromMatrixPosition(e.matrixWorld),t.position.copy(Y_),K_.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(K_),t.updateMatrixWorld(),tp.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(tp),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(tp)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.intensity=e.intensity,this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const e={};return this.intensity!==1&&(e.intensity=this.intensity),this.bias!==0&&(e.bias=this.bias),this.normalBias!==0&&(e.normalBias=this.normalBias),this.radius!==1&&(e.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class SB extends _g{constructor(){super(new ai(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(e){const t=this.camera,n=yl*2*e.angle*this.focus,s=this.mapSize.width/this.mapSize.height,r=e.distance||t.far;(n!==t.fov||s!==t.aspect||r!==t.far)&&(t.fov=n,t.aspect=s,t.far=r,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}class Jw extends Yd{constructor(e,t,n=0,s=Math.PI/3,r=0,o=2){super(e,t),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(en.DEFAULT_UP),this.updateMatrix(),this.target=new en,this.distance=n,this.angle=s,this.penumbra=r,this.decay=o,this.map=null,this.shadow=new SB}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}const $_=new pt,Kl=new he,np=new he;class IB extends _g{constructor(){super(new ai(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new Me(4,2),this._viewportCount=6,this._viewports=[new Ot(2,1,1,1),new Ot(0,1,1,1),new Ot(3,1,1,1),new Ot(1,1,1,1),new Ot(3,0,1,1),new Ot(1,0,1,1)],this._cubeDirections=[new he(1,0,0),new he(-1,0,0),new he(0,0,1),new he(0,0,-1),new he(0,1,0),new he(0,-1,0)],this._cubeUps=[new he(0,1,0),new he(0,1,0),new he(0,1,0),new he(0,1,0),new he(0,0,1),new he(0,0,-1)]}updateMatrices(e,t=0){const n=this.camera,s=this.matrix,r=e.distance||n.far;r!==n.far&&(n.far=r,n.updateProjectionMatrix()),Kl.setFromMatrixPosition(e.matrixWorld),n.position.copy(Kl),np.copy(n.position),np.add(this._cubeDirections[t]),n.up.copy(this._cubeUps[t]),n.lookAt(np),n.updateMatrixWorld(),s.makeTranslation(-Kl.x,-Kl.y,-Kl.z),$_.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix($_)}}class $m extends Yd{constructor(e,t,n=0,s=2){super(e,t),this.isPointLight=!0,this.type="PointLight",this.distance=n,this.decay=s,this.shadow=new IB}get power(){return this.intensity*4*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}class Kd extends hg{constructor(e=-1,t=1,n=1,s=-1,r=.1,o=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=n,this.bottom=s,this.near=r,this.far=o,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,t,n,s,r,o){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=s,this.view.width=r,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,s=(this.top+this.bottom)/2;let r=n-e,o=n+e,a=s+t,l=s-t;if(this.view!==null&&this.view.enabled){const c=(this.right-this.left)/this.view.fullWidth/this.zoom,h=(this.top-this.bottom)/this.view.fullHeight/this.zoom;r+=c*this.view.offsetX,o=r+c*this.view.width,a-=h*this.view.offsetY,l=a-h*this.view.height}this.projectionMatrix.makeOrthographic(r,o,a,l,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,this.view!==null&&(t.object.view=Object.assign({},this.view)),t}}class MB extends _g{constructor(){super(new Kd(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class yg extends Yd{constructor(e,t){super(e,t),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(en.DEFAULT_UP),this.updateMatrix(),this.target=new en,this.shadow=new MB}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}class Zw extends Yd{constructor(e,t){super(e,t),this.isAmbientLight=!0,this.type="AmbientLight"}}class al{static decodeText(e){if(console.warn("THREE.LoaderUtils: decodeText() has been deprecated with r165 and will be removed with r175. Use TextDecoder instead."),typeof TextDecoder<"u")return new TextDecoder().decode(e);let t="";for(let n=0,s=e.length;n<s;n++)t+=String.fromCharCode(e[n]);try{return decodeURIComponent(escape(t))}catch(n){return t}}static extractUrlBase(e){const t=e.lastIndexOf("/");return t===-1?"./":e.slice(0,t+1)}static resolveURL(e,t){return typeof e!="string"||e===""?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}}class TB extends ni{constructor(e){super(e),this.isImageBitmapLoader=!0,typeof createImageBitmap>"u"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(e){return this.options=e,this}load(e,t,n,s){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const r=this,o=Xr.get(e);if(o!==void 0){if(r.manager.itemStart(e),o.then){o.then(c=>{t&&t(c),r.manager.itemEnd(e)}).catch(c=>{s&&s(c)});return}return setTimeout(function(){t&&t(o),r.manager.itemEnd(e)},0),o}const a={};a.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",a.headers=this.requestHeader;const l=fetch(e,a).then(function(c){return c.blob()}).then(function(c){return createImageBitmap(c,Object.assign(r.options,{colorSpaceConversion:"none"}))}).then(function(c){return Xr.add(e,c),t&&t(c),r.manager.itemEnd(e),c}).catch(function(c){s&&s(c),Xr.remove(e),r.manager.itemError(e),r.manager.itemEnd(e)});Xr.add(e,l),r.manager.itemStart(e)}}let du;class BB{static getContext(){return du===void 0&&(du=new(window.AudioContext||window.webkitAudioContext)),du}static setContext(e){du=e}}class RB extends ni{constructor(e){super(e)}load(e,t,n,s){const r=this,o=new ji(this.manager);o.setResponseType("arraybuffer"),o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,function(l){try{const c=l.slice(0);BB.getContext().decodeAudioData(c,function(u){t(u)}).catch(a)}catch(c){a(c)}},n,s);function a(l){s?s(l):console.error(l),r.manager.itemError(e)}}}class PB extends ai{constructor(e=[]){super(),this.isArrayCamera=!0,this.cameras=e}}class DB{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=J_(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const t=J_();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}function J_(){return performance.now()}const xg="\\[\\]\\.:\\/",LB=new RegExp("["+xg+"]","g"),wg="[^"+xg+"]",FB="[^"+xg.replace("\\.","")+"]",NB=/((?:WC+[\/:])*)/.source.replace("WC",wg),kB=/(WCOD+)?/.source.replace("WCOD",FB),OB=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",wg),UB=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",wg),QB=new RegExp("^"+NB+kB+OB+UB+"$"),VB=["material","materials","bones","map"];class zB{constructor(e,t,n){const s=n||Vt.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,s)}getValue(e,t){this.bind();const n=this._targetGroup.nCachedObjects_,s=this._bindings[n];s!==void 0&&s.getValue(e,t)}setValue(e,t){const n=this._bindings;for(let s=this._targetGroup.nCachedObjects_,r=n.length;s!==r;++s)n[s].setValue(e,t)}bind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].bind()}unbind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].unbind()}}class Vt{constructor(e,t,n){this.path=t,this.parsedPath=n||Vt.parseTrackName(t),this.node=Vt.findNode(e,this.parsedPath.nodeName),this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,n){return e&&e.isAnimationObjectGroup?new Vt.Composite(e,t,n):new Vt(e,t,n)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(LB,"")}static parseTrackName(e){const t=QB.exec(e);if(t===null)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const n={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},s=n.nodeName&&n.nodeName.lastIndexOf(".");if(s!==void 0&&s!==-1){const r=n.nodeName.substring(s+1);VB.indexOf(r)!==-1&&(n.nodeName=n.nodeName.substring(0,s),n.objectName=r)}if(n.propertyName===null||n.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return n}static findNode(e,t){if(t===void 0||t===""||t==="."||t===-1||t===e.name||t===e.uuid)return e;if(e.skeleton){const n=e.skeleton.getBoneByName(t);if(n!==void 0)return n}if(e.children){const n=function(r){for(let o=0;o<r.length;o++){const a=r[o];if(a.name===t||a.uuid===t)return a;const l=n(a.children);if(l)return l}return null},s=n(e.children);if(s)return s}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}_getValue_array(e,t){const n=this.resolvedProperty;for(let s=0,r=n.length;s!==r;++s)e[t++]=n[s]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){const n=this.resolvedProperty;for(let s=0,r=n.length;s!==r;++s)n[s]=e[t++]}_setValue_array_setNeedsUpdate(e,t){const n=this.resolvedProperty;for(let s=0,r=n.length;s!==r;++s)n[s]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){const n=this.resolvedProperty;for(let s=0,r=n.length;s!==r;++s)n[s]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node;const t=this.parsedPath,n=t.objectName,s=t.propertyName;let r=t.propertyIndex;if(e||(e=Vt.findNode(this.rootNode,t.nodeName),this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e){console.warn("THREE.PropertyBinding: No target node found for track: "+this.path+".");return}if(n){let c=t.objectIndex;switch(n){case"materials":if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}e=e.material.materials;break;case"bones":if(!e.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}e=e.skeleton.bones;for(let h=0;h<e.length;h++)if(e[h].name===c){c=h;break}break;case"map":if("map"in e){e=e.map;break}if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.map){console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);return}e=e.material.map;break;default:if(e[n]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}e=e[n]}if(c!==void 0){if(e[c]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);return}e=e[c]}}const o=e[s];if(o===void 0){const c=t.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+c+"."+s+" but it wasn't found.",e);return}let a=this.Versioning.None;this.targetObject=e,e.isMaterial===!0?a=this.Versioning.NeedsUpdate:e.isObject3D===!0&&(a=this.Versioning.MatrixWorldNeedsUpdate);let l=this.BindingType.Direct;if(r!==void 0){if(s==="morphTargetInfluences"){if(!e.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(!e.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}e.morphTargetDictionary[r]!==void 0&&(r=e.morphTargetDictionary[r])}l=this.BindingType.ArrayElement,this.resolvedProperty=o,this.propertyIndex=r}else o.fromArray!==void 0&&o.toArray!==void 0?(l=this.BindingType.HasFromToArray,this.resolvedProperty=o):Array.isArray(o)?(l=this.BindingType.EntireArray,this.resolvedProperty=o):this.propertyName=s;this.getValue=this.GetterByBindingType[l],this.setValue=this.SetterByBindingTypeAndVersioning[l][a]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}Vt.Composite=zB;Vt.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3};Vt.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2};Vt.prototype.GetterByBindingType=[Vt.prototype._getValue_direct,Vt.prototype._getValue_array,Vt.prototype._getValue_arrayElement,Vt.prototype._getValue_toArray];Vt.prototype.SetterByBindingTypeAndVersioning=[[Vt.prototype._setValue_direct,Vt.prototype._setValue_direct_setNeedsUpdate,Vt.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[Vt.prototype._setValue_array,Vt.prototype._setValue_array_setNeedsUpdate,Vt.prototype._setValue_array_setMatrixWorldNeedsUpdate],[Vt.prototype._setValue_arrayElement,Vt.prototype._setValue_arrayElement_setNeedsUpdate,Vt.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[Vt.prototype._setValue_fromArray,Vt.prototype._setValue_fromArray_setNeedsUpdate,Vt.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class Z_{constructor(e=1,t=0,n=0){return this.radius=e,this.phi=t,this.theta=n,this}set(e,t,n){return this.radius=e,this.phi=t,this.theta=n,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=It(this.phi,1e-6,Math.PI-1e-6),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,n){return this.radius=Math.sqrt(e*e+t*t+n*n),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,n),this.phi=Math.acos(It(t/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}const e0=new Me;class GB{constructor(e=new Me(1/0,1/0),t=new Me(-1/0,-1/0)){this.isBox2=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=e0.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return e.x>=this.min.x&&e.x<=this.max.x&&e.y>=this.min.y&&e.y<=this.max.y}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return e.max.x>=this.min.x&&e.min.x<=this.max.x&&e.max.y>=this.min.y&&e.min.y<=this.max.y}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,e0).distanceTo(e)}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const fu=new he,wn=new hg;class HB extends Kc{constructor(e){const t=new Nn,n=new no({color:16777215,vertexColors:!0,toneMapped:!1}),s=[],r=[],o={};a("n1","n2"),a("n2","n4"),a("n4","n3"),a("n3","n1"),a("f1","f2"),a("f2","f4"),a("f4","f3"),a("f3","f1"),a("n1","f1"),a("n2","f2"),a("n3","f3"),a("n4","f4"),a("p","n1"),a("p","n2"),a("p","n3"),a("p","n4"),a("u1","u2"),a("u2","u3"),a("u3","u1"),a("c","t"),a("p","c"),a("cn1","cn2"),a("cn3","cn4"),a("cf1","cf2"),a("cf3","cf4");function a(p,A){l(p),l(A)}function l(p){s.push(0,0,0),r.push(0,0,0),o[p]===void 0&&(o[p]=[]),o[p].push(s.length/3-1)}t.setAttribute("position",new jt(s,3)),t.setAttribute("color",new jt(r,3)),super(t,n),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=o,this.update();const c=new at(16755200),h=new at(16711680),u=new at(43775),d=new at(16777215),f=new at(3355443);this.setColors(c,h,u,d,f)}setColors(e,t,n,s,r){const a=this.geometry.getAttribute("color");a.setXYZ(0,e.r,e.g,e.b),a.setXYZ(1,e.r,e.g,e.b),a.setXYZ(2,e.r,e.g,e.b),a.setXYZ(3,e.r,e.g,e.b),a.setXYZ(4,e.r,e.g,e.b),a.setXYZ(5,e.r,e.g,e.b),a.setXYZ(6,e.r,e.g,e.b),a.setXYZ(7,e.r,e.g,e.b),a.setXYZ(8,e.r,e.g,e.b),a.setXYZ(9,e.r,e.g,e.b),a.setXYZ(10,e.r,e.g,e.b),a.setXYZ(11,e.r,e.g,e.b),a.setXYZ(12,e.r,e.g,e.b),a.setXYZ(13,e.r,e.g,e.b),a.setXYZ(14,e.r,e.g,e.b),a.setXYZ(15,e.r,e.g,e.b),a.setXYZ(16,e.r,e.g,e.b),a.setXYZ(17,e.r,e.g,e.b),a.setXYZ(18,e.r,e.g,e.b),a.setXYZ(19,e.r,e.g,e.b),a.setXYZ(20,e.r,e.g,e.b),a.setXYZ(21,e.r,e.g,e.b),a.setXYZ(22,e.r,e.g,e.b),a.setXYZ(23,e.r,e.g,e.b),a.setXYZ(24,t.r,t.g,t.b),a.setXYZ(25,t.r,t.g,t.b),a.setXYZ(26,t.r,t.g,t.b),a.setXYZ(27,t.r,t.g,t.b),a.setXYZ(28,t.r,t.g,t.b),a.setXYZ(29,t.r,t.g,t.b),a.setXYZ(30,t.r,t.g,t.b),a.setXYZ(31,t.r,t.g,t.b),a.setXYZ(32,n.r,n.g,n.b),a.setXYZ(33,n.r,n.g,n.b),a.setXYZ(34,n.r,n.g,n.b),a.setXYZ(35,n.r,n.g,n.b),a.setXYZ(36,n.r,n.g,n.b),a.setXYZ(37,n.r,n.g,n.b),a.setXYZ(38,s.r,s.g,s.b),a.setXYZ(39,s.r,s.g,s.b),a.setXYZ(40,r.r,r.g,r.b),a.setXYZ(41,r.r,r.g,r.b),a.setXYZ(42,r.r,r.g,r.b),a.setXYZ(43,r.r,r.g,r.b),a.setXYZ(44,r.r,r.g,r.b),a.setXYZ(45,r.r,r.g,r.b),a.setXYZ(46,r.r,r.g,r.b),a.setXYZ(47,r.r,r.g,r.b),a.setXYZ(48,r.r,r.g,r.b),a.setXYZ(49,r.r,r.g,r.b),a.needsUpdate=!0}update(){const e=this.geometry,t=this.pointMap,n=1,s=1;wn.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse);const r=this.camera.coordinateSystem===Os?-1:0;Mn("c",t,e,wn,0,0,r),Mn("t",t,e,wn,0,0,1),Mn("n1",t,e,wn,-1,-1,r),Mn("n2",t,e,wn,n,-1,r),Mn("n3",t,e,wn,-1,s,r),Mn("n4",t,e,wn,n,s,r),Mn("f1",t,e,wn,-1,-1,1),Mn("f2",t,e,wn,n,-1,1),Mn("f3",t,e,wn,-1,s,1),Mn("f4",t,e,wn,n,s,1),Mn("u1",t,e,wn,n*.7,s*1.1,r),Mn("u2",t,e,wn,-1*.7,s*1.1,r),Mn("u3",t,e,wn,0,s*2,r),Mn("cf1",t,e,wn,-1,0,1),Mn("cf2",t,e,wn,n,0,1),Mn("cf3",t,e,wn,0,-1,1),Mn("cf4",t,e,wn,0,s,1),Mn("cn1",t,e,wn,-1,0,r),Mn("cn2",t,e,wn,n,0,r),Mn("cn3",t,e,wn,0,-1,r),Mn("cn4",t,e,wn,0,s,r),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}function Mn(i,e,t,n,s,r,o){fu.set(s,r,o).unproject(n);const a=e[i];if(a!==void 0){const l=t.getAttribute("position");for(let c=0,h=a.length;c<h;c++)l.setXYZ(a[c],fu.x,fu.y,fu.z)}}class WB extends Kc{constructor(e=1){const t=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],n=[1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],s=new Nn;s.setAttribute("position",new jt(t,3)),s.setAttribute("color",new jt(n,3));const r=new no({vertexColors:!0,toneMapped:!1});super(s,r),this.type="AxesHelper"}setColors(e,t,n){const s=new at,r=this.geometry.attributes.color.array;return s.set(e),s.toArray(r,0),s.toArray(r,3),s.set(t),s.toArray(r,6),s.toArray(r,9),s.set(n),s.toArray(r,12),s.toArray(r,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class Qr{constructor(){this.type="ShapePath",this.color=new at,this.subPaths=[],this.currentPath=null}moveTo(e,t){return this.currentPath=new ol,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this}lineTo(e,t){return this.currentPath.lineTo(e,t),this}quadraticCurveTo(e,t,n,s){return this.currentPath.quadraticCurveTo(e,t,n,s),this}bezierCurveTo(e,t,n,s,r,o){return this.currentPath.bezierCurveTo(e,t,n,s,r,o),this}splineThru(e){return this.currentPath.splineThru(e),this}toShapes(e){function t(g){const y=[];for(let _=0,v=g.length;_<v;_++){const b=g[_],T=new Tc;T.curves=b.curves,y.push(T)}return y}function n(g,y){const _=y.length;let v=!1;for(let b=_-1,T=0;T<_;b=T++){let L=y[b],I=y[T],x=I.x-L.x,w=I.y-L.y;if(Math.abs(w)>Number.EPSILON){if(w<0&&(L=y[T],x=-x,I=y[b],w=-w),g.y<L.y||g.y>I.y)continue;if(g.y===L.y){if(g.x===L.x)return!0}else{const P=w*(g.x-L.x)-x*(g.y-L.y);if(P===0)return!0;if(P<0)continue;v=!v}}else{if(g.y!==L.y)continue;if(I.x<=g.x&&g.x<=L.x||L.x<=g.x&&g.x<=I.x)return!0}}return v}const s=io.isClockWise,r=this.subPaths;if(r.length===0)return[];let o,a,l;const c=[];if(r.length===1)return a=r[0],l=new Tc,l.curves=a.curves,c.push(l),c;let h=!s(r[0].getPoints());h=e?!h:h;const u=[],d=[];let f=[],p=0,A;d[p]=void 0,f[p]=[];for(let g=0,y=r.length;g<y;g++)a=r[g],A=a.getPoints(),o=s(A),o=e?!o:o,o?(!h&&d[p]&&p++,d[p]={s:new Tc,p:A},d[p].s.curves=a.curves,h&&p++,f[p]=[]):f[p].push({h:a,p:A[0]});if(!d[0])return t(r);if(d.length>1){let g=!1,y=0;for(let _=0,v=d.length;_<v;_++)u[_]=[];for(let _=0,v=d.length;_<v;_++){const b=f[_];for(let T=0;T<b.length;T++){const L=b[T];let I=!0;for(let x=0;x<d.length;x++)n(L.p,d[x].p)&&(_!==x&&y++,I?(I=!1,u[x].push(L)):g=!0);I&&u[_].push(L)}}y>0&&g===!1&&(f=u)}let m;for(let g=0,y=d.length;g<y;g++){l=d[g].s,c.push(l),m=f[g];for(let _=0,v=m.length;_<v;_++)l.holes.push(m[_].h)}return c}}class eb extends ua{constructor(e,t=null){super(),this.object=e,this.domElement=t,this.enabled=!0,this.state=-1,this.keys={},this.mouseButtons={LEFT:null,MIDDLE:null,RIGHT:null},this.touches={ONE:null,TWO:null}}connect(){}disconnect(){}dispose(){}update(){}}function t0(i,e,t,n){const s=qB(n);switch(t){case Ew:return i*e;case Cw:return i*e;case Sw:return i*e*2;case mr:return i*e/s.components*s.byteLength;case rg:return i*e/s.components*s.byteLength;case Vo:return i*e*2/s.components*s.byteLength;case og:return i*e*2/s.components*s.byteLength;case sg:return i*e*3/s.components*s.byteLength;case Hn:return i*e*4/s.components*s.byteLength;case ag:return i*e*4/s.components*s.byteLength;case Fu:case wc:return Math.floor((i+3)/4)*Math.floor((e+3)/4)*8;case Nu:case bc:return Math.floor((i+3)/4)*Math.floor((e+3)/4)*16;case Sm:case Im:return Math.max(i,16)*Math.max(e,8)/4;case nd:case id:return Math.max(i,8)*Math.max(e,8)/2;case sd:case rd:return Math.floor((i+3)/4)*Math.floor((e+3)/4)*8;case od:return Math.floor((i+3)/4)*Math.floor((e+3)/4)*16;case Wc:return Math.floor((i+3)/4)*Math.floor((e+3)/4)*16;case Mm:return Math.floor((i+4)/5)*Math.floor((e+3)/4)*16;case Tm:return Math.floor((i+4)/5)*Math.floor((e+4)/5)*16;case Bm:return Math.floor((i+5)/6)*Math.floor((e+4)/5)*16;case qc:return Math.floor((i+5)/6)*Math.floor((e+5)/6)*16;case Rm:return Math.floor((i+7)/8)*Math.floor((e+4)/5)*16;case Pm:return Math.floor((i+7)/8)*Math.floor((e+5)/6)*16;case Dm:return Math.floor((i+7)/8)*Math.floor((e+7)/8)*16;case Lm:return Math.floor((i+9)/10)*Math.floor((e+4)/5)*16;case Fm:return Math.floor((i+9)/10)*Math.floor((e+5)/6)*16;case Nm:return Math.floor((i+9)/10)*Math.floor((e+7)/8)*16;case km:return Math.floor((i+9)/10)*Math.floor((e+9)/10)*16;case Om:return Math.floor((i+11)/12)*Math.floor((e+9)/10)*16;case Um:return Math.floor((i+11)/12)*Math.floor((e+11)/12)*16;case Ec:case Qm:case ad:return Math.ceil(i/4)*Math.ceil(e/4)*16;case Iw:case Vm:return Math.ceil(i/4)*Math.ceil(e/4)*8;case zm:case Gm:return Math.ceil(i/4)*Math.ceil(e/4)*16}throw new Error("Unable to determine texture byte length for ".concat(t," format."))}function qB(i){switch(i){case Kn:case xw:return{byteLength:1,components:1};case Hc:case ww:case Gn:return{byteLength:2,components:1};case ng:case ig:return{byteLength:2,components:4};case ta:case tg:case Sn:return{byteLength:4,components:1};case bw:return{byteLength:4,components:3}}throw new Error("Unknown texture type ".concat(i,"."))}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:eg}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=eg);/**
 * @license
 * Copyright 2010-2024 Three.js Authors
 * SPDX-License-Identifier: MIT
 */function tb(){let i=null,e=!1,t=null,n=null;function s(r,o){t(r,o),n=i.requestAnimationFrame(s)}return{start:function(){e!==!0&&t!==null&&(n=i.requestAnimationFrame(s),e=!0)},stop:function(){i.cancelAnimationFrame(n),e=!1},setAnimationLoop:function(r){t=r},setContext:function(r){i=r}}}function jB(i){const e=new WeakMap;function t(a,l){const c=a.array,h=a.usage,u=c.byteLength,d=i.createBuffer();i.bindBuffer(l,d),i.bufferData(l,c,h),a.onUploadCallback();let f;if(c instanceof Float32Array)f=i.FLOAT;else if(c instanceof Uint16Array)a.isFloat16BufferAttribute?f=i.HALF_FLOAT:f=i.UNSIGNED_SHORT;else if(c instanceof Int16Array)f=i.SHORT;else if(c instanceof Uint32Array)f=i.UNSIGNED_INT;else if(c instanceof Int32Array)f=i.INT;else if(c instanceof Int8Array)f=i.BYTE;else if(c instanceof Uint8Array)f=i.UNSIGNED_BYTE;else if(c instanceof Uint8ClampedArray)f=i.UNSIGNED_BYTE;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+c);return{buffer:d,type:f,bytesPerElement:c.BYTES_PER_ELEMENT,version:a.version,size:u}}function n(a,l,c){const h=l.array,u=l.updateRanges;if(i.bindBuffer(c,a),u.length===0)i.bufferSubData(c,0,h);else{u.sort((f,p)=>f.start-p.start);let d=0;for(let f=1;f<u.length;f++){const p=u[d],A=u[f];A.start<=p.start+p.count+1?p.count=Math.max(p.count,A.start+A.count-p.start):(++d,u[d]=A)}u.length=d+1;for(let f=0,p=u.length;f<p;f++){const A=u[f];i.bufferSubData(c,A.start*h.BYTES_PER_ELEMENT,h,A.start,A.count)}l.clearUpdateRanges()}l.onUploadCallback()}function s(a){return a.isInterleavedBufferAttribute&&(a=a.data),e.get(a)}function r(a){a.isInterleavedBufferAttribute&&(a=a.data);const l=e.get(a);l&&(i.deleteBuffer(l.buffer),e.delete(a))}function o(a,l){if(a.isInterleavedBufferAttribute&&(a=a.data),a.isGLBufferAttribute){const h=e.get(a);(!h||h.version<a.version)&&e.set(a,{buffer:a.buffer,type:a.type,bytesPerElement:a.elementSize,version:a.version});return}const c=e.get(a);if(c===void 0)e.set(a,t(a,l));else if(c.version<a.version){if(c.size!==a.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");n(c.buffer,a,l),c.version=a.version}}return{get:s,remove:r,update:o}}var XB="#ifdef USE_ALPHAHASH\n	if ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;\n#endif",YB="#ifdef USE_ALPHAHASH\n	const float ALPHA_HASH_SCALE = 0.05;\n	float hash2D( vec2 value ) {\n		return fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );\n	}\n	float hash3D( vec3 value ) {\n		return hash2D( vec2( hash2D( value.xy ), value.z ) );\n	}\n	float getAlphaHashThreshold( vec3 position ) {\n		float maxDeriv = max(\n			length( dFdx( position.xyz ) ),\n			length( dFdy( position.xyz ) )\n		);\n		float pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );\n		vec2 pixScales = vec2(\n			exp2( floor( log2( pixScale ) ) ),\n			exp2( ceil( log2( pixScale ) ) )\n		);\n		vec2 alpha = vec2(\n			hash3D( floor( pixScales.x * position.xyz ) ),\n			hash3D( floor( pixScales.y * position.xyz ) )\n		);\n		float lerpFactor = fract( log2( pixScale ) );\n		float x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;\n		float a = min( lerpFactor, 1.0 - lerpFactor );\n		vec3 cases = vec3(\n			x * x / ( 2.0 * a * ( 1.0 - a ) ),\n			( x - 0.5 * a ) / ( 1.0 - a ),\n			1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )\n		);\n		float threshold = ( x < ( 1.0 - a ) )\n			? ( ( x < a ) ? cases.x : cases.y )\n			: cases.z;\n		return clamp( threshold , 1.0e-6, 1.0 );\n	}\n#endif",KB="#ifdef USE_ALPHAMAP\n	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;\n#endif",$B="#ifdef USE_ALPHAMAP\n	uniform sampler2D alphaMap;\n#endif",JB="#ifdef USE_ALPHATEST\n	#ifdef ALPHA_TO_COVERAGE\n	diffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );\n	if ( diffuseColor.a == 0.0 ) discard;\n	#else\n	if ( diffuseColor.a < alphaTest ) discard;\n	#endif\n#endif",ZB="#ifdef USE_ALPHATEST\n	uniform float alphaTest;\n#endif",eR="#ifdef USE_AOMAP\n	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;\n	reflectedLight.indirectDiffuse *= ambientOcclusion;\n	#if defined( USE_CLEARCOAT ) \n		clearcoatSpecularIndirect *= ambientOcclusion;\n	#endif\n	#if defined( USE_SHEEN ) \n		sheenSpecularIndirect *= ambientOcclusion;\n	#endif\n	#if defined( USE_ENVMAP ) && defined( STANDARD )\n		float dotNV = saturate( dot( geometryNormal, geometryViewDir ) );\n		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n	#endif\n#endif",tR="#ifdef USE_AOMAP\n	uniform sampler2D aoMap;\n	uniform float aoMapIntensity;\n#endif",nR="#ifdef USE_BATCHING\n	#if ! defined( GL_ANGLE_multi_draw )\n	#define gl_DrawID _gl_DrawID\n	uniform int _gl_DrawID;\n	#endif\n	uniform highp sampler2D batchingTexture;\n	uniform highp usampler2D batchingIdTexture;\n	mat4 getBatchingMatrix( const in float i ) {\n		int size = textureSize( batchingTexture, 0 ).x;\n		int j = int( i ) * 4;\n		int x = j % size;\n		int y = j / size;\n		vec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );\n		vec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );\n		vec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );\n		vec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );\n		return mat4( v1, v2, v3, v4 );\n	}\n	float getIndirectIndex( const in int i ) {\n		int size = textureSize( batchingIdTexture, 0 ).x;\n		int x = i % size;\n		int y = i / size;\n		return float( texelFetch( batchingIdTexture, ivec2( x, y ), 0 ).r );\n	}\n#endif\n#ifdef USE_BATCHING_COLOR\n	uniform sampler2D batchingColorTexture;\n	vec3 getBatchingColor( const in float i ) {\n		int size = textureSize( batchingColorTexture, 0 ).x;\n		int j = int( i );\n		int x = j % size;\n		int y = j / size;\n		return texelFetch( batchingColorTexture, ivec2( x, y ), 0 ).rgb;\n	}\n#endif",iR="#ifdef USE_BATCHING\n	mat4 batchingMatrix = getBatchingMatrix( getIndirectIndex( gl_DrawID ) );\n#endif",sR="vec3 transformed = vec3( position );\n#ifdef USE_ALPHAHASH\n	vPosition = vec3( position );\n#endif",rR="vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n	vec3 objectTangent = vec3( tangent.xyz );\n#endif",oR="float G_BlinnPhong_Implicit( ) {\n	return 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {\n	vec3 halfDir = normalize( lightDir + viewDir );\n	float dotNH = saturate( dot( normal, halfDir ) );\n	float dotVH = saturate( dot( viewDir, halfDir ) );\n	vec3 F = F_Schlick( specularColor, 1.0, dotVH );\n	float G = G_BlinnPhong_Implicit( );\n	float D = D_BlinnPhong( shininess, dotNH );\n	return F * ( G * D );\n} // validated",aR="#ifdef USE_IRIDESCENCE\n	const mat3 XYZ_TO_REC709 = mat3(\n		 3.2404542, -0.9692660,  0.0556434,\n		-1.5371385,  1.8760108, -0.2040259,\n		-0.4985314,  0.0415560,  1.0572252\n	);\n	vec3 Fresnel0ToIor( vec3 fresnel0 ) {\n		vec3 sqrtF0 = sqrt( fresnel0 );\n		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );\n	}\n	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {\n		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );\n	}\n	float IorToFresnel0( float transmittedIor, float incidentIor ) {\n		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));\n	}\n	vec3 evalSensitivity( float OPD, vec3 shift ) {\n		float phase = 2.0 * PI * OPD * 1.0e-9;\n		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );\n		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );\n		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );\n		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );\n		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );\n		xyz /= 1.0685e-7;\n		vec3 rgb = XYZ_TO_REC709 * xyz;\n		return rgb;\n	}\n	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {\n		vec3 I;\n		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );\n		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );\n		float cosTheta2Sq = 1.0 - sinTheta2Sq;\n		if ( cosTheta2Sq < 0.0 ) {\n			return vec3( 1.0 );\n		}\n		float cosTheta2 = sqrt( cosTheta2Sq );\n		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );\n		float R12 = F_Schlick( R0, 1.0, cosTheta1 );\n		float T121 = 1.0 - R12;\n		float phi12 = 0.0;\n		if ( iridescenceIOR < outsideIOR ) phi12 = PI;\n		float phi21 = PI - phi12;\n		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );\n		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );\n		vec3 phi23 = vec3( 0.0 );\n		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;\n		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;\n		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;\n		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;\n		vec3 phi = vec3( phi21 ) + phi23;\n		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );\n		vec3 r123 = sqrt( R123 );\n		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );\n		vec3 C0 = R12 + Rs;\n		I = C0;\n		vec3 Cm = Rs - T121;\n		for ( int m = 1; m <= 2; ++ m ) {\n			Cm *= r123;\n			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );\n			I += Cm * Sm;\n		}\n		return max( I, vec3( 0.0 ) );\n	}\n#endif",lR="#ifdef USE_BUMPMAP\n	uniform sampler2D bumpMap;\n	uniform float bumpScale;\n	vec2 dHdxy_fwd() {\n		vec2 dSTdx = dFdx( vBumpMapUv );\n		vec2 dSTdy = dFdy( vBumpMapUv );\n		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;\n		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;\n		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;\n		return vec2( dBx, dBy );\n	}\n	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n		vec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );\n		vec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );\n		vec3 vN = surf_norm;\n		vec3 R1 = cross( vSigmaY, vN );\n		vec3 R2 = cross( vN, vSigmaX );\n		float fDet = dot( vSigmaX, R1 ) * faceDirection;\n		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n		return normalize( abs( fDet ) * surf_norm - vGrad );\n	}\n#endif",cR="#if NUM_CLIPPING_PLANES > 0\n	vec4 plane;\n	#ifdef ALPHA_TO_COVERAGE\n		float distanceToPlane, distanceGradient;\n		float clipOpacity = 1.0;\n		#pragma unroll_loop_start\n		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n			plane = clippingPlanes[ i ];\n			distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;\n			distanceGradient = fwidth( distanceToPlane ) / 2.0;\n			clipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );\n			if ( clipOpacity == 0.0 ) discard;\n		}\n		#pragma unroll_loop_end\n		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n			float unionClipOpacity = 1.0;\n			#pragma unroll_loop_start\n			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n				plane = clippingPlanes[ i ];\n				distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;\n				distanceGradient = fwidth( distanceToPlane ) / 2.0;\n				unionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );\n			}\n			#pragma unroll_loop_end\n			clipOpacity *= 1.0 - unionClipOpacity;\n		#endif\n		diffuseColor.a *= clipOpacity;\n		if ( diffuseColor.a == 0.0 ) discard;\n	#else\n		#pragma unroll_loop_start\n		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n			plane = clippingPlanes[ i ];\n			if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n		}\n		#pragma unroll_loop_end\n		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n			bool clipped = true;\n			#pragma unroll_loop_start\n			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n				plane = clippingPlanes[ i ];\n				clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n			}\n			#pragma unroll_loop_end\n			if ( clipped ) discard;\n		#endif\n	#endif\n#endif",hR="#if NUM_CLIPPING_PLANES > 0\n	varying vec3 vClipPosition;\n	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",uR="#if NUM_CLIPPING_PLANES > 0\n	varying vec3 vClipPosition;\n#endif",dR="#if NUM_CLIPPING_PLANES > 0\n	vClipPosition = - mvPosition.xyz;\n#endif",fR="#if defined( USE_COLOR_ALPHA )\n	diffuseColor *= vColor;\n#elif defined( USE_COLOR )\n	diffuseColor.rgb *= vColor;\n#endif",pR="#if defined( USE_COLOR_ALPHA )\n	varying vec4 vColor;\n#elif defined( USE_COLOR )\n	varying vec3 vColor;\n#endif",mR="#if defined( USE_COLOR_ALPHA )\n	varying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )\n	varying vec3 vColor;\n#endif",AR="#if defined( USE_COLOR_ALPHA )\n	vColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )\n	vColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n	vColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n	vColor.xyz *= instanceColor.xyz;\n#endif\n#ifdef USE_BATCHING_COLOR\n	vec3 batchingColor = getBatchingColor( getIndirectIndex( gl_DrawID ) );\n	vColor.xyz *= batchingColor.xyz;\n#endif",gR="#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nvec3 pow2( const in vec3 x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }\nhighp float rand( const in vec2 uv ) {\n	const highp float a = 12.9898, b = 78.233, c = 43758.5453;\n	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n	return fract( sin( sn ) * c );\n}\n#ifdef HIGH_PRECISION\n	float precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n	float precisionSafeLength( vec3 v ) {\n		float maxComponent = max3( abs( v ) );\n		return length( v / maxComponent ) * maxComponent;\n	}\n#endif\nstruct IncidentLight {\n	vec3 color;\n	vec3 direction;\n	bool visible;\n};\nstruct ReflectedLight {\n	vec3 directDiffuse;\n	vec3 directSpecular;\n	vec3 indirectDiffuse;\n	vec3 indirectSpecular;\n};\n#ifdef USE_ALPHAHASH\n	varying vec3 vPosition;\n#endif\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nmat3 transposeMat3( const in mat3 m ) {\n	mat3 tmp;\n	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n	return tmp;\n}\nbool isPerspectiveMatrix( mat4 m ) {\n	return m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n	return vec2( u, v );\n}\nvec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n	return RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nfloat F_Schlick( const in float f0, const in float f90, const in float dotVH ) {\n	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n} // validated",vR="#ifdef ENVMAP_TYPE_CUBE_UV\n	#define cubeUV_minMipLevel 4.0\n	#define cubeUV_minTileSize 16.0\n	float getFace( vec3 direction ) {\n		vec3 absDirection = abs( direction );\n		float face = - 1.0;\n		if ( absDirection.x > absDirection.z ) {\n			if ( absDirection.x > absDirection.y )\n				face = direction.x > 0.0 ? 0.0 : 3.0;\n			else\n				face = direction.y > 0.0 ? 1.0 : 4.0;\n		} else {\n			if ( absDirection.z > absDirection.y )\n				face = direction.z > 0.0 ? 2.0 : 5.0;\n			else\n				face = direction.y > 0.0 ? 1.0 : 4.0;\n		}\n		return face;\n	}\n	vec2 getUV( vec3 direction, float face ) {\n		vec2 uv;\n		if ( face == 0.0 ) {\n			uv = vec2( direction.z, direction.y ) / abs( direction.x );\n		} else if ( face == 1.0 ) {\n			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n		} else if ( face == 2.0 ) {\n			uv = vec2( - direction.x, direction.y ) / abs( direction.z );\n		} else if ( face == 3.0 ) {\n			uv = vec2( - direction.z, direction.y ) / abs( direction.x );\n		} else if ( face == 4.0 ) {\n			uv = vec2( - direction.x, direction.z ) / abs( direction.y );\n		} else {\n			uv = vec2( direction.x, direction.y ) / abs( direction.z );\n		}\n		return 0.5 * ( uv + 1.0 );\n	}\n	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n		float face = getFace( direction );\n		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n		mipInt = max( mipInt, cubeUV_minMipLevel );\n		float faceSize = exp2( mipInt );\n		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;\n		if ( face > 2.0 ) {\n			uv.y += faceSize;\n			face -= 3.0;\n		}\n		uv.x += face * faceSize;\n		uv.x += filterInt * 3.0 * cubeUV_minTileSize;\n		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );\n		uv.x *= CUBEUV_TEXEL_WIDTH;\n		uv.y *= CUBEUV_TEXEL_HEIGHT;\n		#ifdef texture2DGradEXT\n			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;\n		#else\n			return texture2D( envMap, uv ).rgb;\n		#endif\n	}\n	#define cubeUV_r0 1.0\n	#define cubeUV_m0 - 2.0\n	#define cubeUV_r1 0.8\n	#define cubeUV_m1 - 1.0\n	#define cubeUV_r4 0.4\n	#define cubeUV_m4 2.0\n	#define cubeUV_r5 0.305\n	#define cubeUV_m5 3.0\n	#define cubeUV_r6 0.21\n	#define cubeUV_m6 4.0\n	float roughnessToMip( float roughness ) {\n		float mip = 0.0;\n		if ( roughness >= cubeUV_r1 ) {\n			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;\n		} else if ( roughness >= cubeUV_r4 ) {\n			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;\n		} else if ( roughness >= cubeUV_r5 ) {\n			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;\n		} else if ( roughness >= cubeUV_r6 ) {\n			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;\n		} else {\n			mip = - 2.0 * log2( 1.16 * roughness );		}\n		return mip;\n	}\n	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );\n		float mipF = fract( mip );\n		float mipInt = floor( mip );\n		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n		if ( mipF == 0.0 ) {\n			return vec4( color0, 1.0 );\n		} else {\n			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n			return vec4( mix( color0, color1, mipF ), 1.0 );\n		}\n	}\n#endif",_R="vec3 transformedNormal = objectNormal;\n#ifdef USE_TANGENT\n	vec3 transformedTangent = objectTangent;\n#endif\n#ifdef USE_BATCHING\n	mat3 bm = mat3( batchingMatrix );\n	transformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );\n	transformedNormal = bm * transformedNormal;\n	#ifdef USE_TANGENT\n		transformedTangent = bm * transformedTangent;\n	#endif\n#endif\n#ifdef USE_INSTANCING\n	mat3 im = mat3( instanceMatrix );\n	transformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );\n	transformedNormal = im * transformedNormal;\n	#ifdef USE_TANGENT\n		transformedTangent = im * transformedTangent;\n	#endif\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n	transformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n	transformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;\n	#ifdef FLIP_SIDED\n		transformedTangent = - transformedTangent;\n	#endif\n#endif",yR="#ifdef USE_DISPLACEMENTMAP\n	uniform sampler2D displacementMap;\n	uniform float displacementScale;\n	uniform float displacementBias;\n#endif",xR="#ifdef USE_DISPLACEMENTMAP\n	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );\n#endif",wR="#ifdef USE_EMISSIVEMAP\n	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );\n	#ifdef DECODE_VIDEO_TEXTURE_EMISSIVE\n		emissiveColor = sRGBTransferEOTF( emissiveColor );\n	#endif\n	totalEmissiveRadiance *= emissiveColor.rgb;\n#endif",bR="#ifdef USE_EMISSIVEMAP\n	uniform sampler2D emissiveMap;\n#endif",ER="gl_FragColor = linearToOutputTexel( gl_FragColor );",CR="vec4 LinearTransferOETF( in vec4 value ) {\n	return value;\n}\nvec4 sRGBTransferEOTF( in vec4 value ) {\n	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );\n}\nvec4 sRGBTransferOETF( in vec4 value ) {\n	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}",SR="#ifdef USE_ENVMAP\n	#ifdef ENV_WORLDPOS\n		vec3 cameraToFrag;\n		if ( isOrthographic ) {\n			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n		} else {\n			cameraToFrag = normalize( vWorldPosition - cameraPosition );\n		}\n		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n		#ifdef ENVMAP_MODE_REFLECTION\n			vec3 reflectVec = reflect( cameraToFrag, worldNormal );\n		#else\n			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n		#endif\n	#else\n		vec3 reflectVec = vReflect;\n	#endif\n	#ifdef ENVMAP_TYPE_CUBE\n		vec4 envColor = textureCube( envMap, envMapRotation * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n	#else\n		vec4 envColor = vec4( 0.0 );\n	#endif\n	#ifdef ENVMAP_BLENDING_MULTIPLY\n		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n	#elif defined( ENVMAP_BLENDING_MIX )\n		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n	#elif defined( ENVMAP_BLENDING_ADD )\n		outgoingLight += envColor.xyz * specularStrength * reflectivity;\n	#endif\n#endif",IR="#ifdef USE_ENVMAP\n	uniform float envMapIntensity;\n	uniform float flipEnvMap;\n	uniform mat3 envMapRotation;\n	#ifdef ENVMAP_TYPE_CUBE\n		uniform samplerCube envMap;\n	#else\n		uniform sampler2D envMap;\n	#endif\n	\n#endif",MR="#ifdef USE_ENVMAP\n	uniform float reflectivity;\n	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n		#define ENV_WORLDPOS\n	#endif\n	#ifdef ENV_WORLDPOS\n		varying vec3 vWorldPosition;\n		uniform float refractionRatio;\n	#else\n		varying vec3 vReflect;\n	#endif\n#endif",TR="#ifdef USE_ENVMAP\n	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n		#define ENV_WORLDPOS\n	#endif\n	#ifdef ENV_WORLDPOS\n		\n		varying vec3 vWorldPosition;\n	#else\n		varying vec3 vReflect;\n		uniform float refractionRatio;\n	#endif\n#endif",BR="#ifdef USE_ENVMAP\n	#ifdef ENV_WORLDPOS\n		vWorldPosition = worldPosition.xyz;\n	#else\n		vec3 cameraToVertex;\n		if ( isOrthographic ) {\n			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n		} else {\n			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n		}\n		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n		#ifdef ENVMAP_MODE_REFLECTION\n			vReflect = reflect( cameraToVertex, worldNormal );\n		#else\n			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n		#endif\n	#endif\n#endif",RR="#ifdef USE_FOG\n	vFogDepth = - mvPosition.z;\n#endif",PR="#ifdef USE_FOG\n	varying float vFogDepth;\n#endif",DR="#ifdef USE_FOG\n	#ifdef FOG_EXP2\n		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n	#else\n		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n	#endif\n	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",LR="#ifdef USE_FOG\n	uniform vec3 fogColor;\n	varying float vFogDepth;\n	#ifdef FOG_EXP2\n		uniform float fogDensity;\n	#else\n		uniform float fogNear;\n		uniform float fogFar;\n	#endif\n#endif",FR="#ifdef USE_GRADIENTMAP\n	uniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n	float dotNL = dot( normal, lightDirection );\n	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n	#ifdef USE_GRADIENTMAP\n		return vec3( texture2D( gradientMap, coord ).r );\n	#else\n		vec2 fw = fwidth( coord ) * 0.5;\n		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );\n	#endif\n}",NR="#ifdef USE_LIGHTMAP\n	uniform sampler2D lightMap;\n	uniform float lightMapIntensity;\n#endif",kR="LambertMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularStrength = specularStrength;",OR="varying vec3 vViewPosition;\nstruct LambertMaterial {\n	vec3 diffuseColor;\n	float specularStrength;\n};\nvoid RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n	vec3 irradiance = dotNL * directLight.color;\n	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct				RE_Direct_Lambert\n#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert",UR="uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\n#if defined( USE_LIGHT_PROBES )\n	uniform vec3 lightProbe[ 9 ];\n#endif\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n	float x = normal.x, y = normal.y, z = normal.z;\n	vec3 result = shCoefficients[ 0 ] * 0.886227;\n	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n	return result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {\n	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n	return irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n	vec3 irradiance = ambientLightColor;\n	return irradiance;\n}\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n	float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n	if ( cutoffDistance > 0.0 ) {\n		distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n	}\n	return distanceFalloff;\n}\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n	return smoothstep( coneCosine, penumbraCosine, angleCosine );\n}\n#if NUM_DIR_LIGHTS > 0\n	struct DirectionalLight {\n		vec3 direction;\n		vec3 color;\n	};\n	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n	void getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {\n		light.color = directionalLight.color;\n		light.direction = directionalLight.direction;\n		light.visible = true;\n	}\n#endif\n#if NUM_POINT_LIGHTS > 0\n	struct PointLight {\n		vec3 position;\n		vec3 color;\n		float distance;\n		float decay;\n	};\n	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n	void getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {\n		vec3 lVector = pointLight.position - geometryPosition;\n		light.direction = normalize( lVector );\n		float lightDistance = length( lVector );\n		light.color = pointLight.color;\n		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n		light.visible = ( light.color != vec3( 0.0 ) );\n	}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n	struct SpotLight {\n		vec3 position;\n		vec3 direction;\n		vec3 color;\n		float distance;\n		float decay;\n		float coneCos;\n		float penumbraCos;\n	};\n	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n	void getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {\n		vec3 lVector = spotLight.position - geometryPosition;\n		light.direction = normalize( lVector );\n		float angleCos = dot( light.direction, spotLight.direction );\n		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n		if ( spotAttenuation > 0.0 ) {\n			float lightDistance = length( lVector );\n			light.color = spotLight.color * spotAttenuation;\n			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n			light.visible = ( light.color != vec3( 0.0 ) );\n		} else {\n			light.color = vec3( 0.0 );\n			light.visible = false;\n		}\n	}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n	struct RectAreaLight {\n		vec3 color;\n		vec3 position;\n		vec3 halfWidth;\n		vec3 halfHeight;\n	};\n	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;\n	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n	struct HemisphereLight {\n		vec3 direction;\n		vec3 skyColor;\n		vec3 groundColor;\n	};\n	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {\n		float dotNL = dot( normal, hemiLight.direction );\n		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n		return irradiance;\n	}\n#endif",QR="#ifdef USE_ENVMAP\n	vec3 getIBLIrradiance( const in vec3 normal ) {\n		#ifdef ENVMAP_TYPE_CUBE_UV\n			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * worldNormal, 1.0 );\n			return PI * envMapColor.rgb * envMapIntensity;\n		#else\n			return vec3( 0.0 );\n		#endif\n	}\n	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n		#ifdef ENVMAP_TYPE_CUBE_UV\n			vec3 reflectVec = reflect( - viewDir, normal );\n			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * reflectVec, roughness );\n			return envMapColor.rgb * envMapIntensity;\n		#else\n			return vec3( 0.0 );\n		#endif\n	}\n	#ifdef USE_ANISOTROPY\n		vec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {\n			#ifdef ENVMAP_TYPE_CUBE_UV\n				vec3 bentNormal = cross( bitangent, viewDir );\n				bentNormal = normalize( cross( bentNormal, bitangent ) );\n				bentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );\n				return getIBLRadiance( viewDir, bentNormal, roughness );\n			#else\n				return vec3( 0.0 );\n			#endif\n		}\n	#endif\n#endif",VR="ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",zR="varying vec3 vViewPosition;\nstruct ToonMaterial {\n	vec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n	vec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;\n	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct				RE_Direct_Toon\n#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon",GR="BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",HR="varying vec3 vViewPosition;\nstruct BlinnPhongMaterial {\n	vec3 diffuseColor;\n	vec3 specularColor;\n	float specularShininess;\n	float specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n	vec3 irradiance = dotNL * directLight.color;\n	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct				RE_Direct_BlinnPhong\n#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong",WR="PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n#ifdef IOR\n	material.ior = ior;\n	#ifdef USE_SPECULAR\n		float specularIntensityFactor = specularIntensity;\n		vec3 specularColorFactor = specularColor;\n		#ifdef USE_SPECULAR_COLORMAP\n			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;\n		#endif\n		#ifdef USE_SPECULAR_INTENSITYMAP\n			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;\n		#endif\n		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n	#else\n		float specularIntensityFactor = 1.0;\n		vec3 specularColorFactor = vec3( 1.0 );\n		material.specularF90 = 1.0;\n	#endif\n	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\n#else\n	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n	material.specularF90 = 1.0;\n#endif\n#ifdef USE_CLEARCOAT\n	material.clearcoat = clearcoat;\n	material.clearcoatRoughness = clearcoatRoughness;\n	material.clearcoatF0 = vec3( 0.04 );\n	material.clearcoatF90 = 1.0;\n	#ifdef USE_CLEARCOATMAP\n		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;\n	#endif\n	#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;\n	#endif\n	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n	material.clearcoatRoughness += geometryRoughness;\n	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_DISPERSION\n	material.dispersion = dispersion;\n#endif\n#ifdef USE_IRIDESCENCE\n	material.iridescence = iridescence;\n	material.iridescenceIOR = iridescenceIOR;\n	#ifdef USE_IRIDESCENCEMAP\n		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;\n	#endif\n	#ifdef USE_IRIDESCENCE_THICKNESSMAP\n		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;\n	#else\n		material.iridescenceThickness = iridescenceThicknessMaximum;\n	#endif\n#endif\n#ifdef USE_SHEEN\n	material.sheenColor = sheenColor;\n	#ifdef USE_SHEEN_COLORMAP\n		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;\n	#endif\n	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );\n	#ifdef USE_SHEEN_ROUGHNESSMAP\n		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;\n	#endif\n#endif\n#ifdef USE_ANISOTROPY\n	#ifdef USE_ANISOTROPYMAP\n		mat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );\n		vec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;\n		vec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;\n	#else\n		vec2 anisotropyV = anisotropyVector;\n	#endif\n	material.anisotropy = length( anisotropyV );\n	if( material.anisotropy == 0.0 ) {\n		anisotropyV = vec2( 1.0, 0.0 );\n	} else {\n		anisotropyV /= material.anisotropy;\n		material.anisotropy = saturate( material.anisotropy );\n	}\n	material.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );\n	material.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;\n	material.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;\n#endif",qR="struct PhysicalMaterial {\n	vec3 diffuseColor;\n	float roughness;\n	vec3 specularColor;\n	float specularF90;\n	float dispersion;\n	#ifdef USE_CLEARCOAT\n		float clearcoat;\n		float clearcoatRoughness;\n		vec3 clearcoatF0;\n		float clearcoatF90;\n	#endif\n	#ifdef USE_IRIDESCENCE\n		float iridescence;\n		float iridescenceIOR;\n		float iridescenceThickness;\n		vec3 iridescenceFresnel;\n		vec3 iridescenceF0;\n	#endif\n	#ifdef USE_SHEEN\n		vec3 sheenColor;\n		float sheenRoughness;\n	#endif\n	#ifdef IOR\n		float ior;\n	#endif\n	#ifdef USE_TRANSMISSION\n		float transmission;\n		float transmissionAlpha;\n		float thickness;\n		float attenuationDistance;\n		vec3 attenuationColor;\n	#endif\n	#ifdef USE_ANISOTROPY\n		float anisotropy;\n		float alphaT;\n		vec3 anisotropyT;\n		vec3 anisotropyB;\n	#endif\n};\nvec3 clearcoatSpecularDirect = vec3( 0.0 );\nvec3 clearcoatSpecularIndirect = vec3( 0.0 );\nvec3 sheenSpecularDirect = vec3( 0.0 );\nvec3 sheenSpecularIndirect = vec3(0.0 );\nvec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {\n    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );\n    float x2 = x * x;\n    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );\n    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );\n}\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n	float a2 = pow2( alpha );\n	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n	return 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n	float a2 = pow2( alpha );\n	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n	return RECIPROCAL_PI * a2 / pow2( denom );\n}\n#ifdef USE_ANISOTROPY\n	float V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {\n		float gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );\n		float gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );\n		float v = 0.5 / ( gv + gl );\n		return saturate(v);\n	}\n	float D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {\n		float a2 = alphaT * alphaB;\n		highp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );\n		highp float v2 = dot( v, v );\n		float w2 = a2 / v2;\n		return RECIPROCAL_PI * a2 * pow2 ( w2 );\n	}\n#endif\n#ifdef USE_CLEARCOAT\n	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {\n		vec3 f0 = material.clearcoatF0;\n		float f90 = material.clearcoatF90;\n		float roughness = material.clearcoatRoughness;\n		float alpha = pow2( roughness );\n		vec3 halfDir = normalize( lightDir + viewDir );\n		float dotNL = saturate( dot( normal, lightDir ) );\n		float dotNV = saturate( dot( normal, viewDir ) );\n		float dotNH = saturate( dot( normal, halfDir ) );\n		float dotVH = saturate( dot( viewDir, halfDir ) );\n		vec3 F = F_Schlick( f0, f90, dotVH );\n		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n		float D = D_GGX( alpha, dotNH );\n		return F * ( V * D );\n	}\n#endif\nvec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {\n	vec3 f0 = material.specularColor;\n	float f90 = material.specularF90;\n	float roughness = material.roughness;\n	float alpha = pow2( roughness );\n	vec3 halfDir = normalize( lightDir + viewDir );\n	float dotNL = saturate( dot( normal, lightDir ) );\n	float dotNV = saturate( dot( normal, viewDir ) );\n	float dotNH = saturate( dot( normal, halfDir ) );\n	float dotVH = saturate( dot( viewDir, halfDir ) );\n	vec3 F = F_Schlick( f0, f90, dotVH );\n	#ifdef USE_IRIDESCENCE\n		F = mix( F, material.iridescenceFresnel, material.iridescence );\n	#endif\n	#ifdef USE_ANISOTROPY\n		float dotTL = dot( material.anisotropyT, lightDir );\n		float dotTV = dot( material.anisotropyT, viewDir );\n		float dotTH = dot( material.anisotropyT, halfDir );\n		float dotBL = dot( material.anisotropyB, lightDir );\n		float dotBV = dot( material.anisotropyB, viewDir );\n		float dotBH = dot( material.anisotropyB, halfDir );\n		float V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );\n		float D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );\n	#else\n		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n		float D = D_GGX( alpha, dotNH );\n	#endif\n	return F * ( V * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n	const float LUT_SIZE = 64.0;\n	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n	const float LUT_BIAS = 0.5 / LUT_SIZE;\n	float dotNV = saturate( dot( N, V ) );\n	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n	uv = uv * LUT_SCALE + LUT_BIAS;\n	return uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n	float l = length( f );\n	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n	float x = dot( v1, v2 );\n	float y = abs( x );\n	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n	float b = 3.4175940 + ( 4.1616724 + y ) * y;\n	float v = a / b;\n	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n	return cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n	vec3 lightNormal = cross( v1, v2 );\n	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n	vec3 T1, T2;\n	T1 = normalize( V - N * dot( V, N ) );\n	T2 = - cross( N, T1 );\n	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n	vec3 coords[ 4 ];\n	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n	coords[ 0 ] = normalize( coords[ 0 ] );\n	coords[ 1 ] = normalize( coords[ 1 ] );\n	coords[ 2 ] = normalize( coords[ 2 ] );\n	coords[ 3 ] = normalize( coords[ 3 ] );\n	vec3 vectorFormFactor = vec3( 0.0 );\n	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n	return vec3( result );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie( float roughness, float dotNH ) {\n	float alpha = pow2( roughness );\n	float invAlpha = 1.0 / alpha;\n	float cos2h = dotNH * dotNH;\n	float sin2h = max( 1.0 - cos2h, 0.0078125 );\n	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n}\nfloat V_Neubelt( float dotNV, float dotNL ) {\n	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );\n}\nvec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {\n	vec3 halfDir = normalize( lightDir + viewDir );\n	float dotNL = saturate( dot( normal, lightDir ) );\n	float dotNV = saturate( dot( normal, viewDir ) );\n	float dotNH = saturate( dot( normal, halfDir ) );\n	float D = D_Charlie( sheenRoughness, dotNH );\n	float V = V_Neubelt( dotNV, dotNL );\n	return sheenColor * ( D * V );\n}\n#endif\nfloat IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n	float dotNV = saturate( dot( normal, viewDir ) );\n	float r2 = roughness * roughness;\n	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;\n	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;\n	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );\n	return saturate( DG * RECIPROCAL_PI );\n}\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n	float dotNV = saturate( dot( normal, viewDir ) );\n	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n	vec4 r = roughness * c0 + c1;\n	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;\n	return fab;\n}\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n	vec2 fab = DFGApprox( normal, viewDir, roughness );\n	return specularColor * fab.x + specularF90 * fab.y;\n}\n#ifdef USE_IRIDESCENCE\nvoid computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#else\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#endif\n	vec2 fab = DFGApprox( normal, viewDir, roughness );\n	#ifdef USE_IRIDESCENCE\n		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );\n	#else\n		vec3 Fr = specularColor;\n	#endif\n	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;\n	float Ess = fab.x + fab.y;\n	float Ems = 1.0 - Ess;\n	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n	singleScatter += FssEss;\n	multiScatter += Fms * Ems;\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n		vec3 normal = geometryNormal;\n		vec3 viewDir = geometryViewDir;\n		vec3 position = geometryPosition;\n		vec3 lightPos = rectAreaLight.position;\n		vec3 halfWidth = rectAreaLight.halfWidth;\n		vec3 halfHeight = rectAreaLight.halfHeight;\n		vec3 lightColor = rectAreaLight.color;\n		float roughness = material.roughness;\n		vec3 rectCoords[ 4 ];\n		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n		vec2 uv = LTC_Uv( normal, viewDir, roughness );\n		vec4 t1 = texture2D( ltc_1, uv );\n		vec4 t2 = texture2D( ltc_2, uv );\n		mat3 mInv = mat3(\n			vec3( t1.x, 0, t1.y ),\n			vec3(    0, 1,    0 ),\n			vec3( t1.z, 0, t1.w )\n		);\n		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n	}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n	vec3 irradiance = dotNL * directLight.color;\n	#ifdef USE_CLEARCOAT\n		float dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );\n		vec3 ccIrradiance = dotNLcc * directLight.color;\n		clearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );\n	#endif\n	#ifdef USE_SHEEN\n		sheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );\n	#endif\n	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );\n	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n	#ifdef USE_CLEARCOAT\n		clearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n	#endif\n	#ifdef USE_SHEEN\n		sheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );\n	#endif\n	vec3 singleScattering = vec3( 0.0 );\n	vec3 multiScattering = vec3( 0.0 );\n	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n	#ifdef USE_IRIDESCENCE\n		computeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );\n	#else\n		computeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\n	#endif\n	vec3 totalScattering = singleScattering + multiScattering;\n	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );\n	reflectedLight.indirectSpecular += radiance * singleScattering;\n	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct				RE_Direct_Physical\n#define RE_Direct_RectArea		RE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular		RE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",jR="\nvec3 geometryPosition = - vViewPosition;\nvec3 geometryNormal = normal;\nvec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\nvec3 geometryClearcoatNormal = vec3( 0.0 );\n#ifdef USE_CLEARCOAT\n	geometryClearcoatNormal = clearcoatNormal;\n#endif\n#ifdef USE_IRIDESCENCE\n	float dotNVi = saturate( dot( normal, geometryViewDir ) );\n	if ( material.iridescenceThickness == 0.0 ) {\n		material.iridescence = 0.0;\n	} else {\n		material.iridescence = saturate( material.iridescence );\n	}\n	if ( material.iridescence > 0.0 ) {\n		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );\n		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );\n	}\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n	PointLight pointLight;\n	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n	PointLightShadow pointLightShadow;\n	#endif\n	#pragma unroll_loop_start\n	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n		pointLight = pointLights[ i ];\n		getPointLightInfo( pointLight, geometryPosition, directLight );\n		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n		pointLightShadow = pointLightShadows[ i ];\n		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowIntensity, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n		#endif\n		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n	}\n	#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n	SpotLight spotLight;\n	vec4 spotColor;\n	vec3 spotLightCoord;\n	bool inSpotLightMap;\n	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n	SpotLightShadow spotLightShadow;\n	#endif\n	#pragma unroll_loop_start\n	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n		spotLight = spotLights[ i ];\n		getSpotLightInfo( spotLight, geometryPosition, directLight );\n		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX\n		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS\n		#else\n		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n		#endif\n		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )\n			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;\n			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );\n			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );\n			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;\n		#endif\n		#undef SPOT_LIGHT_MAP_INDEX\n		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n		spotLightShadow = spotLightShadows[ i ];\n		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowIntensity, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n		#endif\n		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n	}\n	#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n	DirectionalLight directionalLight;\n	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n	DirectionalLightShadow directionalLightShadow;\n	#endif\n	#pragma unroll_loop_start\n	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n		directionalLight = directionalLights[ i ];\n		getDirectionalLightInfo( directionalLight, directLight );\n		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n		directionalLightShadow = directionalLightShadows[ i ];\n		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowIntensity, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n		#endif\n		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n	}\n	#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n	RectAreaLight rectAreaLight;\n	#pragma unroll_loop_start\n	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n		rectAreaLight = rectAreaLights[ i ];\n		RE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n	}\n	#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n	vec3 iblIrradiance = vec3( 0.0 );\n	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n	#if defined( USE_LIGHT_PROBES )\n		irradiance += getLightProbeIrradiance( lightProbe, geometryNormal );\n	#endif\n	#if ( NUM_HEMI_LIGHTS > 0 )\n		#pragma unroll_loop_start\n		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );\n		}\n		#pragma unroll_loop_end\n	#endif\n#endif\n#if defined( RE_IndirectSpecular )\n	vec3 radiance = vec3( 0.0 );\n	vec3 clearcoatRadiance = vec3( 0.0 );\n#endif",XR="#if defined( RE_IndirectDiffuse )\n	#ifdef USE_LIGHTMAP\n		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n		irradiance += lightMapIrradiance;\n	#endif\n	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n		iblIrradiance += getIBLIrradiance( geometryNormal );\n	#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n	#ifdef USE_ANISOTROPY\n		radiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );\n	#else\n		radiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );\n	#endif\n	#ifdef USE_CLEARCOAT\n		clearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );\n	#endif\n#endif",YR="#if defined( RE_IndirectDiffuse )\n	RE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n#endif",KR="#if defined( USE_LOGDEPTHBUF )\n	gl_FragDepth = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",$R="#if defined( USE_LOGDEPTHBUF )\n	uniform float logDepthBufFC;\n	varying float vFragDepth;\n	varying float vIsPerspective;\n#endif",JR="#ifdef USE_LOGDEPTHBUF\n	varying float vFragDepth;\n	varying float vIsPerspective;\n#endif",ZR="#ifdef USE_LOGDEPTHBUF\n	vFragDepth = 1.0 + gl_Position.w;\n	vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n#endif",eP="#ifdef USE_MAP\n	vec4 sampledDiffuseColor = texture2D( map, vMapUv );\n	#ifdef DECODE_VIDEO_TEXTURE\n		sampledDiffuseColor = sRGBTransferEOTF( sampledDiffuseColor );\n	#endif\n	diffuseColor *= sampledDiffuseColor;\n#endif",tP="#ifdef USE_MAP\n	uniform sampler2D map;\n#endif",nP="#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n	#if defined( USE_POINTS_UV )\n		vec2 uv = vUv;\n	#else\n		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n	#endif\n#endif\n#ifdef USE_MAP\n	diffuseColor *= texture2D( map, uv );\n#endif\n#ifdef USE_ALPHAMAP\n	diffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",iP="#if defined( USE_POINTS_UV )\n	varying vec2 vUv;\n#else\n	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n		uniform mat3 uvTransform;\n	#endif\n#endif\n#ifdef USE_MAP\n	uniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n	uniform sampler2D alphaMap;\n#endif",sP="float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );\n	metalnessFactor *= texelMetalness.b;\n#endif",rP="#ifdef USE_METALNESSMAP\n	uniform sampler2D metalnessMap;\n#endif",oP="#ifdef USE_INSTANCING_MORPH\n	float morphTargetInfluences[ MORPHTARGETS_COUNT ];\n	float morphTargetBaseInfluence = texelFetch( morphTexture, ivec2( 0, gl_InstanceID ), 0 ).r;\n	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n		morphTargetInfluences[i] =  texelFetch( morphTexture, ivec2( i + 1, gl_InstanceID ), 0 ).r;\n	}\n#endif",aP="#if defined( USE_MORPHCOLORS )\n	vColor *= morphTargetBaseInfluence;\n	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n		#if defined( USE_COLOR_ALPHA )\n			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];\n		#elif defined( USE_COLOR )\n			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];\n		#endif\n	}\n#endif",lP="#ifdef USE_MORPHNORMALS\n	objectNormal *= morphTargetBaseInfluence;\n	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n		if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];\n	}\n#endif",cP="#ifdef USE_MORPHTARGETS\n	#ifndef USE_INSTANCING_MORPH\n		uniform float morphTargetBaseInfluence;\n		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];\n	#endif\n	uniform sampler2DArray morphTargetsTexture;\n	uniform ivec2 morphTargetsTextureSize;\n	vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {\n		int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;\n		int y = texelIndex / morphTargetsTextureSize.x;\n		int x = texelIndex - y * morphTargetsTextureSize.x;\n		ivec3 morphUV = ivec3( x, y, morphTargetIndex );\n		return texelFetch( morphTargetsTexture, morphUV, 0 );\n	}\n#endif",hP="#ifdef USE_MORPHTARGETS\n	transformed *= morphTargetBaseInfluence;\n	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n		if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];\n	}\n#endif",uP="float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n	vec3 fdx = dFdx( vViewPosition );\n	vec3 fdy = dFdy( vViewPosition );\n	vec3 normal = normalize( cross( fdx, fdy ) );\n#else\n	vec3 normal = normalize( vNormal );\n	#ifdef DOUBLE_SIDED\n		normal *= faceDirection;\n	#endif\n#endif\n#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )\n	#ifdef USE_TANGENT\n		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n	#else\n		mat3 tbn = getTangentFrame( - vViewPosition, normal,\n		#if defined( USE_NORMALMAP )\n			vNormalMapUv\n		#elif defined( USE_CLEARCOAT_NORMALMAP )\n			vClearcoatNormalMapUv\n		#else\n			vUv\n		#endif\n		);\n	#endif\n	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n		tbn[0] *= faceDirection;\n		tbn[1] *= faceDirection;\n	#endif\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n	#ifdef USE_TANGENT\n		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n	#else\n		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );\n	#endif\n	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n		tbn2[0] *= faceDirection;\n		tbn2[1] *= faceDirection;\n	#endif\n#endif\nvec3 nonPerturbedNormal = normal;",dP="#ifdef USE_NORMALMAP_OBJECTSPACE\n	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n	#ifdef FLIP_SIDED\n		normal = - normal;\n	#endif\n	#ifdef DOUBLE_SIDED\n		normal = normal * faceDirection;\n	#endif\n	normal = normalize( normalMatrix * normal );\n#elif defined( USE_NORMALMAP_TANGENTSPACE )\n	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n	mapN.xy *= normalScale;\n	normal = normalize( tbn * mapN );\n#elif defined( USE_BUMPMAP )\n	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",fP="#ifndef FLAT_SHADED\n	varying vec3 vNormal;\n	#ifdef USE_TANGENT\n		varying vec3 vTangent;\n		varying vec3 vBitangent;\n	#endif\n#endif",pP="#ifndef FLAT_SHADED\n	varying vec3 vNormal;\n	#ifdef USE_TANGENT\n		varying vec3 vTangent;\n		varying vec3 vBitangent;\n	#endif\n#endif",mP="#ifndef FLAT_SHADED\n	vNormal = normalize( transformedNormal );\n	#ifdef USE_TANGENT\n		vTangent = normalize( transformedTangent );\n		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n	#endif\n#endif",AP="#ifdef USE_NORMALMAP\n	uniform sampler2D normalMap;\n	uniform vec2 normalScale;\n#endif\n#ifdef USE_NORMALMAP_OBJECTSPACE\n	uniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )\n	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {\n		vec3 q0 = dFdx( eye_pos.xyz );\n		vec3 q1 = dFdy( eye_pos.xyz );\n		vec2 st0 = dFdx( uv.st );\n		vec2 st1 = dFdy( uv.st );\n		vec3 N = surf_norm;\n		vec3 q1perp = cross( q1, N );\n		vec3 q0perp = cross( N, q0 );\n		vec3 T = q1perp * st0.x + q0perp * st1.x;\n		vec3 B = q1perp * st0.y + q0perp * st1.y;\n		float det = max( dot( T, T ), dot( B, B ) );\n		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );\n		return mat3( T * scale, B * scale, N );\n	}\n#endif",gP="#ifdef USE_CLEARCOAT\n	vec3 clearcoatNormal = nonPerturbedNormal;\n#endif",vP="#ifdef USE_CLEARCOAT_NORMALMAP\n	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;\n	clearcoatMapN.xy *= clearcoatNormalScale;\n	clearcoatNormal = normalize( tbn2 * clearcoatMapN );\n#endif",_P="#ifdef USE_CLEARCOATMAP\n	uniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n	uniform sampler2D clearcoatNormalMap;\n	uniform vec2 clearcoatNormalScale;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n	uniform sampler2D clearcoatRoughnessMap;\n#endif",yP="#ifdef USE_IRIDESCENCEMAP\n	uniform sampler2D iridescenceMap;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n	uniform sampler2D iridescenceThicknessMap;\n#endif",xP="#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= material.transmissionAlpha;\n#endif\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );",wP="vec3 packNormalToRGB( const in vec3 normal ) {\n	return normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n	return 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;const float ShiftRight8 = 1. / 256.;\nconst float Inv255 = 1. / 255.;\nconst vec4 PackFactors = vec4( 1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0 );\nconst vec2 UnpackFactors2 = vec2( UnpackDownscale, 1.0 / PackFactors.g );\nconst vec3 UnpackFactors3 = vec3( UnpackDownscale / PackFactors.rg, 1.0 / PackFactors.b );\nconst vec4 UnpackFactors4 = vec4( UnpackDownscale / PackFactors.rgb, 1.0 / PackFactors.a );\nvec4 packDepthToRGBA( const in float v ) {\n	if( v <= 0.0 )\n		return vec4( 0., 0., 0., 0. );\n	if( v >= 1.0 )\n		return vec4( 1., 1., 1., 1. );\n	float vuf;\n	float af = modf( v * PackFactors.a, vuf );\n	float bf = modf( vuf * ShiftRight8, vuf );\n	float gf = modf( vuf * ShiftRight8, vuf );\n	return vec4( vuf * Inv255, gf * PackUpscale, bf * PackUpscale, af );\n}\nvec3 packDepthToRGB( const in float v ) {\n	if( v <= 0.0 )\n		return vec3( 0., 0., 0. );\n	if( v >= 1.0 )\n		return vec3( 1., 1., 1. );\n	float vuf;\n	float bf = modf( v * PackFactors.b, vuf );\n	float gf = modf( vuf * ShiftRight8, vuf );\n	return vec3( vuf * Inv255, gf * PackUpscale, bf );\n}\nvec2 packDepthToRG( const in float v ) {\n	if( v <= 0.0 )\n		return vec2( 0., 0. );\n	if( v >= 1.0 )\n		return vec2( 1., 1. );\n	float vuf;\n	float gf = modf( v * 256., vuf );\n	return vec2( vuf * Inv255, gf );\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n	return dot( v, UnpackFactors4 );\n}\nfloat unpackRGBToDepth( const in vec3 v ) {\n	return dot( v, UnpackFactors3 );\n}\nfloat unpackRGToDepth( const in vec2 v ) {\n	return v.r * UnpackFactors2.r + v.g * UnpackFactors2.g;\n}\nvec4 pack2HalfToRGBA( const in vec2 v ) {\n	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\nvec2 unpackRGBATo2Half( const in vec4 v ) {\n	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n	return ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {\n	return depth * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {\n	return ( near * far ) / ( ( far - near ) * depth - far );\n}",bP="#ifdef PREMULTIPLIED_ALPHA\n	gl_FragColor.rgb *= gl_FragColor.a;\n#endif",EP="vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_BATCHING\n	mvPosition = batchingMatrix * mvPosition;\n#endif\n#ifdef USE_INSTANCING\n	mvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",CP="#ifdef DITHERING\n	gl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",SP="#ifdef DITHERING\n	vec3 dithering( vec3 color ) {\n		float grid_position = rand( gl_FragCoord.xy );\n		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n		return color + dither_shift_RGB;\n	}\n#endif",IP="float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );\n	roughnessFactor *= texelRoughness.g;\n#endif",MP="#ifdef USE_ROUGHNESSMAP\n	uniform sampler2D roughnessMap;\n#endif",TP="#if NUM_SPOT_LIGHT_COORDS > 0\n	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#if NUM_SPOT_LIGHT_MAPS > 0\n	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];\n#endif\n#ifdef USE_SHADOWMAP\n	#if NUM_DIR_LIGHT_SHADOWS > 0\n		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n		struct DirectionalLightShadow {\n			float shadowIntensity;\n			float shadowBias;\n			float shadowNormalBias;\n			float shadowRadius;\n			vec2 shadowMapSize;\n		};\n		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n	#endif\n	#if NUM_SPOT_LIGHT_SHADOWS > 0\n		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n		struct SpotLightShadow {\n			float shadowIntensity;\n			float shadowBias;\n			float shadowNormalBias;\n			float shadowRadius;\n			vec2 shadowMapSize;\n		};\n		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n	#endif\n	#if NUM_POINT_LIGHT_SHADOWS > 0\n		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n		struct PointLightShadow {\n			float shadowIntensity;\n			float shadowBias;\n			float shadowNormalBias;\n			float shadowRadius;\n			vec2 shadowMapSize;\n			float shadowCameraNear;\n			float shadowCameraFar;\n		};\n		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n	#endif\n	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n	}\n	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n		return unpackRGBATo2Half( texture2D( shadow, uv ) );\n	}\n	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n		float occlusion = 1.0;\n		vec2 distribution = texture2DDistribution( shadow, uv );\n		float hard_shadow = step( compare , distribution.x );\n		if (hard_shadow != 1.0 ) {\n			float distance = compare - distribution.x ;\n			float variance = max( 0.00000, distribution.y * distribution.y );\n			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n		}\n		return occlusion;\n	}\n	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n		float shadow = 1.0;\n		shadowCoord.xyz /= shadowCoord.w;\n		shadowCoord.z += shadowBias;\n		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;\n		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;\n		if ( frustumTest ) {\n		#if defined( SHADOWMAP_TYPE_PCF )\n			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n			float dx0 = - texelSize.x * shadowRadius;\n			float dy0 = - texelSize.y * shadowRadius;\n			float dx1 = + texelSize.x * shadowRadius;\n			float dy1 = + texelSize.y * shadowRadius;\n			float dx2 = dx0 / 2.0;\n			float dy2 = dy0 / 2.0;\n			float dx3 = dx1 / 2.0;\n			float dy3 = dy1 / 2.0;\n			shadow = (\n				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n			) * ( 1.0 / 17.0 );\n		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n			float dx = texelSize.x;\n			float dy = texelSize.y;\n			vec2 uv = shadowCoord.xy;\n			vec2 f = fract( uv * shadowMapSize + 0.5 );\n			uv -= f * texelSize;\n			shadow = (\n				texture2DCompare( shadowMap, uv, shadowCoord.z ) +\n				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),\n					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n					 f.x ) +\n				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),\n					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n					 f.x ) +\n				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),\n					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n					 f.y ) +\n				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),\n					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n					 f.y ) +\n				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),\n						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n						  f.x ),\n					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),\n						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n						  f.x ),\n					 f.y )\n			) * ( 1.0 / 9.0 );\n		#elif defined( SHADOWMAP_TYPE_VSM )\n			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n		#else\n			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n		#endif\n		}\n		return mix( 1.0, shadow, shadowIntensity );\n	}\n	vec2 cubeToUV( vec3 v, float texelSizeY ) {\n		vec3 absV = abs( v );\n		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n		absV *= scaleToCube;\n		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n		vec2 planar = v.xy;\n		float almostATexel = 1.5 * texelSizeY;\n		float almostOne = 1.0 - almostATexel;\n		if ( absV.z >= almostOne ) {\n			if ( v.z > 0.0 )\n				planar.x = 4.0 - v.x;\n		} else if ( absV.x >= almostOne ) {\n			float signX = sign( v.x );\n			planar.x = v.z * signX + 2.0 * signX;\n		} else if ( absV.y >= almostOne ) {\n			float signY = sign( v.y );\n			planar.x = v.x + 2.0 * signY + 2.0;\n			planar.y = v.z * signY - 2.0;\n		}\n		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n	}\n	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n		float shadow = 1.0;\n		vec3 lightToPosition = shadowCoord.xyz;\n		\n		float lightToPositionLength = length( lightToPosition );\n		if ( lightToPositionLength - shadowCameraFar <= 0.0 && lightToPositionLength - shadowCameraNear >= 0.0 ) {\n			float dp = ( lightToPositionLength - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );			dp += shadowBias;\n			vec3 bd3D = normalize( lightToPosition );\n			vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n			#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n				vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n				shadow = (\n					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n					texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n				) * ( 1.0 / 9.0 );\n			#else\n				shadow = texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n			#endif\n		}\n		return mix( 1.0, shadow, shadowIntensity );\n	}\n#endif",BP="#if NUM_SPOT_LIGHT_COORDS > 0\n	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];\n	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#ifdef USE_SHADOWMAP\n	#if NUM_DIR_LIGHT_SHADOWS > 0\n		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n		struct DirectionalLightShadow {\n			float shadowIntensity;\n			float shadowBias;\n			float shadowNormalBias;\n			float shadowRadius;\n			vec2 shadowMapSize;\n		};\n		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n	#endif\n	#if NUM_SPOT_LIGHT_SHADOWS > 0\n		struct SpotLightShadow {\n			float shadowIntensity;\n			float shadowBias;\n			float shadowNormalBias;\n			float shadowRadius;\n			vec2 shadowMapSize;\n		};\n		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n	#endif\n	#if NUM_POINT_LIGHT_SHADOWS > 0\n		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n		struct PointLightShadow {\n			float shadowIntensity;\n			float shadowBias;\n			float shadowNormalBias;\n			float shadowRadius;\n			vec2 shadowMapSize;\n			float shadowCameraNear;\n			float shadowCameraFar;\n		};\n		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n	#endif\n#endif",RP="#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )\n	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n	vec4 shadowWorldPosition;\n#endif\n#if defined( USE_SHADOWMAP )\n	#if NUM_DIR_LIGHT_SHADOWS > 0\n		#pragma unroll_loop_start\n		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n		}\n		#pragma unroll_loop_end\n	#endif\n	#if NUM_POINT_LIGHT_SHADOWS > 0\n		#pragma unroll_loop_start\n		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n		}\n		#pragma unroll_loop_end\n	#endif\n#endif\n#if NUM_SPOT_LIGHT_COORDS > 0\n	#pragma unroll_loop_start\n	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {\n		shadowWorldPosition = worldPosition;\n		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;\n		#endif\n		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;\n	}\n	#pragma unroll_loop_end\n#endif",PP="float getShadowMask() {\n	float shadow = 1.0;\n	#ifdef USE_SHADOWMAP\n	#if NUM_DIR_LIGHT_SHADOWS > 0\n	DirectionalLightShadow directionalLight;\n	#pragma unroll_loop_start\n	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n		directionalLight = directionalLightShadows[ i ];\n		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowIntensity, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n	}\n	#pragma unroll_loop_end\n	#endif\n	#if NUM_SPOT_LIGHT_SHADOWS > 0\n	SpotLightShadow spotLight;\n	#pragma unroll_loop_start\n	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n		spotLight = spotLightShadows[ i ];\n		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowIntensity, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n	}\n	#pragma unroll_loop_end\n	#endif\n	#if NUM_POINT_LIGHT_SHADOWS > 0\n	PointLightShadow pointLight;\n	#pragma unroll_loop_start\n	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n		pointLight = pointLightShadows[ i ];\n		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowIntensity, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n	}\n	#pragma unroll_loop_end\n	#endif\n	#endif\n	return shadow;\n}",DP="#ifdef USE_SKINNING\n	mat4 boneMatX = getBoneMatrix( skinIndex.x );\n	mat4 boneMatY = getBoneMatrix( skinIndex.y );\n	mat4 boneMatZ = getBoneMatrix( skinIndex.z );\n	mat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",LP="#ifdef USE_SKINNING\n	uniform mat4 bindMatrix;\n	uniform mat4 bindMatrixInverse;\n	uniform highp sampler2D boneTexture;\n	mat4 getBoneMatrix( const in float i ) {\n		int size = textureSize( boneTexture, 0 ).x;\n		int j = int( i ) * 4;\n		int x = j % size;\n		int y = j / size;\n		vec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );\n		vec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );\n		vec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );\n		vec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );\n		return mat4( v1, v2, v3, v4 );\n	}\n#endif",FP="#ifdef USE_SKINNING\n	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n	vec4 skinned = vec4( 0.0 );\n	skinned += boneMatX * skinVertex * skinWeight.x;\n	skinned += boneMatY * skinVertex * skinWeight.y;\n	skinned += boneMatZ * skinVertex * skinWeight.z;\n	skinned += boneMatW * skinVertex * skinWeight.w;\n	transformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",NP="#ifdef USE_SKINNING\n	mat4 skinMatrix = mat4( 0.0 );\n	skinMatrix += skinWeight.x * boneMatX;\n	skinMatrix += skinWeight.y * boneMatY;\n	skinMatrix += skinWeight.z * boneMatZ;\n	skinMatrix += skinWeight.w * boneMatW;\n	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n	#ifdef USE_TANGENT\n		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n	#endif\n#endif",kP="float specularStrength;\n#ifdef USE_SPECULARMAP\n	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );\n	specularStrength = texelSpecular.r;\n#else\n	specularStrength = 1.0;\n#endif",OP="#ifdef USE_SPECULARMAP\n	uniform sampler2D specularMap;\n#endif",UP="#if defined( TONE_MAPPING )\n	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",QP="#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n	return saturate( toneMappingExposure * color );\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n	color *= toneMappingExposure;\n	return saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 CineonToneMapping( vec3 color ) {\n	color *= toneMappingExposure;\n	color = max( vec3( 0.0 ), color - 0.004 );\n	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n	return a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n	const mat3 ACESInputMat = mat3(\n		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),\n		vec3( 0.04823, 0.01566, 0.83777 )\n	);\n	const mat3 ACESOutputMat = mat3(\n		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),\n		vec3( -0.07367, -0.00605,  1.07602 )\n	);\n	color *= toneMappingExposure / 0.6;\n	color = ACESInputMat * color;\n	color = RRTAndODTFit( color );\n	color = ACESOutputMat * color;\n	return saturate( color );\n}\nconst mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(\n	vec3( 1.6605, - 0.1246, - 0.0182 ),\n	vec3( - 0.5876, 1.1329, - 0.1006 ),\n	vec3( - 0.0728, - 0.0083, 1.1187 )\n);\nconst mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(\n	vec3( 0.6274, 0.0691, 0.0164 ),\n	vec3( 0.3293, 0.9195, 0.0880 ),\n	vec3( 0.0433, 0.0113, 0.8956 )\n);\nvec3 agxDefaultContrastApprox( vec3 x ) {\n	vec3 x2 = x * x;\n	vec3 x4 = x2 * x2;\n	return + 15.5 * x4 * x2\n		- 40.14 * x4 * x\n		+ 31.96 * x4\n		- 6.868 * x2 * x\n		+ 0.4298 * x2\n		+ 0.1191 * x\n		- 0.00232;\n}\nvec3 AgXToneMapping( vec3 color ) {\n	const mat3 AgXInsetMatrix = mat3(\n		vec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),\n		vec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),\n		vec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )\n	);\n	const mat3 AgXOutsetMatrix = mat3(\n		vec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),\n		vec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),\n		vec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )\n	);\n	const float AgxMinEv = - 12.47393;	const float AgxMaxEv = 4.026069;\n	color *= toneMappingExposure;\n	color = LINEAR_SRGB_TO_LINEAR_REC2020 * color;\n	color = AgXInsetMatrix * color;\n	color = max( color, 1e-10 );	color = log2( color );\n	color = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );\n	color = clamp( color, 0.0, 1.0 );\n	color = agxDefaultContrastApprox( color );\n	color = AgXOutsetMatrix * color;\n	color = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );\n	color = LINEAR_REC2020_TO_LINEAR_SRGB * color;\n	color = clamp( color, 0.0, 1.0 );\n	return color;\n}\nvec3 NeutralToneMapping( vec3 color ) {\n	const float StartCompression = 0.8 - 0.04;\n	const float Desaturation = 0.15;\n	color *= toneMappingExposure;\n	float x = min( color.r, min( color.g, color.b ) );\n	float offset = x < 0.08 ? x - 6.25 * x * x : 0.04;\n	color -= offset;\n	float peak = max( color.r, max( color.g, color.b ) );\n	if ( peak < StartCompression ) return color;\n	float d = 1. - StartCompression;\n	float newPeak = 1. - d * d / ( peak + d - StartCompression );\n	color *= newPeak / peak;\n	float g = 1. - 1. / ( Desaturation * ( peak - newPeak ) + 1. );\n	return mix( color, vec3( newPeak ), g );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",VP="#ifdef USE_TRANSMISSION\n	material.transmission = transmission;\n	material.transmissionAlpha = 1.0;\n	material.thickness = thickness;\n	material.attenuationDistance = attenuationDistance;\n	material.attenuationColor = attenuationColor;\n	#ifdef USE_TRANSMISSIONMAP\n		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;\n	#endif\n	#ifdef USE_THICKNESSMAP\n		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;\n	#endif\n	vec3 pos = vWorldPosition;\n	vec3 v = normalize( cameraPosition - pos );\n	vec3 n = inverseTransformDirection( normal, viewMatrix );\n	vec4 transmitted = getIBLVolumeRefraction(\n		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,\n		pos, modelMatrix, viewMatrix, projectionMatrix, material.dispersion, material.ior, material.thickness,\n		material.attenuationColor, material.attenuationDistance );\n	material.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );\n	totalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );\n#endif",zP="#ifdef USE_TRANSMISSION\n	uniform float transmission;\n	uniform float thickness;\n	uniform float attenuationDistance;\n	uniform vec3 attenuationColor;\n	#ifdef USE_TRANSMISSIONMAP\n		uniform sampler2D transmissionMap;\n	#endif\n	#ifdef USE_THICKNESSMAP\n		uniform sampler2D thicknessMap;\n	#endif\n	uniform vec2 transmissionSamplerSize;\n	uniform sampler2D transmissionSamplerMap;\n	uniform mat4 modelMatrix;\n	uniform mat4 projectionMatrix;\n	varying vec3 vWorldPosition;\n	float w0( float a ) {\n		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );\n	}\n	float w1( float a ) {\n		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );\n	}\n	float w2( float a ){\n		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );\n	}\n	float w3( float a ) {\n		return ( 1.0 / 6.0 ) * ( a * a * a );\n	}\n	float g0( float a ) {\n		return w0( a ) + w1( a );\n	}\n	float g1( float a ) {\n		return w2( a ) + w3( a );\n	}\n	float h0( float a ) {\n		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );\n	}\n	float h1( float a ) {\n		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );\n	}\n	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {\n		uv = uv * texelSize.zw + 0.5;\n		vec2 iuv = floor( uv );\n		vec2 fuv = fract( uv );\n		float g0x = g0( fuv.x );\n		float g1x = g1( fuv.x );\n		float h0x = h0( fuv.x );\n		float h1x = h1( fuv.x );\n		float h0y = h0( fuv.y );\n		float h1y = h1( fuv.y );\n		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +\n			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );\n	}\n	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {\n		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );\n		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );\n		vec2 fLodSizeInv = 1.0 / fLodSize;\n		vec2 cLodSizeInv = 1.0 / cLodSize;\n		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );\n		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );\n		return mix( fSample, cSample, fract( lod ) );\n	}\n	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {\n		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n		vec3 modelScale;\n		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n		return normalize( refractionVector ) * thickness * modelScale;\n	}\n	float applyIorToRoughness( const in float roughness, const in float ior ) {\n		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n	}\n	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {\n		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n		return textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );\n	}\n	vec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {\n		if ( isinf( attenuationDistance ) ) {\n			return vec3( 1.0 );\n		} else {\n			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance;\n		}\n	}\n	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,\n		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,\n		const in mat4 viewMatrix, const in mat4 projMatrix, const in float dispersion, const in float ior, const in float thickness,\n		const in vec3 attenuationColor, const in float attenuationDistance ) {\n		vec4 transmittedLight;\n		vec3 transmittance;\n		#ifdef USE_DISPERSION\n			float halfSpread = ( ior - 1.0 ) * 0.025 * dispersion;\n			vec3 iors = vec3( ior - halfSpread, ior, ior + halfSpread );\n			for ( int i = 0; i < 3; i ++ ) {\n				vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, iors[ i ], modelMatrix );\n				vec3 refractedRayExit = position + transmissionRay;\n				vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n				vec2 refractionCoords = ndcPos.xy / ndcPos.w;\n				refractionCoords += 1.0;\n				refractionCoords /= 2.0;\n				vec4 transmissionSample = getTransmissionSample( refractionCoords, roughness, iors[ i ] );\n				transmittedLight[ i ] = transmissionSample[ i ];\n				transmittedLight.a += transmissionSample.a;\n				transmittance[ i ] = diffuseColor[ i ] * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance )[ i ];\n			}\n			transmittedLight.a /= 3.0;\n		#else\n			vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n			vec3 refractedRayExit = position + transmissionRay;\n			vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n			vec2 refractionCoords = ndcPos.xy / ndcPos.w;\n			refractionCoords += 1.0;\n			refractionCoords /= 2.0;\n			transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n			transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );\n		#endif\n		vec3 attenuatedColor = transmittance * transmittedLight.rgb;\n		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n		float transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;\n		return vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );\n	}\n#endif",GP="#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n	varying vec2 vUv;\n#endif\n#ifdef USE_MAP\n	varying vec2 vMapUv;\n#endif\n#ifdef USE_ALPHAMAP\n	varying vec2 vAlphaMapUv;\n#endif\n#ifdef USE_LIGHTMAP\n	varying vec2 vLightMapUv;\n#endif\n#ifdef USE_AOMAP\n	varying vec2 vAoMapUv;\n#endif\n#ifdef USE_BUMPMAP\n	varying vec2 vBumpMapUv;\n#endif\n#ifdef USE_NORMALMAP\n	varying vec2 vNormalMapUv;\n#endif\n#ifdef USE_EMISSIVEMAP\n	varying vec2 vEmissiveMapUv;\n#endif\n#ifdef USE_METALNESSMAP\n	varying vec2 vMetalnessMapUv;\n#endif\n#ifdef USE_ROUGHNESSMAP\n	varying vec2 vRoughnessMapUv;\n#endif\n#ifdef USE_ANISOTROPYMAP\n	varying vec2 vAnisotropyMapUv;\n#endif\n#ifdef USE_CLEARCOATMAP\n	varying vec2 vClearcoatMapUv;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n	varying vec2 vClearcoatNormalMapUv;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n	varying vec2 vClearcoatRoughnessMapUv;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n	varying vec2 vIridescenceMapUv;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n	varying vec2 vIridescenceThicknessMapUv;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n	varying vec2 vSheenColorMapUv;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n	varying vec2 vSheenRoughnessMapUv;\n#endif\n#ifdef USE_SPECULARMAP\n	varying vec2 vSpecularMapUv;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n	varying vec2 vSpecularColorMapUv;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n	varying vec2 vSpecularIntensityMapUv;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n	uniform mat3 transmissionMapTransform;\n	varying vec2 vTransmissionMapUv;\n#endif\n#ifdef USE_THICKNESSMAP\n	uniform mat3 thicknessMapTransform;\n	varying vec2 vThicknessMapUv;\n#endif",HP="#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n	varying vec2 vUv;\n#endif\n#ifdef USE_MAP\n	uniform mat3 mapTransform;\n	varying vec2 vMapUv;\n#endif\n#ifdef USE_ALPHAMAP\n	uniform mat3 alphaMapTransform;\n	varying vec2 vAlphaMapUv;\n#endif\n#ifdef USE_LIGHTMAP\n	uniform mat3 lightMapTransform;\n	varying vec2 vLightMapUv;\n#endif\n#ifdef USE_AOMAP\n	uniform mat3 aoMapTransform;\n	varying vec2 vAoMapUv;\n#endif\n#ifdef USE_BUMPMAP\n	uniform mat3 bumpMapTransform;\n	varying vec2 vBumpMapUv;\n#endif\n#ifdef USE_NORMALMAP\n	uniform mat3 normalMapTransform;\n	varying vec2 vNormalMapUv;\n#endif\n#ifdef USE_DISPLACEMENTMAP\n	uniform mat3 displacementMapTransform;\n	varying vec2 vDisplacementMapUv;\n#endif\n#ifdef USE_EMISSIVEMAP\n	uniform mat3 emissiveMapTransform;\n	varying vec2 vEmissiveMapUv;\n#endif\n#ifdef USE_METALNESSMAP\n	uniform mat3 metalnessMapTransform;\n	varying vec2 vMetalnessMapUv;\n#endif\n#ifdef USE_ROUGHNESSMAP\n	uniform mat3 roughnessMapTransform;\n	varying vec2 vRoughnessMapUv;\n#endif\n#ifdef USE_ANISOTROPYMAP\n	uniform mat3 anisotropyMapTransform;\n	varying vec2 vAnisotropyMapUv;\n#endif\n#ifdef USE_CLEARCOATMAP\n	uniform mat3 clearcoatMapTransform;\n	varying vec2 vClearcoatMapUv;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n	uniform mat3 clearcoatNormalMapTransform;\n	varying vec2 vClearcoatNormalMapUv;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n	uniform mat3 clearcoatRoughnessMapTransform;\n	varying vec2 vClearcoatRoughnessMapUv;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n	uniform mat3 sheenColorMapTransform;\n	varying vec2 vSheenColorMapUv;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n	uniform mat3 sheenRoughnessMapTransform;\n	varying vec2 vSheenRoughnessMapUv;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n	uniform mat3 iridescenceMapTransform;\n	varying vec2 vIridescenceMapUv;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n	uniform mat3 iridescenceThicknessMapTransform;\n	varying vec2 vIridescenceThicknessMapUv;\n#endif\n#ifdef USE_SPECULARMAP\n	uniform mat3 specularMapTransform;\n	varying vec2 vSpecularMapUv;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n	uniform mat3 specularColorMapTransform;\n	varying vec2 vSpecularColorMapUv;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n	uniform mat3 specularIntensityMapTransform;\n	varying vec2 vSpecularIntensityMapUv;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n	uniform mat3 transmissionMapTransform;\n	varying vec2 vTransmissionMapUv;\n#endif\n#ifdef USE_THICKNESSMAP\n	uniform mat3 thicknessMapTransform;\n	varying vec2 vThicknessMapUv;\n#endif",WP="#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n	vUv = vec3( uv, 1 ).xy;\n#endif\n#ifdef USE_MAP\n	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ALPHAMAP\n	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_LIGHTMAP\n	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_AOMAP\n	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_BUMPMAP\n	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_NORMALMAP\n	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_DISPLACEMENTMAP\n	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_EMISSIVEMAP\n	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_METALNESSMAP\n	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ROUGHNESSMAP\n	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ANISOTROPYMAP\n	vAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOATMAP\n	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULARMAP\n	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_THICKNESSMAP\n	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;\n#endif",qP="#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0\n	vec4 worldPosition = vec4( transformed, 1.0 );\n	#ifdef USE_BATCHING\n		worldPosition = batchingMatrix * worldPosition;\n	#endif\n	#ifdef USE_INSTANCING\n		worldPosition = instanceMatrix * worldPosition;\n	#endif\n	worldPosition = modelMatrix * worldPosition;\n#endif";const jP="varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n	gl_Position = vec4( position.xy, 1.0, 1.0 );\n}",XP="uniform sampler2D t2D;\nuniform float backgroundIntensity;\nvarying vec2 vUv;\nvoid main() {\n	vec4 texColor = texture2D( t2D, vUv );\n	#ifdef DECODE_VIDEO_TEXTURE\n		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );\n	#endif\n	texColor.rgb *= backgroundIntensity;\n	gl_FragColor = texColor;\n	#include <tonemapping_fragment>\n	#include <colorspace_fragment>\n}",YP="varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n	vWorldDirection = transformDirection( position, modelMatrix );\n	#include <begin_vertex>\n	#include <project_vertex>\n	gl_Position.z = gl_Position.w;\n}",KP="#ifdef ENVMAP_TYPE_CUBE\n	uniform samplerCube envMap;\n#elif defined( ENVMAP_TYPE_CUBE_UV )\n	uniform sampler2D envMap;\n#endif\nuniform float flipEnvMap;\nuniform float backgroundBlurriness;\nuniform float backgroundIntensity;\nuniform mat3 backgroundRotation;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n	#ifdef ENVMAP_TYPE_CUBE\n		vec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );\n	#elif defined( ENVMAP_TYPE_CUBE_UV )\n		vec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );\n	#else\n		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n	#endif\n	texColor.rgb *= backgroundIntensity;\n	gl_FragColor = texColor;\n	#include <tonemapping_fragment>\n	#include <colorspace_fragment>\n}",$P="varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n	vWorldDirection = transformDirection( position, modelMatrix );\n	#include <begin_vertex>\n	#include <project_vertex>\n	gl_Position.z = gl_Position.w;\n}",JP="uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldDirection;\nvoid main() {\n	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );\n	gl_FragColor = texColor;\n	gl_FragColor.a *= opacity;\n	#include <tonemapping_fragment>\n	#include <colorspace_fragment>\n}",ZP="#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n	#include <uv_vertex>\n	#include <batching_vertex>\n	#include <skinbase_vertex>\n	#include <morphinstance_vertex>\n	#ifdef USE_DISPLACEMENTMAP\n		#include <beginnormal_vertex>\n		#include <morphnormal_vertex>\n		#include <skinnormal_vertex>\n	#endif\n	#include <begin_vertex>\n	#include <morphtarget_vertex>\n	#include <skinning_vertex>\n	#include <displacementmap_vertex>\n	#include <project_vertex>\n	#include <logdepthbuf_vertex>\n	#include <clipping_planes_vertex>\n	vHighPrecisionZW = gl_Position.zw;\n}",eD="#if DEPTH_PACKING == 3200\n	uniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n	vec4 diffuseColor = vec4( 1.0 );\n	#include <clipping_planes_fragment>\n	#if DEPTH_PACKING == 3200\n		diffuseColor.a = opacity;\n	#endif\n	#include <map_fragment>\n	#include <alphamap_fragment>\n	#include <alphatest_fragment>\n	#include <alphahash_fragment>\n	#include <logdepthbuf_fragment>\n	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n	#if DEPTH_PACKING == 3200\n		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n	#elif DEPTH_PACKING == 3201\n		gl_FragColor = packDepthToRGBA( fragCoordZ );\n	#elif DEPTH_PACKING == 3202\n		gl_FragColor = vec4( packDepthToRGB( fragCoordZ ), 1.0 );\n	#elif DEPTH_PACKING == 3203\n		gl_FragColor = vec4( packDepthToRG( fragCoordZ ), 0.0, 1.0 );\n	#endif\n}",tD="#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n	#include <uv_vertex>\n	#include <batching_vertex>\n	#include <skinbase_vertex>\n	#include <morphinstance_vertex>\n	#ifdef USE_DISPLACEMENTMAP\n		#include <beginnormal_vertex>\n		#include <morphnormal_vertex>\n		#include <skinnormal_vertex>\n	#endif\n	#include <begin_vertex>\n	#include <morphtarget_vertex>\n	#include <skinning_vertex>\n	#include <displacementmap_vertex>\n	#include <project_vertex>\n	#include <worldpos_vertex>\n	#include <clipping_planes_vertex>\n	vWorldPosition = worldPosition.xyz;\n}",nD="#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n	vec4 diffuseColor = vec4( 1.0 );\n	#include <clipping_planes_fragment>\n	#include <map_fragment>\n	#include <alphamap_fragment>\n	#include <alphatest_fragment>\n	#include <alphahash_fragment>\n	float dist = length( vWorldPosition - referencePosition );\n	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n	dist = saturate( dist );\n	gl_FragColor = packDepthToRGBA( dist );\n}",iD="varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n	vWorldDirection = transformDirection( position, modelMatrix );\n	#include <begin_vertex>\n	#include <project_vertex>\n}",sD="uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n	vec3 direction = normalize( vWorldDirection );\n	vec2 sampleUV = equirectUv( direction );\n	gl_FragColor = texture2D( tEquirect, sampleUV );\n	#include <tonemapping_fragment>\n	#include <colorspace_fragment>\n}",rD="uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n	vLineDistance = scale * lineDistance;\n	#include <uv_vertex>\n	#include <color_vertex>\n	#include <morphinstance_vertex>\n	#include <morphcolor_vertex>\n	#include <begin_vertex>\n	#include <morphtarget_vertex>\n	#include <project_vertex>\n	#include <logdepthbuf_vertex>\n	#include <clipping_planes_vertex>\n	#include <fog_vertex>\n}",oD="uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n	vec4 diffuseColor = vec4( diffuse, opacity );\n	#include <clipping_planes_fragment>\n	if ( mod( vLineDistance, totalSize ) > dashSize ) {\n		discard;\n	}\n	vec3 outgoingLight = vec3( 0.0 );\n	#include <logdepthbuf_fragment>\n	#include <map_fragment>\n	#include <color_fragment>\n	outgoingLight = diffuseColor.rgb;\n	#include <opaque_fragment>\n	#include <tonemapping_fragment>\n	#include <colorspace_fragment>\n	#include <fog_fragment>\n	#include <premultiplied_alpha_fragment>\n}",aD="#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n	#include <uv_vertex>\n	#include <color_vertex>\n	#include <morphinstance_vertex>\n	#include <morphcolor_vertex>\n	#include <batching_vertex>\n	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n		#include <beginnormal_vertex>\n		#include <morphnormal_vertex>\n		#include <skinbase_vertex>\n		#include <skinnormal_vertex>\n		#include <defaultnormal_vertex>\n	#endif\n	#include <begin_vertex>\n	#include <morphtarget_vertex>\n	#include <skinning_vertex>\n	#include <project_vertex>\n	#include <logdepthbuf_vertex>\n	#include <clipping_planes_vertex>\n	#include <worldpos_vertex>\n	#include <envmap_vertex>\n	#include <fog_vertex>\n}",lD="uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n	varying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n	vec4 diffuseColor = vec4( diffuse, opacity );\n	#include <clipping_planes_fragment>\n	#include <logdepthbuf_fragment>\n	#include <map_fragment>\n	#include <color_fragment>\n	#include <alphamap_fragment>\n	#include <alphatest_fragment>\n	#include <alphahash_fragment>\n	#include <specularmap_fragment>\n	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n	#ifdef USE_LIGHTMAP\n		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;\n	#else\n		reflectedLight.indirectDiffuse += vec3( 1.0 );\n	#endif\n	#include <aomap_fragment>\n	reflectedLight.indirectDiffuse *= diffuseColor.rgb;\n	vec3 outgoingLight = reflectedLight.indirectDiffuse;\n	#include <envmap_fragment>\n	#include <opaque_fragment>\n	#include <tonemapping_fragment>\n	#include <colorspace_fragment>\n	#include <fog_fragment>\n	#include <premultiplied_alpha_fragment>\n	#include <dithering_fragment>\n}",cD="#define LAMBERT\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n	#include <uv_vertex>\n	#include <color_vertex>\n	#include <morphinstance_vertex>\n	#include <morphcolor_vertex>\n	#include <batching_vertex>\n	#include <beginnormal_vertex>\n	#include <morphnormal_vertex>\n	#include <skinbase_vertex>\n	#include <skinnormal_vertex>\n	#include <defaultnormal_vertex>\n	#include <normal_vertex>\n	#include <begin_vertex>\n	#include <morphtarget_vertex>\n	#include <skinning_vertex>\n	#include <displacementmap_vertex>\n	#include <project_vertex>\n	#include <logdepthbuf_vertex>\n	#include <clipping_planes_vertex>\n	vViewPosition = - mvPosition.xyz;\n	#include <worldpos_vertex>\n	#include <envmap_vertex>\n	#include <shadowmap_vertex>\n	#include <fog_vertex>\n}",hD="#define LAMBERT\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_lambert_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n	vec4 diffuseColor = vec4( diffuse, opacity );\n	#include <clipping_planes_fragment>\n	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n	vec3 totalEmissiveRadiance = emissive;\n	#include <logdepthbuf_fragment>\n	#include <map_fragment>\n	#include <color_fragment>\n	#include <alphamap_fragment>\n	#include <alphatest_fragment>\n	#include <alphahash_fragment>\n	#include <specularmap_fragment>\n	#include <normal_fragment_begin>\n	#include <normal_fragment_maps>\n	#include <emissivemap_fragment>\n	#include <lights_lambert_fragment>\n	#include <lights_fragment_begin>\n	#include <lights_fragment_maps>\n	#include <lights_fragment_end>\n	#include <aomap_fragment>\n	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n	#include <envmap_fragment>\n	#include <opaque_fragment>\n	#include <tonemapping_fragment>\n	#include <colorspace_fragment>\n	#include <fog_fragment>\n	#include <premultiplied_alpha_fragment>\n	#include <dithering_fragment>\n}",uD="#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n	#include <uv_vertex>\n	#include <color_vertex>\n	#include <morphinstance_vertex>\n	#include <morphcolor_vertex>\n	#include <batching_vertex>\n	#include <beginnormal_vertex>\n	#include <morphnormal_vertex>\n	#include <skinbase_vertex>\n	#include <skinnormal_vertex>\n	#include <defaultnormal_vertex>\n	#include <normal_vertex>\n	#include <begin_vertex>\n	#include <morphtarget_vertex>\n	#include <skinning_vertex>\n	#include <displacementmap_vertex>\n	#include <project_vertex>\n	#include <logdepthbuf_vertex>\n	#include <clipping_planes_vertex>\n	#include <fog_vertex>\n	vViewPosition = - mvPosition.xyz;\n}",dD="#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n	vec4 diffuseColor = vec4( diffuse, opacity );\n	#include <clipping_planes_fragment>\n	#include <logdepthbuf_fragment>\n	#include <map_fragment>\n	#include <color_fragment>\n	#include <alphamap_fragment>\n	#include <alphatest_fragment>\n	#include <alphahash_fragment>\n	#include <normal_fragment_begin>\n	#include <normal_fragment_maps>\n	vec3 viewDir = normalize( vViewPosition );\n	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n	vec3 y = cross( viewDir, x );\n	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n	#ifdef USE_MATCAP\n		vec4 matcapColor = texture2D( matcap, uv );\n	#else\n		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );\n	#endif\n	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n	#include <opaque_fragment>\n	#include <tonemapping_fragment>\n	#include <colorspace_fragment>\n	#include <fog_fragment>\n	#include <premultiplied_alpha_fragment>\n	#include <dithering_fragment>\n}",fD="#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n	varying vec3 vViewPosition;\n#endif\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n	#include <uv_vertex>\n	#include <batching_vertex>\n	#include <beginnormal_vertex>\n	#include <morphinstance_vertex>\n	#include <morphnormal_vertex>\n	#include <skinbase_vertex>\n	#include <skinnormal_vertex>\n	#include <defaultnormal_vertex>\n	#include <normal_vertex>\n	#include <begin_vertex>\n	#include <morphtarget_vertex>\n	#include <skinning_vertex>\n	#include <displacementmap_vertex>\n	#include <project_vertex>\n	#include <logdepthbuf_vertex>\n	#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n	vViewPosition = - mvPosition.xyz;\n#endif\n}",pD="#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n	varying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n	vec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );\n	#include <clipping_planes_fragment>\n	#include <logdepthbuf_fragment>\n	#include <normal_fragment_begin>\n	#include <normal_fragment_maps>\n	gl_FragColor = vec4( packNormalToRGB( normal ), diffuseColor.a );\n	#ifdef OPAQUE\n		gl_FragColor.a = 1.0;\n	#endif\n}",mD="#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n	#include <uv_vertex>\n	#include <color_vertex>\n	#include <morphcolor_vertex>\n	#include <batching_vertex>\n	#include <beginnormal_vertex>\n	#include <morphinstance_vertex>\n	#include <morphnormal_vertex>\n	#include <skinbase_vertex>\n	#include <skinnormal_vertex>\n	#include <defaultnormal_vertex>\n	#include <normal_vertex>\n	#include <begin_vertex>\n	#include <morphtarget_vertex>\n	#include <skinning_vertex>\n	#include <displacementmap_vertex>\n	#include <project_vertex>\n	#include <logdepthbuf_vertex>\n	#include <clipping_planes_vertex>\n	vViewPosition = - mvPosition.xyz;\n	#include <worldpos_vertex>\n	#include <envmap_vertex>\n	#include <shadowmap_vertex>\n	#include <fog_vertex>\n}",AD="#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n	vec4 diffuseColor = vec4( diffuse, opacity );\n	#include <clipping_planes_fragment>\n	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n	vec3 totalEmissiveRadiance = emissive;\n	#include <logdepthbuf_fragment>\n	#include <map_fragment>\n	#include <color_fragment>\n	#include <alphamap_fragment>\n	#include <alphatest_fragment>\n	#include <alphahash_fragment>\n	#include <specularmap_fragment>\n	#include <normal_fragment_begin>\n	#include <normal_fragment_maps>\n	#include <emissivemap_fragment>\n	#include <lights_phong_fragment>\n	#include <lights_fragment_begin>\n	#include <lights_fragment_maps>\n	#include <lights_fragment_end>\n	#include <aomap_fragment>\n	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n	#include <envmap_fragment>\n	#include <opaque_fragment>\n	#include <tonemapping_fragment>\n	#include <colorspace_fragment>\n	#include <fog_fragment>\n	#include <premultiplied_alpha_fragment>\n	#include <dithering_fragment>\n}",gD="#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n	varying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n	#include <uv_vertex>\n	#include <color_vertex>\n	#include <morphinstance_vertex>\n	#include <morphcolor_vertex>\n	#include <batching_vertex>\n	#include <beginnormal_vertex>\n	#include <morphnormal_vertex>\n	#include <skinbase_vertex>\n	#include <skinnormal_vertex>\n	#include <defaultnormal_vertex>\n	#include <normal_vertex>\n	#include <begin_vertex>\n	#include <morphtarget_vertex>\n	#include <skinning_vertex>\n	#include <displacementmap_vertex>\n	#include <project_vertex>\n	#include <logdepthbuf_vertex>\n	#include <clipping_planes_vertex>\n	vViewPosition = - mvPosition.xyz;\n	#include <worldpos_vertex>\n	#include <shadowmap_vertex>\n	#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n	vWorldPosition = worldPosition.xyz;\n#endif\n}",vD="#define STANDARD\n#ifdef PHYSICAL\n	#define IOR\n	#define USE_SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n	uniform float ior;\n#endif\n#ifdef USE_SPECULAR\n	uniform float specularIntensity;\n	uniform vec3 specularColor;\n	#ifdef USE_SPECULAR_COLORMAP\n		uniform sampler2D specularColorMap;\n	#endif\n	#ifdef USE_SPECULAR_INTENSITYMAP\n		uniform sampler2D specularIntensityMap;\n	#endif\n#endif\n#ifdef USE_CLEARCOAT\n	uniform float clearcoat;\n	uniform float clearcoatRoughness;\n#endif\n#ifdef USE_DISPERSION\n	uniform float dispersion;\n#endif\n#ifdef USE_IRIDESCENCE\n	uniform float iridescence;\n	uniform float iridescenceIOR;\n	uniform float iridescenceThicknessMinimum;\n	uniform float iridescenceThicknessMaximum;\n#endif\n#ifdef USE_SHEEN\n	uniform vec3 sheenColor;\n	uniform float sheenRoughness;\n	#ifdef USE_SHEEN_COLORMAP\n		uniform sampler2D sheenColorMap;\n	#endif\n	#ifdef USE_SHEEN_ROUGHNESSMAP\n		uniform sampler2D sheenRoughnessMap;\n	#endif\n#endif\n#ifdef USE_ANISOTROPY\n	uniform vec2 anisotropyVector;\n	#ifdef USE_ANISOTROPYMAP\n		uniform sampler2D anisotropyMap;\n	#endif\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <iridescence_fragment>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <iridescence_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n	vec4 diffuseColor = vec4( diffuse, opacity );\n	#include <clipping_planes_fragment>\n	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n	vec3 totalEmissiveRadiance = emissive;\n	#include <logdepthbuf_fragment>\n	#include <map_fragment>\n	#include <color_fragment>\n	#include <alphamap_fragment>\n	#include <alphatest_fragment>\n	#include <alphahash_fragment>\n	#include <roughnessmap_fragment>\n	#include <metalnessmap_fragment>\n	#include <normal_fragment_begin>\n	#include <normal_fragment_maps>\n	#include <clearcoat_normal_fragment_begin>\n	#include <clearcoat_normal_fragment_maps>\n	#include <emissivemap_fragment>\n	#include <lights_physical_fragment>\n	#include <lights_fragment_begin>\n	#include <lights_fragment_maps>\n	#include <lights_fragment_end>\n	#include <aomap_fragment>\n	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n	#include <transmission_fragment>\n	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n	#ifdef USE_SHEEN\n		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );\n		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;\n	#endif\n	#ifdef USE_CLEARCOAT\n		float dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );\n		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;\n	#endif\n	#include <opaque_fragment>\n	#include <tonemapping_fragment>\n	#include <colorspace_fragment>\n	#include <fog_fragment>\n	#include <premultiplied_alpha_fragment>\n	#include <dithering_fragment>\n}",_D="#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n	#include <uv_vertex>\n	#include <color_vertex>\n	#include <morphinstance_vertex>\n	#include <morphcolor_vertex>\n	#include <batching_vertex>\n	#include <beginnormal_vertex>\n	#include <morphnormal_vertex>\n	#include <skinbase_vertex>\n	#include <skinnormal_vertex>\n	#include <defaultnormal_vertex>\n	#include <normal_vertex>\n	#include <begin_vertex>\n	#include <morphtarget_vertex>\n	#include <skinning_vertex>\n	#include <displacementmap_vertex>\n	#include <project_vertex>\n	#include <logdepthbuf_vertex>\n	#include <clipping_planes_vertex>\n	vViewPosition = - mvPosition.xyz;\n	#include <worldpos_vertex>\n	#include <shadowmap_vertex>\n	#include <fog_vertex>\n}",yD="#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n	vec4 diffuseColor = vec4( diffuse, opacity );\n	#include <clipping_planes_fragment>\n	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n	vec3 totalEmissiveRadiance = emissive;\n	#include <logdepthbuf_fragment>\n	#include <map_fragment>\n	#include <color_fragment>\n	#include <alphamap_fragment>\n	#include <alphatest_fragment>\n	#include <alphahash_fragment>\n	#include <normal_fragment_begin>\n	#include <normal_fragment_maps>\n	#include <emissivemap_fragment>\n	#include <lights_toon_fragment>\n	#include <lights_fragment_begin>\n	#include <lights_fragment_maps>\n	#include <lights_fragment_end>\n	#include <aomap_fragment>\n	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n	#include <opaque_fragment>\n	#include <tonemapping_fragment>\n	#include <colorspace_fragment>\n	#include <fog_fragment>\n	#include <premultiplied_alpha_fragment>\n	#include <dithering_fragment>\n}",xD="uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n#ifdef USE_POINTS_UV\n	varying vec2 vUv;\n	uniform mat3 uvTransform;\n#endif\nvoid main() {\n	#ifdef USE_POINTS_UV\n		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n	#endif\n	#include <color_vertex>\n	#include <morphinstance_vertex>\n	#include <morphcolor_vertex>\n	#include <begin_vertex>\n	#include <morphtarget_vertex>\n	#include <project_vertex>\n	gl_PointSize = size;\n	#ifdef USE_SIZEATTENUATION\n		bool isPerspective = isPerspectiveMatrix( projectionMatrix );\n		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n	#endif\n	#include <logdepthbuf_vertex>\n	#include <clipping_planes_vertex>\n	#include <worldpos_vertex>\n	#include <fog_vertex>\n}",wD="uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n	vec4 diffuseColor = vec4( diffuse, opacity );\n	#include <clipping_planes_fragment>\n	vec3 outgoingLight = vec3( 0.0 );\n	#include <logdepthbuf_fragment>\n	#include <map_particle_fragment>\n	#include <color_fragment>\n	#include <alphatest_fragment>\n	#include <alphahash_fragment>\n	outgoingLight = diffuseColor.rgb;\n	#include <opaque_fragment>\n	#include <tonemapping_fragment>\n	#include <colorspace_fragment>\n	#include <fog_fragment>\n	#include <premultiplied_alpha_fragment>\n}",bD="#include <common>\n#include <batching_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n	#include <batching_vertex>\n	#include <beginnormal_vertex>\n	#include <morphinstance_vertex>\n	#include <morphnormal_vertex>\n	#include <skinbase_vertex>\n	#include <skinnormal_vertex>\n	#include <defaultnormal_vertex>\n	#include <begin_vertex>\n	#include <morphtarget_vertex>\n	#include <skinning_vertex>\n	#include <project_vertex>\n	#include <logdepthbuf_vertex>\n	#include <worldpos_vertex>\n	#include <shadowmap_vertex>\n	#include <fog_vertex>\n}",ED="uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <logdepthbuf_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n	#include <logdepthbuf_fragment>\n	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n	#include <tonemapping_fragment>\n	#include <colorspace_fragment>\n	#include <fog_fragment>\n}",CD="uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n	#include <uv_vertex>\n	vec4 mvPosition = modelViewMatrix[ 3 ];\n	vec2 scale = vec2( length( modelMatrix[ 0 ].xyz ), length( modelMatrix[ 1 ].xyz ) );\n	#ifndef USE_SIZEATTENUATION\n		bool isPerspective = isPerspectiveMatrix( projectionMatrix );\n		if ( isPerspective ) scale *= - mvPosition.z;\n	#endif\n	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n	vec2 rotatedPosition;\n	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n	mvPosition.xy += rotatedPosition;\n	gl_Position = projectionMatrix * mvPosition;\n	#include <logdepthbuf_vertex>\n	#include <clipping_planes_vertex>\n	#include <fog_vertex>\n}",SD="uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n	vec4 diffuseColor = vec4( diffuse, opacity );\n	#include <clipping_planes_fragment>\n	vec3 outgoingLight = vec3( 0.0 );\n	#include <logdepthbuf_fragment>\n	#include <map_fragment>\n	#include <alphamap_fragment>\n	#include <alphatest_fragment>\n	#include <alphahash_fragment>\n	outgoingLight = diffuseColor.rgb;\n	#include <opaque_fragment>\n	#include <tonemapping_fragment>\n	#include <colorspace_fragment>\n	#include <fog_fragment>\n}",Rt={alphahash_fragment:XB,alphahash_pars_fragment:YB,alphamap_fragment:KB,alphamap_pars_fragment:$B,alphatest_fragment:JB,alphatest_pars_fragment:ZB,aomap_fragment:eR,aomap_pars_fragment:tR,batching_pars_vertex:nR,batching_vertex:iR,begin_vertex:sR,beginnormal_vertex:rR,bsdfs:oR,iridescence_fragment:aR,bumpmap_pars_fragment:lR,clipping_planes_fragment:cR,clipping_planes_pars_fragment:hR,clipping_planes_pars_vertex:uR,clipping_planes_vertex:dR,color_fragment:fR,color_pars_fragment:pR,color_pars_vertex:mR,color_vertex:AR,common:gR,cube_uv_reflection_fragment:vR,defaultnormal_vertex:_R,displacementmap_pars_vertex:yR,displacementmap_vertex:xR,emissivemap_fragment:wR,emissivemap_pars_fragment:bR,colorspace_fragment:ER,colorspace_pars_fragment:CR,envmap_fragment:SR,envmap_common_pars_fragment:IR,envmap_pars_fragment:MR,envmap_pars_vertex:TR,envmap_physical_pars_fragment:QR,envmap_vertex:BR,fog_vertex:RR,fog_pars_vertex:PR,fog_fragment:DR,fog_pars_fragment:LR,gradientmap_pars_fragment:FR,lightmap_pars_fragment:NR,lights_lambert_fragment:kR,lights_lambert_pars_fragment:OR,lights_pars_begin:UR,lights_toon_fragment:VR,lights_toon_pars_fragment:zR,lights_phong_fragment:GR,lights_phong_pars_fragment:HR,lights_physical_fragment:WR,lights_physical_pars_fragment:qR,lights_fragment_begin:jR,lights_fragment_maps:XR,lights_fragment_end:YR,logdepthbuf_fragment:KR,logdepthbuf_pars_fragment:$R,logdepthbuf_pars_vertex:JR,logdepthbuf_vertex:ZR,map_fragment:eP,map_pars_fragment:tP,map_particle_fragment:nP,map_particle_pars_fragment:iP,metalnessmap_fragment:sP,metalnessmap_pars_fragment:rP,morphinstance_vertex:oP,morphcolor_vertex:aP,morphnormal_vertex:lP,morphtarget_pars_vertex:cP,morphtarget_vertex:hP,normal_fragment_begin:uP,normal_fragment_maps:dP,normal_pars_fragment:fP,normal_pars_vertex:pP,normal_vertex:mP,normalmap_pars_fragment:AP,clearcoat_normal_fragment_begin:gP,clearcoat_normal_fragment_maps:vP,clearcoat_pars_fragment:_P,iridescence_pars_fragment:yP,opaque_fragment:xP,packing:wP,premultiplied_alpha_fragment:bP,project_vertex:EP,dithering_fragment:CP,dithering_pars_fragment:SP,roughnessmap_fragment:IP,roughnessmap_pars_fragment:MP,shadowmap_pars_fragment:TP,shadowmap_pars_vertex:BP,shadowmap_vertex:RP,shadowmask_pars_fragment:PP,skinbase_vertex:DP,skinning_pars_vertex:LP,skinning_vertex:FP,skinnormal_vertex:NP,specularmap_fragment:kP,specularmap_pars_fragment:OP,tonemapping_fragment:UP,tonemapping_pars_fragment:QP,transmission_fragment:VP,transmission_pars_fragment:zP,uv_pars_fragment:GP,uv_pars_vertex:HP,uv_vertex:WP,worldpos_vertex:qP,background_vert:jP,background_frag:XP,backgroundCube_vert:YP,backgroundCube_frag:KP,cube_vert:$P,cube_frag:JP,depth_vert:ZP,depth_frag:eD,distanceRGBA_vert:tD,distanceRGBA_frag:nD,equirect_vert:iD,equirect_frag:sD,linedashed_vert:rD,linedashed_frag:oD,meshbasic_vert:aD,meshbasic_frag:lD,meshlambert_vert:cD,meshlambert_frag:hD,meshmatcap_vert:uD,meshmatcap_frag:dD,meshnormal_vert:fD,meshnormal_frag:pD,meshphong_vert:mD,meshphong_frag:AD,meshphysical_vert:gD,meshphysical_frag:vD,meshtoon_vert:_D,meshtoon_frag:yD,points_vert:xD,points_frag:wD,shadow_vert:bD,shadow_frag:ED,sprite_vert:CD,sprite_frag:SD},st={common:{diffuse:{value:new at(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new wt},alphaMap:{value:null},alphaMapTransform:{value:new wt},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new wt}},envmap:{envMap:{value:null},envMapRotation:{value:new wt},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new wt}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new wt}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new wt},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new wt},normalScale:{value:new Me(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new wt},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new wt}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new wt}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new wt}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new at(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new at(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new wt},alphaTest:{value:0},uvTransform:{value:new wt}},sprite:{diffuse:{value:new at(16777215)},opacity:{value:1},center:{value:new Me(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new wt},alphaMap:{value:null},alphaMapTransform:{value:new wt},alphaTest:{value:0}}},Fs={basic:{uniforms:mi([st.common,st.specularmap,st.envmap,st.aomap,st.lightmap,st.fog]),vertexShader:Rt.meshbasic_vert,fragmentShader:Rt.meshbasic_frag},lambert:{uniforms:mi([st.common,st.specularmap,st.envmap,st.aomap,st.lightmap,st.emissivemap,st.bumpmap,st.normalmap,st.displacementmap,st.fog,st.lights,{emissive:{value:new at(0)}}]),vertexShader:Rt.meshlambert_vert,fragmentShader:Rt.meshlambert_frag},phong:{uniforms:mi([st.common,st.specularmap,st.envmap,st.aomap,st.lightmap,st.emissivemap,st.bumpmap,st.normalmap,st.displacementmap,st.fog,st.lights,{emissive:{value:new at(0)},specular:{value:new at(1118481)},shininess:{value:30}}]),vertexShader:Rt.meshphong_vert,fragmentShader:Rt.meshphong_frag},standard:{uniforms:mi([st.common,st.envmap,st.aomap,st.lightmap,st.emissivemap,st.bumpmap,st.normalmap,st.displacementmap,st.roughnessmap,st.metalnessmap,st.fog,st.lights,{emissive:{value:new at(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Rt.meshphysical_vert,fragmentShader:Rt.meshphysical_frag},toon:{uniforms:mi([st.common,st.aomap,st.lightmap,st.emissivemap,st.bumpmap,st.normalmap,st.displacementmap,st.gradientmap,st.fog,st.lights,{emissive:{value:new at(0)}}]),vertexShader:Rt.meshtoon_vert,fragmentShader:Rt.meshtoon_frag},matcap:{uniforms:mi([st.common,st.bumpmap,st.normalmap,st.displacementmap,st.fog,{matcap:{value:null}}]),vertexShader:Rt.meshmatcap_vert,fragmentShader:Rt.meshmatcap_frag},points:{uniforms:mi([st.points,st.fog]),vertexShader:Rt.points_vert,fragmentShader:Rt.points_frag},dashed:{uniforms:mi([st.common,st.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Rt.linedashed_vert,fragmentShader:Rt.linedashed_frag},depth:{uniforms:mi([st.common,st.displacementmap]),vertexShader:Rt.depth_vert,fragmentShader:Rt.depth_frag},normal:{uniforms:mi([st.common,st.bumpmap,st.normalmap,st.displacementmap,{opacity:{value:1}}]),vertexShader:Rt.meshnormal_vert,fragmentShader:Rt.meshnormal_frag},sprite:{uniforms:mi([st.sprite,st.fog]),vertexShader:Rt.sprite_vert,fragmentShader:Rt.sprite_frag},background:{uniforms:{uvTransform:{value:new wt},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:Rt.background_vert,fragmentShader:Rt.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new wt}},vertexShader:Rt.backgroundCube_vert,fragmentShader:Rt.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:Rt.cube_vert,fragmentShader:Rt.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Rt.equirect_vert,fragmentShader:Rt.equirect_frag},distanceRGBA:{uniforms:mi([st.common,st.displacementmap,{referencePosition:{value:new he},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Rt.distanceRGBA_vert,fragmentShader:Rt.distanceRGBA_frag},shadow:{uniforms:mi([st.lights,st.fog,{color:{value:new at(0)},opacity:{value:1}}]),vertexShader:Rt.shadow_vert,fragmentShader:Rt.shadow_frag}};Fs.physical={uniforms:mi([Fs.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new wt},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new wt},clearcoatNormalScale:{value:new Me(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new wt},dispersion:{value:0},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new wt},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new wt},sheen:{value:0},sheenColor:{value:new at(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new wt},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new wt},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new wt},transmissionSamplerSize:{value:new Me},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new wt},attenuationDistance:{value:0},attenuationColor:{value:new at(0)},specularColor:{value:new at(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new wt},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new wt},anisotropyVector:{value:new Me},anisotropyMap:{value:null},anisotropyMapTransform:{value:new wt}}]),vertexShader:Rt.meshphysical_vert,fragmentShader:Rt.meshphysical_frag};const pu={r:0,b:0,g:0},So=new Rn,ID=new pt;function MD(i,e,t,n,s,r,o){const a=new at(0);let l=r===!0?0:1,c,h,u=null,d=0,f=null;function p(_){let v=_.isScene===!0?_.background:null;return v&&v.isTexture&&(v=(_.backgroundBlurriness>0?t:e).get(v)),v}function A(_){let v=!1;const b=p(_);b===null?g(a,l):b&&b.isColor&&(g(b,1),v=!0);const T=i.xr.getEnvironmentBlendMode();T==="additive"?n.buffers.color.setClear(0,0,0,1,o):T==="alpha-blend"&&n.buffers.color.setClear(0,0,0,0,o),(i.autoClear||v)&&(n.buffers.depth.setTest(!0),n.buffers.depth.setMask(!0),n.buffers.color.setMask(!0),i.clear(i.autoClearColor,i.autoClearDepth,i.autoClearStencil))}function m(_,v){const b=p(v);b&&(b.isCubeTexture||b.mapping===zd)?(h===void 0&&(h=new $n(new yh(1,1,1),new co({name:"BackgroundCubeMaterial",uniforms:xl(Fs.backgroundCube.uniforms),vertexShader:Fs.backgroundCube.vertexShader,fragmentShader:Fs.backgroundCube.fragmentShader,side:Ti,depthTest:!1,depthWrite:!1,fog:!1})),h.geometry.deleteAttribute("normal"),h.geometry.deleteAttribute("uv"),h.onBeforeRender=function(T,L,I){this.matrixWorld.copyPosition(I.matrixWorld)},Object.defineProperty(h.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),s.update(h)),So.copy(v.backgroundRotation),So.x*=-1,So.y*=-1,So.z*=-1,b.isCubeTexture&&b.isRenderTargetTexture===!1&&(So.y*=-1,So.z*=-1),h.material.uniforms.envMap.value=b,h.material.uniforms.flipEnvMap.value=b.isCubeTexture&&b.isRenderTargetTexture===!1?-1:1,h.material.uniforms.backgroundBlurriness.value=v.backgroundBlurriness,h.material.uniforms.backgroundIntensity.value=v.backgroundIntensity,h.material.uniforms.backgroundRotation.value.setFromMatrix4(ID.makeRotationFromEuler(So)),h.material.toneMapped=St.getTransfer(b.colorSpace)!==Kt,(u!==b||d!==b.version||f!==i.toneMapping)&&(h.material.needsUpdate=!0,u=b,d=b.version,f=i.toneMapping),h.layers.enableAll(),_.unshift(h,h.geometry,h.material,0,0,null)):b&&b.isTexture&&(c===void 0&&(c=new $n(new Xd(2,2),new co({name:"BackgroundMaterial",uniforms:xl(Fs.background.uniforms),vertexShader:Fs.background.vertexShader,fragmentShader:Fs.background.fragmentShader,side:yr,depthTest:!1,depthWrite:!1,fog:!1})),c.geometry.deleteAttribute("normal"),Object.defineProperty(c.material,"map",{get:function(){return this.uniforms.t2D.value}}),s.update(c)),c.material.uniforms.t2D.value=b,c.material.uniforms.backgroundIntensity.value=v.backgroundIntensity,c.material.toneMapped=St.getTransfer(b.colorSpace)!==Kt,b.matrixAutoUpdate===!0&&b.updateMatrix(),c.material.uniforms.uvTransform.value.copy(b.matrix),(u!==b||d!==b.version||f!==i.toneMapping)&&(c.material.needsUpdate=!0,u=b,d=b.version,f=i.toneMapping),c.layers.enableAll(),_.unshift(c,c.geometry,c.material,0,0,null))}function g(_,v){_.getRGB(pu,kw(i)),n.buffers.color.setClear(pu.r,pu.g,pu.b,v,o)}function y(){h!==void 0&&(h.geometry.dispose(),h.material.dispose()),c!==void 0&&(c.geometry.dispose(),c.material.dispose())}return{getClearColor:function(){return a},setClearColor:function(_,v=1){a.set(_),l=v,g(a,l)},getClearAlpha:function(){return l},setClearAlpha:function(_){l=_,g(a,l)},render:A,addToRenderList:m,dispose:y}}function TD(i,e){const t=i.getParameter(i.MAX_VERTEX_ATTRIBS),n={},s=d(null);let r=s,o=!1;function a(w,P,z,H,K){let le=!1;const J=u(H,z,P);r!==J&&(r=J,c(r.object)),le=f(w,H,z,K),le&&p(w,H,z,K),K!==null&&e.update(K,i.ELEMENT_ARRAY_BUFFER),(le||o)&&(o=!1,v(w,P,z,H),K!==null&&i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,e.get(K).buffer))}function l(){return i.createVertexArray()}function c(w){return i.bindVertexArray(w)}function h(w){return i.deleteVertexArray(w)}function u(w,P,z){const H=z.wireframe===!0;let K=n[w.id];K===void 0&&(K={},n[w.id]=K);let le=K[P.id];le===void 0&&(le={},K[P.id]=le);let J=le[H];return J===void 0&&(J=d(l()),le[H]=J),J}function d(w){const P=[],z=[],H=[];for(let K=0;K<t;K++)P[K]=0,z[K]=0,H[K]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:P,enabledAttributes:z,attributeDivisors:H,object:w,attributes:{},index:null}}function f(w,P,z,H){const K=r.attributes,le=P.attributes;let J=0;const W=z.getAttributes();for(const O in W)if(W[O].location>=0){const ue=K[O];let ee=le[O];if(ee===void 0&&(O==="instanceMatrix"&&w.instanceMatrix&&(ee=w.instanceMatrix),O==="instanceColor"&&w.instanceColor&&(ee=w.instanceColor)),ue===void 0||ue.attribute!==ee||ee&&ue.data!==ee.data)return!0;J++}return r.attributesNum!==J||r.index!==H}function p(w,P,z,H){const K={},le=P.attributes;let J=0;const W=z.getAttributes();for(const O in W)if(W[O].location>=0){let ue=le[O];ue===void 0&&(O==="instanceMatrix"&&w.instanceMatrix&&(ue=w.instanceMatrix),O==="instanceColor"&&w.instanceColor&&(ue=w.instanceColor));const ee={};ee.attribute=ue,ue&&ue.data&&(ee.data=ue.data),K[O]=ee,J++}r.attributes=K,r.attributesNum=J,r.index=H}function A(){const w=r.newAttributes;for(let P=0,z=w.length;P<z;P++)w[P]=0}function m(w){g(w,0)}function g(w,P){const z=r.newAttributes,H=r.enabledAttributes,K=r.attributeDivisors;z[w]=1,H[w]===0&&(i.enableVertexAttribArray(w),H[w]=1),K[w]!==P&&(i.vertexAttribDivisor(w,P),K[w]=P)}function y(){const w=r.newAttributes,P=r.enabledAttributes;for(let z=0,H=P.length;z<H;z++)P[z]!==w[z]&&(i.disableVertexAttribArray(z),P[z]=0)}function _(w,P,z,H,K,le,J){J===!0?i.vertexAttribIPointer(w,P,z,K,le):i.vertexAttribPointer(w,P,z,H,K,le)}function v(w,P,z,H){A();const K=H.attributes,le=z.getAttributes(),J=P.defaultAttributeValues;for(const W in le){const O=le[W];if(O.location>=0){let fe=K[W];if(fe===void 0&&(W==="instanceMatrix"&&w.instanceMatrix&&(fe=w.instanceMatrix),W==="instanceColor"&&w.instanceColor&&(fe=w.instanceColor)),fe!==void 0){const ue=fe.normalized,ee=fe.itemSize,de=e.get(fe);if(de===void 0)continue;const ae=de.buffer,R=de.type,M=de.bytesPerElement,B=R===i.INT||R===i.UNSIGNED_INT||fe.gpuType===tg;if(fe.isInterleavedBufferAttribute){const D=fe.data,te=D.stride,ie=fe.offset;if(D.isInstancedInterleavedBuffer){for(let Z=0;Z<O.locationSize;Z++)g(O.location+Z,D.meshPerAttribute);w.isInstancedMesh!==!0&&H._maxInstanceCount===void 0&&(H._maxInstanceCount=D.meshPerAttribute*D.count)}else for(let Z=0;Z<O.locationSize;Z++)m(O.location+Z);i.bindBuffer(i.ARRAY_BUFFER,ae);for(let Z=0;Z<O.locationSize;Z++)_(O.location+Z,ee/O.locationSize,R,ue,te*M,(ie+ee/O.locationSize*Z)*M,B)}else{if(fe.isInstancedBufferAttribute){for(let D=0;D<O.locationSize;D++)g(O.location+D,fe.meshPerAttribute);w.isInstancedMesh!==!0&&H._maxInstanceCount===void 0&&(H._maxInstanceCount=fe.meshPerAttribute*fe.count)}else for(let D=0;D<O.locationSize;D++)m(O.location+D);i.bindBuffer(i.ARRAY_BUFFER,ae);for(let D=0;D<O.locationSize;D++)_(O.location+D,ee/O.locationSize,R,ue,ee*M,ee/O.locationSize*D*M,B)}}else if(J!==void 0){const ue=J[W];if(ue!==void 0)switch(ue.length){case 2:i.vertexAttrib2fv(O.location,ue);break;case 3:i.vertexAttrib3fv(O.location,ue);break;case 4:i.vertexAttrib4fv(O.location,ue);break;default:i.vertexAttrib1fv(O.location,ue)}}}}y()}function b(){I();for(const w in n){const P=n[w];for(const z in P){const H=P[z];for(const K in H)h(H[K].object),delete H[K];delete P[z]}delete n[w]}}function T(w){if(n[w.id]===void 0)return;const P=n[w.id];for(const z in P){const H=P[z];for(const K in H)h(H[K].object),delete H[K];delete P[z]}delete n[w.id]}function L(w){for(const P in n){const z=n[P];if(z[w.id]===void 0)continue;const H=z[w.id];for(const K in H)h(H[K].object),delete H[K];delete z[w.id]}}function I(){x(),o=!0,r!==s&&(r=s,c(r.object))}function x(){s.geometry=null,s.program=null,s.wireframe=!1}return{setup:a,reset:I,resetDefaultState:x,dispose:b,releaseStatesOfGeometry:T,releaseStatesOfProgram:L,initAttributes:A,enableAttribute:m,disableUnusedAttributes:y}}function BD(i,e,t){let n;function s(c){n=c}function r(c,h){i.drawArrays(n,c,h),t.update(h,n,1)}function o(c,h,u){u!==0&&(i.drawArraysInstanced(n,c,h,u),t.update(h,n,u))}function a(c,h,u){if(u===0)return;e.get("WEBGL_multi_draw").multiDrawArraysWEBGL(n,c,0,h,0,u);let f=0;for(let p=0;p<u;p++)f+=h[p];t.update(f,n,1)}function l(c,h,u,d){if(u===0)return;const f=e.get("WEBGL_multi_draw");if(f===null)for(let p=0;p<c.length;p++)o(c[p],h[p],d[p]);else{f.multiDrawArraysInstancedWEBGL(n,c,0,h,0,d,0,u);let p=0;for(let A=0;A<u;A++)p+=h[A]*d[A];t.update(p,n,1)}}this.setMode=s,this.render=r,this.renderInstances=o,this.renderMultiDraw=a,this.renderMultiDrawInstances=l}function RD(i,e,t,n){let s;function r(){if(s!==void 0)return s;if(e.has("EXT_texture_filter_anisotropic")===!0){const L=e.get("EXT_texture_filter_anisotropic");s=i.getParameter(L.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else s=0;return s}function o(L){return!(L!==Hn&&n.convert(L)!==i.getParameter(i.IMPLEMENTATION_COLOR_READ_FORMAT))}function a(L){const I=L===Gn&&(e.has("EXT_color_buffer_half_float")||e.has("EXT_color_buffer_float"));return!(L!==Kn&&n.convert(L)!==i.getParameter(i.IMPLEMENTATION_COLOR_READ_TYPE)&&L!==Sn&&!I)}function l(L){if(L==="highp"){if(i.getShaderPrecisionFormat(i.VERTEX_SHADER,i.HIGH_FLOAT).precision>0&&i.getShaderPrecisionFormat(i.FRAGMENT_SHADER,i.HIGH_FLOAT).precision>0)return"highp";L="mediump"}return L==="mediump"&&i.getShaderPrecisionFormat(i.VERTEX_SHADER,i.MEDIUM_FLOAT).precision>0&&i.getShaderPrecisionFormat(i.FRAGMENT_SHADER,i.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}let c=t.precision!==void 0?t.precision:"highp";const h=l(c);h!==c&&(console.warn("THREE.WebGLRenderer:",c,"not supported, using",h,"instead."),c=h);const u=t.logarithmicDepthBuffer===!0,d=t.reverseDepthBuffer===!0&&e.has("EXT_clip_control"),f=i.getParameter(i.MAX_TEXTURE_IMAGE_UNITS),p=i.getParameter(i.MAX_VERTEX_TEXTURE_IMAGE_UNITS),A=i.getParameter(i.MAX_TEXTURE_SIZE),m=i.getParameter(i.MAX_CUBE_MAP_TEXTURE_SIZE),g=i.getParameter(i.MAX_VERTEX_ATTRIBS),y=i.getParameter(i.MAX_VERTEX_UNIFORM_VECTORS),_=i.getParameter(i.MAX_VARYING_VECTORS),v=i.getParameter(i.MAX_FRAGMENT_UNIFORM_VECTORS),b=p>0,T=i.getParameter(i.MAX_SAMPLES);return{isWebGL2:!0,getMaxAnisotropy:r,getMaxPrecision:l,textureFormatReadable:o,textureTypeReadable:a,precision:c,logarithmicDepthBuffer:u,reverseDepthBuffer:d,maxTextures:f,maxVertexTextures:p,maxTextureSize:A,maxCubemapSize:m,maxAttributes:g,maxVertexUniforms:y,maxVaryings:_,maxFragmentUniforms:v,vertexTextures:b,maxSamples:T}}function PD(i){const e=this;let t=null,n=0,s=!1,r=!1;const o=new Wr,a=new wt,l={value:null,needsUpdate:!1};this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(u,d){const f=u.length!==0||d||n!==0||s;return s=d,n=u.length,f},this.beginShadows=function(){r=!0,h(null)},this.endShadows=function(){r=!1},this.setGlobalState=function(u,d){t=h(u,d,0)},this.setState=function(u,d,f){const p=u.clippingPlanes,A=u.clipIntersection,m=u.clipShadows,g=i.get(u);if(!s||p===null||p.length===0||r&&!m)r?h(null):c();else{const y=r?0:n,_=y*4;let v=g.clippingState||null;l.value=v,v=h(p,d,_,f);for(let b=0;b!==_;++b)v[b]=t[b];g.clippingState=v,this.numIntersection=A?this.numPlanes:0,this.numPlanes+=y}};function c(){l.value!==t&&(l.value=t,l.needsUpdate=n>0),e.numPlanes=n,e.numIntersection=0}function h(u,d,f,p){const A=u!==null?u.length:0;let m=null;if(A!==0){if(m=l.value,p!==!0||m===null){const g=f+A*4,y=d.matrixWorldInverse;a.getNormalMatrix(y),(m===null||m.length<g)&&(m=new Float32Array(g));for(let _=0,v=f;_!==A;++_,v+=4)o.copy(u[_]).applyMatrix4(y,a),o.normal.toArray(m,v),m[v+3]=o.constant}l.value=m,l.needsUpdate=!0}return e.numPlanes=A,e.numIntersection=0,m}}function DD(i){let e=new WeakMap;function t(o,a){return a===ed?o.mapping=ea:a===Cm&&(o.mapping=gl),o}function n(o){if(o&&o.isTexture){const a=o.mapping;if(a===ed||a===Cm)if(e.has(o)){const l=e.get(o).texture;return t(l,o.mapping)}else{const l=o.image;if(l&&l.height>0){const c=new _1(l.height);return c.fromEquirectangularTexture(i,o),e.set(o,c),o.addEventListener("dispose",s),t(c.texture,o.mapping)}else return null}}return o}function s(o){const a=o.target;a.removeEventListener("dispose",s);const l=e.get(a);l!==void 0&&(e.delete(a),l.dispose())}function r(){e=new WeakMap}return{get:n,dispose:r}}const Xa=4,n0=[.125,.215,.35,.446,.526,.582],Uo=20,ip=new Kd,i0=new at;let sp=null,rp=0,op=0,ap=!1;const Lo=(1+Math.sqrt(5))/2,Pa=1/Lo,s0=[new he(-Lo,Pa,0),new he(Lo,Pa,0),new he(-Pa,0,Lo),new he(Pa,0,Lo),new he(0,Lo,-Pa),new he(0,Lo,Pa),new he(-1,1,-1),new he(1,1,-1),new he(-1,1,1),new he(1,1,1)];class r0{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,n=.1,s=100){sp=this._renderer.getRenderTarget(),rp=this._renderer.getActiveCubeFace(),op=this._renderer.getActiveMipmapLevel(),ap=this._renderer.xr.enabled,this._renderer.xr.enabled=!1,this._setSize(256);const r=this._allocateTargets();return r.depthBuffer=!0,this._sceneToCubeUV(e,n,s,r),t>0&&this._blur(r,0,0,t),this._applyPMREM(r),this._cleanup(r),r}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=l0(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=a0(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(sp,rp,op),this._renderer.xr.enabled=ap,e.scissorTest=!1,mu(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===ea||e.mapping===gl?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),sp=this._renderer.getRenderTarget(),rp=this._renderer.getActiveCubeFace(),op=this._renderer.getActiveMipmapLevel(),ap=this._renderer.xr.enabled,this._renderer.xr.enabled=!1;const n=t||this._allocateTargets();return this._textureToCubeUV(e,n),this._applyPMREM(n),this._cleanup(n),n}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,n={magFilter:Zt,minFilter:Zt,generateMipmaps:!1,type:Gn,format:Hn,colorSpace:On,depthBuffer:!1},s=o0(e,t,n);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=o0(e,t,n);const{_lodMax:r}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=LD(r)),this._blurMaterial=FD(r,e,t)}return s}_compileMaterial(e){const t=new $n(this._lodPlanes[0],e);this._renderer.compile(t,ip)}_sceneToCubeUV(e,t,n,s){const a=new ai(90,1,t,n),l=[1,-1,1,1,1,1],c=[1,1,1,-1,-1,-1],h=this._renderer,u=h.autoClear,d=h.toneMapping;h.getClearColor(i0),h.toneMapping=to,h.autoClear=!1;const f=new zo({name:"PMREM.Background",side:Ti,depthWrite:!1,depthTest:!1}),p=new $n(new yh,f);let A=!1;const m=e.background;m?m.isColor&&(f.color.copy(m),e.background=null,A=!0):(f.color.copy(i0),A=!0);for(let g=0;g<6;g++){const y=g%3;y===0?(a.up.set(0,l[g],0),a.lookAt(c[g],0,0)):y===1?(a.up.set(0,0,l[g]),a.lookAt(0,c[g],0)):(a.up.set(0,l[g],0),a.lookAt(0,0,c[g]));const _=this._cubeSize;mu(s,y*_,g>2?_:0,_,_),h.setRenderTarget(s),A&&h.render(p,a),h.render(e,a)}p.geometry.dispose(),p.material.dispose(),h.toneMapping=d,h.autoClear=u,e.background=m}_textureToCubeUV(e,t){const n=this._renderer,s=e.mapping===ea||e.mapping===gl;s?(this._cubemapMaterial===null&&(this._cubemapMaterial=l0()),this._cubemapMaterial.uniforms.flipEnvMap.value=e.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=a0());const r=s?this._cubemapMaterial:this._equirectMaterial,o=new $n(this._lodPlanes[0],r),a=r.uniforms;a.envMap.value=e;const l=this._cubeSize;mu(t,0,0,3*l,2*l),n.setRenderTarget(t),n.render(o,ip)}_applyPMREM(e){const t=this._renderer,n=t.autoClear;t.autoClear=!1;const s=this._lodPlanes.length;for(let r=1;r<s;r++){const o=Math.sqrt(this._sigmas[r]*this._sigmas[r]-this._sigmas[r-1]*this._sigmas[r-1]),a=s0[(s-r-1)%s0.length];this._blur(e,r-1,r,o,a)}t.autoClear=n}_blur(e,t,n,s,r){const o=this._pingPongRenderTarget;this._halfBlur(e,o,t,n,s,"latitudinal",r),this._halfBlur(o,e,n,n,s,"longitudinal",r)}_halfBlur(e,t,n,s,r,o,a){const l=this._renderer,c=this._blurMaterial;o!=="latitudinal"&&o!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const h=3,u=new $n(this._lodPlanes[s],c),d=c.uniforms,f=this._sizeLods[n]-1,p=isFinite(r)?Math.PI/(2*f):2*Math.PI/(2*Uo-1),A=r/p,m=isFinite(r)?1+Math.floor(h*A):Uo;m>Uo&&console.warn("sigmaRadians, ".concat(r,", is too large and will clip, as it requested ").concat(m," samples when the maximum is set to ").concat(Uo));const g=[];let y=0;for(let L=0;L<Uo;++L){const I=L/A,x=Math.exp(-I*I/2);g.push(x),L===0?y+=x:L<m&&(y+=2*x)}for(let L=0;L<g.length;L++)g[L]=g[L]/y;d.envMap.value=e.texture,d.samples.value=m,d.weights.value=g,d.latitudinal.value=o==="latitudinal",a&&(d.poleAxis.value=a);const{_lodMax:_}=this;d.dTheta.value=p,d.mipInt.value=_-n;const v=this._sizeLods[s],b=3*v*(s>_-Xa?s-_+Xa:0),T=4*(this._cubeSize-v);mu(t,b,T,3*v,2*v),l.setRenderTarget(t),l.render(u,ip)}}function LD(i){const e=[],t=[],n=[];let s=i;const r=i-Xa+1+n0.length;for(let o=0;o<r;o++){const a=Math.pow(2,s);t.push(a);let l=1/a;o>i-Xa?l=n0[o-i+Xa-1]:o===0&&(l=0),n.push(l);const c=1/(a-2),h=-c,u=1+c,d=[h,h,u,h,u,u,h,h,u,u,h,u],f=6,p=6,A=3,m=2,g=1,y=new Float32Array(A*p*f),_=new Float32Array(m*p*f),v=new Float32Array(g*p*f);for(let T=0;T<f;T++){const L=T%3*2/3-1,I=T>2?0:-1,x=[L,I,0,L+2/3,I,0,L+2/3,I+1,0,L,I,0,L+2/3,I+1,0,L,I+1,0];y.set(x,A*p*T),_.set(d,m*p*T);const w=[T,T,T,T,T,T];v.set(w,g*p*T)}const b=new Nn;b.setAttribute("position",new Zn(y,A)),b.setAttribute("uv",new Zn(_,m)),b.setAttribute("faceIndex",new Zn(v,g)),e.push(b),s>Xa&&s--}return{lodPlanes:e,sizeLods:t,sigmas:n}}function o0(i,e,t){const n=new na(i,e,t);return n.texture.mapping=zd,n.texture.name="PMREM.cubeUv",n.scissorTest=!0,n}function mu(i,e,t,n,s){i.viewport.set(e,t,n,s),i.scissor.set(e,t,n,s)}function FD(i,e,t){const n=new Float32Array(Uo),s=new he(0,1,0);return new co({name:"SphericalGaussianBlur",defines:{n:Uo,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/t,CUBEUV_MAX_MIP:"".concat(i,".0")},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:n},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:s}},vertexShader:bg(),fragmentShader:"\n\n			precision mediump float;\n			precision mediump int;\n\n			varying vec3 vOutputDirection;\n\n			uniform sampler2D envMap;\n			uniform int samples;\n			uniform float weights[ n ];\n			uniform bool latitudinal;\n			uniform float dTheta;\n			uniform float mipInt;\n			uniform vec3 poleAxis;\n\n			#define ENVMAP_TYPE_CUBE_UV\n			#include <cube_uv_reflection_fragment>\n\n			vec3 getSample( float theta, vec3 axis ) {\n\n				float cosTheta = cos( theta );\n				// Rodrigues' axis-angle rotation\n				vec3 sampleDirection = vOutputDirection * cosTheta\n					+ cross( axis, vOutputDirection ) * sin( theta )\n					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n				return bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n			}\n\n			void main() {\n\n				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n				}\n\n				axis = normalize( axis );\n\n				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n				for ( int i = 1; i < n; i++ ) {\n\n					if ( i >= samples ) {\n\n						break;\n\n					}\n\n					float theta = dTheta * float( i );\n					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n				}\n\n			}\n		",blending:eo,depthTest:!1,depthWrite:!1})}function a0(){return new co({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:bg(),fragmentShader:"\n\n			precision mediump float;\n			precision mediump int;\n\n			varying vec3 vOutputDirection;\n\n			uniform sampler2D envMap;\n\n			#include <common>\n\n			void main() {\n\n				vec3 outputDirection = normalize( vOutputDirection );\n				vec2 uv = equirectUv( outputDirection );\n\n				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );\n\n			}\n		",blending:eo,depthTest:!1,depthWrite:!1})}function l0(){return new co({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:bg(),fragmentShader:"\n\n			precision mediump float;\n			precision mediump int;\n\n			uniform float flipEnvMap;\n\n			varying vec3 vOutputDirection;\n\n			uniform samplerCube envMap;\n\n			void main() {\n\n				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );\n\n			}\n		",blending:eo,depthTest:!1,depthWrite:!1})}function bg(){return"\n\n		precision mediump float;\n		precision mediump int;\n\n		attribute float faceIndex;\n\n		varying vec3 vOutputDirection;\n\n		// RH coordinate system; PMREM face-indexing convention\n		vec3 getDirection( vec2 uv, float face ) {\n\n			uv = 2.0 * uv - 1.0;\n\n			vec3 direction = vec3( uv, 1.0 );\n\n			if ( face == 0.0 ) {\n\n				direction = direction.zyx; // ( 1, v, u ) pos x\n\n			} else if ( face == 1.0 ) {\n\n				direction = direction.xzy;\n				direction.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n			} else if ( face == 2.0 ) {\n\n				direction.x *= -1.0; // ( -u, v, 1 ) pos z\n\n			} else if ( face == 3.0 ) {\n\n				direction = direction.zyx;\n				direction.xz *= -1.0; // ( -1, v, -u ) neg x\n\n			} else if ( face == 4.0 ) {\n\n				direction = direction.xzy;\n				direction.xy *= -1.0; // ( -u, -1, v ) neg y\n\n			} else if ( face == 5.0 ) {\n\n				direction.z *= -1.0; // ( u, v, -1 ) neg z\n\n			}\n\n			return direction;\n\n		}\n\n		void main() {\n\n			vOutputDirection = getDirection( uv, faceIndex );\n			gl_Position = vec4( position, 1.0 );\n\n		}\n	"}function ND(i){let e=new WeakMap,t=null;function n(a){if(a&&a.isTexture){const l=a.mapping,c=l===ed||l===Cm,h=l===ea||l===gl;if(c||h){let u=e.get(a);const d=u!==void 0?u.texture.pmremVersion:0;if(a.isRenderTargetTexture&&a.pmremVersion!==d)return t===null&&(t=new r0(i)),u=c?t.fromEquirectangular(a,u):t.fromCubemap(a,u),u.texture.pmremVersion=a.pmremVersion,e.set(a,u),u.texture;if(u!==void 0)return u.texture;{const f=a.image;return c&&f&&f.height>0||h&&f&&s(f)?(t===null&&(t=new r0(i)),u=c?t.fromEquirectangular(a):t.fromCubemap(a),u.texture.pmremVersion=a.pmremVersion,e.set(a,u),a.addEventListener("dispose",r),u.texture):null}}}return a}function s(a){let l=0;const c=6;for(let h=0;h<c;h++)a[h]!==void 0&&l++;return l===c}function r(a){const l=a.target;l.removeEventListener("dispose",r);const c=e.get(l);c!==void 0&&(e.delete(l),c.dispose())}function o(){e=new WeakMap,t!==null&&(t.dispose(),t=null)}return{get:n,dispose:o}}function kD(i){const e={};function t(n){if(e[n]!==void 0)return e[n];let s;switch(n){case"WEBGL_depth_texture":s=i.getExtension("WEBGL_depth_texture")||i.getExtension("MOZ_WEBGL_depth_texture")||i.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":s=i.getExtension("EXT_texture_filter_anisotropic")||i.getExtension("MOZ_EXT_texture_filter_anisotropic")||i.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":s=i.getExtension("WEBGL_compressed_texture_s3tc")||i.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||i.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":s=i.getExtension("WEBGL_compressed_texture_pvrtc")||i.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:s=i.getExtension(n)}return e[n]=s,s}return{has:function(n){return t(n)!==null},init:function(){t("EXT_color_buffer_float"),t("WEBGL_clip_cull_distance"),t("OES_texture_float_linear"),t("EXT_color_buffer_half_float"),t("WEBGL_multisampled_render_to_texture"),t("WEBGL_render_shared_exponent")},get:function(n){const s=t(n);return s===null&&za("THREE.WebGLRenderer: "+n+" extension not supported."),s}}}function OD(i,e,t,n){const s={},r=new WeakMap;function o(u){const d=u.target;d.index!==null&&e.remove(d.index);for(const p in d.attributes)e.remove(d.attributes[p]);d.removeEventListener("dispose",o),delete s[d.id];const f=r.get(d);f&&(e.remove(f),r.delete(d)),n.releaseStatesOfGeometry(d),d.isInstancedBufferGeometry===!0&&delete d._maxInstanceCount,t.memory.geometries--}function a(u,d){return s[d.id]===!0||(d.addEventListener("dispose",o),s[d.id]=!0,t.memory.geometries++),d}function l(u){const d=u.attributes;for(const f in d)e.update(d[f],i.ARRAY_BUFFER)}function c(u){const d=[],f=u.index,p=u.attributes.position;let A=0;if(f!==null){const y=f.array;A=f.version;for(let _=0,v=y.length;_<v;_+=3){const b=y[_+0],T=y[_+1],L=y[_+2];d.push(b,T,T,L,L,b)}}else if(p!==void 0){const y=p.array;A=p.version;for(let _=0,v=y.length/3-1;_<v;_+=3){const b=_+0,T=_+1,L=_+2;d.push(b,T,T,L,L,b)}}else return;const m=new(Bw(d)?Nw:cg)(d,1);m.version=A;const g=r.get(u);g&&e.remove(g),r.set(u,m)}function h(u){const d=r.get(u);if(d){const f=u.index;f!==null&&d.version<f.version&&c(u)}else c(u);return r.get(u)}return{get:a,update:l,getWireframeAttribute:h}}function UD(i,e,t){let n;function s(d){n=d}let r,o;function a(d){r=d.type,o=d.bytesPerElement}function l(d,f){i.drawElements(n,f,r,d*o),t.update(f,n,1)}function c(d,f,p){p!==0&&(i.drawElementsInstanced(n,f,r,d*o,p),t.update(f,n,p))}function h(d,f,p){if(p===0)return;e.get("WEBGL_multi_draw").multiDrawElementsWEBGL(n,f,0,r,d,0,p);let m=0;for(let g=0;g<p;g++)m+=f[g];t.update(m,n,1)}function u(d,f,p,A){if(p===0)return;const m=e.get("WEBGL_multi_draw");if(m===null)for(let g=0;g<d.length;g++)c(d[g]/o,f[g],A[g]);else{m.multiDrawElementsInstancedWEBGL(n,f,0,r,d,0,A,0,p);let g=0;for(let y=0;y<p;y++)g+=f[y]*A[y];t.update(g,n,1)}}this.setMode=s,this.setIndex=a,this.render=l,this.renderInstances=c,this.renderMultiDraw=h,this.renderMultiDrawInstances=u}function QD(i){const e={geometries:0,textures:0},t={frame:0,calls:0,triangles:0,points:0,lines:0};function n(r,o,a){switch(t.calls++,o){case i.TRIANGLES:t.triangles+=a*(r/3);break;case i.LINES:t.lines+=a*(r/2);break;case i.LINE_STRIP:t.lines+=a*(r-1);break;case i.LINE_LOOP:t.lines+=a*r;break;case i.POINTS:t.points+=a*r;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",o);break}}function s(){t.calls=0,t.triangles=0,t.points=0,t.lines=0}return{memory:e,render:t,programs:null,autoReset:!0,reset:s,update:n}}function VD(i,e,t){const n=new WeakMap,s=new Ot;function r(o,a,l){const c=o.morphTargetInfluences,h=a.morphAttributes.position||a.morphAttributes.normal||a.morphAttributes.color,u=h!==void 0?h.length:0;let d=n.get(a);if(d===void 0||d.count!==u){let x=function(){L.dispose(),n.delete(a),a.removeEventListener("dispose",x)};d!==void 0&&d.texture.dispose();const f=a.morphAttributes.position!==void 0,p=a.morphAttributes.normal!==void 0,A=a.morphAttributes.color!==void 0,m=a.morphAttributes.position||[],g=a.morphAttributes.normal||[],y=a.morphAttributes.color||[];let _=0;f===!0&&(_=1),p===!0&&(_=2),A===!0&&(_=3);let v=a.attributes.position.count*_,b=1;v>e.maxTextureSize&&(b=Math.ceil(v/e.maxTextureSize),v=e.maxTextureSize);const T=new Float32Array(v*b*4*u),L=new Pw(T,v,b,u);L.type=Sn,L.needsUpdate=!0;const I=_*4;for(let w=0;w<u;w++){const P=m[w],z=g[w],H=y[w],K=v*b*4*w;for(let le=0;le<P.count;le++){const J=le*I;f===!0&&(s.fromBufferAttribute(P,le),T[K+J+0]=s.x,T[K+J+1]=s.y,T[K+J+2]=s.z,T[K+J+3]=0),p===!0&&(s.fromBufferAttribute(z,le),T[K+J+4]=s.x,T[K+J+5]=s.y,T[K+J+6]=s.z,T[K+J+7]=0),A===!0&&(s.fromBufferAttribute(H,le),T[K+J+8]=s.x,T[K+J+9]=s.y,T[K+J+10]=s.z,T[K+J+11]=H.itemSize===4?s.w:1)}}d={count:u,texture:L,size:new Me(v,b)},n.set(a,d),a.addEventListener("dispose",x)}if(o.isInstancedMesh===!0&&o.morphTexture!==null)l.getUniforms().setValue(i,"morphTexture",o.morphTexture,t);else{let f=0;for(let A=0;A<c.length;A++)f+=c[A];const p=a.morphTargetsRelative?1:1-f;l.getUniforms().setValue(i,"morphTargetBaseInfluence",p),l.getUniforms().setValue(i,"morphTargetInfluences",c)}l.getUniforms().setValue(i,"morphTargetsTexture",d.texture,t),l.getUniforms().setValue(i,"morphTargetsTextureSize",d.size)}return{update:r}}function zD(i,e,t,n){let s=new WeakMap;function r(l){const c=n.render.frame,h=l.geometry,u=e.get(l,h);if(s.get(u)!==c&&(e.update(u),s.set(u,c)),l.isInstancedMesh&&(l.hasEventListener("dispose",a)===!1&&l.addEventListener("dispose",a),s.get(l)!==c&&(t.update(l.instanceMatrix,i.ARRAY_BUFFER),l.instanceColor!==null&&t.update(l.instanceColor,i.ARRAY_BUFFER),s.set(l,c))),l.isSkinnedMesh){const d=l.skeleton;s.get(d)!==c&&(d.update(),s.set(d,c))}return u}function o(){s=new WeakMap}function a(l){const c=l.target;c.removeEventListener("dispose",a),t.remove(c.instanceMatrix),c.instanceColor!==null&&t.remove(c.instanceColor)}return{update:r,dispose:o}}const nb=new Pn,c0=new Uw(1,1),ib=new Pw,sb=new Dw,rb=new ug,h0=[],u0=[],d0=new Float32Array(16),f0=new Float32Array(9),p0=new Float32Array(4);function Ll(i,e,t){const n=i[0];if(n<=0||n>0)return i;const s=e*t;let r=h0[s];if(r===void 0&&(r=new Float32Array(s),h0[s]=r),e!==0){n.toArray(r,0);for(let o=1,a=0;o!==e;++o)a+=t,i[o].toArray(r,a)}return r}function qn(i,e){if(i.length!==e.length)return!1;for(let t=0,n=i.length;t<n;t++)if(i[t]!==e[t])return!1;return!0}function jn(i,e){for(let t=0,n=e.length;t<n;t++)i[t]=e[t]}function $d(i,e){let t=u0[e];t===void 0&&(t=new Int32Array(e),u0[e]=t);for(let n=0;n!==e;++n)t[n]=i.allocateTextureUnit();return t}function GD(i,e){const t=this.cache;t[0]!==e&&(i.uniform1f(this.addr,e),t[0]=e)}function HD(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(i.uniform2f(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(qn(t,e))return;i.uniform2fv(this.addr,e),jn(t,e)}}function WD(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(i.uniform3f(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else if(e.r!==void 0)(t[0]!==e.r||t[1]!==e.g||t[2]!==e.b)&&(i.uniform3f(this.addr,e.r,e.g,e.b),t[0]=e.r,t[1]=e.g,t[2]=e.b);else{if(qn(t,e))return;i.uniform3fv(this.addr,e),jn(t,e)}}function qD(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(i.uniform4f(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(qn(t,e))return;i.uniform4fv(this.addr,e),jn(t,e)}}function jD(i,e){const t=this.cache,n=e.elements;if(n===void 0){if(qn(t,e))return;i.uniformMatrix2fv(this.addr,!1,e),jn(t,e)}else{if(qn(t,n))return;p0.set(n),i.uniformMatrix2fv(this.addr,!1,p0),jn(t,n)}}function XD(i,e){const t=this.cache,n=e.elements;if(n===void 0){if(qn(t,e))return;i.uniformMatrix3fv(this.addr,!1,e),jn(t,e)}else{if(qn(t,n))return;f0.set(n),i.uniformMatrix3fv(this.addr,!1,f0),jn(t,n)}}function YD(i,e){const t=this.cache,n=e.elements;if(n===void 0){if(qn(t,e))return;i.uniformMatrix4fv(this.addr,!1,e),jn(t,e)}else{if(qn(t,n))return;d0.set(n),i.uniformMatrix4fv(this.addr,!1,d0),jn(t,n)}}function KD(i,e){const t=this.cache;t[0]!==e&&(i.uniform1i(this.addr,e),t[0]=e)}function $D(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(i.uniform2i(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(qn(t,e))return;i.uniform2iv(this.addr,e),jn(t,e)}}function JD(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(i.uniform3i(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(qn(t,e))return;i.uniform3iv(this.addr,e),jn(t,e)}}function ZD(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(i.uniform4i(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(qn(t,e))return;i.uniform4iv(this.addr,e),jn(t,e)}}function eL(i,e){const t=this.cache;t[0]!==e&&(i.uniform1ui(this.addr,e),t[0]=e)}function tL(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(i.uniform2ui(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(qn(t,e))return;i.uniform2uiv(this.addr,e),jn(t,e)}}function nL(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(i.uniform3ui(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(qn(t,e))return;i.uniform3uiv(this.addr,e),jn(t,e)}}function iL(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(i.uniform4ui(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(qn(t,e))return;i.uniform4uiv(this.addr,e),jn(t,e)}}function sL(i,e,t){const n=this.cache,s=t.allocateTextureUnit();n[0]!==s&&(i.uniform1i(this.addr,s),n[0]=s);let r;this.type===i.SAMPLER_2D_SHADOW?(c0.compareFunction=Tw,r=c0):r=nb,t.setTexture2D(e||r,s)}function rL(i,e,t){const n=this.cache,s=t.allocateTextureUnit();n[0]!==s&&(i.uniform1i(this.addr,s),n[0]=s),t.setTexture3D(e||sb,s)}function oL(i,e,t){const n=this.cache,s=t.allocateTextureUnit();n[0]!==s&&(i.uniform1i(this.addr,s),n[0]=s),t.setTextureCube(e||rb,s)}function aL(i,e,t){const n=this.cache,s=t.allocateTextureUnit();n[0]!==s&&(i.uniform1i(this.addr,s),n[0]=s),t.setTexture2DArray(e||ib,s)}function lL(i){switch(i){case 5126:return GD;case 35664:return HD;case 35665:return WD;case 35666:return qD;case 35674:return jD;case 35675:return XD;case 35676:return YD;case 5124:case 35670:return KD;case 35667:case 35671:return $D;case 35668:case 35672:return JD;case 35669:case 35673:return ZD;case 5125:return eL;case 36294:return tL;case 36295:return nL;case 36296:return iL;case 35678:case 36198:case 36298:case 36306:case 35682:return sL;case 35679:case 36299:case 36307:return rL;case 35680:case 36300:case 36308:case 36293:return oL;case 36289:case 36303:case 36311:case 36292:return aL}}function cL(i,e){i.uniform1fv(this.addr,e)}function hL(i,e){const t=Ll(e,this.size,2);i.uniform2fv(this.addr,t)}function uL(i,e){const t=Ll(e,this.size,3);i.uniform3fv(this.addr,t)}function dL(i,e){const t=Ll(e,this.size,4);i.uniform4fv(this.addr,t)}function fL(i,e){const t=Ll(e,this.size,4);i.uniformMatrix2fv(this.addr,!1,t)}function pL(i,e){const t=Ll(e,this.size,9);i.uniformMatrix3fv(this.addr,!1,t)}function mL(i,e){const t=Ll(e,this.size,16);i.uniformMatrix4fv(this.addr,!1,t)}function AL(i,e){i.uniform1iv(this.addr,e)}function gL(i,e){i.uniform2iv(this.addr,e)}function vL(i,e){i.uniform3iv(this.addr,e)}function _L(i,e){i.uniform4iv(this.addr,e)}function yL(i,e){i.uniform1uiv(this.addr,e)}function xL(i,e){i.uniform2uiv(this.addr,e)}function wL(i,e){i.uniform3uiv(this.addr,e)}function bL(i,e){i.uniform4uiv(this.addr,e)}function EL(i,e,t){const n=this.cache,s=e.length,r=$d(t,s);qn(n,r)||(i.uniform1iv(this.addr,r),jn(n,r));for(let o=0;o!==s;++o)t.setTexture2D(e[o]||nb,r[o])}function CL(i,e,t){const n=this.cache,s=e.length,r=$d(t,s);qn(n,r)||(i.uniform1iv(this.addr,r),jn(n,r));for(let o=0;o!==s;++o)t.setTexture3D(e[o]||sb,r[o])}function SL(i,e,t){const n=this.cache,s=e.length,r=$d(t,s);qn(n,r)||(i.uniform1iv(this.addr,r),jn(n,r));for(let o=0;o!==s;++o)t.setTextureCube(e[o]||rb,r[o])}function IL(i,e,t){const n=this.cache,s=e.length,r=$d(t,s);qn(n,r)||(i.uniform1iv(this.addr,r),jn(n,r));for(let o=0;o!==s;++o)t.setTexture2DArray(e[o]||ib,r[o])}function ML(i){switch(i){case 5126:return cL;case 35664:return hL;case 35665:return uL;case 35666:return dL;case 35674:return fL;case 35675:return pL;case 35676:return mL;case 5124:case 35670:return AL;case 35667:case 35671:return gL;case 35668:case 35672:return vL;case 35669:case 35673:return _L;case 5125:return yL;case 36294:return xL;case 36295:return wL;case 36296:return bL;case 35678:case 36198:case 36298:case 36306:case 35682:return EL;case 35679:case 36299:case 36307:return CL;case 35680:case 36300:case 36308:case 36293:return SL;case 36289:case 36303:case 36311:case 36292:return IL}}class TL{constructor(e,t,n){this.id=e,this.addr=n,this.cache=[],this.type=t.type,this.setValue=lL(t.type)}}class BL{constructor(e,t,n){this.id=e,this.addr=n,this.cache=[],this.type=t.type,this.size=t.size,this.setValue=ML(t.type)}}class RL{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,n){const s=this.seq;for(let r=0,o=s.length;r!==o;++r){const a=s[r];a.setValue(e,t[a.id],n)}}}const lp=/(\w+)(\])?(\[|\.)?/g;function m0(i,e){i.seq.push(e),i.map[e.id]=e}function PL(i,e,t){const n=i.name,s=n.length;for(lp.lastIndex=0;;){const r=lp.exec(n),o=lp.lastIndex;let a=r[1];const l=r[2]==="]",c=r[3];if(l&&(a=a|0),c===void 0||c==="["&&o+2===s){m0(t,c===void 0?new TL(a,i,e):new BL(a,i,e));break}else{let u=t.map[a];u===void 0&&(u=new RL(a),m0(t,u)),t=u}}}class Uu{constructor(e,t){this.seq=[],this.map={};const n=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let s=0;s<n;++s){const r=e.getActiveUniform(t,s),o=e.getUniformLocation(t,r.name);PL(r,o,this)}}setValue(e,t,n,s){const r=this.map[t];r!==void 0&&r.setValue(e,n,s)}setOptional(e,t,n){const s=t[n];s!==void 0&&this.setValue(e,n,s)}static upload(e,t,n,s){for(let r=0,o=t.length;r!==o;++r){const a=t[r],l=n[a.id];l.needsUpdate!==!1&&a.setValue(e,l.value,s)}}static seqWithValue(e,t){const n=[];for(let s=0,r=e.length;s!==r;++s){const o=e[s];o.id in t&&n.push(o)}return n}}function A0(i,e,t){const n=i.createShader(e);return i.shaderSource(n,t),i.compileShader(n),n}const DL=37297;let LL=0;function FL(i,e){const t=i.split("\n"),n=[],s=Math.max(e-6,0),r=Math.min(e+6,t.length);for(let o=s;o<r;o++){const a=o+1;n.push("".concat(a===e?">":" "," ").concat(a,": ").concat(t[o]))}return n.join("\n")}const g0=new wt;function NL(i){St._getMatrix(g0,St.workingColorSpace,i);const e="mat3( ".concat(g0.elements.map(t=>t.toFixed(4))," )");switch(St.getTransfer(i)){case ld:return[e,"LinearTransferOETF"];case Kt:return[e,"sRGBTransferOETF"];default:return console.warn("THREE.WebGLProgram: Unsupported color space: ",i),[e,"LinearTransferOETF"]}}function v0(i,e,t){const n=i.getShaderParameter(e,i.COMPILE_STATUS),s=i.getShaderInfoLog(e).trim();if(n&&s==="")return"";const r=/ERROR: 0:(\d+)/.exec(s);if(r){const o=parseInt(r[1]);return t.toUpperCase()+"\n\n"+s+"\n\n"+FL(i.getShaderSource(e),o)}else return s}function kL(i,e){const t=NL(e);return["vec4 ".concat(i,"( vec4 value ) {"),"	return ".concat(t[1],"( vec4( value.rgb * ").concat(t[0],", value.a ) );"),"}"].join("\n")}function OL(i,e){let t;switch(e){case uT:t="Linear";break;case dT:t="Reinhard";break;case fT:t="Cineon";break;case vw:t="ACESFilmic";break;case mT:t="AgX";break;case AT:t="Neutral";break;case pT:t="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),t="Linear"}return"vec3 "+i+"( vec3 color ) { return "+t+"ToneMapping( color ); }"}const Au=new he;function UL(){St.getLuminanceCoefficients(Au);const i=Au.x.toFixed(4),e=Au.y.toFixed(4),t=Au.z.toFixed(4);return["float luminance( const in vec3 rgb ) {","	const vec3 weights = vec3( ".concat(i,", ").concat(e,", ").concat(t," );"),"	return dot( weights, rgb );","}"].join("\n")}function QL(i){return[i.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":"",i.extensionMultiDraw?"#extension GL_ANGLE_multi_draw : require":""].filter(ac).join("\n")}function VL(i){const e=[];for(const t in i){const n=i[t];n!==!1&&e.push("#define "+t+" "+n)}return e.join("\n")}function zL(i,e){const t={},n=i.getProgramParameter(e,i.ACTIVE_ATTRIBUTES);for(let s=0;s<n;s++){const r=i.getActiveAttrib(e,s),o=r.name;let a=1;r.type===i.FLOAT_MAT2&&(a=2),r.type===i.FLOAT_MAT3&&(a=3),r.type===i.FLOAT_MAT4&&(a=4),t[o]={type:r.type,location:i.getAttribLocation(e,o),locationSize:a}}return t}function ac(i){return i!==""}function _0(i,e){const t=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return i.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,t).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function y0(i,e){return i.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const GL=/^[ \t]*#include +<([\w\d./]+)>/gm;function Jm(i){return i.replace(GL,WL)}const HL=new Map;function WL(i,e){let t=Rt[e];if(t===void 0){const n=HL.get(e);if(n!==void 0)t=Rt[n],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',e,n);else throw new Error("Can not resolve #include <"+e+">")}return Jm(t)}const qL=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function x0(i){return i.replace(qL,jL)}function jL(i,e,t,n){let s="";for(let r=parseInt(e);r<parseInt(t);r++)s+=n.replace(/\[\s*i\s*\]/g,"[ "+r+" ]").replace(/UNROLLED_LOOP_INDEX/g,r);return s}function w0(i){let e="precision ".concat(i.precision," float;\n	precision ").concat(i.precision," int;\n	precision ").concat(i.precision," sampler2D;\n	precision ").concat(i.precision," samplerCube;\n	precision ").concat(i.precision," sampler3D;\n	precision ").concat(i.precision," sampler2DArray;\n	precision ").concat(i.precision," sampler2DShadow;\n	precision ").concat(i.precision," samplerCubeShadow;\n	precision ").concat(i.precision," sampler2DArrayShadow;\n	precision ").concat(i.precision," isampler2D;\n	precision ").concat(i.precision," isampler3D;\n	precision ").concat(i.precision," isamplerCube;\n	precision ").concat(i.precision," isampler2DArray;\n	precision ").concat(i.precision," usampler2D;\n	precision ").concat(i.precision," usampler3D;\n	precision ").concat(i.precision," usamplerCube;\n	precision ").concat(i.precision," usampler2DArray;\n	");return i.precision==="highp"?e+="\n#define HIGH_PRECISION":i.precision==="mediump"?e+="\n#define MEDIUM_PRECISION":i.precision==="lowp"&&(e+="\n#define LOW_PRECISION"),e}function XL(i){let e="SHADOWMAP_TYPE_BASIC";return i.shadowMapType===Aw?e="SHADOWMAP_TYPE_PCF":i.shadowMapType===gw?e="SHADOWMAP_TYPE_PCF_SOFT":i.shadowMapType===rr&&(e="SHADOWMAP_TYPE_VSM"),e}function YL(i){let e="ENVMAP_TYPE_CUBE";if(i.envMap)switch(i.envMapMode){case ea:case gl:e="ENVMAP_TYPE_CUBE";break;case zd:e="ENVMAP_TYPE_CUBE_UV";break}return e}function KL(i){let e="ENVMAP_MODE_REFLECTION";if(i.envMap)switch(i.envMapMode){case gl:e="ENVMAP_MODE_REFRACTION";break}return e}function $L(i){let e="ENVMAP_BLENDING_NONE";if(i.envMap)switch(i.combine){case Vd:e="ENVMAP_BLENDING_MULTIPLY";break;case cT:e="ENVMAP_BLENDING_MIX";break;case hT:e="ENVMAP_BLENDING_ADD";break}return e}function JL(i){const e=i.envMapCubeUVHeight;if(e===null)return null;const t=Math.log2(e)-2,n=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,t),7*16)),texelHeight:n,maxMip:t}}function ZL(i,e,t,n){const s=i.getContext(),r=t.defines;let o=t.vertexShader,a=t.fragmentShader;const l=XL(t),c=YL(t),h=KL(t),u=$L(t),d=JL(t),f=QL(t),p=VL(r),A=s.createProgram();let m,g,y=t.glslVersion?"#version "+t.glslVersion+"\n":"";t.isRawShaderMaterial?(m=["#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,p].filter(ac).join("\n"),m.length>0&&(m+="\n"),g=["#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,p].filter(ac).join("\n"),g.length>0&&(g+="\n")):(m=[w0(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,p,t.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",t.batching?"#define USE_BATCHING":"",t.batchingColor?"#define USE_BATCHING_COLOR":"",t.instancing?"#define USE_INSTANCING":"",t.instancingColor?"#define USE_INSTANCING_COLOR":"",t.instancingMorph?"#define USE_INSTANCING_MORPH":"",t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+h:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.displacementMap?"#define USE_DISPLACEMENTMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.mapUv?"#define MAP_UV "+t.mapUv:"",t.alphaMapUv?"#define ALPHAMAP_UV "+t.alphaMapUv:"",t.lightMapUv?"#define LIGHTMAP_UV "+t.lightMapUv:"",t.aoMapUv?"#define AOMAP_UV "+t.aoMapUv:"",t.emissiveMapUv?"#define EMISSIVEMAP_UV "+t.emissiveMapUv:"",t.bumpMapUv?"#define BUMPMAP_UV "+t.bumpMapUv:"",t.normalMapUv?"#define NORMALMAP_UV "+t.normalMapUv:"",t.displacementMapUv?"#define DISPLACEMENTMAP_UV "+t.displacementMapUv:"",t.metalnessMapUv?"#define METALNESSMAP_UV "+t.metalnessMapUv:"",t.roughnessMapUv?"#define ROUGHNESSMAP_UV "+t.roughnessMapUv:"",t.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+t.anisotropyMapUv:"",t.clearcoatMapUv?"#define CLEARCOATMAP_UV "+t.clearcoatMapUv:"",t.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+t.clearcoatNormalMapUv:"",t.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+t.clearcoatRoughnessMapUv:"",t.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+t.iridescenceMapUv:"",t.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+t.iridescenceThicknessMapUv:"",t.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+t.sheenColorMapUv:"",t.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+t.sheenRoughnessMapUv:"",t.specularMapUv?"#define SPECULARMAP_UV "+t.specularMapUv:"",t.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+t.specularColorMapUv:"",t.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+t.specularIntensityMapUv:"",t.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+t.transmissionMapUv:"",t.thicknessMapUv?"#define THICKNESSMAP_UV "+t.thicknessMapUv:"",t.vertexTangents&&t.flatShading===!1?"#define USE_TANGENT":"",t.vertexColors?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.flatShading?"#define FLAT_SHADED":"",t.skinning?"#define USE_SKINNING":"",t.morphTargets?"#define USE_MORPHTARGETS":"",t.morphNormals&&t.flatShading===!1?"#define USE_MORPHNORMALS":"",t.morphColors?"#define USE_MORPHCOLORS":"",t.morphTargetsCount>0?"#define MORPHTARGETS_TEXTURE_STRIDE "+t.morphTextureStride:"",t.morphTargetsCount>0?"#define MORPHTARGETS_COUNT "+t.morphTargetsCount:"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+l:"",t.sizeAttenuation?"#define USE_SIZEATTENUATION":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.reverseDepthBuffer?"#define USE_REVERSEDEPTHBUF":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","#ifdef USE_INSTANCING_MORPH","	uniform sampler2D morphTexture;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","	attribute vec2 uv1;","#endif","#ifdef USE_UV2","	attribute vec2 uv2;","#endif","#ifdef USE_UV3","	attribute vec2 uv3;","#endif","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif","\n"].filter(ac).join("\n"),g=[w0(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,p,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.alphaToCoverage?"#define ALPHA_TO_COVERAGE":"",t.map?"#define USE_MAP":"",t.matcap?"#define USE_MATCAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+c:"",t.envMap?"#define "+h:"",t.envMap?"#define "+u:"",d?"#define CUBEUV_TEXEL_WIDTH "+d.texelWidth:"",d?"#define CUBEUV_TEXEL_HEIGHT "+d.texelHeight:"",d?"#define CUBEUV_MAX_MIP "+d.maxMip+".0":"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoat?"#define USE_CLEARCOAT":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.dispersion?"#define USE_DISPERSION":"",t.iridescence?"#define USE_IRIDESCENCE":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaTest?"#define USE_ALPHATEST":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.sheen?"#define USE_SHEEN":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.vertexTangents&&t.flatShading===!1?"#define USE_TANGENT":"",t.vertexColors||t.instancingColor||t.batchingColor?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.gradientMap?"#define USE_GRADIENTMAP":"",t.flatShading?"#define FLAT_SHADED":"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+l:"",t.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",t.decodeVideoTextureEmissive?"#define DECODE_VIDEO_TEXTURE_EMISSIVE":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.reverseDepthBuffer?"#define USE_REVERSEDEPTHBUF":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",t.toneMapping!==to?"#define TONE_MAPPING":"",t.toneMapping!==to?Rt.tonemapping_pars_fragment:"",t.toneMapping!==to?OL("toneMapping",t.toneMapping):"",t.dithering?"#define DITHERING":"",t.opaque?"#define OPAQUE":"",Rt.colorspace_pars_fragment,kL("linearToOutputTexel",t.outputColorSpace),UL(),t.useDepthPacking?"#define DEPTH_PACKING "+t.depthPacking:"","\n"].filter(ac).join("\n")),o=Jm(o),o=_0(o,t),o=y0(o,t),a=Jm(a),a=_0(a,t),a=y0(a,t),o=x0(o),a=x0(a),t.isRawShaderMaterial!==!0&&(y="#version 300 es\n",m=[f,"#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+m,g=["#define varying in",t.glslVersion===u_?"":"layout(location = 0) out highp vec4 pc_fragColor;",t.glslVersion===u_?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+g);const _=y+m+o,v=y+g+a,b=A0(s,s.VERTEX_SHADER,_),T=A0(s,s.FRAGMENT_SHADER,v);s.attachShader(A,b),s.attachShader(A,T),t.index0AttributeName!==void 0?s.bindAttribLocation(A,0,t.index0AttributeName):t.morphTargets===!0&&s.bindAttribLocation(A,0,"position"),s.linkProgram(A);function L(P){if(i.debug.checkShaderErrors){const z=s.getProgramInfoLog(A).trim(),H=s.getShaderInfoLog(b).trim(),K=s.getShaderInfoLog(T).trim();let le=!0,J=!0;if(s.getProgramParameter(A,s.LINK_STATUS)===!1)if(le=!1,typeof i.debug.onShaderError=="function")i.debug.onShaderError(s,A,b,T);else{const W=v0(s,b,"vertex"),O=v0(s,T,"fragment");console.error("THREE.WebGLProgram: Shader Error "+s.getError()+" - VALIDATE_STATUS "+s.getProgramParameter(A,s.VALIDATE_STATUS)+"\n\nMaterial Name: "+P.name+"\nMaterial Type: "+P.type+"\n\nProgram Info Log: "+z+"\n"+W+"\n"+O)}else z!==""?console.warn("THREE.WebGLProgram: Program Info Log:",z):(H===""||K==="")&&(J=!1);J&&(P.diagnostics={runnable:le,programLog:z,vertexShader:{log:H,prefix:m},fragmentShader:{log:K,prefix:g}})}s.deleteShader(b),s.deleteShader(T),I=new Uu(s,A),x=zL(s,A)}let I;this.getUniforms=function(){return I===void 0&&L(this),I};let x;this.getAttributes=function(){return x===void 0&&L(this),x};let w=t.rendererExtensionParallelShaderCompile===!1;return this.isReady=function(){return w===!1&&(w=s.getProgramParameter(A,DL)),w},this.destroy=function(){n.releaseStatesOfProgram(this),s.deleteProgram(A),this.program=void 0},this.type=t.shaderType,this.name=t.shaderName,this.id=LL++,this.cacheKey=e,this.usedTimes=1,this.program=A,this.vertexShader=b,this.fragmentShader=T,this}let e2=0;class t2{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const t=e.vertexShader,n=e.fragmentShader,s=this._getShaderStage(t),r=this._getShaderStage(n),o=this._getShaderCacheForMaterial(e);return o.has(s)===!1&&(o.add(s),s.usedTimes++),o.has(r)===!1&&(o.add(r),r.usedTimes++),this}remove(e){const t=this.materialCache.get(e);for(const n of t)n.usedTimes--,n.usedTimes===0&&this.shaderCache.delete(n.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;let n=t.get(e);return n===void 0&&(n=new Set,t.set(e,n)),n}_getShaderStage(e){const t=this.shaderCache;let n=t.get(e);return n===void 0&&(n=new n2(e),t.set(e,n)),n}}class n2{constructor(e){this.id=e2++,this.code=e,this.usedTimes=0}}function i2(i,e,t,n,s,r,o){const a=new Lw,l=new t2,c=new Set,h=[],u=s.logarithmicDepthBuffer,d=s.vertexTextures;let f=s.precision;const p={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function A(x){return c.add(x),x===0?"uv":"uv".concat(x)}function m(x,w,P,z,H){const K=z.fog,le=H.geometry,J=x.isMeshStandardMaterial?z.environment:null,W=(x.isMeshStandardMaterial?t:e).get(x.envMap||J),O=W&&W.mapping===zd?W.image.height:null,fe=p[x.type];x.precision!==null&&(f=s.getMaxPrecision(x.precision),f!==x.precision&&console.warn("THREE.WebGLProgram.getParameters:",x.precision,"not supported, using",f,"instead."));const ue=le.morphAttributes.position||le.morphAttributes.normal||le.morphAttributes.color,ee=ue!==void 0?ue.length:0;let de=0;le.morphAttributes.position!==void 0&&(de=1),le.morphAttributes.normal!==void 0&&(de=2),le.morphAttributes.color!==void 0&&(de=3);let ae,R,M,B;if(fe){const yt=Fs[fe];ae=yt.vertexShader,R=yt.fragmentShader}else ae=x.vertexShader,R=x.fragmentShader,l.update(x),M=l.getVertexShaderID(x),B=l.getFragmentShaderID(x);const D=i.getRenderTarget(),te=i.state.buffers.depth.getReversed(),ie=H.isInstancedMesh===!0,Z=H.isBatchedMesh===!0,me=!!x.map,F=!!x.matcap,Q=!!W,E=!!x.aoMap,j=!!x.lightMap,q=!!x.bumpMap,ce=!!x.normalMap,G=!!x.displacementMap,V=!!x.emissiveMap,re=!!x.metalnessMap,k=!!x.roughnessMap,N=x.anisotropy>0,oe=x.clearcoat>0,pe=x.dispersion>0,ve=x.iridescence>0,xe=x.sheen>0,Pe=x.transmission>0,Te=N&&!!x.anisotropyMap,Qe=oe&&!!x.clearcoatMap,lt=oe&&!!x.clearcoatNormalMap,Ne=oe&&!!x.clearcoatRoughnessMap,qe=ve&&!!x.iridescenceMap,Ke=ve&&!!x.iridescenceThicknessMap,it=xe&&!!x.sheenColorMap,je=xe&&!!x.sheenRoughnessMap,dt=!!x.specularMap,ct=!!x.specularColorMap,At=!!x.specularIntensityMap,ge=Pe&&!!x.transmissionMap,be=Pe&&!!x.thicknessMap,Ce=!!x.gradientMap,Le=!!x.alphaMap,et=x.alphaTest>0,Ze=!!x.alphaHash,_t=!!x.extensions;let Ht=to;x.toneMapped&&(D===null||D.isXRRenderTarget===!0)&&(Ht=i.toneMapping);const dn={shaderID:fe,shaderType:x.type,shaderName:x.name,vertexShader:ae,fragmentShader:R,defines:x.defines,customVertexShaderID:M,customFragmentShaderID:B,isRawShaderMaterial:x.isRawShaderMaterial===!0,glslVersion:x.glslVersion,precision:f,batching:Z,batchingColor:Z&&H._colorsTexture!==null,instancing:ie,instancingColor:ie&&H.instanceColor!==null,instancingMorph:ie&&H.morphTexture!==null,supportsVertexTextures:d,outputColorSpace:D===null?i.outputColorSpace:D.isXRRenderTarget===!0?D.texture.colorSpace:On,alphaToCoverage:!!x.alphaToCoverage,map:me,matcap:F,envMap:Q,envMapMode:Q&&W.mapping,envMapCubeUVHeight:O,aoMap:E,lightMap:j,bumpMap:q,normalMap:ce,displacementMap:d&&G,emissiveMap:V,normalMapObjectSpace:ce&&x.normalMapType===wT,normalMapTangentSpace:ce&&x.normalMapType===vh,metalnessMap:re,roughnessMap:k,anisotropy:N,anisotropyMap:Te,clearcoat:oe,clearcoatMap:Qe,clearcoatNormalMap:lt,clearcoatRoughnessMap:Ne,dispersion:pe,iridescence:ve,iridescenceMap:qe,iridescenceThicknessMap:Ke,sheen:xe,sheenColorMap:it,sheenRoughnessMap:je,specularMap:dt,specularColorMap:ct,specularIntensityMap:At,transmission:Pe,transmissionMap:ge,thicknessMap:be,gradientMap:Ce,opaque:x.transparent===!1&&x.blending===il&&x.alphaToCoverage===!1,alphaMap:Le,alphaTest:et,alphaHash:Ze,combine:x.combine,mapUv:me&&A(x.map.channel),aoMapUv:E&&A(x.aoMap.channel),lightMapUv:j&&A(x.lightMap.channel),bumpMapUv:q&&A(x.bumpMap.channel),normalMapUv:ce&&A(x.normalMap.channel),displacementMapUv:G&&A(x.displacementMap.channel),emissiveMapUv:V&&A(x.emissiveMap.channel),metalnessMapUv:re&&A(x.metalnessMap.channel),roughnessMapUv:k&&A(x.roughnessMap.channel),anisotropyMapUv:Te&&A(x.anisotropyMap.channel),clearcoatMapUv:Qe&&A(x.clearcoatMap.channel),clearcoatNormalMapUv:lt&&A(x.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:Ne&&A(x.clearcoatRoughnessMap.channel),iridescenceMapUv:qe&&A(x.iridescenceMap.channel),iridescenceThicknessMapUv:Ke&&A(x.iridescenceThicknessMap.channel),sheenColorMapUv:it&&A(x.sheenColorMap.channel),sheenRoughnessMapUv:je&&A(x.sheenRoughnessMap.channel),specularMapUv:dt&&A(x.specularMap.channel),specularColorMapUv:ct&&A(x.specularColorMap.channel),specularIntensityMapUv:At&&A(x.specularIntensityMap.channel),transmissionMapUv:ge&&A(x.transmissionMap.channel),thicknessMapUv:be&&A(x.thicknessMap.channel),alphaMapUv:Le&&A(x.alphaMap.channel),vertexTangents:!!le.attributes.tangent&&(ce||N),vertexColors:x.vertexColors,vertexAlphas:x.vertexColors===!0&&!!le.attributes.color&&le.attributes.color.itemSize===4,pointsUvs:H.isPoints===!0&&!!le.attributes.uv&&(me||Le),fog:!!K,useFog:x.fog===!0,fogExp2:!!K&&K.isFogExp2,flatShading:x.flatShading===!0,sizeAttenuation:x.sizeAttenuation===!0,logarithmicDepthBuffer:u,reverseDepthBuffer:te,skinning:H.isSkinnedMesh===!0,morphTargets:le.morphAttributes.position!==void 0,morphNormals:le.morphAttributes.normal!==void 0,morphColors:le.morphAttributes.color!==void 0,morphTargetsCount:ee,morphTextureStride:de,numDirLights:w.directional.length,numPointLights:w.point.length,numSpotLights:w.spot.length,numSpotLightMaps:w.spotLightMap.length,numRectAreaLights:w.rectArea.length,numHemiLights:w.hemi.length,numDirLightShadows:w.directionalShadowMap.length,numPointLightShadows:w.pointShadowMap.length,numSpotLightShadows:w.spotShadowMap.length,numSpotLightShadowsWithMaps:w.numSpotLightShadowsWithMaps,numLightProbes:w.numLightProbes,numClippingPlanes:o.numPlanes,numClipIntersection:o.numIntersection,dithering:x.dithering,shadowMapEnabled:i.shadowMap.enabled&&P.length>0,shadowMapType:i.shadowMap.type,toneMapping:Ht,decodeVideoTexture:me&&x.map.isVideoTexture===!0&&St.getTransfer(x.map.colorSpace)===Kt,decodeVideoTextureEmissive:V&&x.emissiveMap.isVideoTexture===!0&&St.getTransfer(x.emissiveMap.colorSpace)===Kt,premultipliedAlpha:x.premultipliedAlpha,doubleSided:x.side===Ns,flipSided:x.side===Ti,useDepthPacking:x.depthPacking>=0,depthPacking:x.depthPacking||0,index0AttributeName:x.index0AttributeName,extensionClipCullDistance:_t&&x.extensions.clipCullDistance===!0&&n.has("WEBGL_clip_cull_distance"),extensionMultiDraw:(_t&&x.extensions.multiDraw===!0||Z)&&n.has("WEBGL_multi_draw"),rendererExtensionParallelShaderCompile:n.has("KHR_parallel_shader_compile"),customProgramCacheKey:x.customProgramCacheKey()};return dn.vertexUv1s=c.has(1),dn.vertexUv2s=c.has(2),dn.vertexUv3s=c.has(3),c.clear(),dn}function g(x){const w=[];if(x.shaderID?w.push(x.shaderID):(w.push(x.customVertexShaderID),w.push(x.customFragmentShaderID)),x.defines!==void 0)for(const P in x.defines)w.push(P),w.push(x.defines[P]);return x.isRawShaderMaterial===!1&&(y(w,x),_(w,x),w.push(i.outputColorSpace)),w.push(x.customProgramCacheKey),w.join()}function y(x,w){x.push(w.precision),x.push(w.outputColorSpace),x.push(w.envMapMode),x.push(w.envMapCubeUVHeight),x.push(w.mapUv),x.push(w.alphaMapUv),x.push(w.lightMapUv),x.push(w.aoMapUv),x.push(w.bumpMapUv),x.push(w.normalMapUv),x.push(w.displacementMapUv),x.push(w.emissiveMapUv),x.push(w.metalnessMapUv),x.push(w.roughnessMapUv),x.push(w.anisotropyMapUv),x.push(w.clearcoatMapUv),x.push(w.clearcoatNormalMapUv),x.push(w.clearcoatRoughnessMapUv),x.push(w.iridescenceMapUv),x.push(w.iridescenceThicknessMapUv),x.push(w.sheenColorMapUv),x.push(w.sheenRoughnessMapUv),x.push(w.specularMapUv),x.push(w.specularColorMapUv),x.push(w.specularIntensityMapUv),x.push(w.transmissionMapUv),x.push(w.thicknessMapUv),x.push(w.combine),x.push(w.fogExp2),x.push(w.sizeAttenuation),x.push(w.morphTargetsCount),x.push(w.morphAttributeCount),x.push(w.numDirLights),x.push(w.numPointLights),x.push(w.numSpotLights),x.push(w.numSpotLightMaps),x.push(w.numHemiLights),x.push(w.numRectAreaLights),x.push(w.numDirLightShadows),x.push(w.numPointLightShadows),x.push(w.numSpotLightShadows),x.push(w.numSpotLightShadowsWithMaps),x.push(w.numLightProbes),x.push(w.shadowMapType),x.push(w.toneMapping),x.push(w.numClippingPlanes),x.push(w.numClipIntersection),x.push(w.depthPacking)}function _(x,w){a.disableAll(),w.supportsVertexTextures&&a.enable(0),w.instancing&&a.enable(1),w.instancingColor&&a.enable(2),w.instancingMorph&&a.enable(3),w.matcap&&a.enable(4),w.envMap&&a.enable(5),w.normalMapObjectSpace&&a.enable(6),w.normalMapTangentSpace&&a.enable(7),w.clearcoat&&a.enable(8),w.iridescence&&a.enable(9),w.alphaTest&&a.enable(10),w.vertexColors&&a.enable(11),w.vertexAlphas&&a.enable(12),w.vertexUv1s&&a.enable(13),w.vertexUv2s&&a.enable(14),w.vertexUv3s&&a.enable(15),w.vertexTangents&&a.enable(16),w.anisotropy&&a.enable(17),w.alphaHash&&a.enable(18),w.batching&&a.enable(19),w.dispersion&&a.enable(20),w.batchingColor&&a.enable(21),x.push(a.mask),a.disableAll(),w.fog&&a.enable(0),w.useFog&&a.enable(1),w.flatShading&&a.enable(2),w.logarithmicDepthBuffer&&a.enable(3),w.reverseDepthBuffer&&a.enable(4),w.skinning&&a.enable(5),w.morphTargets&&a.enable(6),w.morphNormals&&a.enable(7),w.morphColors&&a.enable(8),w.premultipliedAlpha&&a.enable(9),w.shadowMapEnabled&&a.enable(10),w.doubleSided&&a.enable(11),w.flipSided&&a.enable(12),w.useDepthPacking&&a.enable(13),w.dithering&&a.enable(14),w.transmission&&a.enable(15),w.sheen&&a.enable(16),w.opaque&&a.enable(17),w.pointsUvs&&a.enable(18),w.decodeVideoTexture&&a.enable(19),w.decodeVideoTextureEmissive&&a.enable(20),w.alphaToCoverage&&a.enable(21),x.push(a.mask)}function v(x){const w=p[x.type];let P;if(w){const z=Fs[w];P=m1.clone(z.uniforms)}else P=x.uniforms;return P}function b(x,w){let P;for(let z=0,H=h.length;z<H;z++){const K=h[z];if(K.cacheKey===w){P=K,++P.usedTimes;break}}return P===void 0&&(P=new ZL(i,w,x,r),h.push(P)),P}function T(x){if(--x.usedTimes===0){const w=h.indexOf(x);h[w]=h[h.length-1],h.pop(),x.destroy()}}function L(x){l.remove(x)}function I(){l.dispose()}return{getParameters:m,getProgramCacheKey:g,getUniforms:v,acquireProgram:b,releaseProgram:T,releaseShaderCache:L,programs:h,dispose:I}}function s2(){let i=new WeakMap;function e(o){return i.has(o)}function t(o){let a=i.get(o);return a===void 0&&(a={},i.set(o,a)),a}function n(o){i.delete(o)}function s(o,a,l){i.get(o)[a]=l}function r(){i=new WeakMap}return{has:e,get:t,remove:n,update:s,dispose:r}}function r2(i,e){return i.groupOrder!==e.groupOrder?i.groupOrder-e.groupOrder:i.renderOrder!==e.renderOrder?i.renderOrder-e.renderOrder:i.material.id!==e.material.id?i.material.id-e.material.id:i.z!==e.z?i.z-e.z:i.id-e.id}function b0(i,e){return i.groupOrder!==e.groupOrder?i.groupOrder-e.groupOrder:i.renderOrder!==e.renderOrder?i.renderOrder-e.renderOrder:i.z!==e.z?e.z-i.z:i.id-e.id}function E0(){const i=[];let e=0;const t=[],n=[],s=[];function r(){e=0,t.length=0,n.length=0,s.length=0}function o(u,d,f,p,A,m){let g=i[e];return g===void 0?(g={id:u.id,object:u,geometry:d,material:f,groupOrder:p,renderOrder:u.renderOrder,z:A,group:m},i[e]=g):(g.id=u.id,g.object=u,g.geometry=d,g.material=f,g.groupOrder=p,g.renderOrder=u.renderOrder,g.z=A,g.group=m),e++,g}function a(u,d,f,p,A,m){const g=o(u,d,f,p,A,m);f.transmission>0?n.push(g):f.transparent===!0?s.push(g):t.push(g)}function l(u,d,f,p,A,m){const g=o(u,d,f,p,A,m);f.transmission>0?n.unshift(g):f.transparent===!0?s.unshift(g):t.unshift(g)}function c(u,d){t.length>1&&t.sort(u||r2),n.length>1&&n.sort(d||b0),s.length>1&&s.sort(d||b0)}function h(){for(let u=e,d=i.length;u<d;u++){const f=i[u];if(f.id===null)break;f.id=null,f.object=null,f.geometry=null,f.material=null,f.group=null}}return{opaque:t,transmissive:n,transparent:s,init:r,push:a,unshift:l,finish:h,sort:c}}function o2(){let i=new WeakMap;function e(n,s){const r=i.get(n);let o;return r===void 0?(o=new E0,i.set(n,[o])):s>=r.length?(o=new E0,r.push(o)):o=r[s],o}function t(){i=new WeakMap}return{get:e,dispose:t}}function a2(){const i={};return{get:function(e){if(i[e.id]!==void 0)return i[e.id];let t;switch(e.type){case"DirectionalLight":t={direction:new he,color:new at};break;case"SpotLight":t={position:new he,direction:new he,color:new at,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":t={position:new he,color:new at,distance:0,decay:0};break;case"HemisphereLight":t={direction:new he,skyColor:new at,groundColor:new at};break;case"RectAreaLight":t={color:new at,position:new he,halfWidth:new he,halfHeight:new he};break}return i[e.id]=t,t}}}function l2(){const i={};return{get:function(e){if(i[e.id]!==void 0)return i[e.id];let t;switch(e.type){case"DirectionalLight":t={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Me};break;case"SpotLight":t={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Me};break;case"PointLight":t={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Me,shadowCameraNear:1,shadowCameraFar:1e3};break}return i[e.id]=t,t}}}let c2=0;function h2(i,e){return(e.castShadow?2:0)-(i.castShadow?2:0)+(e.map?1:0)-(i.map?1:0)}function u2(i){const e=new a2,t=l2(),n={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let c=0;c<9;c++)n.probe.push(new he);const s=new he,r=new pt,o=new pt;function a(c){let h=0,u=0,d=0;for(let x=0;x<9;x++)n.probe[x].set(0,0,0);let f=0,p=0,A=0,m=0,g=0,y=0,_=0,v=0,b=0,T=0,L=0;c.sort(h2);for(let x=0,w=c.length;x<w;x++){const P=c[x],z=P.color,H=P.intensity,K=P.distance,le=P.shadow&&P.shadow.map?P.shadow.map.texture:null;if(P.isAmbientLight)h+=z.r*H,u+=z.g*H,d+=z.b*H;else if(P.isLightProbe){for(let J=0;J<9;J++)n.probe[J].addScaledVector(P.sh.coefficients[J],H);L++}else if(P.isDirectionalLight){const J=e.get(P);if(J.color.copy(P.color).multiplyScalar(P.intensity),P.castShadow){const W=P.shadow,O=t.get(P);O.shadowIntensity=W.intensity,O.shadowBias=W.bias,O.shadowNormalBias=W.normalBias,O.shadowRadius=W.radius,O.shadowMapSize=W.mapSize,n.directionalShadow[f]=O,n.directionalShadowMap[f]=le,n.directionalShadowMatrix[f]=P.shadow.matrix,y++}n.directional[f]=J,f++}else if(P.isSpotLight){const J=e.get(P);J.position.setFromMatrixPosition(P.matrixWorld),J.color.copy(z).multiplyScalar(H),J.distance=K,J.coneCos=Math.cos(P.angle),J.penumbraCos=Math.cos(P.angle*(1-P.penumbra)),J.decay=P.decay,n.spot[A]=J;const W=P.shadow;if(P.map&&(n.spotLightMap[b]=P.map,b++,W.updateMatrices(P),P.castShadow&&T++),n.spotLightMatrix[A]=W.matrix,P.castShadow){const O=t.get(P);O.shadowIntensity=W.intensity,O.shadowBias=W.bias,O.shadowNormalBias=W.normalBias,O.shadowRadius=W.radius,O.shadowMapSize=W.mapSize,n.spotShadow[A]=O,n.spotShadowMap[A]=le,v++}A++}else if(P.isRectAreaLight){const J=e.get(P);J.color.copy(z).multiplyScalar(H),J.halfWidth.set(P.width*.5,0,0),J.halfHeight.set(0,P.height*.5,0),n.rectArea[m]=J,m++}else if(P.isPointLight){const J=e.get(P);if(J.color.copy(P.color).multiplyScalar(P.intensity),J.distance=P.distance,J.decay=P.decay,P.castShadow){const W=P.shadow,O=t.get(P);O.shadowIntensity=W.intensity,O.shadowBias=W.bias,O.shadowNormalBias=W.normalBias,O.shadowRadius=W.radius,O.shadowMapSize=W.mapSize,O.shadowCameraNear=W.camera.near,O.shadowCameraFar=W.camera.far,n.pointShadow[p]=O,n.pointShadowMap[p]=le,n.pointShadowMatrix[p]=P.shadow.matrix,_++}n.point[p]=J,p++}else if(P.isHemisphereLight){const J=e.get(P);J.skyColor.copy(P.color).multiplyScalar(H),J.groundColor.copy(P.groundColor).multiplyScalar(H),n.hemi[g]=J,g++}}m>0&&(i.has("OES_texture_float_linear")===!0?(n.rectAreaLTC1=st.LTC_FLOAT_1,n.rectAreaLTC2=st.LTC_FLOAT_2):(n.rectAreaLTC1=st.LTC_HALF_1,n.rectAreaLTC2=st.LTC_HALF_2)),n.ambient[0]=h,n.ambient[1]=u,n.ambient[2]=d;const I=n.hash;(I.directionalLength!==f||I.pointLength!==p||I.spotLength!==A||I.rectAreaLength!==m||I.hemiLength!==g||I.numDirectionalShadows!==y||I.numPointShadows!==_||I.numSpotShadows!==v||I.numSpotMaps!==b||I.numLightProbes!==L)&&(n.directional.length=f,n.spot.length=A,n.rectArea.length=m,n.point.length=p,n.hemi.length=g,n.directionalShadow.length=y,n.directionalShadowMap.length=y,n.pointShadow.length=_,n.pointShadowMap.length=_,n.spotShadow.length=v,n.spotShadowMap.length=v,n.directionalShadowMatrix.length=y,n.pointShadowMatrix.length=_,n.spotLightMatrix.length=v+b-T,n.spotLightMap.length=b,n.numSpotLightShadowsWithMaps=T,n.numLightProbes=L,I.directionalLength=f,I.pointLength=p,I.spotLength=A,I.rectAreaLength=m,I.hemiLength=g,I.numDirectionalShadows=y,I.numPointShadows=_,I.numSpotShadows=v,I.numSpotMaps=b,I.numLightProbes=L,n.version=c2++)}function l(c,h){let u=0,d=0,f=0,p=0,A=0;const m=h.matrixWorldInverse;for(let g=0,y=c.length;g<y;g++){const _=c[g];if(_.isDirectionalLight){const v=n.directional[u];v.direction.setFromMatrixPosition(_.matrixWorld),s.setFromMatrixPosition(_.target.matrixWorld),v.direction.sub(s),v.direction.transformDirection(m),u++}else if(_.isSpotLight){const v=n.spot[f];v.position.setFromMatrixPosition(_.matrixWorld),v.position.applyMatrix4(m),v.direction.setFromMatrixPosition(_.matrixWorld),s.setFromMatrixPosition(_.target.matrixWorld),v.direction.sub(s),v.direction.transformDirection(m),f++}else if(_.isRectAreaLight){const v=n.rectArea[p];v.position.setFromMatrixPosition(_.matrixWorld),v.position.applyMatrix4(m),o.identity(),r.copy(_.matrixWorld),r.premultiply(m),o.extractRotation(r),v.halfWidth.set(_.width*.5,0,0),v.halfHeight.set(0,_.height*.5,0),v.halfWidth.applyMatrix4(o),v.halfHeight.applyMatrix4(o),p++}else if(_.isPointLight){const v=n.point[d];v.position.setFromMatrixPosition(_.matrixWorld),v.position.applyMatrix4(m),d++}else if(_.isHemisphereLight){const v=n.hemi[A];v.direction.setFromMatrixPosition(_.matrixWorld),v.direction.transformDirection(m),A++}}}return{setup:a,setupView:l,state:n}}function C0(i){const e=new u2(i),t=[],n=[];function s(h){c.camera=h,t.length=0,n.length=0}function r(h){t.push(h)}function o(h){n.push(h)}function a(){e.setup(t)}function l(h){e.setupView(t,h)}const c={lightsArray:t,shadowsArray:n,camera:null,lights:e,transmissionRenderTarget:{}};return{init:s,state:c,setupLights:a,setupLightsView:l,pushLight:r,pushShadow:o}}function d2(i){let e=new WeakMap;function t(s,r=0){const o=e.get(s);let a;return o===void 0?(a=new C0(i),e.set(s,[a])):r>=o.length?(a=new C0(i),o.push(a)):a=o[r],a}function n(){e=new WeakMap}return{get:t,dispose:n}}const f2="void main() {\n	gl_Position = vec4( position, 1.0 );\n}",p2="uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n	const float samples = float( VSM_SAMPLES );\n	float mean = 0.0;\n	float squared_mean = 0.0;\n	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );\n	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;\n	for ( float i = 0.0; i < samples; i ++ ) {\n		float uvOffset = uvStart + i * uvStride;\n		#ifdef HORIZONTAL_PASS\n			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );\n			mean += distribution.x;\n			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n		#else\n			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );\n			mean += depth;\n			squared_mean += depth * depth;\n		#endif\n	}\n	mean = mean / samples;\n	squared_mean = squared_mean / samples;\n	float std_dev = sqrt( squared_mean - mean * mean );\n	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}";function m2(i,e,t){let n=new fg;const s=new Me,r=new Me,o=new Ot,a=new uB({depthPacking:xT}),l=new dB,c={},h=t.maxTextureSize,u={[yr]:Ti,[Ti]:yr,[Ns]:Ns},d=new co({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new Me},radius:{value:4}},vertexShader:f2,fragmentShader:p2}),f=d.clone();f.defines.HORIZONTAL_PASS=1;const p=new Nn;p.setAttribute("position",new Zn(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const A=new $n(p,d),m=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=Aw;let g=this.type;this.render=function(T,L,I){if(m.enabled===!1||m.autoUpdate===!1&&m.needsUpdate===!1||T.length===0)return;const x=i.getRenderTarget(),w=i.getActiveCubeFace(),P=i.getActiveMipmapLevel(),z=i.state;z.setBlending(eo),z.buffers.color.setClear(1,1,1,1),z.buffers.depth.setTest(!0),z.setScissorTest(!1);const H=g!==rr&&this.type===rr,K=g===rr&&this.type!==rr;for(let le=0,J=T.length;le<J;le++){const W=T[le],O=W.shadow;if(O===void 0){console.warn("THREE.WebGLShadowMap:",W,"has no shadow.");continue}if(O.autoUpdate===!1&&O.needsUpdate===!1)continue;s.copy(O.mapSize);const fe=O.getFrameExtents();if(s.multiply(fe),r.copy(O.mapSize),(s.x>h||s.y>h)&&(s.x>h&&(r.x=Math.floor(h/fe.x),s.x=r.x*fe.x,O.mapSize.x=r.x),s.y>h&&(r.y=Math.floor(h/fe.y),s.y=r.y*fe.y,O.mapSize.y=r.y)),O.map===null||H===!0||K===!0){const ee=this.type!==rr?{minFilter:yi,magFilter:yi}:{};O.map!==null&&O.map.dispose(),O.map=new na(s.x,s.y,ee),O.map.texture.name=W.name+".shadowMap",O.camera.updateProjectionMatrix()}i.setRenderTarget(O.map),i.clear();const ue=O.getViewportCount();for(let ee=0;ee<ue;ee++){const de=O.getViewport(ee);o.set(r.x*de.x,r.y*de.y,r.x*de.z,r.y*de.w),z.viewport(o),O.updateMatrices(W,ee),n=O.getFrustum(),v(L,I,O.camera,W,this.type)}O.isPointLightShadow!==!0&&this.type===rr&&y(O,I),O.needsUpdate=!1}g=this.type,m.needsUpdate=!1,i.setRenderTarget(x,w,P)};function y(T,L){const I=e.update(A);d.defines.VSM_SAMPLES!==T.blurSamples&&(d.defines.VSM_SAMPLES=T.blurSamples,f.defines.VSM_SAMPLES=T.blurSamples,d.needsUpdate=!0,f.needsUpdate=!0),T.mapPass===null&&(T.mapPass=new na(s.x,s.y)),d.uniforms.shadow_pass.value=T.map.texture,d.uniforms.resolution.value=T.mapSize,d.uniforms.radius.value=T.radius,i.setRenderTarget(T.mapPass),i.clear(),i.renderBufferDirect(L,null,I,d,A,null),f.uniforms.shadow_pass.value=T.mapPass.texture,f.uniforms.resolution.value=T.mapSize,f.uniforms.radius.value=T.radius,i.setRenderTarget(T.map),i.clear(),i.renderBufferDirect(L,null,I,f,A,null)}function _(T,L,I,x){let w=null;const P=I.isPointLight===!0?T.customDistanceMaterial:T.customDepthMaterial;if(P!==void 0)w=P;else if(w=I.isPointLight===!0?l:a,i.localClippingEnabled&&L.clipShadows===!0&&Array.isArray(L.clippingPlanes)&&L.clippingPlanes.length!==0||L.displacementMap&&L.displacementScale!==0||L.alphaMap&&L.alphaTest>0||L.map&&L.alphaTest>0){const z=w.uuid,H=L.uuid;let K=c[z];K===void 0&&(K={},c[z]=K);let le=K[H];le===void 0&&(le=w.clone(),K[H]=le,L.addEventListener("dispose",b)),w=le}if(w.visible=L.visible,w.wireframe=L.wireframe,x===rr?w.side=L.shadowSide!==null?L.shadowSide:L.side:w.side=L.shadowSide!==null?L.shadowSide:u[L.side],w.alphaMap=L.alphaMap,w.alphaTest=L.alphaTest,w.map=L.map,w.clipShadows=L.clipShadows,w.clippingPlanes=L.clippingPlanes,w.clipIntersection=L.clipIntersection,w.displacementMap=L.displacementMap,w.displacementScale=L.displacementScale,w.displacementBias=L.displacementBias,w.wireframeLinewidth=L.wireframeLinewidth,w.linewidth=L.linewidth,I.isPointLight===!0&&w.isMeshDistanceMaterial===!0){const z=i.properties.get(w);z.light=I}return w}function v(T,L,I,x,w){if(T.visible===!1)return;if(T.layers.test(L.layers)&&(T.isMesh||T.isLine||T.isPoints)&&(T.castShadow||T.receiveShadow&&w===rr)&&(!T.frustumCulled||n.intersectsObject(T))){T.modelViewMatrix.multiplyMatrices(I.matrixWorldInverse,T.matrixWorld);const H=e.update(T),K=T.material;if(Array.isArray(K)){const le=H.groups;for(let J=0,W=le.length;J<W;J++){const O=le[J],fe=K[O.materialIndex];if(fe&&fe.visible){const ue=_(T,fe,x,w);T.onBeforeShadow(i,T,L,I,H,ue,O),i.renderBufferDirect(I,null,H,ue,T,O),T.onAfterShadow(i,T,L,I,H,ue,O)}}}else if(K.visible){const le=_(T,K,x,w);T.onBeforeShadow(i,T,L,I,H,le,null),i.renderBufferDirect(I,null,H,le,T,null),T.onAfterShadow(i,T,L,I,H,le,null)}}const z=T.children;for(let H=0,K=z.length;H<K;H++)v(z[H],L,I,x,w)}function b(T){T.target.removeEventListener("dispose",b);for(const I in c){const x=c[I],w=T.target.uuid;w in x&&(x[w].dispose(),delete x[w])}}}const A2={[vm]:_m,[ym]:bm,[xm]:Em,[Al]:wm,[_m]:vm,[bm]:ym,[Em]:xm,[wm]:Al};function g2(i,e){function t(){let ge=!1;const be=new Ot;let Ce=null;const Le=new Ot(0,0,0,0);return{setMask:function(et){Ce!==et&&!ge&&(i.colorMask(et,et,et,et),Ce=et)},setLocked:function(et){ge=et},setClear:function(et,Ze,_t,Ht,dn){dn===!0&&(et*=Ht,Ze*=Ht,_t*=Ht),be.set(et,Ze,_t,Ht),Le.equals(be)===!1&&(i.clearColor(et,Ze,_t,Ht),Le.copy(be))},reset:function(){ge=!1,Ce=null,Le.set(-1,0,0,0)}}}function n(){let ge=!1,be=!1,Ce=null,Le=null,et=null;return{setReversed:function(Ze){if(be!==Ze){const _t=e.get("EXT_clip_control");be?_t.clipControlEXT(_t.LOWER_LEFT_EXT,_t.ZERO_TO_ONE_EXT):_t.clipControlEXT(_t.LOWER_LEFT_EXT,_t.NEGATIVE_ONE_TO_ONE_EXT);const Ht=et;et=null,this.setClear(Ht)}be=Ze},getReversed:function(){return be},setTest:function(Ze){Ze?D(i.DEPTH_TEST):te(i.DEPTH_TEST)},setMask:function(Ze){Ce!==Ze&&!ge&&(i.depthMask(Ze),Ce=Ze)},setFunc:function(Ze){if(be&&(Ze=A2[Ze]),Le!==Ze){switch(Ze){case vm:i.depthFunc(i.NEVER);break;case _m:i.depthFunc(i.ALWAYS);break;case ym:i.depthFunc(i.LESS);break;case Al:i.depthFunc(i.LEQUAL);break;case xm:i.depthFunc(i.EQUAL);break;case wm:i.depthFunc(i.GEQUAL);break;case bm:i.depthFunc(i.GREATER);break;case Em:i.depthFunc(i.NOTEQUAL);break;default:i.depthFunc(i.LEQUAL)}Le=Ze}},setLocked:function(Ze){ge=Ze},setClear:function(Ze){et!==Ze&&(be&&(Ze=1-Ze),i.clearDepth(Ze),et=Ze)},reset:function(){ge=!1,Ce=null,Le=null,et=null,be=!1}}}function s(){let ge=!1,be=null,Ce=null,Le=null,et=null,Ze=null,_t=null,Ht=null,dn=null;return{setTest:function(yt){ge||(yt?D(i.STENCIL_TEST):te(i.STENCIL_TEST))},setMask:function(yt){be!==yt&&!ge&&(i.stencilMask(yt),be=yt)},setFunc:function(yt,Se,Be){(Ce!==yt||Le!==Se||et!==Be)&&(i.stencilFunc(yt,Se,Be),Ce=yt,Le=Se,et=Be)},setOp:function(yt,Se,Be){(Ze!==yt||_t!==Se||Ht!==Be)&&(i.stencilOp(yt,Se,Be),Ze=yt,_t=Se,Ht=Be)},setLocked:function(yt){ge=yt},setClear:function(yt){dn!==yt&&(i.clearStencil(yt),dn=yt)},reset:function(){ge=!1,be=null,Ce=null,Le=null,et=null,Ze=null,_t=null,Ht=null,dn=null}}}const r=new t,o=new n,a=new s,l=new WeakMap,c=new WeakMap;let h={},u={},d=new WeakMap,f=[],p=null,A=!1,m=null,g=null,y=null,_=null,v=null,b=null,T=null,L=new at(0,0,0),I=0,x=!1,w=null,P=null,z=null,H=null,K=null;const le=i.getParameter(i.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let J=!1,W=0;const O=i.getParameter(i.VERSION);O.indexOf("WebGL")!==-1?(W=parseFloat(/^WebGL (\d)/.exec(O)[1]),J=W>=1):O.indexOf("OpenGL ES")!==-1&&(W=parseFloat(/^OpenGL ES (\d)/.exec(O)[1]),J=W>=2);let fe=null,ue={};const ee=i.getParameter(i.SCISSOR_BOX),de=i.getParameter(i.VIEWPORT),ae=new Ot().fromArray(ee),R=new Ot().fromArray(de);function M(ge,be,Ce,Le){const et=new Uint8Array(4),Ze=i.createTexture();i.bindTexture(ge,Ze),i.texParameteri(ge,i.TEXTURE_MIN_FILTER,i.NEAREST),i.texParameteri(ge,i.TEXTURE_MAG_FILTER,i.NEAREST);for(let _t=0;_t<Ce;_t++)ge===i.TEXTURE_3D||ge===i.TEXTURE_2D_ARRAY?i.texImage3D(be,0,i.RGBA,1,1,Le,0,i.RGBA,i.UNSIGNED_BYTE,et):i.texImage2D(be+_t,0,i.RGBA,1,1,0,i.RGBA,i.UNSIGNED_BYTE,et);return Ze}const B={};B[i.TEXTURE_2D]=M(i.TEXTURE_2D,i.TEXTURE_2D,1),B[i.TEXTURE_CUBE_MAP]=M(i.TEXTURE_CUBE_MAP,i.TEXTURE_CUBE_MAP_POSITIVE_X,6),B[i.TEXTURE_2D_ARRAY]=M(i.TEXTURE_2D_ARRAY,i.TEXTURE_2D_ARRAY,1,1),B[i.TEXTURE_3D]=M(i.TEXTURE_3D,i.TEXTURE_3D,1,1),r.setClear(0,0,0,1),o.setClear(1),a.setClear(0),D(i.DEPTH_TEST),o.setFunc(Al),q(!1),ce(n_),D(i.CULL_FACE),E(eo);function D(ge){h[ge]!==!0&&(i.enable(ge),h[ge]=!0)}function te(ge){h[ge]!==!1&&(i.disable(ge),h[ge]=!1)}function ie(ge,be){return u[ge]!==be?(i.bindFramebuffer(ge,be),u[ge]=be,ge===i.DRAW_FRAMEBUFFER&&(u[i.FRAMEBUFFER]=be),ge===i.FRAMEBUFFER&&(u[i.DRAW_FRAMEBUFFER]=be),!0):!1}function Z(ge,be){let Ce=f,Le=!1;if(ge){Ce=d.get(be),Ce===void 0&&(Ce=[],d.set(be,Ce));const et=ge.textures;if(Ce.length!==et.length||Ce[0]!==i.COLOR_ATTACHMENT0){for(let Ze=0,_t=et.length;Ze<_t;Ze++)Ce[Ze]=i.COLOR_ATTACHMENT0+Ze;Ce.length=et.length,Le=!0}}else Ce[0]!==i.BACK&&(Ce[0]=i.BACK,Le=!0);Le&&i.drawBuffers(Ce)}function me(ge){return p!==ge?(i.useProgram(ge),p=ge,!0):!1}const F={[Oo]:i.FUNC_ADD,[qM]:i.FUNC_SUBTRACT,[jM]:i.FUNC_REVERSE_SUBTRACT};F[XM]=i.MIN,F[YM]=i.MAX;const Q={[KM]:i.ZERO,[$M]:i.ONE,[JM]:i.SRC_COLOR,[Am]:i.SRC_ALPHA,[sT]:i.SRC_ALPHA_SATURATE,[nT]:i.DST_COLOR,[eT]:i.DST_ALPHA,[ZM]:i.ONE_MINUS_SRC_COLOR,[gm]:i.ONE_MINUS_SRC_ALPHA,[iT]:i.ONE_MINUS_DST_COLOR,[tT]:i.ONE_MINUS_DST_ALPHA,[rT]:i.CONSTANT_COLOR,[oT]:i.ONE_MINUS_CONSTANT_COLOR,[aT]:i.CONSTANT_ALPHA,[lT]:i.ONE_MINUS_CONSTANT_ALPHA};function E(ge,be,Ce,Le,et,Ze,_t,Ht,dn,yt){if(ge===eo){A===!0&&(te(i.BLEND),A=!1);return}if(A===!1&&(D(i.BLEND),A=!0),ge!==WM){if(ge!==m||yt!==x){if((g!==Oo||v!==Oo)&&(i.blendEquation(i.FUNC_ADD),g=Oo,v=Oo),yt)switch(ge){case il:i.blendFuncSeparate(i.ONE,i.ONE_MINUS_SRC_ALPHA,i.ONE,i.ONE_MINUS_SRC_ALPHA);break;case i_:i.blendFunc(i.ONE,i.ONE);break;case s_:i.blendFuncSeparate(i.ZERO,i.ONE_MINUS_SRC_COLOR,i.ZERO,i.ONE);break;case r_:i.blendFuncSeparate(i.ZERO,i.SRC_COLOR,i.ZERO,i.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",ge);break}else switch(ge){case il:i.blendFuncSeparate(i.SRC_ALPHA,i.ONE_MINUS_SRC_ALPHA,i.ONE,i.ONE_MINUS_SRC_ALPHA);break;case i_:i.blendFunc(i.SRC_ALPHA,i.ONE);break;case s_:i.blendFuncSeparate(i.ZERO,i.ONE_MINUS_SRC_COLOR,i.ZERO,i.ONE);break;case r_:i.blendFunc(i.ZERO,i.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",ge);break}y=null,_=null,b=null,T=null,L.set(0,0,0),I=0,m=ge,x=yt}return}et=et||be,Ze=Ze||Ce,_t=_t||Le,(be!==g||et!==v)&&(i.blendEquationSeparate(F[be],F[et]),g=be,v=et),(Ce!==y||Le!==_||Ze!==b||_t!==T)&&(i.blendFuncSeparate(Q[Ce],Q[Le],Q[Ze],Q[_t]),y=Ce,_=Le,b=Ze,T=_t),(Ht.equals(L)===!1||dn!==I)&&(i.blendColor(Ht.r,Ht.g,Ht.b,dn),L.copy(Ht),I=dn),m=ge,x=!1}function j(ge,be){ge.side===Ns?te(i.CULL_FACE):D(i.CULL_FACE);let Ce=ge.side===Ti;be&&(Ce=!Ce),q(Ce),ge.blending===il&&ge.transparent===!1?E(eo):E(ge.blending,ge.blendEquation,ge.blendSrc,ge.blendDst,ge.blendEquationAlpha,ge.blendSrcAlpha,ge.blendDstAlpha,ge.blendColor,ge.blendAlpha,ge.premultipliedAlpha),o.setFunc(ge.depthFunc),o.setTest(ge.depthTest),o.setMask(ge.depthWrite),r.setMask(ge.colorWrite);const Le=ge.stencilWrite;a.setTest(Le),Le&&(a.setMask(ge.stencilWriteMask),a.setFunc(ge.stencilFunc,ge.stencilRef,ge.stencilFuncMask),a.setOp(ge.stencilFail,ge.stencilZFail,ge.stencilZPass)),V(ge.polygonOffset,ge.polygonOffsetFactor,ge.polygonOffsetUnits),ge.alphaToCoverage===!0?D(i.SAMPLE_ALPHA_TO_COVERAGE):te(i.SAMPLE_ALPHA_TO_COVERAGE)}function q(ge){w!==ge&&(ge?i.frontFace(i.CW):i.frontFace(i.CCW),w=ge)}function ce(ge){ge!==GM?(D(i.CULL_FACE),ge!==P&&(ge===n_?i.cullFace(i.BACK):ge===HM?i.cullFace(i.FRONT):i.cullFace(i.FRONT_AND_BACK))):te(i.CULL_FACE),P=ge}function G(ge){ge!==z&&(J&&i.lineWidth(ge),z=ge)}function V(ge,be,Ce){ge?(D(i.POLYGON_OFFSET_FILL),(H!==be||K!==Ce)&&(i.polygonOffset(be,Ce),H=be,K=Ce)):te(i.POLYGON_OFFSET_FILL)}function re(ge){ge?D(i.SCISSOR_TEST):te(i.SCISSOR_TEST)}function k(ge){ge===void 0&&(ge=i.TEXTURE0+le-1),fe!==ge&&(i.activeTexture(ge),fe=ge)}function N(ge,be,Ce){Ce===void 0&&(fe===null?Ce=i.TEXTURE0+le-1:Ce=fe);let Le=ue[Ce];Le===void 0&&(Le={type:void 0,texture:void 0},ue[Ce]=Le),(Le.type!==ge||Le.texture!==be)&&(fe!==Ce&&(i.activeTexture(Ce),fe=Ce),i.bindTexture(ge,be||B[ge]),Le.type=ge,Le.texture=be)}function oe(){const ge=ue[fe];ge!==void 0&&ge.type!==void 0&&(i.bindTexture(ge.type,null),ge.type=void 0,ge.texture=void 0)}function pe(){try{i.compressedTexImage2D.apply(i,arguments)}catch(ge){console.error("THREE.WebGLState:",ge)}}function ve(){try{i.compressedTexImage3D.apply(i,arguments)}catch(ge){console.error("THREE.WebGLState:",ge)}}function xe(){try{i.texSubImage2D.apply(i,arguments)}catch(ge){console.error("THREE.WebGLState:",ge)}}function Pe(){try{i.texSubImage3D.apply(i,arguments)}catch(ge){console.error("THREE.WebGLState:",ge)}}function Te(){try{i.compressedTexSubImage2D.apply(i,arguments)}catch(ge){console.error("THREE.WebGLState:",ge)}}function Qe(){try{i.compressedTexSubImage3D.apply(i,arguments)}catch(ge){console.error("THREE.WebGLState:",ge)}}function lt(){try{i.texStorage2D.apply(i,arguments)}catch(ge){console.error("THREE.WebGLState:",ge)}}function Ne(){try{i.texStorage3D.apply(i,arguments)}catch(ge){console.error("THREE.WebGLState:",ge)}}function qe(){try{i.texImage2D.apply(i,arguments)}catch(ge){console.error("THREE.WebGLState:",ge)}}function Ke(){try{i.texImage3D.apply(i,arguments)}catch(ge){console.error("THREE.WebGLState:",ge)}}function it(ge){ae.equals(ge)===!1&&(i.scissor(ge.x,ge.y,ge.z,ge.w),ae.copy(ge))}function je(ge){R.equals(ge)===!1&&(i.viewport(ge.x,ge.y,ge.z,ge.w),R.copy(ge))}function dt(ge,be){let Ce=c.get(be);Ce===void 0&&(Ce=new WeakMap,c.set(be,Ce));let Le=Ce.get(ge);Le===void 0&&(Le=i.getUniformBlockIndex(be,ge.name),Ce.set(ge,Le))}function ct(ge,be){const Le=c.get(be).get(ge);l.get(be)!==Le&&(i.uniformBlockBinding(be,Le,ge.__bindingPointIndex),l.set(be,Le))}function At(){i.disable(i.BLEND),i.disable(i.CULL_FACE),i.disable(i.DEPTH_TEST),i.disable(i.POLYGON_OFFSET_FILL),i.disable(i.SCISSOR_TEST),i.disable(i.STENCIL_TEST),i.disable(i.SAMPLE_ALPHA_TO_COVERAGE),i.blendEquation(i.FUNC_ADD),i.blendFunc(i.ONE,i.ZERO),i.blendFuncSeparate(i.ONE,i.ZERO,i.ONE,i.ZERO),i.blendColor(0,0,0,0),i.colorMask(!0,!0,!0,!0),i.clearColor(0,0,0,0),i.depthMask(!0),i.depthFunc(i.LESS),o.setReversed(!1),i.clearDepth(1),i.stencilMask(4294967295),i.stencilFunc(i.ALWAYS,0,4294967295),i.stencilOp(i.KEEP,i.KEEP,i.KEEP),i.clearStencil(0),i.cullFace(i.BACK),i.frontFace(i.CCW),i.polygonOffset(0,0),i.activeTexture(i.TEXTURE0),i.bindFramebuffer(i.FRAMEBUFFER,null),i.bindFramebuffer(i.DRAW_FRAMEBUFFER,null),i.bindFramebuffer(i.READ_FRAMEBUFFER,null),i.useProgram(null),i.lineWidth(1),i.scissor(0,0,i.canvas.width,i.canvas.height),i.viewport(0,0,i.canvas.width,i.canvas.height),h={},fe=null,ue={},u={},d=new WeakMap,f=[],p=null,A=!1,m=null,g=null,y=null,_=null,v=null,b=null,T=null,L=new at(0,0,0),I=0,x=!1,w=null,P=null,z=null,H=null,K=null,ae.set(0,0,i.canvas.width,i.canvas.height),R.set(0,0,i.canvas.width,i.canvas.height),r.reset(),o.reset(),a.reset()}return{buffers:{color:r,depth:o,stencil:a},enable:D,disable:te,bindFramebuffer:ie,drawBuffers:Z,useProgram:me,setBlending:E,setMaterial:j,setFlipSided:q,setCullFace:ce,setLineWidth:G,setPolygonOffset:V,setScissorTest:re,activeTexture:k,bindTexture:N,unbindTexture:oe,compressedTexImage2D:pe,compressedTexImage3D:ve,texImage2D:qe,texImage3D:Ke,updateUBOMapping:dt,uniformBlockBinding:ct,texStorage2D:lt,texStorage3D:Ne,texSubImage2D:xe,texSubImage3D:Pe,compressedTexSubImage2D:Te,compressedTexSubImage3D:Qe,scissor:it,viewport:je,reset:At}}function v2(i,e,t,n,s,r,o){const a=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,l=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),c=new Me,h=new WeakMap;let u;const d=new WeakMap;let f=!1;try{f=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch(k){}function p(k,N){return f?new OffscreenCanvas(k,N):Yc("canvas")}function A(k,N,oe){let pe=1;const ve=re(k);if((ve.width>oe||ve.height>oe)&&(pe=oe/Math.max(ve.width,ve.height)),pe<1)if(typeof HTMLImageElement<"u"&&k instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&k instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&k instanceof ImageBitmap||typeof VideoFrame<"u"&&k instanceof VideoFrame){const xe=Math.floor(pe*ve.width),Pe=Math.floor(pe*ve.height);u===void 0&&(u=p(xe,Pe));const Te=N?p(xe,Pe):u;return Te.width=xe,Te.height=Pe,Te.getContext("2d").drawImage(k,0,0,xe,Pe),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+ve.width+"x"+ve.height+") to ("+xe+"x"+Pe+")."),Te}else return"data"in k&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+ve.width+"x"+ve.height+")."),k;return k}function m(k){return k.generateMipmaps}function g(k){i.generateMipmap(k)}function y(k){return k.isWebGLCubeRenderTarget?i.TEXTURE_CUBE_MAP:k.isWebGL3DRenderTarget?i.TEXTURE_3D:k.isWebGLArrayRenderTarget||k.isCompressedArrayTexture?i.TEXTURE_2D_ARRAY:i.TEXTURE_2D}function _(k,N,oe,pe,ve=!1){if(k!==null){if(i[k]!==void 0)return i[k];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+k+"'")}let xe=N;if(N===i.RED&&(oe===i.FLOAT&&(xe=i.R32F),oe===i.HALF_FLOAT&&(xe=i.R16F),oe===i.UNSIGNED_BYTE&&(xe=i.R8)),N===i.RED_INTEGER&&(oe===i.UNSIGNED_BYTE&&(xe=i.R8UI),oe===i.UNSIGNED_SHORT&&(xe=i.R16UI),oe===i.UNSIGNED_INT&&(xe=i.R32UI),oe===i.BYTE&&(xe=i.R8I),oe===i.SHORT&&(xe=i.R16I),oe===i.INT&&(xe=i.R32I)),N===i.RG&&(oe===i.FLOAT&&(xe=i.RG32F),oe===i.HALF_FLOAT&&(xe=i.RG16F),oe===i.UNSIGNED_BYTE&&(xe=i.RG8)),N===i.RG_INTEGER&&(oe===i.UNSIGNED_BYTE&&(xe=i.RG8UI),oe===i.UNSIGNED_SHORT&&(xe=i.RG16UI),oe===i.UNSIGNED_INT&&(xe=i.RG32UI),oe===i.BYTE&&(xe=i.RG8I),oe===i.SHORT&&(xe=i.RG16I),oe===i.INT&&(xe=i.RG32I)),N===i.RGB_INTEGER&&(oe===i.UNSIGNED_BYTE&&(xe=i.RGB8UI),oe===i.UNSIGNED_SHORT&&(xe=i.RGB16UI),oe===i.UNSIGNED_INT&&(xe=i.RGB32UI),oe===i.BYTE&&(xe=i.RGB8I),oe===i.SHORT&&(xe=i.RGB16I),oe===i.INT&&(xe=i.RGB32I)),N===i.RGBA_INTEGER&&(oe===i.UNSIGNED_BYTE&&(xe=i.RGBA8UI),oe===i.UNSIGNED_SHORT&&(xe=i.RGBA16UI),oe===i.UNSIGNED_INT&&(xe=i.RGBA32UI),oe===i.BYTE&&(xe=i.RGBA8I),oe===i.SHORT&&(xe=i.RGBA16I),oe===i.INT&&(xe=i.RGBA32I)),N===i.RGB&&oe===i.UNSIGNED_INT_5_9_9_9_REV&&(xe=i.RGB9_E5),N===i.RGBA){const Pe=ve?ld:St.getTransfer(pe);oe===i.FLOAT&&(xe=i.RGBA32F),oe===i.HALF_FLOAT&&(xe=i.RGBA16F),oe===i.UNSIGNED_BYTE&&(xe=Pe===Kt?i.SRGB8_ALPHA8:i.RGBA8),oe===i.UNSIGNED_SHORT_4_4_4_4&&(xe=i.RGBA4),oe===i.UNSIGNED_SHORT_5_5_5_1&&(xe=i.RGB5_A1)}return(xe===i.R16F||xe===i.R32F||xe===i.RG16F||xe===i.RG32F||xe===i.RGBA16F||xe===i.RGBA32F)&&e.get("EXT_color_buffer_float"),xe}function v(k,N){let oe;return k?N===null||N===ta||N===vl?oe=i.DEPTH24_STENCIL8:N===Sn?oe=i.DEPTH32F_STENCIL8:N===Hc&&(oe=i.DEPTH24_STENCIL8,console.warn("DepthTexture: 16 bit depth attachment is not supported with stencil. Using 24-bit attachment.")):N===null||N===ta||N===vl?oe=i.DEPTH_COMPONENT24:N===Sn?oe=i.DEPTH_COMPONENT32F:N===Hc&&(oe=i.DEPTH_COMPONENT16),oe}function b(k,N){return m(k)===!0||k.isFramebufferTexture&&k.minFilter!==yi&&k.minFilter!==Zt?Math.log2(Math.max(N.width,N.height))+1:k.mipmaps!==void 0&&k.mipmaps.length>0?k.mipmaps.length:k.isCompressedTexture&&Array.isArray(k.image)?N.mipmaps.length:1}function T(k){const N=k.target;N.removeEventListener("dispose",T),I(N),N.isVideoTexture&&h.delete(N)}function L(k){const N=k.target;N.removeEventListener("dispose",L),w(N)}function I(k){const N=n.get(k);if(N.__webglInit===void 0)return;const oe=k.source,pe=d.get(oe);if(pe){const ve=pe[N.__cacheKey];ve.usedTimes--,ve.usedTimes===0&&x(k),Object.keys(pe).length===0&&d.delete(oe)}n.remove(k)}function x(k){const N=n.get(k);i.deleteTexture(N.__webglTexture);const oe=k.source,pe=d.get(oe);delete pe[N.__cacheKey],o.memory.textures--}function w(k){const N=n.get(k);if(k.depthTexture&&(k.depthTexture.dispose(),n.remove(k.depthTexture)),k.isWebGLCubeRenderTarget)for(let pe=0;pe<6;pe++){if(Array.isArray(N.__webglFramebuffer[pe]))for(let ve=0;ve<N.__webglFramebuffer[pe].length;ve++)i.deleteFramebuffer(N.__webglFramebuffer[pe][ve]);else i.deleteFramebuffer(N.__webglFramebuffer[pe]);N.__webglDepthbuffer&&i.deleteRenderbuffer(N.__webglDepthbuffer[pe])}else{if(Array.isArray(N.__webglFramebuffer))for(let pe=0;pe<N.__webglFramebuffer.length;pe++)i.deleteFramebuffer(N.__webglFramebuffer[pe]);else i.deleteFramebuffer(N.__webglFramebuffer);if(N.__webglDepthbuffer&&i.deleteRenderbuffer(N.__webglDepthbuffer),N.__webglMultisampledFramebuffer&&i.deleteFramebuffer(N.__webglMultisampledFramebuffer),N.__webglColorRenderbuffer)for(let pe=0;pe<N.__webglColorRenderbuffer.length;pe++)N.__webglColorRenderbuffer[pe]&&i.deleteRenderbuffer(N.__webglColorRenderbuffer[pe]);N.__webglDepthRenderbuffer&&i.deleteRenderbuffer(N.__webglDepthRenderbuffer)}const oe=k.textures;for(let pe=0,ve=oe.length;pe<ve;pe++){const xe=n.get(oe[pe]);xe.__webglTexture&&(i.deleteTexture(xe.__webglTexture),o.memory.textures--),n.remove(oe[pe])}n.remove(k)}let P=0;function z(){P=0}function H(){const k=P;return k>=s.maxTextures&&console.warn("THREE.WebGLTextures: Trying to use "+k+" texture units while this GPU supports only "+s.maxTextures),P+=1,k}function K(k){const N=[];return N.push(k.wrapS),N.push(k.wrapT),N.push(k.wrapR||0),N.push(k.magFilter),N.push(k.minFilter),N.push(k.anisotropy),N.push(k.internalFormat),N.push(k.format),N.push(k.type),N.push(k.generateMipmaps),N.push(k.premultiplyAlpha),N.push(k.flipY),N.push(k.unpackAlignment),N.push(k.colorSpace),N.join()}function le(k,N){const oe=n.get(k);if(k.isVideoTexture&&G(k),k.isRenderTargetTexture===!1&&k.version>0&&oe.__version!==k.version){const pe=k.image;if(pe===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(pe.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{R(oe,k,N);return}}t.bindTexture(i.TEXTURE_2D,oe.__webglTexture,i.TEXTURE0+N)}function J(k,N){const oe=n.get(k);if(k.version>0&&oe.__version!==k.version){R(oe,k,N);return}t.bindTexture(i.TEXTURE_2D_ARRAY,oe.__webglTexture,i.TEXTURE0+N)}function W(k,N){const oe=n.get(k);if(k.version>0&&oe.__version!==k.version){R(oe,k,N);return}t.bindTexture(i.TEXTURE_3D,oe.__webglTexture,i.TEXTURE0+N)}function O(k,N){const oe=n.get(k);if(k.version>0&&oe.__version!==k.version){M(oe,k,N);return}t.bindTexture(i.TEXTURE_CUBE_MAP,oe.__webglTexture,i.TEXTURE0+N)}const fe={[lo]:i.REPEAT,[Hi]:i.CLAMP_TO_EDGE,[td]:i.MIRRORED_REPEAT},ue={[yi]:i.NEAREST,[yw]:i.NEAREST_MIPMAP_NEAREST,[oc]:i.NEAREST_MIPMAP_LINEAR,[Zt]:i.LINEAR,[Lu]:i.LINEAR_MIPMAP_NEAREST,[os]:i.LINEAR_MIPMAP_LINEAR},ee={[bT]:i.NEVER,[TT]:i.ALWAYS,[ET]:i.LESS,[Tw]:i.LEQUAL,[CT]:i.EQUAL,[MT]:i.GEQUAL,[ST]:i.GREATER,[IT]:i.NOTEQUAL};function de(k,N){if(N.type===Sn&&e.has("OES_texture_float_linear")===!1&&(N.magFilter===Zt||N.magFilter===Lu||N.magFilter===oc||N.magFilter===os||N.minFilter===Zt||N.minFilter===Lu||N.minFilter===oc||N.minFilter===os)&&console.warn("THREE.WebGLRenderer: Unable to use linear filtering with floating point textures. OES_texture_float_linear not supported on this device."),i.texParameteri(k,i.TEXTURE_WRAP_S,fe[N.wrapS]),i.texParameteri(k,i.TEXTURE_WRAP_T,fe[N.wrapT]),(k===i.TEXTURE_3D||k===i.TEXTURE_2D_ARRAY)&&i.texParameteri(k,i.TEXTURE_WRAP_R,fe[N.wrapR]),i.texParameteri(k,i.TEXTURE_MAG_FILTER,ue[N.magFilter]),i.texParameteri(k,i.TEXTURE_MIN_FILTER,ue[N.minFilter]),N.compareFunction&&(i.texParameteri(k,i.TEXTURE_COMPARE_MODE,i.COMPARE_REF_TO_TEXTURE),i.texParameteri(k,i.TEXTURE_COMPARE_FUNC,ee[N.compareFunction])),e.has("EXT_texture_filter_anisotropic")===!0){if(N.magFilter===yi||N.minFilter!==oc&&N.minFilter!==os||N.type===Sn&&e.has("OES_texture_float_linear")===!1)return;if(N.anisotropy>1||n.get(N).__currentAnisotropy){const oe=e.get("EXT_texture_filter_anisotropic");i.texParameterf(k,oe.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(N.anisotropy,s.getMaxAnisotropy())),n.get(N).__currentAnisotropy=N.anisotropy}}}function ae(k,N){let oe=!1;k.__webglInit===void 0&&(k.__webglInit=!0,N.addEventListener("dispose",T));const pe=N.source;let ve=d.get(pe);ve===void 0&&(ve={},d.set(pe,ve));const xe=K(N);if(xe!==k.__cacheKey){ve[xe]===void 0&&(ve[xe]={texture:i.createTexture(),usedTimes:0},o.memory.textures++,oe=!0),ve[xe].usedTimes++;const Pe=ve[k.__cacheKey];Pe!==void 0&&(ve[k.__cacheKey].usedTimes--,Pe.usedTimes===0&&x(N)),k.__cacheKey=xe,k.__webglTexture=ve[xe].texture}return oe}function R(k,N,oe){let pe=i.TEXTURE_2D;(N.isDataArrayTexture||N.isCompressedArrayTexture)&&(pe=i.TEXTURE_2D_ARRAY),N.isData3DTexture&&(pe=i.TEXTURE_3D);const ve=ae(k,N),xe=N.source;t.bindTexture(pe,k.__webglTexture,i.TEXTURE0+oe);const Pe=n.get(xe);if(xe.version!==Pe.__version||ve===!0){t.activeTexture(i.TEXTURE0+oe);const Te=St.getPrimaries(St.workingColorSpace),Qe=N.colorSpace===bs?null:St.getPrimaries(N.colorSpace),lt=N.colorSpace===bs||Te===Qe?i.NONE:i.BROWSER_DEFAULT_WEBGL;i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,N.flipY),i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,N.premultiplyAlpha),i.pixelStorei(i.UNPACK_ALIGNMENT,N.unpackAlignment),i.pixelStorei(i.UNPACK_COLORSPACE_CONVERSION_WEBGL,lt);let Ne=A(N.image,!1,s.maxTextureSize);Ne=V(N,Ne);const qe=r.convert(N.format,N.colorSpace),Ke=r.convert(N.type);let it=_(N.internalFormat,qe,Ke,N.colorSpace,N.isVideoTexture);de(pe,N);let je;const dt=N.mipmaps,ct=N.isVideoTexture!==!0,At=Pe.__version===void 0||ve===!0,ge=xe.dataReady,be=b(N,Ne);if(N.isDepthTexture)it=v(N.format===_l,N.type),At&&(ct?t.texStorage2D(i.TEXTURE_2D,1,it,Ne.width,Ne.height):t.texImage2D(i.TEXTURE_2D,0,it,Ne.width,Ne.height,0,qe,Ke,null));else if(N.isDataTexture)if(dt.length>0){ct&&At&&t.texStorage2D(i.TEXTURE_2D,be,it,dt[0].width,dt[0].height);for(let Ce=0,Le=dt.length;Ce<Le;Ce++)je=dt[Ce],ct?ge&&t.texSubImage2D(i.TEXTURE_2D,Ce,0,0,je.width,je.height,qe,Ke,je.data):t.texImage2D(i.TEXTURE_2D,Ce,it,je.width,je.height,0,qe,Ke,je.data);N.generateMipmaps=!1}else ct?(At&&t.texStorage2D(i.TEXTURE_2D,be,it,Ne.width,Ne.height),ge&&t.texSubImage2D(i.TEXTURE_2D,0,0,0,Ne.width,Ne.height,qe,Ke,Ne.data)):t.texImage2D(i.TEXTURE_2D,0,it,Ne.width,Ne.height,0,qe,Ke,Ne.data);else if(N.isCompressedTexture)if(N.isCompressedArrayTexture){ct&&At&&t.texStorage3D(i.TEXTURE_2D_ARRAY,be,it,dt[0].width,dt[0].height,Ne.depth);for(let Ce=0,Le=dt.length;Ce<Le;Ce++)if(je=dt[Ce],N.format!==Hn)if(qe!==null)if(ct){if(ge)if(N.layerUpdates.size>0){const et=t0(je.width,je.height,N.format,N.type);for(const Ze of N.layerUpdates){const _t=je.data.subarray(Ze*et/je.data.BYTES_PER_ELEMENT,(Ze+1)*et/je.data.BYTES_PER_ELEMENT);t.compressedTexSubImage3D(i.TEXTURE_2D_ARRAY,Ce,0,0,Ze,je.width,je.height,1,qe,_t)}N.clearLayerUpdates()}else t.compressedTexSubImage3D(i.TEXTURE_2D_ARRAY,Ce,0,0,0,je.width,je.height,Ne.depth,qe,je.data)}else t.compressedTexImage3D(i.TEXTURE_2D_ARRAY,Ce,it,je.width,je.height,Ne.depth,0,je.data,0,0);else console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()");else ct?ge&&t.texSubImage3D(i.TEXTURE_2D_ARRAY,Ce,0,0,0,je.width,je.height,Ne.depth,qe,Ke,je.data):t.texImage3D(i.TEXTURE_2D_ARRAY,Ce,it,je.width,je.height,Ne.depth,0,qe,Ke,je.data)}else{ct&&At&&t.texStorage2D(i.TEXTURE_2D,be,it,dt[0].width,dt[0].height);for(let Ce=0,Le=dt.length;Ce<Le;Ce++)je=dt[Ce],N.format!==Hn?qe!==null?ct?ge&&t.compressedTexSubImage2D(i.TEXTURE_2D,Ce,0,0,je.width,je.height,qe,je.data):t.compressedTexImage2D(i.TEXTURE_2D,Ce,it,je.width,je.height,0,je.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):ct?ge&&t.texSubImage2D(i.TEXTURE_2D,Ce,0,0,je.width,je.height,qe,Ke,je.data):t.texImage2D(i.TEXTURE_2D,Ce,it,je.width,je.height,0,qe,Ke,je.data)}else if(N.isDataArrayTexture)if(ct){if(At&&t.texStorage3D(i.TEXTURE_2D_ARRAY,be,it,Ne.width,Ne.height,Ne.depth),ge)if(N.layerUpdates.size>0){const Ce=t0(Ne.width,Ne.height,N.format,N.type);for(const Le of N.layerUpdates){const et=Ne.data.subarray(Le*Ce/Ne.data.BYTES_PER_ELEMENT,(Le+1)*Ce/Ne.data.BYTES_PER_ELEMENT);t.texSubImage3D(i.TEXTURE_2D_ARRAY,0,0,0,Le,Ne.width,Ne.height,1,qe,Ke,et)}N.clearLayerUpdates()}else t.texSubImage3D(i.TEXTURE_2D_ARRAY,0,0,0,0,Ne.width,Ne.height,Ne.depth,qe,Ke,Ne.data)}else t.texImage3D(i.TEXTURE_2D_ARRAY,0,it,Ne.width,Ne.height,Ne.depth,0,qe,Ke,Ne.data);else if(N.isData3DTexture)ct?(At&&t.texStorage3D(i.TEXTURE_3D,be,it,Ne.width,Ne.height,Ne.depth),ge&&t.texSubImage3D(i.TEXTURE_3D,0,0,0,0,Ne.width,Ne.height,Ne.depth,qe,Ke,Ne.data)):t.texImage3D(i.TEXTURE_3D,0,it,Ne.width,Ne.height,Ne.depth,0,qe,Ke,Ne.data);else if(N.isFramebufferTexture){if(At)if(ct)t.texStorage2D(i.TEXTURE_2D,be,it,Ne.width,Ne.height);else{let Ce=Ne.width,Le=Ne.height;for(let et=0;et<be;et++)t.texImage2D(i.TEXTURE_2D,et,it,Ce,Le,0,qe,Ke,null),Ce>>=1,Le>>=1}}else if(dt.length>0){if(ct&&At){const Ce=re(dt[0]);t.texStorage2D(i.TEXTURE_2D,be,it,Ce.width,Ce.height)}for(let Ce=0,Le=dt.length;Ce<Le;Ce++)je=dt[Ce],ct?ge&&t.texSubImage2D(i.TEXTURE_2D,Ce,0,0,qe,Ke,je):t.texImage2D(i.TEXTURE_2D,Ce,it,qe,Ke,je);N.generateMipmaps=!1}else if(ct){if(At){const Ce=re(Ne);t.texStorage2D(i.TEXTURE_2D,be,it,Ce.width,Ce.height)}ge&&t.texSubImage2D(i.TEXTURE_2D,0,0,0,qe,Ke,Ne)}else t.texImage2D(i.TEXTURE_2D,0,it,qe,Ke,Ne);m(N)&&g(pe),Pe.__version=xe.version,N.onUpdate&&N.onUpdate(N)}k.__version=N.version}function M(k,N,oe){if(N.image.length!==6)return;const pe=ae(k,N),ve=N.source;t.bindTexture(i.TEXTURE_CUBE_MAP,k.__webglTexture,i.TEXTURE0+oe);const xe=n.get(ve);if(ve.version!==xe.__version||pe===!0){t.activeTexture(i.TEXTURE0+oe);const Pe=St.getPrimaries(St.workingColorSpace),Te=N.colorSpace===bs?null:St.getPrimaries(N.colorSpace),Qe=N.colorSpace===bs||Pe===Te?i.NONE:i.BROWSER_DEFAULT_WEBGL;i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,N.flipY),i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,N.premultiplyAlpha),i.pixelStorei(i.UNPACK_ALIGNMENT,N.unpackAlignment),i.pixelStorei(i.UNPACK_COLORSPACE_CONVERSION_WEBGL,Qe);const lt=N.isCompressedTexture||N.image[0].isCompressedTexture,Ne=N.image[0]&&N.image[0].isDataTexture,qe=[];for(let Le=0;Le<6;Le++)!lt&&!Ne?qe[Le]=A(N.image[Le],!0,s.maxCubemapSize):qe[Le]=Ne?N.image[Le].image:N.image[Le],qe[Le]=V(N,qe[Le]);const Ke=qe[0],it=r.convert(N.format,N.colorSpace),je=r.convert(N.type),dt=_(N.internalFormat,it,je,N.colorSpace),ct=N.isVideoTexture!==!0,At=xe.__version===void 0||pe===!0,ge=ve.dataReady;let be=b(N,Ke);de(i.TEXTURE_CUBE_MAP,N);let Ce;if(lt){ct&&At&&t.texStorage2D(i.TEXTURE_CUBE_MAP,be,dt,Ke.width,Ke.height);for(let Le=0;Le<6;Le++){Ce=qe[Le].mipmaps;for(let et=0;et<Ce.length;et++){const Ze=Ce[et];N.format!==Hn?it!==null?ct?ge&&t.compressedTexSubImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+Le,et,0,0,Ze.width,Ze.height,it,Ze.data):t.compressedTexImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+Le,et,dt,Ze.width,Ze.height,0,Ze.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):ct?ge&&t.texSubImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+Le,et,0,0,Ze.width,Ze.height,it,je,Ze.data):t.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+Le,et,dt,Ze.width,Ze.height,0,it,je,Ze.data)}}}else{if(Ce=N.mipmaps,ct&&At){Ce.length>0&&be++;const Le=re(qe[0]);t.texStorage2D(i.TEXTURE_CUBE_MAP,be,dt,Le.width,Le.height)}for(let Le=0;Le<6;Le++)if(Ne){ct?ge&&t.texSubImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+Le,0,0,0,qe[Le].width,qe[Le].height,it,je,qe[Le].data):t.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+Le,0,dt,qe[Le].width,qe[Le].height,0,it,je,qe[Le].data);for(let et=0;et<Ce.length;et++){const _t=Ce[et].image[Le].image;ct?ge&&t.texSubImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+Le,et+1,0,0,_t.width,_t.height,it,je,_t.data):t.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+Le,et+1,dt,_t.width,_t.height,0,it,je,_t.data)}}else{ct?ge&&t.texSubImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+Le,0,0,0,it,je,qe[Le]):t.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+Le,0,dt,it,je,qe[Le]);for(let et=0;et<Ce.length;et++){const Ze=Ce[et];ct?ge&&t.texSubImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+Le,et+1,0,0,it,je,Ze.image[Le]):t.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+Le,et+1,dt,it,je,Ze.image[Le])}}}m(N)&&g(i.TEXTURE_CUBE_MAP),xe.__version=ve.version,N.onUpdate&&N.onUpdate(N)}k.__version=N.version}function B(k,N,oe,pe,ve,xe){const Pe=r.convert(oe.format,oe.colorSpace),Te=r.convert(oe.type),Qe=_(oe.internalFormat,Pe,Te,oe.colorSpace),lt=n.get(N),Ne=n.get(oe);if(Ne.__renderTarget=N,!lt.__hasExternalTextures){const qe=Math.max(1,N.width>>xe),Ke=Math.max(1,N.height>>xe);ve===i.TEXTURE_3D||ve===i.TEXTURE_2D_ARRAY?t.texImage3D(ve,xe,Qe,qe,Ke,N.depth,0,Pe,Te,null):t.texImage2D(ve,xe,Qe,qe,Ke,0,Pe,Te,null)}t.bindFramebuffer(i.FRAMEBUFFER,k),ce(N)?a.framebufferTexture2DMultisampleEXT(i.FRAMEBUFFER,pe,ve,Ne.__webglTexture,0,q(N)):(ve===i.TEXTURE_2D||ve>=i.TEXTURE_CUBE_MAP_POSITIVE_X&&ve<=i.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&i.framebufferTexture2D(i.FRAMEBUFFER,pe,ve,Ne.__webglTexture,xe),t.bindFramebuffer(i.FRAMEBUFFER,null)}function D(k,N,oe){if(i.bindRenderbuffer(i.RENDERBUFFER,k),N.depthBuffer){const pe=N.depthTexture,ve=pe&&pe.isDepthTexture?pe.type:null,xe=v(N.stencilBuffer,ve),Pe=N.stencilBuffer?i.DEPTH_STENCIL_ATTACHMENT:i.DEPTH_ATTACHMENT,Te=q(N);ce(N)?a.renderbufferStorageMultisampleEXT(i.RENDERBUFFER,Te,xe,N.width,N.height):oe?i.renderbufferStorageMultisample(i.RENDERBUFFER,Te,xe,N.width,N.height):i.renderbufferStorage(i.RENDERBUFFER,xe,N.width,N.height),i.framebufferRenderbuffer(i.FRAMEBUFFER,Pe,i.RENDERBUFFER,k)}else{const pe=N.textures;for(let ve=0;ve<pe.length;ve++){const xe=pe[ve],Pe=r.convert(xe.format,xe.colorSpace),Te=r.convert(xe.type),Qe=_(xe.internalFormat,Pe,Te,xe.colorSpace),lt=q(N);oe&&ce(N)===!1?i.renderbufferStorageMultisample(i.RENDERBUFFER,lt,Qe,N.width,N.height):ce(N)?a.renderbufferStorageMultisampleEXT(i.RENDERBUFFER,lt,Qe,N.width,N.height):i.renderbufferStorage(i.RENDERBUFFER,Qe,N.width,N.height)}}i.bindRenderbuffer(i.RENDERBUFFER,null)}function te(k,N){if(N&&N.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(t.bindFramebuffer(i.FRAMEBUFFER,k),!(N.depthTexture&&N.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");const pe=n.get(N.depthTexture);pe.__renderTarget=N,(!pe.__webglTexture||N.depthTexture.image.width!==N.width||N.depthTexture.image.height!==N.height)&&(N.depthTexture.image.width=N.width,N.depthTexture.image.height=N.height,N.depthTexture.needsUpdate=!0),le(N.depthTexture,0);const ve=pe.__webglTexture,xe=q(N);if(N.depthTexture.format===sl)ce(N)?a.framebufferTexture2DMultisampleEXT(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.TEXTURE_2D,ve,0,xe):i.framebufferTexture2D(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.TEXTURE_2D,ve,0);else if(N.depthTexture.format===_l)ce(N)?a.framebufferTexture2DMultisampleEXT(i.FRAMEBUFFER,i.DEPTH_STENCIL_ATTACHMENT,i.TEXTURE_2D,ve,0,xe):i.framebufferTexture2D(i.FRAMEBUFFER,i.DEPTH_STENCIL_ATTACHMENT,i.TEXTURE_2D,ve,0);else throw new Error("Unknown depthTexture format")}function ie(k){const N=n.get(k),oe=k.isWebGLCubeRenderTarget===!0;if(N.__boundDepthTexture!==k.depthTexture){const pe=k.depthTexture;if(N.__depthDisposeCallback&&N.__depthDisposeCallback(),pe){const ve=()=>{delete N.__boundDepthTexture,delete N.__depthDisposeCallback,pe.removeEventListener("dispose",ve)};pe.addEventListener("dispose",ve),N.__depthDisposeCallback=ve}N.__boundDepthTexture=pe}if(k.depthTexture&&!N.__autoAllocateDepthBuffer){if(oe)throw new Error("target.depthTexture not supported in Cube render targets");te(N.__webglFramebuffer,k)}else if(oe){N.__webglDepthbuffer=[];for(let pe=0;pe<6;pe++)if(t.bindFramebuffer(i.FRAMEBUFFER,N.__webglFramebuffer[pe]),N.__webglDepthbuffer[pe]===void 0)N.__webglDepthbuffer[pe]=i.createRenderbuffer(),D(N.__webglDepthbuffer[pe],k,!1);else{const ve=k.stencilBuffer?i.DEPTH_STENCIL_ATTACHMENT:i.DEPTH_ATTACHMENT,xe=N.__webglDepthbuffer[pe];i.bindRenderbuffer(i.RENDERBUFFER,xe),i.framebufferRenderbuffer(i.FRAMEBUFFER,ve,i.RENDERBUFFER,xe)}}else if(t.bindFramebuffer(i.FRAMEBUFFER,N.__webglFramebuffer),N.__webglDepthbuffer===void 0)N.__webglDepthbuffer=i.createRenderbuffer(),D(N.__webglDepthbuffer,k,!1);else{const pe=k.stencilBuffer?i.DEPTH_STENCIL_ATTACHMENT:i.DEPTH_ATTACHMENT,ve=N.__webglDepthbuffer;i.bindRenderbuffer(i.RENDERBUFFER,ve),i.framebufferRenderbuffer(i.FRAMEBUFFER,pe,i.RENDERBUFFER,ve)}t.bindFramebuffer(i.FRAMEBUFFER,null)}function Z(k,N,oe){const pe=n.get(k);N!==void 0&&B(pe.__webglFramebuffer,k,k.texture,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,0),oe!==void 0&&ie(k)}function me(k){const N=k.texture,oe=n.get(k),pe=n.get(N);k.addEventListener("dispose",L);const ve=k.textures,xe=k.isWebGLCubeRenderTarget===!0,Pe=ve.length>1;if(Pe||(pe.__webglTexture===void 0&&(pe.__webglTexture=i.createTexture()),pe.__version=N.version,o.memory.textures++),xe){oe.__webglFramebuffer=[];for(let Te=0;Te<6;Te++)if(N.mipmaps&&N.mipmaps.length>0){oe.__webglFramebuffer[Te]=[];for(let Qe=0;Qe<N.mipmaps.length;Qe++)oe.__webglFramebuffer[Te][Qe]=i.createFramebuffer()}else oe.__webglFramebuffer[Te]=i.createFramebuffer()}else{if(N.mipmaps&&N.mipmaps.length>0){oe.__webglFramebuffer=[];for(let Te=0;Te<N.mipmaps.length;Te++)oe.__webglFramebuffer[Te]=i.createFramebuffer()}else oe.__webglFramebuffer=i.createFramebuffer();if(Pe)for(let Te=0,Qe=ve.length;Te<Qe;Te++){const lt=n.get(ve[Te]);lt.__webglTexture===void 0&&(lt.__webglTexture=i.createTexture(),o.memory.textures++)}if(k.samples>0&&ce(k)===!1){oe.__webglMultisampledFramebuffer=i.createFramebuffer(),oe.__webglColorRenderbuffer=[],t.bindFramebuffer(i.FRAMEBUFFER,oe.__webglMultisampledFramebuffer);for(let Te=0;Te<ve.length;Te++){const Qe=ve[Te];oe.__webglColorRenderbuffer[Te]=i.createRenderbuffer(),i.bindRenderbuffer(i.RENDERBUFFER,oe.__webglColorRenderbuffer[Te]);const lt=r.convert(Qe.format,Qe.colorSpace),Ne=r.convert(Qe.type),qe=_(Qe.internalFormat,lt,Ne,Qe.colorSpace,k.isXRRenderTarget===!0),Ke=q(k);i.renderbufferStorageMultisample(i.RENDERBUFFER,Ke,qe,k.width,k.height),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0+Te,i.RENDERBUFFER,oe.__webglColorRenderbuffer[Te])}i.bindRenderbuffer(i.RENDERBUFFER,null),k.depthBuffer&&(oe.__webglDepthRenderbuffer=i.createRenderbuffer(),D(oe.__webglDepthRenderbuffer,k,!0)),t.bindFramebuffer(i.FRAMEBUFFER,null)}}if(xe){t.bindTexture(i.TEXTURE_CUBE_MAP,pe.__webglTexture),de(i.TEXTURE_CUBE_MAP,N);for(let Te=0;Te<6;Te++)if(N.mipmaps&&N.mipmaps.length>0)for(let Qe=0;Qe<N.mipmaps.length;Qe++)B(oe.__webglFramebuffer[Te][Qe],k,N,i.COLOR_ATTACHMENT0,i.TEXTURE_CUBE_MAP_POSITIVE_X+Te,Qe);else B(oe.__webglFramebuffer[Te],k,N,i.COLOR_ATTACHMENT0,i.TEXTURE_CUBE_MAP_POSITIVE_X+Te,0);m(N)&&g(i.TEXTURE_CUBE_MAP),t.unbindTexture()}else if(Pe){for(let Te=0,Qe=ve.length;Te<Qe;Te++){const lt=ve[Te],Ne=n.get(lt);t.bindTexture(i.TEXTURE_2D,Ne.__webglTexture),de(i.TEXTURE_2D,lt),B(oe.__webglFramebuffer,k,lt,i.COLOR_ATTACHMENT0+Te,i.TEXTURE_2D,0),m(lt)&&g(i.TEXTURE_2D)}t.unbindTexture()}else{let Te=i.TEXTURE_2D;if((k.isWebGL3DRenderTarget||k.isWebGLArrayRenderTarget)&&(Te=k.isWebGL3DRenderTarget?i.TEXTURE_3D:i.TEXTURE_2D_ARRAY),t.bindTexture(Te,pe.__webglTexture),de(Te,N),N.mipmaps&&N.mipmaps.length>0)for(let Qe=0;Qe<N.mipmaps.length;Qe++)B(oe.__webglFramebuffer[Qe],k,N,i.COLOR_ATTACHMENT0,Te,Qe);else B(oe.__webglFramebuffer,k,N,i.COLOR_ATTACHMENT0,Te,0);m(N)&&g(Te),t.unbindTexture()}k.depthBuffer&&ie(k)}function F(k){const N=k.textures;for(let oe=0,pe=N.length;oe<pe;oe++){const ve=N[oe];if(m(ve)){const xe=y(k),Pe=n.get(ve).__webglTexture;t.bindTexture(xe,Pe),g(xe),t.unbindTexture()}}}const Q=[],E=[];function j(k){if(k.samples>0){if(ce(k)===!1){const N=k.textures,oe=k.width,pe=k.height;let ve=i.COLOR_BUFFER_BIT;const xe=k.stencilBuffer?i.DEPTH_STENCIL_ATTACHMENT:i.DEPTH_ATTACHMENT,Pe=n.get(k),Te=N.length>1;if(Te)for(let Qe=0;Qe<N.length;Qe++)t.bindFramebuffer(i.FRAMEBUFFER,Pe.__webglMultisampledFramebuffer),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0+Qe,i.RENDERBUFFER,null),t.bindFramebuffer(i.FRAMEBUFFER,Pe.__webglFramebuffer),i.framebufferTexture2D(i.DRAW_FRAMEBUFFER,i.COLOR_ATTACHMENT0+Qe,i.TEXTURE_2D,null,0);t.bindFramebuffer(i.READ_FRAMEBUFFER,Pe.__webglMultisampledFramebuffer),t.bindFramebuffer(i.DRAW_FRAMEBUFFER,Pe.__webglFramebuffer);for(let Qe=0;Qe<N.length;Qe++){if(k.resolveDepthBuffer&&(k.depthBuffer&&(ve|=i.DEPTH_BUFFER_BIT),k.stencilBuffer&&k.resolveStencilBuffer&&(ve|=i.STENCIL_BUFFER_BIT)),Te){i.framebufferRenderbuffer(i.READ_FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.RENDERBUFFER,Pe.__webglColorRenderbuffer[Qe]);const lt=n.get(N[Qe]).__webglTexture;i.framebufferTexture2D(i.DRAW_FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,lt,0)}i.blitFramebuffer(0,0,oe,pe,0,0,oe,pe,ve,i.NEAREST),l===!0&&(Q.length=0,E.length=0,Q.push(i.COLOR_ATTACHMENT0+Qe),k.depthBuffer&&k.resolveDepthBuffer===!1&&(Q.push(xe),E.push(xe),i.invalidateFramebuffer(i.DRAW_FRAMEBUFFER,E)),i.invalidateFramebuffer(i.READ_FRAMEBUFFER,Q))}if(t.bindFramebuffer(i.READ_FRAMEBUFFER,null),t.bindFramebuffer(i.DRAW_FRAMEBUFFER,null),Te)for(let Qe=0;Qe<N.length;Qe++){t.bindFramebuffer(i.FRAMEBUFFER,Pe.__webglMultisampledFramebuffer),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0+Qe,i.RENDERBUFFER,Pe.__webglColorRenderbuffer[Qe]);const lt=n.get(N[Qe]).__webglTexture;t.bindFramebuffer(i.FRAMEBUFFER,Pe.__webglFramebuffer),i.framebufferTexture2D(i.DRAW_FRAMEBUFFER,i.COLOR_ATTACHMENT0+Qe,i.TEXTURE_2D,lt,0)}t.bindFramebuffer(i.DRAW_FRAMEBUFFER,Pe.__webglMultisampledFramebuffer)}else if(k.depthBuffer&&k.resolveDepthBuffer===!1&&l){const N=k.stencilBuffer?i.DEPTH_STENCIL_ATTACHMENT:i.DEPTH_ATTACHMENT;i.invalidateFramebuffer(i.DRAW_FRAMEBUFFER,[N])}}}function q(k){return Math.min(s.maxSamples,k.samples)}function ce(k){const N=n.get(k);return k.samples>0&&e.has("WEBGL_multisampled_render_to_texture")===!0&&N.__useRenderToTexture!==!1}function G(k){const N=o.render.frame;h.get(k)!==N&&(h.set(k,N),k.update())}function V(k,N){const oe=k.colorSpace,pe=k.format,ve=k.type;return k.isCompressedTexture===!0||k.isVideoTexture===!0||oe!==On&&oe!==bs&&(St.getTransfer(oe)===Kt?(pe!==Hn||ve!==Kn)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",oe)),N}function re(k){return typeof HTMLImageElement<"u"&&k instanceof HTMLImageElement?(c.width=k.naturalWidth||k.width,c.height=k.naturalHeight||k.height):typeof VideoFrame<"u"&&k instanceof VideoFrame?(c.width=k.displayWidth,c.height=k.displayHeight):(c.width=k.width,c.height=k.height),c}this.allocateTextureUnit=H,this.resetTextureUnits=z,this.setTexture2D=le,this.setTexture2DArray=J,this.setTexture3D=W,this.setTextureCube=O,this.rebindTextures=Z,this.setupRenderTarget=me,this.updateRenderTargetMipmap=F,this.updateMultisampleRenderTarget=j,this.setupDepthRenderbuffer=ie,this.setupFrameBufferTexture=B,this.useMultisampledRTT=ce}function _2(i,e){function t(n,s=bs){let r;const o=St.getTransfer(s);if(n===Kn)return i.UNSIGNED_BYTE;if(n===ng)return i.UNSIGNED_SHORT_4_4_4_4;if(n===ig)return i.UNSIGNED_SHORT_5_5_5_1;if(n===bw)return i.UNSIGNED_INT_5_9_9_9_REV;if(n===xw)return i.BYTE;if(n===ww)return i.SHORT;if(n===Hc)return i.UNSIGNED_SHORT;if(n===tg)return i.INT;if(n===ta)return i.UNSIGNED_INT;if(n===Sn)return i.FLOAT;if(n===Gn)return i.HALF_FLOAT;if(n===Ew)return i.ALPHA;if(n===sg)return i.RGB;if(n===Hn)return i.RGBA;if(n===Cw)return i.LUMINANCE;if(n===Sw)return i.LUMINANCE_ALPHA;if(n===sl)return i.DEPTH_COMPONENT;if(n===_l)return i.DEPTH_STENCIL;if(n===mr)return i.RED;if(n===rg)return i.RED_INTEGER;if(n===Vo)return i.RG;if(n===og)return i.RG_INTEGER;if(n===ag)return i.RGBA_INTEGER;if(n===Fu||n===wc||n===Nu||n===bc)if(o===Kt)if(r=e.get("WEBGL_compressed_texture_s3tc_srgb"),r!==null){if(n===Fu)return r.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(n===wc)return r.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(n===Nu)return r.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(n===bc)return r.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(r=e.get("WEBGL_compressed_texture_s3tc"),r!==null){if(n===Fu)return r.COMPRESSED_RGB_S3TC_DXT1_EXT;if(n===wc)return r.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(n===Nu)return r.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(n===bc)return r.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(n===nd||n===Sm||n===id||n===Im)if(r=e.get("WEBGL_compressed_texture_pvrtc"),r!==null){if(n===nd)return r.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(n===Sm)return r.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(n===id)return r.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(n===Im)return r.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(n===sd||n===rd||n===od)if(r=e.get("WEBGL_compressed_texture_etc"),r!==null){if(n===sd||n===rd)return o===Kt?r.COMPRESSED_SRGB8_ETC2:r.COMPRESSED_RGB8_ETC2;if(n===od)return o===Kt?r.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:r.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(n===Wc||n===Mm||n===Tm||n===Bm||n===qc||n===Rm||n===Pm||n===Dm||n===Lm||n===Fm||n===Nm||n===km||n===Om||n===Um)if(r=e.get("WEBGL_compressed_texture_astc"),r!==null){if(n===Wc)return o===Kt?r.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:r.COMPRESSED_RGBA_ASTC_4x4_KHR;if(n===Mm)return o===Kt?r.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:r.COMPRESSED_RGBA_ASTC_5x4_KHR;if(n===Tm)return o===Kt?r.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:r.COMPRESSED_RGBA_ASTC_5x5_KHR;if(n===Bm)return o===Kt?r.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:r.COMPRESSED_RGBA_ASTC_6x5_KHR;if(n===qc)return o===Kt?r.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:r.COMPRESSED_RGBA_ASTC_6x6_KHR;if(n===Rm)return o===Kt?r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:r.COMPRESSED_RGBA_ASTC_8x5_KHR;if(n===Pm)return o===Kt?r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:r.COMPRESSED_RGBA_ASTC_8x6_KHR;if(n===Dm)return o===Kt?r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:r.COMPRESSED_RGBA_ASTC_8x8_KHR;if(n===Lm)return o===Kt?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:r.COMPRESSED_RGBA_ASTC_10x5_KHR;if(n===Fm)return o===Kt?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:r.COMPRESSED_RGBA_ASTC_10x6_KHR;if(n===Nm)return o===Kt?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:r.COMPRESSED_RGBA_ASTC_10x8_KHR;if(n===km)return o===Kt?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:r.COMPRESSED_RGBA_ASTC_10x10_KHR;if(n===Om)return o===Kt?r.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:r.COMPRESSED_RGBA_ASTC_12x10_KHR;if(n===Um)return o===Kt?r.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:r.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(n===Ec||n===Qm||n===ad)if(r=e.get("EXT_texture_compression_bptc"),r!==null){if(n===Ec)return o===Kt?r.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:r.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(n===Qm)return r.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(n===ad)return r.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}else return null;if(n===Iw||n===Vm||n===zm||n===Gm)if(r=e.get("EXT_texture_compression_rgtc"),r!==null){if(n===Ec)return r.COMPRESSED_RED_RGTC1_EXT;if(n===Vm)return r.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(n===zm)return r.COMPRESSED_RED_GREEN_RGTC2_EXT;if(n===Gm)return r.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return n===vl?i.UNSIGNED_INT_24_8:i[n]!==void 0?i[n]:null}return{convert:t}}const y2={type:"move"};class cp{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new Wi,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new Wi,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new he,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new he),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new Wi,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new he,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new he),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const t=this._hand;if(t)for(const n of e.hand.values())this._getHandJoint(t,n)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,t,n){let s=null,r=null,o=null;const a=this._targetRay,l=this._grip,c=this._hand;if(e&&t.session.visibilityState!=="visible-blurred"){if(c&&e.hand){o=!0;for(const A of e.hand.values()){const m=t.getJointPose(A,n),g=this._getHandJoint(c,A);m!==null&&(g.matrix.fromArray(m.transform.matrix),g.matrix.decompose(g.position,g.rotation,g.scale),g.matrixWorldNeedsUpdate=!0,g.jointRadius=m.radius),g.visible=m!==null}const h=c.joints["index-finger-tip"],u=c.joints["thumb-tip"],d=h.position.distanceTo(u.position),f=.02,p=.005;c.inputState.pinching&&d>f+p?(c.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!c.inputState.pinching&&d<=f-p&&(c.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else l!==null&&e.gripSpace&&(r=t.getPose(e.gripSpace,n),r!==null&&(l.matrix.fromArray(r.transform.matrix),l.matrix.decompose(l.position,l.rotation,l.scale),l.matrixWorldNeedsUpdate=!0,r.linearVelocity?(l.hasLinearVelocity=!0,l.linearVelocity.copy(r.linearVelocity)):l.hasLinearVelocity=!1,r.angularVelocity?(l.hasAngularVelocity=!0,l.angularVelocity.copy(r.angularVelocity)):l.hasAngularVelocity=!1));a!==null&&(s=t.getPose(e.targetRaySpace,n),s===null&&r!==null&&(s=r),s!==null&&(a.matrix.fromArray(s.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),a.matrixWorldNeedsUpdate=!0,s.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(s.linearVelocity)):a.hasLinearVelocity=!1,s.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(s.angularVelocity)):a.hasAngularVelocity=!1,this.dispatchEvent(y2)))}return a!==null&&(a.visible=s!==null),l!==null&&(l.visible=r!==null),c!==null&&(c.visible=o!==null),this}_getHandJoint(e,t){if(e.joints[t.jointName]===void 0){const n=new Wi;n.matrixAutoUpdate=!1,n.visible=!1,e.joints[t.jointName]=n,e.add(n)}return e.joints[t.jointName]}}const x2="\nvoid main() {\n\n	gl_Position = vec4( position, 1.0 );\n\n}",w2="\nuniform sampler2DArray depthColor;\nuniform float depthWidth;\nuniform float depthHeight;\n\nvoid main() {\n\n	vec2 coord = vec2( gl_FragCoord.x / depthWidth, gl_FragCoord.y / depthHeight );\n\n	if ( coord.x >= 1.0 ) {\n\n		gl_FragDepth = texture( depthColor, vec3( coord.x - 1.0, coord.y, 1 ) ).r;\n\n	} else {\n\n		gl_FragDepth = texture( depthColor, vec3( coord.x, coord.y, 0 ) ).r;\n\n	}\n\n}";class b2{constructor(){this.texture=null,this.mesh=null,this.depthNear=0,this.depthFar=0}init(e,t,n){if(this.texture===null){const s=new Pn,r=e.properties.get(s);r.__webglTexture=t.texture,(t.depthNear!==n.depthNear||t.depthFar!==n.depthFar)&&(this.depthNear=t.depthNear,this.depthFar=t.depthFar),this.texture=s}}getMesh(e){if(this.texture!==null&&this.mesh===null){const t=e.cameras[0].viewport,n=new co({vertexShader:x2,fragmentShader:w2,uniforms:{depthColor:{value:this.texture},depthWidth:{value:t.z},depthHeight:{value:t.w}}});this.mesh=new $n(new Xd(20,20),n)}return this.mesh}reset(){this.texture=null,this.mesh=null}getDepthTexture(){return this.texture}}class E2 extends ua{constructor(e,t){super();const n=this;let s=null,r=1,o=null,a="local-floor",l=1,c=null,h=null,u=null,d=null,f=null,p=null;const A=new b2,m=t.getContextAttributes();let g=null,y=null;const _=[],v=[],b=new Me;let T=null;const L=new ai;L.viewport=new Ot;const I=new ai;I.viewport=new Ot;const x=[L,I],w=new PB;let P=null,z=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(R){let M=_[R];return M===void 0&&(M=new cp,_[R]=M),M.getTargetRaySpace()},this.getControllerGrip=function(R){let M=_[R];return M===void 0&&(M=new cp,_[R]=M),M.getGripSpace()},this.getHand=function(R){let M=_[R];return M===void 0&&(M=new cp,_[R]=M),M.getHandSpace()};function H(R){const M=v.indexOf(R.inputSource);if(M===-1)return;const B=_[M];B!==void 0&&(B.update(R.inputSource,R.frame,c||o),B.dispatchEvent({type:R.type,data:R.inputSource}))}function K(){s.removeEventListener("select",H),s.removeEventListener("selectstart",H),s.removeEventListener("selectend",H),s.removeEventListener("squeeze",H),s.removeEventListener("squeezestart",H),s.removeEventListener("squeezeend",H),s.removeEventListener("end",K),s.removeEventListener("inputsourceschange",le);for(let R=0;R<_.length;R++){const M=v[R];M!==null&&(v[R]=null,_[R].disconnect(M))}P=null,z=null,A.reset(),e.setRenderTarget(g),f=null,d=null,u=null,s=null,y=null,ae.stop(),n.isPresenting=!1,e.setPixelRatio(T),e.setSize(b.width,b.height,!1),n.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(R){r=R,n.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(R){a=R,n.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return c||o},this.setReferenceSpace=function(R){c=R},this.getBaseLayer=function(){return d!==null?d:f},this.getBinding=function(){return u},this.getFrame=function(){return p},this.getSession=function(){return s},this.setSession=async function(R){if(s=R,s!==null){if(g=e.getRenderTarget(),s.addEventListener("select",H),s.addEventListener("selectstart",H),s.addEventListener("selectend",H),s.addEventListener("squeeze",H),s.addEventListener("squeezestart",H),s.addEventListener("squeezeend",H),s.addEventListener("end",K),s.addEventListener("inputsourceschange",le),m.xrCompatible!==!0&&await t.makeXRCompatible(),T=e.getPixelRatio(),e.getSize(b),s.enabledFeatures!==void 0&&s.enabledFeatures.includes("layers")){let B=null,D=null,te=null;m.depth&&(te=m.stencil?t.DEPTH24_STENCIL8:t.DEPTH_COMPONENT24,B=m.stencil?_l:sl,D=m.stencil?vl:ta);const ie={colorFormat:t.RGBA8,depthFormat:te,scaleFactor:r};u=new XRWebGLBinding(s,t),d=u.createProjectionLayer(ie),s.updateRenderState({layers:[d]}),e.setPixelRatio(1),e.setSize(d.textureWidth,d.textureHeight,!1),y=new na(d.textureWidth,d.textureHeight,{format:Hn,type:Kn,depthTexture:new Uw(d.textureWidth,d.textureHeight,D,void 0,void 0,void 0,void 0,void 0,void 0,B),stencilBuffer:m.stencil,colorSpace:e.outputColorSpace,samples:m.antialias?4:0,resolveDepthBuffer:d.ignoreDepthValues===!1})}else{const B={antialias:m.antialias,alpha:!0,depth:m.depth,stencil:m.stencil,framebufferScaleFactor:r};f=new XRWebGLLayer(s,t,B),s.updateRenderState({baseLayer:f}),e.setPixelRatio(1),e.setSize(f.framebufferWidth,f.framebufferHeight,!1),y=new na(f.framebufferWidth,f.framebufferHeight,{format:Hn,type:Kn,colorSpace:e.outputColorSpace,stencilBuffer:m.stencil})}y.isXRRenderTarget=!0,this.setFoveation(l),c=null,o=await s.requestReferenceSpace(a),ae.setContext(s),ae.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(s!==null)return s.environmentBlendMode},this.getDepthTexture=function(){return A.getDepthTexture()};function le(R){for(let M=0;M<R.removed.length;M++){const B=R.removed[M],D=v.indexOf(B);D>=0&&(v[D]=null,_[D].disconnect(B))}for(let M=0;M<R.added.length;M++){const B=R.added[M];let D=v.indexOf(B);if(D===-1){for(let ie=0;ie<_.length;ie++)if(ie>=v.length){v.push(B),D=ie;break}else if(v[ie]===null){v[ie]=B,D=ie;break}if(D===-1)break}const te=_[D];te&&te.connect(B)}}const J=new he,W=new he;function O(R,M,B){J.setFromMatrixPosition(M.matrixWorld),W.setFromMatrixPosition(B.matrixWorld);const D=J.distanceTo(W),te=M.projectionMatrix.elements,ie=B.projectionMatrix.elements,Z=te[14]/(te[10]-1),me=te[14]/(te[10]+1),F=(te[9]+1)/te[5],Q=(te[9]-1)/te[5],E=(te[8]-1)/te[0],j=(ie[8]+1)/ie[0],q=Z*E,ce=Z*j,G=D/(-E+j),V=G*-E;if(M.matrixWorld.decompose(R.position,R.quaternion,R.scale),R.translateX(V),R.translateZ(G),R.matrixWorld.compose(R.position,R.quaternion,R.scale),R.matrixWorldInverse.copy(R.matrixWorld).invert(),te[10]===-1)R.projectionMatrix.copy(M.projectionMatrix),R.projectionMatrixInverse.copy(M.projectionMatrixInverse);else{const re=Z+G,k=me+G,N=q-V,oe=ce+(D-V),pe=F*me/k*re,ve=Q*me/k*re;R.projectionMatrix.makePerspective(N,oe,pe,ve,re,k),R.projectionMatrixInverse.copy(R.projectionMatrix).invert()}}function fe(R,M){M===null?R.matrixWorld.copy(R.matrix):R.matrixWorld.multiplyMatrices(M.matrixWorld,R.matrix),R.matrixWorldInverse.copy(R.matrixWorld).invert()}this.updateCamera=function(R){if(s===null)return;let M=R.near,B=R.far;A.texture!==null&&(A.depthNear>0&&(M=A.depthNear),A.depthFar>0&&(B=A.depthFar)),w.near=I.near=L.near=M,w.far=I.far=L.far=B,(P!==w.near||z!==w.far)&&(s.updateRenderState({depthNear:w.near,depthFar:w.far}),P=w.near,z=w.far),L.layers.mask=R.layers.mask|2,I.layers.mask=R.layers.mask|4,w.layers.mask=L.layers.mask|I.layers.mask;const D=R.parent,te=w.cameras;fe(w,D);for(let ie=0;ie<te.length;ie++)fe(te[ie],D);te.length===2?O(w,L,I):w.projectionMatrix.copy(L.projectionMatrix),ue(R,w,D)};function ue(R,M,B){B===null?R.matrix.copy(M.matrixWorld):(R.matrix.copy(B.matrixWorld),R.matrix.invert(),R.matrix.multiply(M.matrixWorld)),R.matrix.decompose(R.position,R.quaternion,R.scale),R.updateMatrixWorld(!0),R.projectionMatrix.copy(M.projectionMatrix),R.projectionMatrixInverse.copy(M.projectionMatrixInverse),R.isPerspectiveCamera&&(R.fov=yl*2*Math.atan(1/R.projectionMatrix.elements[5]),R.zoom=1)}this.getCamera=function(){return w},this.getFoveation=function(){if(!(d===null&&f===null))return l},this.setFoveation=function(R){l=R,d!==null&&(d.fixedFoveation=R),f!==null&&f.fixedFoveation!==void 0&&(f.fixedFoveation=R)},this.hasDepthSensing=function(){return A.texture!==null},this.getDepthSensingMesh=function(){return A.getMesh(w)};let ee=null;function de(R,M){if(h=M.getViewerPose(c||o),p=M,h!==null){const B=h.views;f!==null&&(e.setRenderTargetFramebuffer(y,f.framebuffer),e.setRenderTarget(y));let D=!1;B.length!==w.cameras.length&&(w.cameras.length=0,D=!0);for(let ie=0;ie<B.length;ie++){const Z=B[ie];let me=null;if(f!==null)me=f.getViewport(Z);else{const Q=u.getViewSubImage(d,Z);me=Q.viewport,ie===0&&(e.setRenderTargetTextures(y,Q.colorTexture,d.ignoreDepthValues?void 0:Q.depthStencilTexture),e.setRenderTarget(y))}let F=x[ie];F===void 0&&(F=new ai,F.layers.enable(ie),F.viewport=new Ot,x[ie]=F),F.matrix.fromArray(Z.transform.matrix),F.matrix.decompose(F.position,F.quaternion,F.scale),F.projectionMatrix.fromArray(Z.projectionMatrix),F.projectionMatrixInverse.copy(F.projectionMatrix).invert(),F.viewport.set(me.x,me.y,me.width,me.height),ie===0&&(w.matrix.copy(F.matrix),w.matrix.decompose(w.position,w.quaternion,w.scale)),D===!0&&w.cameras.push(F)}const te=s.enabledFeatures;if(te&&te.includes("depth-sensing")){const ie=u.getDepthInformation(B[0]);ie&&ie.isValid&&ie.texture&&A.init(e,ie,s.renderState)}}for(let B=0;B<_.length;B++){const D=v[B],te=_[B];D!==null&&te!==void 0&&te.update(D,M,c||o)}ee&&ee(R,M),M.detectedPlanes&&n.dispatchEvent({type:"planesdetected",data:M}),p=null}const ae=new tb;ae.setAnimationLoop(de),this.setAnimationLoop=function(R){ee=R},this.dispose=function(){}}}const Io=new Rn,C2=new pt;function S2(i,e){function t(m,g){m.matrixAutoUpdate===!0&&m.updateMatrix(),g.value.copy(m.matrix)}function n(m,g){g.color.getRGB(m.fogColor.value,kw(i)),g.isFog?(m.fogNear.value=g.near,m.fogFar.value=g.far):g.isFogExp2&&(m.fogDensity.value=g.density)}function s(m,g,y,_,v){g.isMeshBasicMaterial||g.isMeshLambertMaterial?r(m,g):g.isMeshToonMaterial?(r(m,g),u(m,g)):g.isMeshPhongMaterial?(r(m,g),h(m,g)):g.isMeshStandardMaterial?(r(m,g),d(m,g),g.isMeshPhysicalMaterial&&f(m,g,v)):g.isMeshMatcapMaterial?(r(m,g),p(m,g)):g.isMeshDepthMaterial?r(m,g):g.isMeshDistanceMaterial?(r(m,g),A(m,g)):g.isMeshNormalMaterial?r(m,g):g.isLineBasicMaterial?(o(m,g),g.isLineDashedMaterial&&a(m,g)):g.isPointsMaterial?l(m,g,y,_):g.isSpriteMaterial?c(m,g):g.isShadowMaterial?(m.color.value.copy(g.color),m.opacity.value=g.opacity):g.isShaderMaterial&&(g.uniformsNeedUpdate=!1)}function r(m,g){m.opacity.value=g.opacity,g.color&&m.diffuse.value.copy(g.color),g.emissive&&m.emissive.value.copy(g.emissive).multiplyScalar(g.emissiveIntensity),g.map&&(m.map.value=g.map,t(g.map,m.mapTransform)),g.alphaMap&&(m.alphaMap.value=g.alphaMap,t(g.alphaMap,m.alphaMapTransform)),g.bumpMap&&(m.bumpMap.value=g.bumpMap,t(g.bumpMap,m.bumpMapTransform),m.bumpScale.value=g.bumpScale,g.side===Ti&&(m.bumpScale.value*=-1)),g.normalMap&&(m.normalMap.value=g.normalMap,t(g.normalMap,m.normalMapTransform),m.normalScale.value.copy(g.normalScale),g.side===Ti&&m.normalScale.value.negate()),g.displacementMap&&(m.displacementMap.value=g.displacementMap,t(g.displacementMap,m.displacementMapTransform),m.displacementScale.value=g.displacementScale,m.displacementBias.value=g.displacementBias),g.emissiveMap&&(m.emissiveMap.value=g.emissiveMap,t(g.emissiveMap,m.emissiveMapTransform)),g.specularMap&&(m.specularMap.value=g.specularMap,t(g.specularMap,m.specularMapTransform)),g.alphaTest>0&&(m.alphaTest.value=g.alphaTest);const y=e.get(g),_=y.envMap,v=y.envMapRotation;_&&(m.envMap.value=_,Io.copy(v),Io.x*=-1,Io.y*=-1,Io.z*=-1,_.isCubeTexture&&_.isRenderTargetTexture===!1&&(Io.y*=-1,Io.z*=-1),m.envMapRotation.value.setFromMatrix4(C2.makeRotationFromEuler(Io)),m.flipEnvMap.value=_.isCubeTexture&&_.isRenderTargetTexture===!1?-1:1,m.reflectivity.value=g.reflectivity,m.ior.value=g.ior,m.refractionRatio.value=g.refractionRatio),g.lightMap&&(m.lightMap.value=g.lightMap,m.lightMapIntensity.value=g.lightMapIntensity,t(g.lightMap,m.lightMapTransform)),g.aoMap&&(m.aoMap.value=g.aoMap,m.aoMapIntensity.value=g.aoMapIntensity,t(g.aoMap,m.aoMapTransform))}function o(m,g){m.diffuse.value.copy(g.color),m.opacity.value=g.opacity,g.map&&(m.map.value=g.map,t(g.map,m.mapTransform))}function a(m,g){m.dashSize.value=g.dashSize,m.totalSize.value=g.dashSize+g.gapSize,m.scale.value=g.scale}function l(m,g,y,_){m.diffuse.value.copy(g.color),m.opacity.value=g.opacity,m.size.value=g.size*y,m.scale.value=_*.5,g.map&&(m.map.value=g.map,t(g.map,m.uvTransform)),g.alphaMap&&(m.alphaMap.value=g.alphaMap,t(g.alphaMap,m.alphaMapTransform)),g.alphaTest>0&&(m.alphaTest.value=g.alphaTest)}function c(m,g){m.diffuse.value.copy(g.color),m.opacity.value=g.opacity,m.rotation.value=g.rotation,g.map&&(m.map.value=g.map,t(g.map,m.mapTransform)),g.alphaMap&&(m.alphaMap.value=g.alphaMap,t(g.alphaMap,m.alphaMapTransform)),g.alphaTest>0&&(m.alphaTest.value=g.alphaTest)}function h(m,g){m.specular.value.copy(g.specular),m.shininess.value=Math.max(g.shininess,1e-4)}function u(m,g){g.gradientMap&&(m.gradientMap.value=g.gradientMap)}function d(m,g){m.metalness.value=g.metalness,g.metalnessMap&&(m.metalnessMap.value=g.metalnessMap,t(g.metalnessMap,m.metalnessMapTransform)),m.roughness.value=g.roughness,g.roughnessMap&&(m.roughnessMap.value=g.roughnessMap,t(g.roughnessMap,m.roughnessMapTransform)),g.envMap&&(m.envMapIntensity.value=g.envMapIntensity)}function f(m,g,y){m.ior.value=g.ior,g.sheen>0&&(m.sheenColor.value.copy(g.sheenColor).multiplyScalar(g.sheen),m.sheenRoughness.value=g.sheenRoughness,g.sheenColorMap&&(m.sheenColorMap.value=g.sheenColorMap,t(g.sheenColorMap,m.sheenColorMapTransform)),g.sheenRoughnessMap&&(m.sheenRoughnessMap.value=g.sheenRoughnessMap,t(g.sheenRoughnessMap,m.sheenRoughnessMapTransform))),g.clearcoat>0&&(m.clearcoat.value=g.clearcoat,m.clearcoatRoughness.value=g.clearcoatRoughness,g.clearcoatMap&&(m.clearcoatMap.value=g.clearcoatMap,t(g.clearcoatMap,m.clearcoatMapTransform)),g.clearcoatRoughnessMap&&(m.clearcoatRoughnessMap.value=g.clearcoatRoughnessMap,t(g.clearcoatRoughnessMap,m.clearcoatRoughnessMapTransform)),g.clearcoatNormalMap&&(m.clearcoatNormalMap.value=g.clearcoatNormalMap,t(g.clearcoatNormalMap,m.clearcoatNormalMapTransform),m.clearcoatNormalScale.value.copy(g.clearcoatNormalScale),g.side===Ti&&m.clearcoatNormalScale.value.negate())),g.dispersion>0&&(m.dispersion.value=g.dispersion),g.iridescence>0&&(m.iridescence.value=g.iridescence,m.iridescenceIOR.value=g.iridescenceIOR,m.iridescenceThicknessMinimum.value=g.iridescenceThicknessRange[0],m.iridescenceThicknessMaximum.value=g.iridescenceThicknessRange[1],g.iridescenceMap&&(m.iridescenceMap.value=g.iridescenceMap,t(g.iridescenceMap,m.iridescenceMapTransform)),g.iridescenceThicknessMap&&(m.iridescenceThicknessMap.value=g.iridescenceThicknessMap,t(g.iridescenceThicknessMap,m.iridescenceThicknessMapTransform))),g.transmission>0&&(m.transmission.value=g.transmission,m.transmissionSamplerMap.value=y.texture,m.transmissionSamplerSize.value.set(y.width,y.height),g.transmissionMap&&(m.transmissionMap.value=g.transmissionMap,t(g.transmissionMap,m.transmissionMapTransform)),m.thickness.value=g.thickness,g.thicknessMap&&(m.thicknessMap.value=g.thicknessMap,t(g.thicknessMap,m.thicknessMapTransform)),m.attenuationDistance.value=g.attenuationDistance,m.attenuationColor.value.copy(g.attenuationColor)),g.anisotropy>0&&(m.anisotropyVector.value.set(g.anisotropy*Math.cos(g.anisotropyRotation),g.anisotropy*Math.sin(g.anisotropyRotation)),g.anisotropyMap&&(m.anisotropyMap.value=g.anisotropyMap,t(g.anisotropyMap,m.anisotropyMapTransform))),m.specularIntensity.value=g.specularIntensity,m.specularColor.value.copy(g.specularColor),g.specularColorMap&&(m.specularColorMap.value=g.specularColorMap,t(g.specularColorMap,m.specularColorMapTransform)),g.specularIntensityMap&&(m.specularIntensityMap.value=g.specularIntensityMap,t(g.specularIntensityMap,m.specularIntensityMapTransform))}function p(m,g){g.matcap&&(m.matcap.value=g.matcap)}function A(m,g){const y=e.get(g).light;m.referencePosition.value.setFromMatrixPosition(y.matrixWorld),m.nearDistance.value=y.shadow.camera.near,m.farDistance.value=y.shadow.camera.far}return{refreshFogUniforms:n,refreshMaterialUniforms:s}}function I2(i,e,t,n){let s={},r={},o=[];const a=i.getParameter(i.MAX_UNIFORM_BUFFER_BINDINGS);function l(y,_){const v=_.program;n.uniformBlockBinding(y,v)}function c(y,_){let v=s[y.id];v===void 0&&(p(y),v=h(y),s[y.id]=v,y.addEventListener("dispose",m));const b=_.program;n.updateUBOMapping(y,b);const T=e.render.frame;r[y.id]!==T&&(d(y),r[y.id]=T)}function h(y){const _=u();y.__bindingPointIndex=_;const v=i.createBuffer(),b=y.__size,T=y.usage;return i.bindBuffer(i.UNIFORM_BUFFER,v),i.bufferData(i.UNIFORM_BUFFER,b,T),i.bindBuffer(i.UNIFORM_BUFFER,null),i.bindBufferBase(i.UNIFORM_BUFFER,_,v),v}function u(){for(let y=0;y<a;y++)if(o.indexOf(y)===-1)return o.push(y),y;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function d(y){const _=s[y.id],v=y.uniforms,b=y.__cache;i.bindBuffer(i.UNIFORM_BUFFER,_);for(let T=0,L=v.length;T<L;T++){const I=Array.isArray(v[T])?v[T]:[v[T]];for(let x=0,w=I.length;x<w;x++){const P=I[x];if(f(P,T,x,b)===!0){const z=P.__offset,H=Array.isArray(P.value)?P.value:[P.value];let K=0;for(let le=0;le<H.length;le++){const J=H[le],W=A(J);typeof J=="number"||typeof J=="boolean"?(P.__data[0]=J,i.bufferSubData(i.UNIFORM_BUFFER,z+K,P.__data)):J.isMatrix3?(P.__data[0]=J.elements[0],P.__data[1]=J.elements[1],P.__data[2]=J.elements[2],P.__data[3]=0,P.__data[4]=J.elements[3],P.__data[5]=J.elements[4],P.__data[6]=J.elements[5],P.__data[7]=0,P.__data[8]=J.elements[6],P.__data[9]=J.elements[7],P.__data[10]=J.elements[8],P.__data[11]=0):(J.toArray(P.__data,K),K+=W.storage/Float32Array.BYTES_PER_ELEMENT)}i.bufferSubData(i.UNIFORM_BUFFER,z,P.__data)}}}i.bindBuffer(i.UNIFORM_BUFFER,null)}function f(y,_,v,b){const T=y.value,L=_+"_"+v;if(b[L]===void 0)return typeof T=="number"||typeof T=="boolean"?b[L]=T:b[L]=T.clone(),!0;{const I=b[L];if(typeof T=="number"||typeof T=="boolean"){if(I!==T)return b[L]=T,!0}else if(I.equals(T)===!1)return I.copy(T),!0}return!1}function p(y){const _=y.uniforms;let v=0;const b=16;for(let L=0,I=_.length;L<I;L++){const x=Array.isArray(_[L])?_[L]:[_[L]];for(let w=0,P=x.length;w<P;w++){const z=x[w],H=Array.isArray(z.value)?z.value:[z.value];for(let K=0,le=H.length;K<le;K++){const J=H[K],W=A(J),O=v%b,fe=O%W.boundary,ue=O+fe;v+=fe,ue!==0&&b-ue<W.storage&&(v+=b-ue),z.__data=new Float32Array(W.storage/Float32Array.BYTES_PER_ELEMENT),z.__offset=v,v+=W.storage}}}const T=v%b;return T>0&&(v+=b-T),y.__size=v,y.__cache={},this}function A(y){const _={boundary:0,storage:0};return typeof y=="number"||typeof y=="boolean"?(_.boundary=4,_.storage=4):y.isVector2?(_.boundary=8,_.storage=8):y.isVector3||y.isColor?(_.boundary=16,_.storage=12):y.isVector4?(_.boundary=16,_.storage=16):y.isMatrix3?(_.boundary=48,_.storage=48):y.isMatrix4?(_.boundary=64,_.storage=64):y.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",y),_}function m(y){const _=y.target;_.removeEventListener("dispose",m);const v=o.indexOf(_.__bindingPointIndex);o.splice(v,1),i.deleteBuffer(s[_.id]),delete s[_.id],delete r[_.id]}function g(){for(const y in s)i.deleteBuffer(s[y]);o=[],s={},r={}}return{bind:l,update:c,dispose:g}}class M2{constructor(e={}){const{canvas:t=qT(),context:n=null,depth:s=!0,stencil:r=!1,alpha:o=!1,antialias:a=!1,premultipliedAlpha:l=!0,preserveDrawingBuffer:c=!1,powerPreference:h="default",failIfMajorPerformanceCaveat:u=!1,reverseDepthBuffer:d=!1}=e;this.isWebGLRenderer=!0;let f;if(n!==null){if(typeof WebGLRenderingContext<"u"&&n instanceof WebGLRenderingContext)throw new Error("THREE.WebGLRenderer: WebGL 1 is not supported since r163.");f=n.getContextAttributes().alpha}else f=o;const p=new Uint32Array(4),A=new Int32Array(4);let m=null,g=null;const y=[],_=[];this.domElement=t,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this._outputColorSpace=Ft,this.toneMapping=to,this.toneMappingExposure=1;const v=this;let b=!1,T=0,L=0,I=null,x=-1,w=null;const P=new Ot,z=new Ot;let H=null;const K=new at(0);let le=0,J=t.width,W=t.height,O=1,fe=null,ue=null;const ee=new Ot(0,0,J,W),de=new Ot(0,0,J,W);let ae=!1;const R=new fg;let M=!1,B=!1;this.transmissionResolutionScale=1;const D=new pt,te=new pt,ie=new he,Z=new Ot,me={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};let F=!1;function Q(){return I===null?O:1}let E=n;function j(S,Y){return t.getContext(S,Y)}try{const S={alpha:!0,depth:s,stencil:r,antialias:a,premultipliedAlpha:l,preserveDrawingBuffer:c,powerPreference:h,failIfMajorPerformanceCaveat:u};if("setAttribute"in t&&t.setAttribute("data-engine","three.js r".concat(eg)),t.addEventListener("webglcontextlost",Le,!1),t.addEventListener("webglcontextrestored",et,!1),t.addEventListener("webglcontextcreationerror",Ze,!1),E===null){const Y="webgl2";if(E=j(Y,S),E===null)throw j(Y)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}}catch(S){throw console.error("THREE.WebGLRenderer: "+S.message),S}let q,ce,G,V,re,k,N,oe,pe,ve,xe,Pe,Te,Qe,lt,Ne,qe,Ke,it,je,dt,ct,At,ge;function be(){q=new kD(E),q.init(),ct=new _2(E,q),ce=new RD(E,q,e,ct),G=new g2(E,q),ce.reverseDepthBuffer&&d&&G.buffers.depth.setReversed(!0),V=new QD(E),re=new s2,k=new v2(E,q,G,re,ce,ct,V),N=new DD(v),oe=new ND(v),pe=new jB(E),At=new TD(E,pe),ve=new OD(E,pe,V,At),xe=new zD(E,ve,pe,V),it=new VD(E,ce,k),Ne=new PD(re),Pe=new i2(v,N,oe,q,ce,At,Ne),Te=new S2(v,re),Qe=new o2,lt=new d2(q),Ke=new MD(v,N,oe,G,xe,f,l),qe=new m2(v,xe,ce),ge=new I2(E,V,ce,G),je=new BD(E,q,V),dt=new UD(E,q,V),V.programs=Pe.programs,v.capabilities=ce,v.extensions=q,v.properties=re,v.renderLists=Qe,v.shadowMap=qe,v.state=G,v.info=V}be();const Ce=new E2(v,E);this.xr=Ce,this.getContext=function(){return E},this.getContextAttributes=function(){return E.getContextAttributes()},this.forceContextLoss=function(){const S=q.get("WEBGL_lose_context");S&&S.loseContext()},this.forceContextRestore=function(){const S=q.get("WEBGL_lose_context");S&&S.restoreContext()},this.getPixelRatio=function(){return O},this.setPixelRatio=function(S){S!==void 0&&(O=S,this.setSize(J,W,!1))},this.getSize=function(S){return S.set(J,W)},this.setSize=function(S,Y,X=!0){if(Ce.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}J=S,W=Y,t.width=Math.floor(S*O),t.height=Math.floor(Y*O),X===!0&&(t.style.width=S+"px",t.style.height=Y+"px"),this.setViewport(0,0,S,Y)},this.getDrawingBufferSize=function(S){return S.set(J*O,W*O).floor()},this.setDrawingBufferSize=function(S,Y,X){J=S,W=Y,O=X,t.width=Math.floor(S*X),t.height=Math.floor(Y*X),this.setViewport(0,0,S,Y)},this.getCurrentViewport=function(S){return S.copy(P)},this.getViewport=function(S){return S.copy(ee)},this.setViewport=function(S,Y,X,se){S.isVector4?ee.set(S.x,S.y,S.z,S.w):ee.set(S,Y,X,se),G.viewport(P.copy(ee).multiplyScalar(O).round())},this.getScissor=function(S){return S.copy(de)},this.setScissor=function(S,Y,X,se){S.isVector4?de.set(S.x,S.y,S.z,S.w):de.set(S,Y,X,se),G.scissor(z.copy(de).multiplyScalar(O).round())},this.getScissorTest=function(){return ae},this.setScissorTest=function(S){G.setScissorTest(ae=S)},this.setOpaqueSort=function(S){fe=S},this.setTransparentSort=function(S){ue=S},this.getClearColor=function(S){return S.copy(Ke.getClearColor())},this.setClearColor=function(){Ke.setClearColor.apply(Ke,arguments)},this.getClearAlpha=function(){return Ke.getClearAlpha()},this.setClearAlpha=function(){Ke.setClearAlpha.apply(Ke,arguments)},this.clear=function(S=!0,Y=!0,X=!0){let se=0;if(S){let $=!1;if(I!==null){const Ae=I.texture.format;$=Ae===ag||Ae===og||Ae===rg}if($){const Ae=I.texture.type,_e=Ae===Kn||Ae===ta||Ae===Hc||Ae===vl||Ae===ng||Ae===ig,ye=Ke.getClearColor(),Ee=Ke.getClearAlpha(),Re=ye.r,Ie=ye.g,Fe=ye.b;_e?(p[0]=Re,p[1]=Ie,p[2]=Fe,p[3]=Ee,E.clearBufferuiv(E.COLOR,0,p)):(A[0]=Re,A[1]=Ie,A[2]=Fe,A[3]=Ee,E.clearBufferiv(E.COLOR,0,A))}else se|=E.COLOR_BUFFER_BIT}Y&&(se|=E.DEPTH_BUFFER_BIT),X&&(se|=E.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),E.clear(se)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",Le,!1),t.removeEventListener("webglcontextrestored",et,!1),t.removeEventListener("webglcontextcreationerror",Ze,!1),Ke.dispose(),Qe.dispose(),lt.dispose(),re.dispose(),N.dispose(),oe.dispose(),xe.dispose(),At.dispose(),ge.dispose(),Pe.dispose(),Ce.dispose(),Ce.removeEventListener("sessionstart",Oe),Ce.removeEventListener("sessionend",Ue),mt.stop()};function Le(S){S.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),b=!0}function et(){console.log("THREE.WebGLRenderer: Context Restored."),b=!1;const S=V.autoReset,Y=qe.enabled,X=qe.autoUpdate,se=qe.needsUpdate,$=qe.type;be(),V.autoReset=S,qe.enabled=Y,qe.autoUpdate=X,qe.needsUpdate=se,qe.type=$}function Ze(S){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",S.statusMessage)}function _t(S){const Y=S.target;Y.removeEventListener("dispose",_t),Ht(Y)}function Ht(S){dn(S),re.remove(S)}function dn(S){const Y=re.get(S).programs;Y!==void 0&&(Y.forEach(function(X){Pe.releaseProgram(X)}),S.isShaderMaterial&&Pe.releaseShaderCache(S))}this.renderBufferDirect=function(S,Y,X,se,$,Ae){Y===null&&(Y=me);const _e=$.isMesh&&$.matrixWorld.determinant()<0,ye=ze(S,Y,X,se,$);G.setMaterial(se,_e);let Ee=X.index,Re=1;if(se.wireframe===!0){if(Ee=ve.getWireframeAttribute(X),Ee===void 0)return;Re=2}const Ie=X.drawRange,Fe=X.attributes.position;let De=Ie.start*Re,Ve=(Ie.start+Ie.count)*Re;Ae!==null&&(De=Math.max(De,Ae.start*Re),Ve=Math.min(Ve,(Ae.start+Ae.count)*Re)),Ee!==null?(De=Math.max(De,0),Ve=Math.min(Ve,Ee.count)):Fe!=null&&(De=Math.max(De,0),Ve=Math.min(Ve,Fe.count));const tt=Ve-De;if(tt<0||tt===1/0)return;At.setup($,se,ye,X,Ee);let ht,rt=je;if(Ee!==null&&(ht=pe.get(Ee),rt=dt,rt.setIndex(ht)),$.isMesh)se.wireframe===!0?(G.setLineWidth(se.wireframeLinewidth*Q()),rt.setMode(E.LINES)):rt.setMode(E.TRIANGLES);else if($.isLine){let nt=se.linewidth;nt===void 0&&(nt=1),G.setLineWidth(nt*Q()),$.isLineSegments?rt.setMode(E.LINES):$.isLineLoop?rt.setMode(E.LINE_LOOP):rt.setMode(E.LINE_STRIP)}else $.isPoints?rt.setMode(E.POINTS):$.isSprite&&rt.setMode(E.TRIANGLES);if($.isBatchedMesh)if($._multiDrawInstances!==null)rt.renderMultiDrawInstances($._multiDrawStarts,$._multiDrawCounts,$._multiDrawCount,$._multiDrawInstances);else if(q.get("WEBGL_multi_draw"))rt.renderMultiDraw($._multiDrawStarts,$._multiDrawCounts,$._multiDrawCount);else{const nt=$._multiDrawStarts,gt=$._multiDrawCounts,ke=$._multiDrawCount,bt=Ee?pe.get(Ee).bytesPerElement:1,Lt=re.get(se).currentProgram.getUniforms();for(let Bt=0;Bt<ke;Bt++)Lt.setValue(E,"_gl_DrawID",Bt),rt.render(nt[Bt]/bt,gt[Bt])}else if($.isInstancedMesh)rt.renderInstances(De,tt,$.count);else if(X.isInstancedBufferGeometry){const nt=X._maxInstanceCount!==void 0?X._maxInstanceCount:1/0,gt=Math.min(X.instanceCount,nt);rt.renderInstances(De,tt,gt)}else rt.render(De,tt)};function yt(S,Y,X){S.transparent===!0&&S.side===Ns&&S.forceSinglePass===!1?(S.side=Ti,S.needsUpdate=!0,Ye(S,Y,X),S.side=yr,S.needsUpdate=!0,Ye(S,Y,X),S.side=Ns):Ye(S,Y,X)}this.compile=function(S,Y,X=null){X===null&&(X=S),g=lt.get(X),g.init(Y),_.push(g),X.traverseVisible(function($){$.isLight&&$.layers.test(Y.layers)&&(g.pushLight($),$.castShadow&&g.pushShadow($))}),S!==X&&S.traverseVisible(function($){$.isLight&&$.layers.test(Y.layers)&&(g.pushLight($),$.castShadow&&g.pushShadow($))}),g.setupLights();const se=new Set;return S.traverse(function($){if(!($.isMesh||$.isPoints||$.isLine||$.isSprite))return;const Ae=$.material;if(Ae)if(Array.isArray(Ae))for(let _e=0;_e<Ae.length;_e++){const ye=Ae[_e];yt(ye,X,$),se.add(ye)}else yt(Ae,X,$),se.add(Ae)}),_.pop(),g=null,se},this.compileAsync=function(S,Y,X=null){const se=this.compile(S,Y,X);return new Promise($=>{function Ae(){if(se.forEach(function(_e){re.get(_e).currentProgram.isReady()&&se.delete(_e)}),se.size===0){$(S);return}setTimeout(Ae,10)}q.get("KHR_parallel_shader_compile")!==null?Ae():setTimeout(Ae,10)})};let Se=null;function Be(S){Se&&Se(S)}function Oe(){mt.stop()}function Ue(){mt.start()}const mt=new tb;mt.setAnimationLoop(Be),typeof self<"u"&&mt.setContext(self),this.setAnimationLoop=function(S){Se=S,Ce.setAnimationLoop(S),S===null?mt.stop():mt.start()},Ce.addEventListener("sessionstart",Oe),Ce.addEventListener("sessionend",Ue),this.render=function(S,Y){if(Y!==void 0&&Y.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(b===!0)return;if(S.matrixWorldAutoUpdate===!0&&S.updateMatrixWorld(),Y.parent===null&&Y.matrixWorldAutoUpdate===!0&&Y.updateMatrixWorld(),Ce.enabled===!0&&Ce.isPresenting===!0&&(Ce.cameraAutoUpdate===!0&&Ce.updateCamera(Y),Y=Ce.getCamera()),S.isScene===!0&&S.onBeforeRender(v,S,Y,I),g=lt.get(S,_.length),g.init(Y),_.push(g),te.multiplyMatrices(Y.projectionMatrix,Y.matrixWorldInverse),R.setFromProjectionMatrix(te),B=this.localClippingEnabled,M=Ne.init(this.clippingPlanes,B),m=Qe.get(S,y.length),m.init(),y.push(m),Ce.enabled===!0&&Ce.isPresenting===!0){const Ae=v.xr.getDepthSensingMesh();Ae!==null&&Je(Ae,Y,-1/0,v.sortObjects)}Je(S,Y,0,v.sortObjects),m.finish(),v.sortObjects===!0&&m.sort(fe,ue),F=Ce.enabled===!1||Ce.isPresenting===!1||Ce.hasDepthSensing()===!1,F&&Ke.addToRenderList(m,S),this.info.render.frame++,M===!0&&Ne.beginShadows();const X=g.state.shadowsArray;qe.render(X,S,Y),M===!0&&Ne.endShadows(),this.info.autoReset===!0&&this.info.reset();const se=m.opaque,$=m.transmissive;if(g.setupLights(),Y.isArrayCamera){const Ae=Y.cameras;if($.length>0)for(let _e=0,ye=Ae.length;_e<ye;_e++){const Ee=Ae[_e];$e(se,$,S,Ee)}F&&Ke.render(S);for(let _e=0,ye=Ae.length;_e<ye;_e++){const Ee=Ae[_e];Ge(m,S,Ee,Ee.viewport)}}else $.length>0&&$e(se,$,S,Y),F&&Ke.render(S),Ge(m,S,Y);I!==null&&L===0&&(k.updateMultisampleRenderTarget(I),k.updateRenderTargetMipmap(I)),S.isScene===!0&&S.onAfterRender(v,S,Y),At.resetDefaultState(),x=-1,w=null,_.pop(),_.length>0?(g=_[_.length-1],M===!0&&Ne.setGlobalState(v.clippingPlanes,g.state.camera)):g=null,y.pop(),y.length>0?m=y[y.length-1]:m=null};function Je(S,Y,X,se){if(S.visible===!1)return;if(S.layers.test(Y.layers)){if(S.isGroup)X=S.renderOrder;else if(S.isLOD)S.autoUpdate===!0&&S.update(Y);else if(S.isLight)g.pushLight(S),S.castShadow&&g.pushShadow(S);else if(S.isSprite){if(!S.frustumCulled||R.intersectsSprite(S)){se&&Z.setFromMatrixPosition(S.matrixWorld).applyMatrix4(te);const _e=xe.update(S),ye=S.material;ye.visible&&m.push(S,_e,ye,X,Z.z,null)}}else if((S.isMesh||S.isLine||S.isPoints)&&(!S.frustumCulled||R.intersectsObject(S))){const _e=xe.update(S),ye=S.material;if(se&&(S.boundingSphere!==void 0?(S.boundingSphere===null&&S.computeBoundingSphere(),Z.copy(S.boundingSphere.center)):(_e.boundingSphere===null&&_e.computeBoundingSphere(),Z.copy(_e.boundingSphere.center)),Z.applyMatrix4(S.matrixWorld).applyMatrix4(te)),Array.isArray(ye)){const Ee=_e.groups;for(let Re=0,Ie=Ee.length;Re<Ie;Re++){const Fe=Ee[Re],De=ye[Fe.materialIndex];De&&De.visible&&m.push(S,_e,De,X,Z.z,Fe)}}else ye.visible&&m.push(S,_e,ye,X,Z.z,null)}}const Ae=S.children;for(let _e=0,ye=Ae.length;_e<ye;_e++)Je(Ae[_e],Y,X,se)}function Ge(S,Y,X,se){const $=S.opaque,Ae=S.transmissive,_e=S.transparent;g.setupLightsView(X),M===!0&&Ne.setGlobalState(v.clippingPlanes,X),se&&G.viewport(P.copy(se)),$.length>0&&we($,Y,X),Ae.length>0&&we(Ae,Y,X),_e.length>0&&we(_e,Y,X),G.buffers.depth.setTest(!0),G.buffers.depth.setMask(!0),G.buffers.color.setMask(!0),G.setPolygonOffset(!1)}function $e(S,Y,X,se){if((X.isScene===!0?X.overrideMaterial:null)!==null)return;g.state.transmissionRenderTarget[se.id]===void 0&&(g.state.transmissionRenderTarget[se.id]=new na(1,1,{generateMipmaps:!0,type:q.has("EXT_color_buffer_half_float")||q.has("EXT_color_buffer_float")?Gn:Kn,minFilter:os,samples:4,stencilBuffer:r,resolveDepthBuffer:!1,resolveStencilBuffer:!1,colorSpace:St.workingColorSpace}));const Ae=g.state.transmissionRenderTarget[se.id],_e=se.viewport||P;Ae.setSize(_e.z*v.transmissionResolutionScale,_e.w*v.transmissionResolutionScale);const ye=v.getRenderTarget();v.setRenderTarget(Ae),v.getClearColor(K),le=v.getClearAlpha(),le<1&&v.setClearColor(16777215,.5),v.clear(),F&&Ke.render(X);const Ee=v.toneMapping;v.toneMapping=to;const Re=se.viewport;if(se.viewport!==void 0&&(se.viewport=void 0),g.setupLightsView(se),M===!0&&Ne.setGlobalState(v.clippingPlanes,se),we(S,X,se),k.updateMultisampleRenderTarget(Ae),k.updateRenderTargetMipmap(Ae),q.has("WEBGL_multisampled_render_to_texture")===!1){let Ie=!1;for(let Fe=0,De=Y.length;Fe<De;Fe++){const Ve=Y[Fe],tt=Ve.object,ht=Ve.geometry,rt=Ve.material,nt=Ve.group;if(rt.side===Ns&&tt.layers.test(se.layers)){const gt=rt.side;rt.side=Ti,rt.needsUpdate=!0,He(tt,X,se,ht,rt,nt),rt.side=gt,rt.needsUpdate=!0,Ie=!0}}Ie===!0&&(k.updateMultisampleRenderTarget(Ae),k.updateRenderTargetMipmap(Ae))}v.setRenderTarget(ye),v.setClearColor(K,le),Re!==void 0&&(se.viewport=Re),v.toneMapping=Ee}function we(S,Y,X){const se=Y.isScene===!0?Y.overrideMaterial:null;for(let $=0,Ae=S.length;$<Ae;$++){const _e=S[$],ye=_e.object,Ee=_e.geometry,Re=se===null?_e.material:se,Ie=_e.group;ye.layers.test(X.layers)&&He(ye,Y,X,Ee,Re,Ie)}}function He(S,Y,X,se,$,Ae){S.onBeforeRender(v,Y,X,se,$,Ae),S.modelViewMatrix.multiplyMatrices(X.matrixWorldInverse,S.matrixWorld),S.normalMatrix.getNormalMatrix(S.modelViewMatrix),$.onBeforeRender(v,Y,X,se,S,Ae),$.transparent===!0&&$.side===Ns&&$.forceSinglePass===!1?($.side=Ti,$.needsUpdate=!0,v.renderBufferDirect(X,Y,se,$,S,Ae),$.side=yr,$.needsUpdate=!0,v.renderBufferDirect(X,Y,se,$,S,Ae),$.side=Ns):v.renderBufferDirect(X,Y,se,$,S,Ae),S.onAfterRender(v,Y,X,se,$,Ae)}function Ye(S,Y,X){Y.isScene!==!0&&(Y=me);const se=re.get(S),$=g.state.lights,Ae=g.state.shadowsArray,_e=$.state.version,ye=Pe.getParameters(S,$.state,Ae,Y,X),Ee=Pe.getProgramCacheKey(ye);let Re=se.programs;se.environment=S.isMeshStandardMaterial?Y.environment:null,se.fog=Y.fog,se.envMap=(S.isMeshStandardMaterial?oe:N).get(S.envMap||se.environment),se.envMapRotation=se.environment!==null&&S.envMap===null?Y.environmentRotation:S.envMapRotation,Re===void 0&&(S.addEventListener("dispose",_t),Re=new Map,se.programs=Re);let Ie=Re.get(Ee);if(Ie!==void 0){if(se.currentProgram===Ie&&se.lightsStateVersion===_e)return Xe(S,ye),Ie}else ye.uniforms=Pe.getUniforms(S),S.onBeforeCompile(ye,v),Ie=Pe.acquireProgram(ye,Ee),Re.set(Ee,Ie),se.uniforms=ye.uniforms;const Fe=se.uniforms;return(!S.isShaderMaterial&&!S.isRawShaderMaterial||S.clipping===!0)&&(Fe.clippingPlanes=Ne.uniform),Xe(S,ye),se.needsLights=ut(S),se.lightsStateVersion=_e,se.needsLights&&(Fe.ambientLightColor.value=$.state.ambient,Fe.lightProbe.value=$.state.probe,Fe.directionalLights.value=$.state.directional,Fe.directionalLightShadows.value=$.state.directionalShadow,Fe.spotLights.value=$.state.spot,Fe.spotLightShadows.value=$.state.spotShadow,Fe.rectAreaLights.value=$.state.rectArea,Fe.ltc_1.value=$.state.rectAreaLTC1,Fe.ltc_2.value=$.state.rectAreaLTC2,Fe.pointLights.value=$.state.point,Fe.pointLightShadows.value=$.state.pointShadow,Fe.hemisphereLights.value=$.state.hemi,Fe.directionalShadowMap.value=$.state.directionalShadowMap,Fe.directionalShadowMatrix.value=$.state.directionalShadowMatrix,Fe.spotShadowMap.value=$.state.spotShadowMap,Fe.spotLightMatrix.value=$.state.spotLightMatrix,Fe.spotLightMap.value=$.state.spotLightMap,Fe.pointShadowMap.value=$.state.pointShadowMap,Fe.pointShadowMatrix.value=$.state.pointShadowMatrix),se.currentProgram=Ie,se.uniformsList=null,Ie}function ot(S){if(S.uniformsList===null){const Y=S.currentProgram.getUniforms();S.uniformsList=Uu.seqWithValue(Y.seq,S.uniforms)}return S.uniformsList}function Xe(S,Y){const X=re.get(S);X.outputColorSpace=Y.outputColorSpace,X.batching=Y.batching,X.batchingColor=Y.batchingColor,X.instancing=Y.instancing,X.instancingColor=Y.instancingColor,X.instancingMorph=Y.instancingMorph,X.skinning=Y.skinning,X.morphTargets=Y.morphTargets,X.morphNormals=Y.morphNormals,X.morphColors=Y.morphColors,X.morphTargetsCount=Y.morphTargetsCount,X.numClippingPlanes=Y.numClippingPlanes,X.numIntersection=Y.numClipIntersection,X.vertexAlphas=Y.vertexAlphas,X.vertexTangents=Y.vertexTangents,X.toneMapping=Y.toneMapping}function ze(S,Y,X,se,$){Y.isScene!==!0&&(Y=me),k.resetTextureUnits();const Ae=Y.fog,_e=se.isMeshStandardMaterial?Y.environment:null,ye=I===null?v.outputColorSpace:I.isXRRenderTarget===!0?I.texture.colorSpace:On,Ee=(se.isMeshStandardMaterial?oe:N).get(se.envMap||_e),Re=se.vertexColors===!0&&!!X.attributes.color&&X.attributes.color.itemSize===4,Ie=!!X.attributes.tangent&&(!!se.normalMap||se.anisotropy>0),Fe=!!X.morphAttributes.position,De=!!X.morphAttributes.normal,Ve=!!X.morphAttributes.color;let tt=to;se.toneMapped&&(I===null||I.isXRRenderTarget===!0)&&(tt=v.toneMapping);const ht=X.morphAttributes.position||X.morphAttributes.normal||X.morphAttributes.color,rt=ht!==void 0?ht.length:0,nt=re.get(se),gt=g.state.lights;if(M===!0&&(B===!0||S!==w)){const rn=S===w&&se.id===x;Ne.setState(se,S,rn)}let ke=!1;se.version===nt.__version?(nt.needsLights&&nt.lightsStateVersion!==gt.state.version||nt.outputColorSpace!==ye||$.isBatchedMesh&&nt.batching===!1||!$.isBatchedMesh&&nt.batching===!0||$.isBatchedMesh&&nt.batchingColor===!0&&$.colorTexture===null||$.isBatchedMesh&&nt.batchingColor===!1&&$.colorTexture!==null||$.isInstancedMesh&&nt.instancing===!1||!$.isInstancedMesh&&nt.instancing===!0||$.isSkinnedMesh&&nt.skinning===!1||!$.isSkinnedMesh&&nt.skinning===!0||$.isInstancedMesh&&nt.instancingColor===!0&&$.instanceColor===null||$.isInstancedMesh&&nt.instancingColor===!1&&$.instanceColor!==null||$.isInstancedMesh&&nt.instancingMorph===!0&&$.morphTexture===null||$.isInstancedMesh&&nt.instancingMorph===!1&&$.morphTexture!==null||nt.envMap!==Ee||se.fog===!0&&nt.fog!==Ae||nt.numClippingPlanes!==void 0&&(nt.numClippingPlanes!==Ne.numPlanes||nt.numIntersection!==Ne.numIntersection)||nt.vertexAlphas!==Re||nt.vertexTangents!==Ie||nt.morphTargets!==Fe||nt.morphNormals!==De||nt.morphColors!==Ve||nt.toneMapping!==tt||nt.morphTargetsCount!==rt)&&(ke=!0):(ke=!0,nt.__version=se.version);let bt=nt.currentProgram;ke===!0&&(bt=Ye(se,Y,$));let Lt=!1,Bt=!1,Et=!1;const vt=bt.getUniforms(),pn=nt.uniforms;if(G.useProgram(bt.program)&&(Lt=!0,Bt=!0,Et=!0),se.id!==x&&(x=se.id,Bt=!0),Lt||w!==S){G.buffers.depth.getReversed()?(D.copy(S.projectionMatrix),XT(D),YT(D),vt.setValue(E,"projectionMatrix",D)):vt.setValue(E,"projectionMatrix",S.projectionMatrix),vt.setValue(E,"viewMatrix",S.matrixWorldInverse);const Qn=vt.map.cameraPosition;Qn!==void 0&&Qn.setValue(E,ie.setFromMatrixPosition(S.matrixWorld)),ce.logarithmicDepthBuffer&&vt.setValue(E,"logDepthBufFC",2/(Math.log(S.far+1)/Math.LN2)),(se.isMeshPhongMaterial||se.isMeshToonMaterial||se.isMeshLambertMaterial||se.isMeshBasicMaterial||se.isMeshStandardMaterial||se.isShaderMaterial)&&vt.setValue(E,"isOrthographic",S.isOrthographicCamera===!0),w!==S&&(w=S,Bt=!0,Et=!0)}if($.isSkinnedMesh){vt.setOptional(E,$,"bindMatrix"),vt.setOptional(E,$,"bindMatrixInverse");const rn=$.skeleton;rn&&(rn.boneTexture===null&&rn.computeBoneTexture(),vt.setValue(E,"boneTexture",rn.boneTexture,k))}$.isBatchedMesh&&(vt.setOptional(E,$,"batchingTexture"),vt.setValue(E,"batchingTexture",$._matricesTexture,k),vt.setOptional(E,$,"batchingIdTexture"),vt.setValue(E,"batchingIdTexture",$._indirectTexture,k),vt.setOptional(E,$,"batchingColorTexture"),$._colorsTexture!==null&&vt.setValue(E,"batchingColorTexture",$._colorsTexture,k));const Ct=X.morphAttributes;if((Ct.position!==void 0||Ct.normal!==void 0||Ct.color!==void 0)&&it.update($,X,bt),(Bt||nt.receiveShadow!==$.receiveShadow)&&(nt.receiveShadow=$.receiveShadow,vt.setValue(E,"receiveShadow",$.receiveShadow)),se.isMeshGouraudMaterial&&se.envMap!==null&&(pn.envMap.value=Ee,pn.flipEnvMap.value=Ee.isCubeTexture&&Ee.isRenderTargetTexture===!1?-1:1),se.isMeshStandardMaterial&&se.envMap===null&&Y.environment!==null&&(pn.envMapIntensity.value=Y.environmentIntensity),Bt&&(vt.setValue(E,"toneMappingExposure",v.toneMappingExposure),nt.needsLights&&We(pn,Et),Ae&&se.fog===!0&&Te.refreshFogUniforms(pn,Ae),Te.refreshMaterialUniforms(pn,se,O,W,g.state.transmissionRenderTarget[S.id]),Uu.upload(E,ot(nt),pn,k)),se.isShaderMaterial&&se.uniformsNeedUpdate===!0&&(Uu.upload(E,ot(nt),pn,k),se.uniformsNeedUpdate=!1),se.isSpriteMaterial&&vt.setValue(E,"center",$.center),vt.setValue(E,"modelViewMatrix",$.modelViewMatrix),vt.setValue(E,"normalMatrix",$.normalMatrix),vt.setValue(E,"modelMatrix",$.matrixWorld),se.isShaderMaterial||se.isRawShaderMaterial){const rn=se.uniformsGroups;for(let Qn=0,Af=rn.length;Qn<Af;Qn++){const _o=rn[Qn];ge.update(_o,bt),ge.bind(_o,bt)}}return bt}function We(S,Y){S.ambientLightColor.needsUpdate=Y,S.lightProbe.needsUpdate=Y,S.directionalLights.needsUpdate=Y,S.directionalLightShadows.needsUpdate=Y,S.pointLights.needsUpdate=Y,S.pointLightShadows.needsUpdate=Y,S.spotLights.needsUpdate=Y,S.spotLightShadows.needsUpdate=Y,S.rectAreaLights.needsUpdate=Y,S.hemisphereLights.needsUpdate=Y}function ut(S){return S.isMeshLambertMaterial||S.isMeshToonMaterial||S.isMeshPhongMaterial||S.isMeshStandardMaterial||S.isShadowMaterial||S.isShaderMaterial&&S.lights===!0}this.getActiveCubeFace=function(){return T},this.getActiveMipmapLevel=function(){return L},this.getRenderTarget=function(){return I},this.setRenderTargetTextures=function(S,Y,X){re.get(S.texture).__webglTexture=Y,re.get(S.depthTexture).__webglTexture=X;const se=re.get(S);se.__hasExternalTextures=!0,se.__autoAllocateDepthBuffer=X===void 0,se.__autoAllocateDepthBuffer||q.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),se.__useRenderToTexture=!1)},this.setRenderTargetFramebuffer=function(S,Y){const X=re.get(S);X.__webglFramebuffer=Y,X.__useDefaultFramebuffer=Y===void 0};const C=E.createFramebuffer();this.setRenderTarget=function(S,Y=0,X=0){I=S,T=Y,L=X;let se=!0,$=null,Ae=!1,_e=!1;if(S){const Ee=re.get(S);if(Ee.__useDefaultFramebuffer!==void 0)G.bindFramebuffer(E.FRAMEBUFFER,null),se=!1;else if(Ee.__webglFramebuffer===void 0)k.setupRenderTarget(S);else if(Ee.__hasExternalTextures)k.rebindTextures(S,re.get(S.texture).__webglTexture,re.get(S.depthTexture).__webglTexture);else if(S.depthBuffer){const Fe=S.depthTexture;if(Ee.__boundDepthTexture!==Fe){if(Fe!==null&&re.has(Fe)&&(S.width!==Fe.image.width||S.height!==Fe.image.height))throw new Error("WebGLRenderTarget: Attached DepthTexture is initialized to the incorrect size.");k.setupDepthRenderbuffer(S)}}const Re=S.texture;(Re.isData3DTexture||Re.isDataArrayTexture||Re.isCompressedArrayTexture)&&(_e=!0);const Ie=re.get(S).__webglFramebuffer;S.isWebGLCubeRenderTarget?(Array.isArray(Ie[Y])?$=Ie[Y][X]:$=Ie[Y],Ae=!0):S.samples>0&&k.useMultisampledRTT(S)===!1?$=re.get(S).__webglMultisampledFramebuffer:Array.isArray(Ie)?$=Ie[X]:$=Ie,P.copy(S.viewport),z.copy(S.scissor),H=S.scissorTest}else P.copy(ee).multiplyScalar(O).floor(),z.copy(de).multiplyScalar(O).floor(),H=ae;if(X!==0&&($=C),G.bindFramebuffer(E.FRAMEBUFFER,$)&&se&&G.drawBuffers(S,$),G.viewport(P),G.scissor(z),G.setScissorTest(H),Ae){const Ee=re.get(S.texture);E.framebufferTexture2D(E.FRAMEBUFFER,E.COLOR_ATTACHMENT0,E.TEXTURE_CUBE_MAP_POSITIVE_X+Y,Ee.__webglTexture,X)}else if(_e){const Ee=re.get(S.texture),Re=Y;E.framebufferTextureLayer(E.FRAMEBUFFER,E.COLOR_ATTACHMENT0,Ee.__webglTexture,X,Re)}else if(S!==null&&X!==0){const Ee=re.get(S.texture);E.framebufferTexture2D(E.FRAMEBUFFER,E.COLOR_ATTACHMENT0,E.TEXTURE_2D,Ee.__webglTexture,X)}x=-1},this.readRenderTargetPixels=function(S,Y,X,se,$,Ae,_e){if(!(S&&S.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let ye=re.get(S).__webglFramebuffer;if(S.isWebGLCubeRenderTarget&&_e!==void 0&&(ye=ye[_e]),ye){G.bindFramebuffer(E.FRAMEBUFFER,ye);try{const Ee=S.texture,Re=Ee.format,Ie=Ee.type;if(!ce.textureFormatReadable(Re)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}if(!ce.textureTypeReadable(Ie)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}Y>=0&&Y<=S.width-se&&X>=0&&X<=S.height-$&&E.readPixels(Y,X,se,$,ct.convert(Re),ct.convert(Ie),Ae)}finally{const Ee=I!==null?re.get(I).__webglFramebuffer:null;G.bindFramebuffer(E.FRAMEBUFFER,Ee)}}},this.readRenderTargetPixelsAsync=async function(S,Y,X,se,$,Ae,_e){if(!(S&&S.isWebGLRenderTarget))throw new Error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let ye=re.get(S).__webglFramebuffer;if(S.isWebGLCubeRenderTarget&&_e!==void 0&&(ye=ye[_e]),ye){const Ee=S.texture,Re=Ee.format,Ie=Ee.type;if(!ce.textureFormatReadable(Re))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in RGBA or implementation defined format.");if(!ce.textureTypeReadable(Ie))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in UnsignedByteType or implementation defined type.");if(Y>=0&&Y<=S.width-se&&X>=0&&X<=S.height-$){G.bindFramebuffer(E.FRAMEBUFFER,ye);const Fe=E.createBuffer();E.bindBuffer(E.PIXEL_PACK_BUFFER,Fe),E.bufferData(E.PIXEL_PACK_BUFFER,Ae.byteLength,E.STREAM_READ),E.readPixels(Y,X,se,$,ct.convert(Re),ct.convert(Ie),0);const De=I!==null?re.get(I).__webglFramebuffer:null;G.bindFramebuffer(E.FRAMEBUFFER,De);const Ve=E.fenceSync(E.SYNC_GPU_COMMANDS_COMPLETE,0);return E.flush(),await jT(E,Ve,4),E.bindBuffer(E.PIXEL_PACK_BUFFER,Fe),E.getBufferSubData(E.PIXEL_PACK_BUFFER,0,Ae),E.deleteBuffer(Fe),E.deleteSync(Ve),Ae}else throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: requested read bounds are out of range.")}},this.copyFramebufferToTexture=function(S,Y=null,X=0){S.isTexture!==!0&&(za("WebGLRenderer: copyFramebufferToTexture function signature has changed."),Y=arguments[0]||null,S=arguments[1]);const se=Math.pow(2,-X),$=Math.floor(S.image.width*se),Ae=Math.floor(S.image.height*se),_e=Y!==null?Y.x:0,ye=Y!==null?Y.y:0;k.setTexture2D(S,0),E.copyTexSubImage2D(E.TEXTURE_2D,X,0,0,_e,ye,$,Ae),G.unbindTexture()};const U=E.createFramebuffer(),ne=E.createFramebuffer();this.copyTextureToTexture=function(S,Y,X=null,se=null,$=0,Ae=null){S.isTexture!==!0&&(za("WebGLRenderer: copyTextureToTexture function signature has changed."),se=arguments[0]||null,S=arguments[1],Y=arguments[2],Ae=arguments[3]||0,X=null),Ae===null&&($!==0?(za("WebGLRenderer: copyTextureToTexture function signature has changed to support src and dst mipmap levels."),Ae=$,$=0):Ae=0);let _e,ye,Ee,Re,Ie,Fe,De,Ve,tt;const ht=S.isCompressedTexture?S.mipmaps[Ae]:S.image;if(X!==null)_e=X.max.x-X.min.x,ye=X.max.y-X.min.y,Ee=X.isBox3?X.max.z-X.min.z:1,Re=X.min.x,Ie=X.min.y,Fe=X.isBox3?X.min.z:0;else{const Ct=Math.pow(2,-$);_e=Math.floor(ht.width*Ct),ye=Math.floor(ht.height*Ct),S.isDataArrayTexture?Ee=ht.depth:S.isData3DTexture?Ee=Math.floor(ht.depth*Ct):Ee=1,Re=0,Ie=0,Fe=0}se!==null?(De=se.x,Ve=se.y,tt=se.z):(De=0,Ve=0,tt=0);const rt=ct.convert(Y.format),nt=ct.convert(Y.type);let gt;Y.isData3DTexture?(k.setTexture3D(Y,0),gt=E.TEXTURE_3D):Y.isDataArrayTexture||Y.isCompressedArrayTexture?(k.setTexture2DArray(Y,0),gt=E.TEXTURE_2D_ARRAY):(k.setTexture2D(Y,0),gt=E.TEXTURE_2D),E.pixelStorei(E.UNPACK_FLIP_Y_WEBGL,Y.flipY),E.pixelStorei(E.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Y.premultiplyAlpha),E.pixelStorei(E.UNPACK_ALIGNMENT,Y.unpackAlignment);const ke=E.getParameter(E.UNPACK_ROW_LENGTH),bt=E.getParameter(E.UNPACK_IMAGE_HEIGHT),Lt=E.getParameter(E.UNPACK_SKIP_PIXELS),Bt=E.getParameter(E.UNPACK_SKIP_ROWS),Et=E.getParameter(E.UNPACK_SKIP_IMAGES);E.pixelStorei(E.UNPACK_ROW_LENGTH,ht.width),E.pixelStorei(E.UNPACK_IMAGE_HEIGHT,ht.height),E.pixelStorei(E.UNPACK_SKIP_PIXELS,Re),E.pixelStorei(E.UNPACK_SKIP_ROWS,Ie),E.pixelStorei(E.UNPACK_SKIP_IMAGES,Fe);const vt=S.isDataArrayTexture||S.isData3DTexture,pn=Y.isDataArrayTexture||Y.isData3DTexture;if(S.isDepthTexture){const Ct=re.get(S),rn=re.get(Y),Qn=re.get(Ct.__renderTarget),Af=re.get(rn.__renderTarget);G.bindFramebuffer(E.READ_FRAMEBUFFER,Qn.__webglFramebuffer),G.bindFramebuffer(E.DRAW_FRAMEBUFFER,Af.__webglFramebuffer);for(let _o=0;_o<Ee;_o++)vt&&(E.framebufferTextureLayer(E.READ_FRAMEBUFFER,E.COLOR_ATTACHMENT0,re.get(S).__webglTexture,$,Fe+_o),E.framebufferTextureLayer(E.DRAW_FRAMEBUFFER,E.COLOR_ATTACHMENT0,re.get(Y).__webglTexture,Ae,tt+_o)),E.blitFramebuffer(Re,Ie,_e,ye,De,Ve,_e,ye,E.DEPTH_BUFFER_BIT,E.NEAREST);G.bindFramebuffer(E.READ_FRAMEBUFFER,null),G.bindFramebuffer(E.DRAW_FRAMEBUFFER,null)}else if($!==0||S.isRenderTargetTexture||re.has(S)){const Ct=re.get(S),rn=re.get(Y);G.bindFramebuffer(E.READ_FRAMEBUFFER,U),G.bindFramebuffer(E.DRAW_FRAMEBUFFER,ne);for(let Qn=0;Qn<Ee;Qn++)vt?E.framebufferTextureLayer(E.READ_FRAMEBUFFER,E.COLOR_ATTACHMENT0,Ct.__webglTexture,$,Fe+Qn):E.framebufferTexture2D(E.READ_FRAMEBUFFER,E.COLOR_ATTACHMENT0,E.TEXTURE_2D,Ct.__webglTexture,$),pn?E.framebufferTextureLayer(E.DRAW_FRAMEBUFFER,E.COLOR_ATTACHMENT0,rn.__webglTexture,Ae,tt+Qn):E.framebufferTexture2D(E.DRAW_FRAMEBUFFER,E.COLOR_ATTACHMENT0,E.TEXTURE_2D,rn.__webglTexture,Ae),$!==0?E.blitFramebuffer(Re,Ie,_e,ye,De,Ve,_e,ye,E.COLOR_BUFFER_BIT,E.NEAREST):pn?E.copyTexSubImage3D(gt,Ae,De,Ve,tt+Qn,Re,Ie,_e,ye):E.copyTexSubImage2D(gt,Ae,De,Ve,Re,Ie,_e,ye);G.bindFramebuffer(E.READ_FRAMEBUFFER,null),G.bindFramebuffer(E.DRAW_FRAMEBUFFER,null)}else pn?S.isDataTexture||S.isData3DTexture?E.texSubImage3D(gt,Ae,De,Ve,tt,_e,ye,Ee,rt,nt,ht.data):Y.isCompressedArrayTexture?E.compressedTexSubImage3D(gt,Ae,De,Ve,tt,_e,ye,Ee,rt,ht.data):E.texSubImage3D(gt,Ae,De,Ve,tt,_e,ye,Ee,rt,nt,ht):S.isDataTexture?E.texSubImage2D(E.TEXTURE_2D,Ae,De,Ve,_e,ye,rt,nt,ht.data):S.isCompressedTexture?E.compressedTexSubImage2D(E.TEXTURE_2D,Ae,De,Ve,ht.width,ht.height,rt,ht.data):E.texSubImage2D(E.TEXTURE_2D,Ae,De,Ve,_e,ye,rt,nt,ht);E.pixelStorei(E.UNPACK_ROW_LENGTH,ke),E.pixelStorei(E.UNPACK_IMAGE_HEIGHT,bt),E.pixelStorei(E.UNPACK_SKIP_PIXELS,Lt),E.pixelStorei(E.UNPACK_SKIP_ROWS,Bt),E.pixelStorei(E.UNPACK_SKIP_IMAGES,Et),Ae===0&&Y.generateMipmaps&&E.generateMipmap(gt),G.unbindTexture()},this.copyTextureToTexture3D=function(S,Y,X=null,se=null,$=0){return S.isTexture!==!0&&(za("WebGLRenderer: copyTextureToTexture3D function signature has changed."),X=arguments[0]||null,se=arguments[1]||null,S=arguments[2],Y=arguments[3],$=arguments[4]||0),za('WebGLRenderer: copyTextureToTexture3D function has been deprecated. Use "copyTextureToTexture" instead.'),this.copyTextureToTexture(S,Y,X,se,$)},this.initRenderTarget=function(S){re.get(S).__webglFramebuffer===void 0&&k.setupRenderTarget(S)},this.initTexture=function(S){S.isCubeTexture?k.setTextureCube(S,0):S.isData3DTexture?k.setTexture3D(S,0):S.isDataArrayTexture||S.isCompressedArrayTexture?k.setTexture2DArray(S,0):k.setTexture2D(S,0),G.unbindTexture()},this.resetState=function(){T=0,L=0,I=null,G.reset(),At.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return Os}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e;const t=this.getContext();t.drawingBufferColorspace=St._getDrawingBufferColorSpace(e),t.unpackColorSpace=St._getUnpackColorSpace()}}const S0={type:"change"},Eg={type:"start"},ob={type:"end"},gu=new _h,I0=new Wr,T2=Math.cos(70*bn.DEG2RAD),Vn=new he,Ci=2*Math.PI,Jt={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},hp=1e-6;class B2 extends eb{constructor(e,t=null){super(e,t),this.state=Jt.NONE,this.enabled=!0,this.target=new he,this.cursor=new he,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minTargetRadius=0,this.maxTargetRadius=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.keyRotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:ds.ROTATE,MIDDLE:ds.DOLLY,RIGHT:ds.PAN},this.touches={ONE:Ha.ROTATE,TWO:Ha.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this._lastPosition=new he,this._lastQuaternion=new zn,this._lastTargetPosition=new he,this._quat=new zn().setFromUnitVectors(e.up,new he(0,1,0)),this._quatInverse=this._quat.clone().invert(),this._spherical=new Z_,this._sphericalDelta=new Z_,this._scale=1,this._panOffset=new he,this._rotateStart=new Me,this._rotateEnd=new Me,this._rotateDelta=new Me,this._panStart=new Me,this._panEnd=new Me,this._panDelta=new Me,this._dollyStart=new Me,this._dollyEnd=new Me,this._dollyDelta=new Me,this._dollyDirection=new he,this._mouse=new Me,this._performCursorZoom=!1,this._pointers=[],this._pointerPositions={},this._controlActive=!1,this._onPointerMove=P2.bind(this),this._onPointerDown=R2.bind(this),this._onPointerUp=D2.bind(this),this._onContextMenu=Q2.bind(this),this._onMouseWheel=N2.bind(this),this._onKeyDown=k2.bind(this),this._onTouchStart=O2.bind(this),this._onTouchMove=U2.bind(this),this._onMouseDown=L2.bind(this),this._onMouseMove=F2.bind(this),this._interceptControlDown=V2.bind(this),this._interceptControlUp=z2.bind(this),this.domElement!==null&&this.connect(),this.update()}connect(){this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointercancel",this._onPointerUp),this.domElement.addEventListener("contextmenu",this._onContextMenu),this.domElement.addEventListener("wheel",this._onMouseWheel,{passive:!1}),this.domElement.getRootNode().addEventListener("keydown",this._interceptControlDown,{passive:!0,capture:!0}),this.domElement.style.touchAction="none"}disconnect(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.removeEventListener("pointercancel",this._onPointerUp),this.domElement.removeEventListener("wheel",this._onMouseWheel),this.domElement.removeEventListener("contextmenu",this._onContextMenu),this.stopListenToKeyEvents(),this.domElement.getRootNode().removeEventListener("keydown",this._interceptControlDown,{capture:!0}),this.domElement.style.touchAction="auto"}dispose(){this.disconnect()}getPolarAngle(){return this._spherical.phi}getAzimuthalAngle(){return this._spherical.theta}getDistance(){return this.object.position.distanceTo(this.target)}listenToKeyEvents(e){e.addEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=e}stopListenToKeyEvents(){this._domElementKeyEvents!==null&&(this._domElementKeyEvents.removeEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=null)}saveState(){this.target0.copy(this.target),this.position0.copy(this.object.position),this.zoom0=this.object.zoom}reset(){this.target.copy(this.target0),this.object.position.copy(this.position0),this.object.zoom=this.zoom0,this.object.updateProjectionMatrix(),this.dispatchEvent(S0),this.update(),this.state=Jt.NONE}update(e=null){const t=this.object.position;Vn.copy(t).sub(this.target),Vn.applyQuaternion(this._quat),this._spherical.setFromVector3(Vn),this.autoRotate&&this.state===Jt.NONE&&this._rotateLeft(this._getAutoRotationAngle(e)),this.enableDamping?(this._spherical.theta+=this._sphericalDelta.theta*this.dampingFactor,this._spherical.phi+=this._sphericalDelta.phi*this.dampingFactor):(this._spherical.theta+=this._sphericalDelta.theta,this._spherical.phi+=this._sphericalDelta.phi);let n=this.minAzimuthAngle,s=this.maxAzimuthAngle;isFinite(n)&&isFinite(s)&&(n<-Math.PI?n+=Ci:n>Math.PI&&(n-=Ci),s<-Math.PI?s+=Ci:s>Math.PI&&(s-=Ci),n<=s?this._spherical.theta=Math.max(n,Math.min(s,this._spherical.theta)):this._spherical.theta=this._spherical.theta>(n+s)/2?Math.max(n,this._spherical.theta):Math.min(s,this._spherical.theta)),this._spherical.phi=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,this._spherical.phi)),this._spherical.makeSafe(),this.enableDamping===!0?this.target.addScaledVector(this._panOffset,this.dampingFactor):this.target.add(this._panOffset),this.target.sub(this.cursor),this.target.clampLength(this.minTargetRadius,this.maxTargetRadius),this.target.add(this.cursor);let r=!1;if(this.zoomToCursor&&this._performCursorZoom||this.object.isOrthographicCamera)this._spherical.radius=this._clampDistance(this._spherical.radius);else{const o=this._spherical.radius;this._spherical.radius=this._clampDistance(this._spherical.radius*this._scale),r=o!=this._spherical.radius}if(Vn.setFromSpherical(this._spherical),Vn.applyQuaternion(this._quatInverse),t.copy(this.target).add(Vn),this.object.lookAt(this.target),this.enableDamping===!0?(this._sphericalDelta.theta*=1-this.dampingFactor,this._sphericalDelta.phi*=1-this.dampingFactor,this._panOffset.multiplyScalar(1-this.dampingFactor)):(this._sphericalDelta.set(0,0,0),this._panOffset.set(0,0,0)),this.zoomToCursor&&this._performCursorZoom){let o=null;if(this.object.isPerspectiveCamera){const a=Vn.length();o=this._clampDistance(a*this._scale);const l=a-o;this.object.position.addScaledVector(this._dollyDirection,l),this.object.updateMatrixWorld(),r=!!l}else if(this.object.isOrthographicCamera){const a=new he(this._mouse.x,this._mouse.y,0);a.unproject(this.object);const l=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),this.object.updateProjectionMatrix(),r=l!==this.object.zoom;const c=new he(this._mouse.x,this._mouse.y,0);c.unproject(this.object),this.object.position.sub(c).add(a),this.object.updateMatrixWorld(),o=Vn.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),this.zoomToCursor=!1;o!==null&&(this.screenSpacePanning?this.target.set(0,0,-1).transformDirection(this.object.matrix).multiplyScalar(o).add(this.object.position):(gu.origin.copy(this.object.position),gu.direction.set(0,0,-1).transformDirection(this.object.matrix),Math.abs(this.object.up.dot(gu.direction))<T2?this.object.lookAt(this.target):(I0.setFromNormalAndCoplanarPoint(this.object.up,this.target),gu.intersectPlane(I0,this.target))))}else if(this.object.isOrthographicCamera){const o=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),o!==this.object.zoom&&(this.object.updateProjectionMatrix(),r=!0)}return this._scale=1,this._performCursorZoom=!1,r||this._lastPosition.distanceToSquared(this.object.position)>hp||8*(1-this._lastQuaternion.dot(this.object.quaternion))>hp||this._lastTargetPosition.distanceToSquared(this.target)>hp?(this.dispatchEvent(S0),this._lastPosition.copy(this.object.position),this._lastQuaternion.copy(this.object.quaternion),this._lastTargetPosition.copy(this.target),!0):!1}_getAutoRotationAngle(e){return e!==null?Ci/60*this.autoRotateSpeed*e:Ci/60/60*this.autoRotateSpeed}_getZoomScale(e){const t=Math.abs(e*.01);return Math.pow(.95,this.zoomSpeed*t)}_rotateLeft(e){this._sphericalDelta.theta-=e}_rotateUp(e){this._sphericalDelta.phi-=e}_panLeft(e,t){Vn.setFromMatrixColumn(t,0),Vn.multiplyScalar(-e),this._panOffset.add(Vn)}_panUp(e,t){this.screenSpacePanning===!0?Vn.setFromMatrixColumn(t,1):(Vn.setFromMatrixColumn(t,0),Vn.crossVectors(this.object.up,Vn)),Vn.multiplyScalar(e),this._panOffset.add(Vn)}_pan(e,t){const n=this.domElement;if(this.object.isPerspectiveCamera){const s=this.object.position;Vn.copy(s).sub(this.target);let r=Vn.length();r*=Math.tan(this.object.fov/2*Math.PI/180),this._panLeft(2*e*r/n.clientHeight,this.object.matrix),this._panUp(2*t*r/n.clientHeight,this.object.matrix)}else this.object.isOrthographicCamera?(this._panLeft(e*(this.object.right-this.object.left)/this.object.zoom/n.clientWidth,this.object.matrix),this._panUp(t*(this.object.top-this.object.bottom)/this.object.zoom/n.clientHeight,this.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),this.enablePan=!1)}_dollyOut(e){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale/=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_dollyIn(e){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale*=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_updateZoomParameters(e,t){if(!this.zoomToCursor)return;this._performCursorZoom=!0;const n=this.domElement.getBoundingClientRect(),s=e-n.left,r=t-n.top,o=n.width,a=n.height;this._mouse.x=s/o*2-1,this._mouse.y=-(r/a)*2+1,this._dollyDirection.set(this._mouse.x,this._mouse.y,1).unproject(this.object).sub(this.object.position).normalize()}_clampDistance(e){return Math.max(this.minDistance,Math.min(this.maxDistance,e))}_handleMouseDownRotate(e){this._rotateStart.set(e.clientX,e.clientY)}_handleMouseDownDolly(e){this._updateZoomParameters(e.clientX,e.clientX),this._dollyStart.set(e.clientX,e.clientY)}_handleMouseDownPan(e){this._panStart.set(e.clientX,e.clientY)}_handleMouseMoveRotate(e){this._rotateEnd.set(e.clientX,e.clientY),this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const t=this.domElement;this._rotateLeft(Ci*this._rotateDelta.x/t.clientHeight),this._rotateUp(Ci*this._rotateDelta.y/t.clientHeight),this._rotateStart.copy(this._rotateEnd),this.update()}_handleMouseMoveDolly(e){this._dollyEnd.set(e.clientX,e.clientY),this._dollyDelta.subVectors(this._dollyEnd,this._dollyStart),this._dollyDelta.y>0?this._dollyOut(this._getZoomScale(this._dollyDelta.y)):this._dollyDelta.y<0&&this._dollyIn(this._getZoomScale(this._dollyDelta.y)),this._dollyStart.copy(this._dollyEnd),this.update()}_handleMouseMovePan(e){this._panEnd.set(e.clientX,e.clientY),this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd),this.update()}_handleMouseWheel(e){this._updateZoomParameters(e.clientX,e.clientY),e.deltaY<0?this._dollyIn(this._getZoomScale(e.deltaY)):e.deltaY>0&&this._dollyOut(this._getZoomScale(e.deltaY)),this.update()}_handleKeyDown(e){let t=!1;switch(e.code){case this.keys.UP:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateUp(Ci*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(0,this.keyPanSpeed),t=!0;break;case this.keys.BOTTOM:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateUp(-Ci*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(0,-this.keyPanSpeed),t=!0;break;case this.keys.LEFT:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateLeft(Ci*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(this.keyPanSpeed,0),t=!0;break;case this.keys.RIGHT:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateLeft(-Ci*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(-this.keyPanSpeed,0),t=!0;break}t&&(e.preventDefault(),this.update())}_handleTouchStartRotate(e){if(this._pointers.length===1)this._rotateStart.set(e.pageX,e.pageY);else{const t=this._getSecondPointerPosition(e),n=.5*(e.pageX+t.x),s=.5*(e.pageY+t.y);this._rotateStart.set(n,s)}}_handleTouchStartPan(e){if(this._pointers.length===1)this._panStart.set(e.pageX,e.pageY);else{const t=this._getSecondPointerPosition(e),n=.5*(e.pageX+t.x),s=.5*(e.pageY+t.y);this._panStart.set(n,s)}}_handleTouchStartDolly(e){const t=this._getSecondPointerPosition(e),n=e.pageX-t.x,s=e.pageY-t.y,r=Math.sqrt(n*n+s*s);this._dollyStart.set(0,r)}_handleTouchStartDollyPan(e){this.enableZoom&&this._handleTouchStartDolly(e),this.enablePan&&this._handleTouchStartPan(e)}_handleTouchStartDollyRotate(e){this.enableZoom&&this._handleTouchStartDolly(e),this.enableRotate&&this._handleTouchStartRotate(e)}_handleTouchMoveRotate(e){if(this._pointers.length==1)this._rotateEnd.set(e.pageX,e.pageY);else{const n=this._getSecondPointerPosition(e),s=.5*(e.pageX+n.x),r=.5*(e.pageY+n.y);this._rotateEnd.set(s,r)}this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const t=this.domElement;this._rotateLeft(Ci*this._rotateDelta.x/t.clientHeight),this._rotateUp(Ci*this._rotateDelta.y/t.clientHeight),this._rotateStart.copy(this._rotateEnd)}_handleTouchMovePan(e){if(this._pointers.length===1)this._panEnd.set(e.pageX,e.pageY);else{const t=this._getSecondPointerPosition(e),n=.5*(e.pageX+t.x),s=.5*(e.pageY+t.y);this._panEnd.set(n,s)}this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd)}_handleTouchMoveDolly(e){const t=this._getSecondPointerPosition(e),n=e.pageX-t.x,s=e.pageY-t.y,r=Math.sqrt(n*n+s*s);this._dollyEnd.set(0,r),this._dollyDelta.set(0,Math.pow(this._dollyEnd.y/this._dollyStart.y,this.zoomSpeed)),this._dollyOut(this._dollyDelta.y),this._dollyStart.copy(this._dollyEnd);const o=(e.pageX+t.x)*.5,a=(e.pageY+t.y)*.5;this._updateZoomParameters(o,a)}_handleTouchMoveDollyPan(e){this.enableZoom&&this._handleTouchMoveDolly(e),this.enablePan&&this._handleTouchMovePan(e)}_handleTouchMoveDollyRotate(e){this.enableZoom&&this._handleTouchMoveDolly(e),this.enableRotate&&this._handleTouchMoveRotate(e)}_addPointer(e){this._pointers.push(e.pointerId)}_removePointer(e){delete this._pointerPositions[e.pointerId];for(let t=0;t<this._pointers.length;t++)if(this._pointers[t]==e.pointerId){this._pointers.splice(t,1);return}}_isTrackingPointer(e){for(let t=0;t<this._pointers.length;t++)if(this._pointers[t]==e.pointerId)return!0;return!1}_trackPointer(e){let t=this._pointerPositions[e.pointerId];t===void 0&&(t=new Me,this._pointerPositions[e.pointerId]=t),t.set(e.pageX,e.pageY)}_getSecondPointerPosition(e){const t=e.pointerId===this._pointers[0]?this._pointers[1]:this._pointers[0];return this._pointerPositions[t]}_customWheelEvent(e){const t=e.deltaMode,n={clientX:e.clientX,clientY:e.clientY,deltaY:e.deltaY};switch(t){case 1:n.deltaY*=16;break;case 2:n.deltaY*=100;break}return e.ctrlKey&&!this._controlActive&&(n.deltaY*=10),n}}function R2(i){this.enabled!==!1&&(this._pointers.length===0&&(this.domElement.setPointerCapture(i.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.domElement.addEventListener("pointerup",this._onPointerUp)),!this._isTrackingPointer(i)&&(this._addPointer(i),i.pointerType==="touch"?this._onTouchStart(i):this._onMouseDown(i)))}function P2(i){this.enabled!==!1&&(i.pointerType==="touch"?this._onTouchMove(i):this._onMouseMove(i))}function D2(i){switch(this._removePointer(i),this._pointers.length){case 0:this.domElement.releasePointerCapture(i.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.dispatchEvent(ob),this.state=Jt.NONE;break;case 1:const e=this._pointers[0],t=this._pointerPositions[e];this._onTouchStart({pointerId:e,pageX:t.x,pageY:t.y});break}}function L2(i){let e;switch(i.button){case 0:e=this.mouseButtons.LEFT;break;case 1:e=this.mouseButtons.MIDDLE;break;case 2:e=this.mouseButtons.RIGHT;break;default:e=-1}switch(e){case ds.DOLLY:if(this.enableZoom===!1)return;this._handleMouseDownDolly(i),this.state=Jt.DOLLY;break;case ds.ROTATE:if(i.ctrlKey||i.metaKey||i.shiftKey){if(this.enablePan===!1)return;this._handleMouseDownPan(i),this.state=Jt.PAN}else{if(this.enableRotate===!1)return;this._handleMouseDownRotate(i),this.state=Jt.ROTATE}break;case ds.PAN:if(i.ctrlKey||i.metaKey||i.shiftKey){if(this.enableRotate===!1)return;this._handleMouseDownRotate(i),this.state=Jt.ROTATE}else{if(this.enablePan===!1)return;this._handleMouseDownPan(i),this.state=Jt.PAN}break;default:this.state=Jt.NONE}this.state!==Jt.NONE&&this.dispatchEvent(Eg)}function F2(i){switch(this.state){case Jt.ROTATE:if(this.enableRotate===!1)return;this._handleMouseMoveRotate(i);break;case Jt.DOLLY:if(this.enableZoom===!1)return;this._handleMouseMoveDolly(i);break;case Jt.PAN:if(this.enablePan===!1)return;this._handleMouseMovePan(i);break}}function N2(i){this.enabled===!1||this.enableZoom===!1||this.state!==Jt.NONE||(i.preventDefault(),this.dispatchEvent(Eg),this._handleMouseWheel(this._customWheelEvent(i)),this.dispatchEvent(ob))}function k2(i){this.enabled!==!1&&this._handleKeyDown(i)}function O2(i){switch(this._trackPointer(i),this._pointers.length){case 1:switch(this.touches.ONE){case Ha.ROTATE:if(this.enableRotate===!1)return;this._handleTouchStartRotate(i),this.state=Jt.TOUCH_ROTATE;break;case Ha.PAN:if(this.enablePan===!1)return;this._handleTouchStartPan(i),this.state=Jt.TOUCH_PAN;break;default:this.state=Jt.NONE}break;case 2:switch(this.touches.TWO){case Ha.DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this._handleTouchStartDollyPan(i),this.state=Jt.TOUCH_DOLLY_PAN;break;case Ha.DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this._handleTouchStartDollyRotate(i),this.state=Jt.TOUCH_DOLLY_ROTATE;break;default:this.state=Jt.NONE}break;default:this.state=Jt.NONE}this.state!==Jt.NONE&&this.dispatchEvent(Eg)}function U2(i){switch(this._trackPointer(i),this.state){case Jt.TOUCH_ROTATE:if(this.enableRotate===!1)return;this._handleTouchMoveRotate(i),this.update();break;case Jt.TOUCH_PAN:if(this.enablePan===!1)return;this._handleTouchMovePan(i),this.update();break;case Jt.TOUCH_DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this._handleTouchMoveDollyPan(i),this.update();break;case Jt.TOUCH_DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this._handleTouchMoveDollyRotate(i),this.update();break;default:this.state=Jt.NONE}}function Q2(i){this.enabled!==!1&&i.preventDefault()}function V2(i){i.key==="Control"&&(this._controlActive=!0,this.domElement.getRootNode().addEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0}))}function z2(i){i.key==="Control"&&(this._controlActive=!1,this.domElement.getRootNode().removeEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0}))}const up={type:"change"},Cg={type:"start"},Sg={type:"end"},M0=1e-6,Wt={NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM_PAN:4},vu=new Me,Dr=new Me,G2=new he,_u=new he,dp=new he,Da=new zn,T0=new he,yu=new he,fp=new he,xu=new he;class H2 extends eb{constructor(e,t=null){super(e,t),this.enabled=!0,this.screen={left:0,top:0,width:0,height:0},this.rotateSpeed=1,this.zoomSpeed=1.2,this.panSpeed=.3,this.noRotate=!1,this.noZoom=!1,this.noPan=!1,this.staticMoving=!1,this.dynamicDampingFactor=.2,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.keys=["KeyA","KeyS","KeyD"],this.mouseButtons={LEFT:ds.ROTATE,MIDDLE:ds.DOLLY,RIGHT:ds.PAN},this.state=Wt.NONE,this.keyState=Wt.NONE,this.target=new he,this._lastPosition=new he,this._lastZoom=1,this._touchZoomDistanceStart=0,this._touchZoomDistanceEnd=0,this._lastAngle=0,this._eye=new he,this._movePrev=new Me,this._moveCurr=new Me,this._lastAxis=new he,this._zoomStart=new Me,this._zoomEnd=new Me,this._panStart=new Me,this._panEnd=new Me,this._pointers=[],this._pointerPositions={},this._onPointerMove=q2.bind(this),this._onPointerDown=W2.bind(this),this._onPointerUp=j2.bind(this),this._onPointerCancel=X2.bind(this),this._onContextMenu=tF.bind(this),this._onMouseWheel=eF.bind(this),this._onKeyDown=K2.bind(this),this._onKeyUp=Y2.bind(this),this._onTouchStart=nF.bind(this),this._onTouchMove=iF.bind(this),this._onTouchEnd=sF.bind(this),this._onMouseDown=$2.bind(this),this._onMouseMove=J2.bind(this),this._onMouseUp=Z2.bind(this),this._target0=this.target.clone(),this._position0=this.object.position.clone(),this._up0=this.object.up.clone(),this._zoom0=this.object.zoom,t!==null&&(this.connect(),this.handleResize()),this.update()}connect(){window.addEventListener("keydown",this._onKeyDown),window.addEventListener("keyup",this._onKeyUp),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointercancel",this._onPointerCancel),this.domElement.addEventListener("wheel",this._onMouseWheel,{passive:!1}),this.domElement.addEventListener("contextmenu",this._onContextMenu),this.domElement.style.touchAction="none"}disconnect(){window.removeEventListener("keydown",this._onKeyDown),window.removeEventListener("keyup",this._onKeyUp),this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.removeEventListener("pointercancel",this._onPointerCancel),this.domElement.removeEventListener("wheel",this._onMouseWheel),this.domElement.removeEventListener("contextmenu",this._onContextMenu),this.domElement.style.touchAction="auto"}dispose(){this.disconnect()}handleResize(){const e=this.domElement.getBoundingClientRect(),t=this.domElement.ownerDocument.documentElement;this.screen.left=e.left+window.pageXOffset-t.clientLeft,this.screen.top=e.top+window.pageYOffset-t.clientTop,this.screen.width=e.width,this.screen.height=e.height}update(){this._eye.subVectors(this.object.position,this.target),this.noRotate||this._rotateCamera(),this.noZoom||this._zoomCamera(),this.noPan||this._panCamera(),this.object.position.addVectors(this.target,this._eye),this.object.isPerspectiveCamera?(this._checkDistances(),this.object.lookAt(this.target),this._lastPosition.distanceToSquared(this.object.position)>M0&&(this.dispatchEvent(up),this._lastPosition.copy(this.object.position))):this.object.isOrthographicCamera?(this.object.lookAt(this.target),(this._lastPosition.distanceToSquared(this.object.position)>M0||this._lastZoom!==this.object.zoom)&&(this.dispatchEvent(up),this._lastPosition.copy(this.object.position),this._lastZoom=this.object.zoom)):console.warn("THREE.TrackballControls: Unsupported camera type.")}reset(){this.state=Wt.NONE,this.keyState=Wt.NONE,this.target.copy(this._target0),this.object.position.copy(this._position0),this.object.up.copy(this._up0),this.object.zoom=this._zoom0,this.object.updateProjectionMatrix(),this._eye.subVectors(this.object.position,this.target),this.object.lookAt(this.target),this.dispatchEvent(up),this._lastPosition.copy(this.object.position),this._lastZoom=this.object.zoom}_panCamera(){if(Dr.copy(this._panEnd).sub(this._panStart),Dr.lengthSq()){if(this.object.isOrthographicCamera){const e=(this.object.right-this.object.left)/this.object.zoom/this.domElement.clientWidth,t=(this.object.top-this.object.bottom)/this.object.zoom/this.domElement.clientWidth;Dr.x*=e,Dr.y*=t}Dr.multiplyScalar(this._eye.length()*this.panSpeed),_u.copy(this._eye).cross(this.object.up).setLength(Dr.x),_u.add(G2.copy(this.object.up).setLength(Dr.y)),this.object.position.add(_u),this.target.add(_u),this.staticMoving?this._panStart.copy(this._panEnd):this._panStart.add(Dr.subVectors(this._panEnd,this._panStart).multiplyScalar(this.dynamicDampingFactor))}}_rotateCamera(){xu.set(this._moveCurr.x-this._movePrev.x,this._moveCurr.y-this._movePrev.y,0);let e=xu.length();e?(this._eye.copy(this.object.position).sub(this.target),T0.copy(this._eye).normalize(),yu.copy(this.object.up).normalize(),fp.crossVectors(yu,T0).normalize(),yu.setLength(this._moveCurr.y-this._movePrev.y),fp.setLength(this._moveCurr.x-this._movePrev.x),xu.copy(yu.add(fp)),dp.crossVectors(xu,this._eye).normalize(),e*=this.rotateSpeed,Da.setFromAxisAngle(dp,e),this._eye.applyQuaternion(Da),this.object.up.applyQuaternion(Da),this._lastAxis.copy(dp),this._lastAngle=e):!this.staticMoving&&this._lastAngle&&(this._lastAngle*=Math.sqrt(1-this.dynamicDampingFactor),this._eye.copy(this.object.position).sub(this.target),Da.setFromAxisAngle(this._lastAxis,this._lastAngle),this._eye.applyQuaternion(Da),this.object.up.applyQuaternion(Da)),this._movePrev.copy(this._moveCurr)}_zoomCamera(){let e;this.state===Wt.TOUCH_ZOOM_PAN?(e=this._touchZoomDistanceStart/this._touchZoomDistanceEnd,this._touchZoomDistanceStart=this._touchZoomDistanceEnd,this.object.isPerspectiveCamera?this._eye.multiplyScalar(e):this.object.isOrthographicCamera?(this.object.zoom=bn.clamp(this.object.zoom/e,this.minZoom,this.maxZoom),this._lastZoom!==this.object.zoom&&this.object.updateProjectionMatrix()):console.warn("THREE.TrackballControls: Unsupported camera type")):(e=1+(this._zoomEnd.y-this._zoomStart.y)*this.zoomSpeed,e!==1&&e>0&&(this.object.isPerspectiveCamera?this._eye.multiplyScalar(e):this.object.isOrthographicCamera?(this.object.zoom=bn.clamp(this.object.zoom/e,this.minZoom,this.maxZoom),this._lastZoom!==this.object.zoom&&this.object.updateProjectionMatrix()):console.warn("THREE.TrackballControls: Unsupported camera type")),this.staticMoving?this._zoomStart.copy(this._zoomEnd):this._zoomStart.y+=(this._zoomEnd.y-this._zoomStart.y)*this.dynamicDampingFactor)}_getMouseOnScreen(e,t){return vu.set((e-this.screen.left)/this.screen.width,(t-this.screen.top)/this.screen.height),vu}_getMouseOnCircle(e,t){return vu.set((e-this.screen.width*.5-this.screen.left)/(this.screen.width*.5),(this.screen.height+2*(this.screen.top-t))/this.screen.width),vu}_addPointer(e){this._pointers.push(e)}_removePointer(e){delete this._pointerPositions[e.pointerId];for(let t=0;t<this._pointers.length;t++)if(this._pointers[t].pointerId==e.pointerId){this._pointers.splice(t,1);return}}_trackPointer(e){let t=this._pointerPositions[e.pointerId];t===void 0&&(t=new Me,this._pointerPositions[e.pointerId]=t),t.set(e.pageX,e.pageY)}_getSecondPointerPosition(e){const t=e.pointerId===this._pointers[0].pointerId?this._pointers[1]:this._pointers[0];return this._pointerPositions[t.pointerId]}_checkDistances(){(!this.noZoom||!this.noPan)&&(this._eye.lengthSq()>this.maxDistance*this.maxDistance&&(this.object.position.addVectors(this.target,this._eye.setLength(this.maxDistance)),this._zoomStart.copy(this._zoomEnd)),this._eye.lengthSq()<this.minDistance*this.minDistance&&(this.object.position.addVectors(this.target,this._eye.setLength(this.minDistance)),this._zoomStart.copy(this._zoomEnd)))}}function W2(i){this.enabled!==!1&&(this._pointers.length===0&&(this.domElement.setPointerCapture(i.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.domElement.addEventListener("pointerup",this._onPointerUp)),this._addPointer(i),i.pointerType==="touch"?this._onTouchStart(i):this._onMouseDown(i))}function q2(i){this.enabled!==!1&&(i.pointerType==="touch"?this._onTouchMove(i):this._onMouseMove(i))}function j2(i){this.enabled!==!1&&(i.pointerType==="touch"?this._onTouchEnd(i):this._onMouseUp(),this._removePointer(i),this._pointers.length===0&&(this.domElement.releasePointerCapture(i.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp)))}function X2(i){this._removePointer(i)}function Y2(){this.enabled!==!1&&(this.keyState=Wt.NONE,window.addEventListener("keydown",this._onKeyDown))}function K2(i){this.enabled!==!1&&(window.removeEventListener("keydown",this._onKeyDown),this.keyState===Wt.NONE&&(i.code===this.keys[Wt.ROTATE]&&!this.noRotate?this.keyState=Wt.ROTATE:i.code===this.keys[Wt.ZOOM]&&!this.noZoom?this.keyState=Wt.ZOOM:i.code===this.keys[Wt.PAN]&&!this.noPan&&(this.keyState=Wt.PAN)))}function $2(i){let e;switch(i.button){case 0:e=this.mouseButtons.LEFT;break;case 1:e=this.mouseButtons.MIDDLE;break;case 2:e=this.mouseButtons.RIGHT;break;default:e=-1}switch(e){case ds.DOLLY:this.state=Wt.ZOOM;break;case ds.ROTATE:this.state=Wt.ROTATE;break;case ds.PAN:this.state=Wt.PAN;break;default:this.state=Wt.NONE}const t=this.keyState!==Wt.NONE?this.keyState:this.state;t===Wt.ROTATE&&!this.noRotate?(this._moveCurr.copy(this._getMouseOnCircle(i.pageX,i.pageY)),this._movePrev.copy(this._moveCurr)):t===Wt.ZOOM&&!this.noZoom?(this._zoomStart.copy(this._getMouseOnScreen(i.pageX,i.pageY)),this._zoomEnd.copy(this._zoomStart)):t===Wt.PAN&&!this.noPan&&(this._panStart.copy(this._getMouseOnScreen(i.pageX,i.pageY)),this._panEnd.copy(this._panStart)),this.dispatchEvent(Cg)}function J2(i){const e=this.keyState!==Wt.NONE?this.keyState:this.state;e===Wt.ROTATE&&!this.noRotate?(this._movePrev.copy(this._moveCurr),this._moveCurr.copy(this._getMouseOnCircle(i.pageX,i.pageY))):e===Wt.ZOOM&&!this.noZoom?this._zoomEnd.copy(this._getMouseOnScreen(i.pageX,i.pageY)):e===Wt.PAN&&!this.noPan&&this._panEnd.copy(this._getMouseOnScreen(i.pageX,i.pageY))}function Z2(){this.state=Wt.NONE,this.dispatchEvent(Sg)}function eF(i){if(this.enabled!==!1&&this.noZoom!==!0){switch(i.preventDefault(),i.deltaMode){case 2:this._zoomStart.y-=i.deltaY*.025;break;case 1:this._zoomStart.y-=i.deltaY*.01;break;default:this._zoomStart.y-=i.deltaY*25e-5;break}this.dispatchEvent(Cg),this.dispatchEvent(Sg)}}function tF(i){this.enabled!==!1&&i.preventDefault()}function nF(i){switch(this._trackPointer(i),this._pointers.length){case 1:this.state=Wt.TOUCH_ROTATE,this._moveCurr.copy(this._getMouseOnCircle(this._pointers[0].pageX,this._pointers[0].pageY)),this._movePrev.copy(this._moveCurr);break;default:this.state=Wt.TOUCH_ZOOM_PAN;const e=this._pointers[0].pageX-this._pointers[1].pageX,t=this._pointers[0].pageY-this._pointers[1].pageY;this._touchZoomDistanceEnd=this._touchZoomDistanceStart=Math.sqrt(e*e+t*t);const n=(this._pointers[0].pageX+this._pointers[1].pageX)/2,s=(this._pointers[0].pageY+this._pointers[1].pageY)/2;this._panStart.copy(this._getMouseOnScreen(n,s)),this._panEnd.copy(this._panStart);break}this.dispatchEvent(Cg)}function iF(i){switch(this._trackPointer(i),this._pointers.length){case 1:this._movePrev.copy(this._moveCurr),this._moveCurr.copy(this._getMouseOnCircle(i.pageX,i.pageY));break;default:const e=this._getSecondPointerPosition(i),t=i.pageX-e.x,n=i.pageY-e.y;this._touchZoomDistanceEnd=Math.sqrt(t*t+n*n);const s=(i.pageX+e.x)/2,r=(i.pageY+e.y)/2;this._panEnd.copy(this._getMouseOnScreen(s,r));break}}function sF(i){switch(this._pointers.length){case 0:this.state=Wt.NONE;break;case 1:this.state=Wt.TOUCH_ROTATE,this._moveCurr.copy(this._getMouseOnCircle(i.pageX,i.pageY)),this._movePrev.copy(this._moveCurr);break;case 2:this.state=Wt.TOUCH_ZOOM_PAN;for(let e=0;e<this._pointers.length;e++)if(this._pointers[e].pointerId!==i.pointerId){const t=this._pointerPositions[this._pointers[e].pointerId];this._moveCurr.copy(this._getMouseOnCircle(t.x,t.y)),this._movePrev.copy(this._moveCurr);break}break}this.dispatchEvent(Sg)}const qo=-12,Bc=12,ab=Bc-qo+1,Zm=-16,eA=16,pp=10,B0=10,lb=5e3,rF=.1,mp=5e3,oF=5e3,R0=7e3,aF=.11,lF=.2,cF="https://nlnuahwicwmejljfjsli.supabase.co",hF="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5sbnVhaHdpY3dtZWpsamZqc2xpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDcxMjI3MDcsImV4cCI6MjA2MjY5ODcwN30.7xIo48aNraErwV2KYqqoD55cVi-2PDmPaQowqb0YK5o",cb="leaderboard";class hb{constructor(e={}){var t;this.experience=new ti,this.scene=this.experience.scene,this.time=this.experience.time,this.speed=e.speed||1,this.rotationIntensity=e.rotationIntensity||1,this.floatIntensity=e.floatIntensity||1,this.floatingRange=e.floatingRange||[-.1,.1],this.rotationSpeed=(t=e.rotationSpeed)!=null?t:.01,this.group=new Wi,this.offset=Math.random()*114514,this.scene.add(this.group)}add(...e){this.group.add(...e)}update(){var n,s;const e=(this.offset+this.time.elapsed)*.01;this.group.rotation.x=Math.cos(e/4*this.speed)/8*this.rotationIntensity,this.group.rotation.y=Math.sin(e/4*this.speed)/8*this.rotationIntensity,this.group.rotation.z=Math.sin(e/4*this.speed)/20*this.rotationIntensity;let t=Math.sin(e/4*this.speed)/10;t=bn.mapLinear(t,-.1,.1,(n=this.floatingRange[0])!=null?n:-.1,(s=this.floatingRange[1])!=null?s:.1),this.group.position.y=t*this.floatIntensity,this.group.rotation.y+=this.rotationSpeed}}const nn={CLOCK:"clock",RANDOM:"random",SHEID:"sheid",SHOE:"shoe",ZONGZI:"zongzi"};class uF{constructor(){this.experience=new ti,this.scene=this.experience.scene,this.resources=this.experience.resources,this.items=[],this.floats=[]}addItems(e,t){Array.isArray(e)&&e.forEach(({tileIndex:n,type:s})=>{let r;if([nn.CLOCK,nn.RANDOM,nn.SHEID,nn.SHOE,nn.ZONGZI].includes(s)&&this.resources.items[s]){const o=this.resources.items[s];r=o.scene?o.scene.clone(!0):o.clone(!0),r.scale.set(.3,.3,.3),r.position.set(0,.5,0);const a=new hb({floatIntensity:1,rotationIntensity:1,rotationSpeed:.02});a.group.position.set(n,0,t),a.add(r),a.group.userData={type:s,tile:{x:n,z:t}},this.floats.push(a),this.items.push(a.group)}})}checkUserTile(e){for(let t=0;t<this.items.length;t++){const n=this.items[t],{x:s,z:r}=n.userData.tile;if(e.x===s&&e.z===r){let o=n.userData.type;if(o===nn.RANDOM){const a=Object.values(nn).filter(l=>l!==nn.RANDOM);o=a[Math.floor(Math.random()*a.length)]}return this.experience.trigger("itemCollected",[o]),this.scene.remove(n),this.items.splice(t,1),o}}return null}update(){this.floats.forEach(e=>{e.update()})}clear(){this.floats.forEach(e=>{this.scene.remove(e.group)}),this.items=[],this.floats=[]}}function Ts(i,e){return Math.floor(Math.random()*(e-i+1))+i}function Ap(i){return i[Ts(0,i.length-1)]}function dF(i,e=20){const t=[];for(let n=0;n<e;n++)if(Math.random()<.5){const r=Ts(0,5),o=new Set,a=[];for(;a.length<r;){const f=Ts(qo,Bc);o.has(f)||(o.add(f),a.push({tileIndex:f,type:"tree0".concat(Ts(1,4))}))}const l=[],c=[nn.CLOCK,nn.RANDOM,nn.SHEID,nn.SHOE,nn.ZONGZI],h=Math.random()<.2?Ts(1,2):0,u=new Set([...o]);let d=0;for(;l.length<h&&d<10;){const f=Ts(qo,Bc);u.has(f)||(u.add(f),l.push({tileIndex:f,type:Ap(c)})),d++}t.push({type:"forest",trees:a,items:l})}else{const r=Ts(1,4),o=[],a=[],l=[];for(let p=Zm+2;p<=eA-2;p++)p%2===0&&l.push(p);for(;a.length<r;){let p,A=!1;for(;!A;)p=Ap(l),A=o.every(m=>Math.abs(m-p)>1),A&&o.push(p);a.push({initialTileIndex:p,type:"car0".concat(Ts(1,8))})}const c=[],h=[nn.CLOCK,nn.RANDOM,nn.SHEID,nn.SHOE,nn.ZONGZI],u=Math.random()<.2?Ts(1,2):0,d=new Set([...o]);let f=0;for(;c.length<u&&f<10;){const p=Ts(qo,Bc);d.has(p)||(d.add(p),c.push({tileIndex:p,type:Ap(h)})),f++}t.push({type:"road",direction:Math.random()<.5,speed:1,vehicles:a,items:c})}return t}function fF(i){return i==="forward"?Math.PI:i==="left"?-Math.PI/2:i==="right"?Math.PI/2:0}function pF(i,e){if(i.x<qo||i.x>Bc||i.z<=-5)return!1;const t=i.z,n=e[t-1];return!(n&&n.type==="forest"&&n.trees.some(s=>s.tileIndex===i.x))}function mF(i,e,t,n){const s=t-i,r=n-e;if(Math.abs(s)<B0*.5&&Math.abs(r)<B0)return null;if(gF()){if(s!==0&&r!==0){if(s<0&&r<0)return"left";if(s>0&&r>0)return"right";if(s<0&&r>0)return"backward";if(s>0&&r<0)return"forward"}return null}else return Math.abs(s)>Math.abs(r)?s>0?"right":"left":r>0?"backward":"forward"}function fd(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)}function AF(){return window.innerWidth>window.innerHeight}function gF(){return window.innerHeight>=window.innerWidth}function vF(i,e=300){let t=null;return function(...n){const s=this;clearTimeout(t),t=setTimeout(()=>{i.apply(s,n)},e)}}class _F{constructor(e=!1){this.experience=new ti,this.sizes=this.experience.sizes,this.scene=this.experience.scene,this.canvas=this.experience.canvas,this.orthographic=e,this.debug=this.experience.debug,this.debugActive=this.experience.debug.active,this.position=this.getAdaptivePosition(),this.target=new he(0,1.5,0),this.setInstance(),this.setControls(),this.setDebug()}setInstance(){if(this.orthographic){const e=this.sizes.aspect;this.frustumSize=this.getAdaptiveFrustumSize(),this.instance=new Kd(-this.frustumSize*e,this.frustumSize*e,this.frustumSize,-this.frustumSize,-50,100)}else this.instance=new ai(34,this.sizes.aspect,.1,100);this.instance.position.copy(this.position),this.instance.lookAt(this.target),this.scene.add(this.instance)}setControls(){this.orbitControls=new B2(this.instance,this.canvas),this.orbitControls.enableRotate=!1,this.orbitControls.enablePan=!1,this.orbitControls.enableDamping=!0,this.orbitControls.enableZoom=!1,this.orbitControls.target.copy(this.target),this.trackballControls=new H2(this.instance,this.canvas),this.trackballControls.noRotate=!0,this.trackballControls.noPan=!0,this.trackballControls.noZoom=!1,this.trackballControls.zoomSpeed=1,this.trackballControls.minZoom=.5,this.trackballControls.maxZoom=5,this.trackballControls.target.copy(this.target)}setDebug(){if(this.debugActive){const e=this.debug.ui.addFolder({title:"Camera",expanded:!1});e.addBinding(this,"position",{label:"camera Position"}).on("change",this.updateCamera.bind(this)),e.addBinding(this,"target",{label:"camera Target"}).on("change",this.updateCamera.bind(this))}}updateCamera(){this.instance.position.copy(this.position),this.instance.lookAt(this.target),this.orbitControls.target.copy(this.target),this.trackballControls.target.copy(this.target),this.orbitControls.update(),this.trackballControls.update()}resize(){if(this.orthographic){const e=this.sizes.width/this.sizes.height;this.frustumSize=this.getAdaptiveFrustumSize(),this.instance.left=-this.frustumSize*e,this.instance.right=this.frustumSize*e,this.instance.top=this.frustumSize,this.instance.bottom=-this.frustumSize,this.instance.updateProjectionMatrix()}else this.instance.aspect=this.sizes.aspect,this.instance.updateProjectionMatrix();this.trackballControls.handleResize(),this.handleResizeForMobile()}update(){this.orbitControls.update(),this.trackballControls.update()}getAdaptivePosition(){return fd()?AF()?new he(3,4,6):new he(6,4,4.6):new he(2.5,4.3,7.03)}handleResizeForMobile(){this.position=this.getAdaptivePosition(),this.updateCamera()}getAdaptiveFrustumSize(){return fd()?4:3}}class yF{constructor(){this.experience=new ti,this.canvas=this.experience.canvas,this.sizes=this.experience.sizes,this.scene=this.experience.scene,this.camera=this.experience.camera,this.setInstance()}setInstance(){this.instance=new M2({canvas:this.canvas,antialias:!0}),this.instance.toneMapping=vw,this.instance.toneMappingExposure=1,this.instance.shadowMap.enabled=!0,this.instance.shadowMap.type=gw,this.instance.setClearColor("#f7f3e8"),this.instance.setSize(this.sizes.width,this.sizes.height),this.instance.setPixelRatio(this.sizes.pixelRatio)}resize(){this.instance.setSize(this.sizes.width,this.sizes.height),this.instance.setPixelRatio(this.sizes.pixelRatio)}update(){this.instance.render(this.scene,this.camera.instance)}}const xF=[{name:"fontSource",type:"font",path:"./fonts/helvetiker_bold.typeface.json"},{name:"matcapGreen",type:"texture",path:"./textures/matcap/4A6442_D0AB75_81CD94_181B12-64px.png"},{name:"environmentMapTexture",type:"cubeTexture",path:["textures/environmentMap/px.jpg","textures/environmentMap/nx.jpg","textures/environmentMap/py.jpg","textures/environmentMap/ny.jpg","textures/environmentMap/pz.jpg","textures/environmentMap/nz.jpg"]},{name:"chicken",type:"gltfModel",path:"./model/chicken.glb"},{name:"bigChicken",type:"gltfModel",path:"./model/zexin.glb"},{name:"grass",type:"gltfModel",path:"./model/grass.glb"},{name:"road",type:"gltfModel",path:"./model/road.glb"},{name:"tree01",type:"gltfModel",path:"./model/tree01.glb"},{name:"tree02",type:"gltfModel",path:"./model/tree02.glb"},{name:"tree03",type:"gltfModel",path:"./model/tree03.glb"},{name:"tree04",type:"gltfModel",path:"./model/tree04.glb"},{name:"tile",type:"gltfModel",path:"./model/grass02.glb"},{name:"car01",type:"gltfModel",path:"./model/car01.glb"},{name:"car02",type:"gltfModel",path:"./model/car02.glb"},{name:"car03",type:"gltfModel",path:"./model/car03.glb"},{name:"car04",type:"gltfModel",path:"./model/car04.glb"},{name:"car05",type:"gltfModel",path:"./model/car05.glb"},{name:"car06",type:"gltfModel",path:"./model/car06.glb"},{name:"car07",type:"gltfModel",path:"./model/car07.glb"},{name:"car08",type:"gltfModel",path:"./model/car08.glb"},{name:"clock",type:"gltfModel",path:"./model/clock.glb"},{name:"random",type:"gltfModel",path:"./model/random.glb"},{name:"sheid",type:"gltfModel",path:"./model/sheid.glb"},{name:"shoe",type:"gltfModel",path:"./model/shoe.glb"},{name:"zongzi",type:"gltfModel",path:"./model/zongzi.glb"}];/*! Tweakpane 4.0.5 (c) 2016 cocopon, licensed under the MIT license. */function hn(i){return i==null}function Ig(i){return i!==null&&typeof i=="object"}function tA(i){return i!==null&&typeof i=="object"}function wF(i,e){if(i.length!==e.length)return!1;for(let t=0;t<i.length;t++)if(i[t]!==e[t])return!1;return!0}function oa(i,e){return Array.from(new Set([...Object.keys(i),...Object.keys(e)])).reduce((n,s)=>{const r=i[s],o=e[s];return tA(r)&&tA(o)?Object.assign(Object.assign({},n),{[s]:oa(r,o)}):Object.assign(Object.assign({},n),{[s]:s in e?o:r})},{})}function Mg(i){return Ig(i)?"target"in i:!1}const bF={alreadydisposed:()=>"View has been already disposed",invalidparams:i=>"Invalid parameters for '".concat(i.name,"'"),nomatchingcontroller:i=>"No matching controller for '".concat(i.key,"'"),nomatchingview:i=>"No matching view for '".concat(JSON.stringify(i.params),"'"),notbindable:()=>"Value is not bindable",notcompatible:i=>"Not compatible with  plugin '".concat(i.id,"'"),propertynotfound:i=>"Property '".concat(i.name,"' not found"),shouldneverhappen:()=>"This error should never happen"};class Cn{static alreadyDisposed(){return new Cn({type:"alreadydisposed"})}static notBindable(){return new Cn({type:"notbindable"})}static notCompatible(e,t){return new Cn({type:"notcompatible",context:{id:"".concat(e,".").concat(t)}})}static propertyNotFound(e){return new Cn({type:"propertynotfound",context:{name:e}})}static shouldNeverHappen(){return new Cn({type:"shouldneverhappen"})}constructor(e){var t;this.message=(t=bF[e.type](e.context))!==null&&t!==void 0?t:"Unexpected error",this.name=this.constructor.name,this.stack=new Error(this.message).stack,this.type=e.type}toString(){return this.message}}class pd{constructor(e,t){this.obj_=e,this.key=t}static isBindable(e){return!(e===null||typeof e!="object"&&typeof e!="function")}read(){return this.obj_[this.key]}write(e){this.obj_[this.key]=e}writeProperty(e,t){const n=this.read();if(!pd.isBindable(n))throw Cn.notBindable();if(!(e in n))throw Cn.propertyNotFound(e);n[e]=t}}class Un{constructor(){this.observers_={}}on(e,t,n){var s;let r=this.observers_[e];return r||(r=this.observers_[e]=[]),r.push({handler:t,key:(s=n==null?void 0:n.key)!==null&&s!==void 0?s:t}),this}off(e,t){const n=this.observers_[e];return n&&(this.observers_[e]=n.filter(s=>s.key!==t)),this}emit(e,t){const n=this.observers_[e];n&&n.forEach(s=>{s.handler(t)})}}class EF{constructor(e,t){var n;this.constraint_=t==null?void 0:t.constraint,this.equals_=(n=t==null?void 0:t.equals)!==null&&n!==void 0?n:(s,r)=>s===r,this.emitter=new Un,this.rawValue_=e}get constraint(){return this.constraint_}get rawValue(){return this.rawValue_}set rawValue(e){this.setRawValue(e,{forceEmit:!1,last:!0})}setRawValue(e,t){const n=t!=null?t:{forceEmit:!1,last:!0},s=this.constraint_?this.constraint_.constrain(e):e,r=this.rawValue_;this.equals_(r,s)&&!n.forceEmit||(this.emitter.emit("beforechange",{sender:this}),this.rawValue_=s,this.emitter.emit("change",{options:n,previousRawValue:r,rawValue:s,sender:this}))}}class CF{constructor(e){this.emitter=new Un,this.value_=e}get rawValue(){return this.value_}set rawValue(e){this.setRawValue(e,{forceEmit:!1,last:!0})}setRawValue(e,t){const n=t!=null?t:{forceEmit:!1,last:!0},s=this.value_;s===e&&!n.forceEmit||(this.emitter.emit("beforechange",{sender:this}),this.value_=e,this.emitter.emit("change",{options:n,previousRawValue:s,rawValue:this.value_,sender:this}))}}class SF{constructor(e){this.emitter=new Un,this.onValueBeforeChange_=this.onValueBeforeChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.value_=e,this.value_.emitter.on("beforechange",this.onValueBeforeChange_),this.value_.emitter.on("change",this.onValueChange_)}get rawValue(){return this.value_.rawValue}onValueBeforeChange_(e){this.emitter.emit("beforechange",Object.assign(Object.assign({},e),{sender:this}))}onValueChange_(e){this.emitter.emit("change",Object.assign(Object.assign({},e),{sender:this}))}}function An(i,e){const t=e==null?void 0:e.constraint,n=e==null?void 0:e.equals;return!t&&!n?new CF(i):new EF(i,e)}function IF(i){return[new SF(i),(e,t)=>{i.setRawValue(e,t)}]}class Dt{constructor(e){this.emitter=new Un,this.valMap_=e;for(const t in this.valMap_)this.valMap_[t].emitter.on("change",()=>{this.emitter.emit("change",{key:t,sender:this})})}static createCore(e){return Object.keys(e).reduce((n,s)=>Object.assign(n,{[s]:An(e[s])}),{})}static fromObject(e){const t=this.createCore(e);return new Dt(t)}get(e){return this.valMap_[e].rawValue}set(e,t){this.valMap_[e].rawValue=t}value(e){return this.valMap_[e]}}class wh{constructor(e){this.values=Dt.fromObject({max:e.max,min:e.min})}constrain(e){const t=this.values.get("max"),n=this.values.get("min");return Math.min(Math.max(e,n),t)}}class MF{constructor(e){this.values=Dt.fromObject({max:e.max,min:e.min})}constrain(e){const t=this.values.get("max"),n=this.values.get("min");let s=e;return hn(n)||(s=Math.max(s,n)),hn(t)||(s=Math.min(s,t)),s}}class TF{constructor(e,t=0){this.step=e,this.origin=t}constrain(e){const t=this.origin%this.step,n=Math.round((e-t)/this.step);return t+n*this.step}}class BF{constructor(e){this.text=e}evaluate(){return Number(this.text)}toString(){return this.text}}const RF={"**":(i,e)=>Math.pow(i,e),"*":(i,e)=>i*e,"/":(i,e)=>i/e,"%":(i,e)=>i%e,"+":(i,e)=>i+e,"-":(i,e)=>i-e,"<<":(i,e)=>i<<e,">>":(i,e)=>i>>e,">>>":(i,e)=>i>>>e,"&":(i,e)=>i&e,"^":(i,e)=>i^e,"|":(i,e)=>i|e};class PF{constructor(e,t,n){this.left=t,this.operator=e,this.right=n}evaluate(){const e=RF[this.operator];if(!e)throw new Error("unexpected binary operator: '".concat(this.operator));return e(this.left.evaluate(),this.right.evaluate())}toString(){return["b(",this.left.toString(),this.operator,this.right.toString(),")"].join(" ")}}const DF={"+":i=>i,"-":i=>-i,"~":i=>~i};class LF{constructor(e,t){this.operator=e,this.expression=t}evaluate(){const e=DF[this.operator];if(!e)throw new Error("unexpected unary operator: '".concat(this.operator));return e(this.expression.evaluate())}toString(){return["u(",this.operator,this.expression.toString(),")"].join(" ")}}function Tg(i){return(e,t)=>{for(let n=0;n<i.length;n++){const s=i[n](e,t);if(s!=="")return s}return""}}function eh(i,e){var t;const n=i.substr(e).match(/^\s+/);return(t=n&&n[0])!==null&&t!==void 0?t:""}function FF(i,e){const t=i.substr(e,1);return t.match(/^[1-9]$/)?t:""}function th(i,e){var t;const n=i.substr(e).match(/^[0-9]+/);return(t=n&&n[0])!==null&&t!==void 0?t:""}function NF(i,e){const t=th(i,e);if(t!=="")return t;const n=i.substr(e,1);if(e+=1,n!=="-"&&n!=="+")return"";const s=th(i,e);return s===""?"":n+s}function Bg(i,e){const t=i.substr(e,1);if(e+=1,t.toLowerCase()!=="e")return"";const n=NF(i,e);return n===""?"":t+n}function ub(i,e){const t=i.substr(e,1);if(t==="0")return t;const n=FF(i,e);return e+=n.length,n===""?"":n+th(i,e)}function kF(i,e){const t=ub(i,e);if(e+=t.length,t==="")return"";const n=i.substr(e,1);if(e+=n.length,n!==".")return"";const s=th(i,e);return e+=s.length,t+n+s+Bg(i,e)}function OF(i,e){const t=i.substr(e,1);if(e+=t.length,t!==".")return"";const n=th(i,e);return e+=n.length,n===""?"":t+n+Bg(i,e)}function UF(i,e){const t=ub(i,e);return e+=t.length,t===""?"":t+Bg(i,e)}const QF=Tg([kF,OF,UF]);function VF(i,e){var t;const n=i.substr(e).match(/^[01]+/);return(t=n&&n[0])!==null&&t!==void 0?t:""}function zF(i,e){const t=i.substr(e,2);if(e+=t.length,t.toLowerCase()!=="0b")return"";const n=VF(i,e);return n===""?"":t+n}function GF(i,e){var t;const n=i.substr(e).match(/^[0-7]+/);return(t=n&&n[0])!==null&&t!==void 0?t:""}function HF(i,e){const t=i.substr(e,2);if(e+=t.length,t.toLowerCase()!=="0o")return"";const n=GF(i,e);return n===""?"":t+n}function WF(i,e){var t;const n=i.substr(e).match(/^[0-9a-f]+/i);return(t=n&&n[0])!==null&&t!==void 0?t:""}function qF(i,e){const t=i.substr(e,2);if(e+=t.length,t.toLowerCase()!=="0x")return"";const n=WF(i,e);return n===""?"":t+n}const jF=Tg([zF,HF,qF]),XF=Tg([jF,QF]);function YF(i,e){const t=XF(i,e);return e+=t.length,t===""?null:{evaluable:new BF(t),cursor:e}}function KF(i,e){const t=i.substr(e,1);if(e+=t.length,t!=="(")return null;const n=fb(i,e);if(!n)return null;e=n.cursor,e+=eh(i,e).length;const s=i.substr(e,1);return e+=s.length,s!==")"?null:{evaluable:n.evaluable,cursor:e}}function $F(i,e){var t;return(t=YF(i,e))!==null&&t!==void 0?t:KF(i,e)}function db(i,e){const t=$F(i,e);if(t)return t;const n=i.substr(e,1);if(e+=n.length,n!=="+"&&n!=="-"&&n!=="~")return null;const s=db(i,e);return s?(e=s.cursor,{cursor:e,evaluable:new LF(n,s.evaluable)}):null}function JF(i,e,t){t+=eh(e,t).length;const n=i.filter(s=>e.startsWith(s,t))[0];return n?(t+=n.length,t+=eh(e,t).length,{cursor:t,operator:n}):null}function ZF(i,e){return(t,n)=>{const s=i(t,n);if(!s)return null;n=s.cursor;let r=s.evaluable;for(;;){const o=JF(e,t,n);if(!o)break;n=o.cursor;const a=i(t,n);if(!a)return null;n=a.cursor,r=new PF(o.operator,r,a.evaluable)}return r?{cursor:n,evaluable:r}:null}}const eN=[["**"],["*","/","%"],["+","-"],["<<",">>>",">>"],["&"],["^"],["|"]].reduce((i,e)=>ZF(i,e),db);function fb(i,e){return e+=eh(i,e).length,eN(i,e)}function tN(i){const e=fb(i,0);return!e||e.cursor+eh(i,e.cursor).length!==i.length?null:e.evaluable}function xr(i){var e;const t=tN(i);return(e=t==null?void 0:t.evaluate())!==null&&e!==void 0?e:null}function pb(i){if(typeof i=="number")return i;if(typeof i=="string"){const e=xr(i);if(!hn(e))return e}return 0}function nN(i){return String(i)}function Li(i){return e=>e.toFixed(Math.max(Math.min(i,20),0))}function Xt(i,e,t,n,s){const r=(i-e)/(t-e);return n+r*(s-n)}function P0(i){return String(i.toFixed(10)).split(".")[1].replace(/0+$/,"").length}function Wn(i,e,t){return Math.min(Math.max(i,e),t)}function mb(i,e){return(i%e+e)%e}function iN(i,e){return hn(i.step)?Math.max(P0(e),2):P0(i.step)}function Ab(i){var e;return(e=i.step)!==null&&e!==void 0?e:1}function gb(i,e){var t;const n=Math.abs((t=i.step)!==null&&t!==void 0?t:e);return n===0?.1:Math.pow(10,Math.floor(Math.log10(n))-1)}function vb(i,e){return hn(i.step)?null:new TF(i.step,e)}function _b(i){return!hn(i.max)&&!hn(i.min)?new wh({max:i.max,min:i.min}):!hn(i.max)||!hn(i.min)?new MF({max:i.max,min:i.min}):null}function yb(i,e){var t,n,s;return{formatter:(t=i.format)!==null&&t!==void 0?t:Li(iN(i,e)),keyScale:(n=i.keyScale)!==null&&n!==void 0?n:Ab(i),pointerScale:(s=i.pointerScale)!==null&&s!==void 0?s:gb(i,e)}}function xb(i){return{format:i.optional.function,keyScale:i.optional.number,max:i.optional.number,min:i.optional.number,pointerScale:i.optional.number,step:i.optional.number}}function Rg(i){return{constraint:i.constraint,textProps:Dt.fromObject(yb(i.params,i.initialValue))}}class da{constructor(e){this.controller=e}get element(){return this.controller.view.element}get disabled(){return this.controller.viewProps.get("disabled")}set disabled(e){this.controller.viewProps.set("disabled",e)}get hidden(){return this.controller.viewProps.get("hidden")}set hidden(e){this.controller.viewProps.set("hidden",e)}dispose(){this.controller.viewProps.set("disposed",!0)}importState(e){return this.controller.importState(e)}exportState(){return this.controller.exportState()}}class Jd{constructor(e){this.target=e}}class bh extends Jd{constructor(e,t,n){super(e),this.value=t,this.last=n!=null?n:!0}}class sN extends Jd{constructor(e,t){super(e),this.expanded=t}}class rN extends Jd{constructor(e,t){super(e),this.index=t}}class oN extends Jd{constructor(e,t){super(e),this.native=t}}class nh extends da{constructor(e){super(e),this.onValueChange_=this.onValueChange_.bind(this),this.emitter_=new Un,this.controller.value.emitter.on("change",this.onValueChange_)}get label(){return this.controller.labelController.props.get("label")}set label(e){this.controller.labelController.props.set("label",e)}get key(){return this.controller.value.binding.target.key}get tag(){return this.controller.tag}set tag(e){this.controller.tag=e}on(e,t){const n=t.bind(this);return this.emitter_.on(e,s=>{n(s)},{key:t}),this}off(e,t){return this.emitter_.off(e,t),this}refresh(){this.controller.value.fetch()}onValueChange_(e){const t=this.controller.value;this.emitter_.emit("change",new bh(this,t.binding.target.read(),e.options.last))}}class aN{constructor(e,t){this.onValueBeforeChange_=this.onValueBeforeChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.binding=t,this.value_=e,this.value_.emitter.on("beforechange",this.onValueBeforeChange_),this.value_.emitter.on("change",this.onValueChange_),this.emitter=new Un}get rawValue(){return this.value_.rawValue}set rawValue(e){this.value_.rawValue=e}setRawValue(e,t){this.value_.setRawValue(e,t)}fetch(){this.value_.rawValue=this.binding.read()}push(){this.binding.write(this.value_.rawValue)}onValueBeforeChange_(e){this.emitter.emit("beforechange",Object.assign(Object.assign({},e),{sender:this}))}onValueChange_(e){this.push(),this.emitter.emit("change",Object.assign(Object.assign({},e),{sender:this}))}}function lN(i){if(!("binding"in i))return!1;const e=i.binding;return Mg(e)&&"read"in e&&"write"in e}function cN(i,e){const n=Object.keys(e).reduce((s,r)=>{if(s===void 0)return;const o=e[r],a=o(i[r]);return a.succeeded?Object.assign(Object.assign({},s),{[r]:a.value}):void 0},{});return n}function hN(i,e){return i.reduce((t,n)=>{if(t===void 0)return;const s=e(n);if(!(!s.succeeded||s.value===void 0))return[...t,s.value]},[])}function uN(i){return i===null?!1:typeof i=="object"}function sr(i){return e=>t=>{if(!e&&t===void 0)return{succeeded:!1,value:void 0};if(e&&t===void 0)return{succeeded:!0,value:void 0};const n=i(t);return n!==void 0?{succeeded:!0,value:n}:{succeeded:!1,value:void 0}}}function D0(i){return{custom:e=>sr(e)(i),boolean:sr(e=>typeof e=="boolean"?e:void 0)(i),number:sr(e=>typeof e=="number"?e:void 0)(i),string:sr(e=>typeof e=="string"?e:void 0)(i),function:sr(e=>typeof e=="function"?e:void 0)(i),constant:e=>sr(t=>t===e?e:void 0)(i),raw:sr(e=>e)(i),object:e=>sr(t=>{if(uN(t))return cN(t,e)})(i),array:e=>sr(t=>{if(Array.isArray(t))return hN(t,e)})(i)}}const nA={optional:D0(!0),required:D0(!1)};function xn(i,e){const t=e(nA),n=nA.required.object(t)(i);return n.succeeded?n.value:void 0}function $i(i,e,t,n){if(e&&!e(i))return!1;const s=xn(i,t);return s?n(s):!1}function Ji(i,e){var t;return oa((t=i==null?void 0:i())!==null&&t!==void 0?t:{},e)}function jo(i){return"value"in i}function wb(i){if(!Ig(i)||!("binding"in i))return!1;const e=i.binding;return Mg(e)}const Us="http://www.w3.org/2000/svg";function md(i){i.offsetHeight}function dN(i,e){const t=i.style.transition;i.style.transition="none",e(),i.style.transition=t}function Pg(i){return i.ontouchstart!==void 0}function fN(){return globalThis}function pN(){return fN().document}function mN(i){const e=i.ownerDocument.defaultView;return e&&"document"in e?i.getContext("2d",{willReadFrequently:!0}):null}const AN={check:'<path d="M2 8l4 4l8 -8"/>',dropdown:'<path d="M5 7h6l-3 3 z"/>',p2dpad:'<path d="M8 4v8"/><path d="M4 8h8"/><circle cx="12" cy="12" r="1.2"/>'};function Zd(i,e){const t=i.createElementNS(Us,"svg");return t.innerHTML=AN[e],t}function bb(i,e,t){i.insertBefore(e,i.children[t])}function Dg(i){i.parentElement&&i.parentElement.removeChild(i)}function Eb(i){for(;i.children.length>0;)i.removeChild(i.children[0])}function gN(i){for(;i.childNodes.length>0;)i.removeChild(i.childNodes[0])}function Cb(i){return i.relatedTarget?i.relatedTarget:"explicitOriginalTarget"in i?i.explicitOriginalTarget:null}function _r(i,e){i.emitter.on("change",t=>{e(t.rawValue)}),e(i.rawValue)}function Ws(i,e,t){_r(i.value(e),t)}const vN="tp";function zt(i){return(t,n)=>[vN,"-",i,"v",t?"_".concat(t):"",n?"-".concat(n):""].join("")}const $l=zt("lbl");function _N(i,e){const t=i.createDocumentFragment();return e.split("\n").map(s=>i.createTextNode(s)).forEach((s,r)=>{r>0&&t.appendChild(i.createElement("br")),t.appendChild(s)}),t}class Sb{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add($l()),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("div");n.classList.add($l("l")),Ws(t.props,"label",r=>{hn(r)?this.element.classList.add($l(void 0,"nol")):(this.element.classList.remove($l(void 0,"nol")),gN(n),n.appendChild(_N(e,r)))}),this.element.appendChild(n),this.labelElement=n;const s=e.createElement("div");s.classList.add($l("v")),this.element.appendChild(s),this.valueElement=s}}class Ib{constructor(e,t){this.props=t.props,this.valueController=t.valueController,this.viewProps=t.valueController.viewProps,this.view=new Sb(e,{props:t.props,viewProps:this.viewProps}),this.view.valueElement.appendChild(this.valueController.view.element)}importProps(e){return $i(e,null,t=>({label:t.optional.string}),t=>(this.props.set("label",t.label),!0))}exportProps(){return Ji(null,{label:this.props.get("label")})}}function yN(){return["veryfirst","first","last","verylast"]}const L0=zt(""),F0={veryfirst:"vfst",first:"fst",last:"lst",verylast:"vlst"};class ef{constructor(e){this.parent_=null,this.blade=e.blade,this.view=e.view,this.viewProps=e.viewProps;const t=this.view.element;this.blade.value("positions").emitter.on("change",()=>{yN().forEach(n=>{t.classList.remove(L0(void 0,F0[n]))}),this.blade.get("positions").forEach(n=>{t.classList.add(L0(void 0,F0[n]))})}),this.viewProps.handleDispose(()=>{Dg(t)})}get parent(){return this.parent_}set parent(e){this.parent_=e,this.viewProps.set("parent",this.parent_?this.parent_.viewProps:null)}importState(e){return $i(e,null,t=>({disabled:t.required.boolean,hidden:t.required.boolean}),t=>(this.viewProps.importState(t),!0))}exportState(){return Ji(null,Object.assign({},this.viewProps.exportState()))}}class aa extends ef{constructor(e,t){if(t.value!==t.valueController.value)throw Cn.shouldNeverHappen();const n=t.valueController.viewProps,s=new Ib(e,{blade:t.blade,props:t.props,valueController:t.valueController});super(Object.assign(Object.assign({},t),{view:new Sb(e,{props:t.props,viewProps:n}),viewProps:n})),this.labelController=s,this.value=t.value,this.valueController=t.valueController,this.view.valueElement.appendChild(this.valueController.view.element)}importState(e){return $i(e,t=>{var n,s,r;return super.importState(t)&&this.labelController.importProps(t)&&((r=(s=(n=this.valueController).importProps)===null||s===void 0?void 0:s.call(n,e))!==null&&r!==void 0?r:!0)},t=>({value:t.optional.raw}),t=>(t.value&&(this.value.rawValue=t.value),!0))}exportState(){var e,t,n;return Ji(()=>super.exportState(),Object.assign(Object.assign({value:this.value.rawValue},this.labelController.exportProps()),(n=(t=(e=this.valueController).exportProps)===null||t===void 0?void 0:t.call(e))!==null&&n!==void 0?n:{}))}}function N0(i){const e=Object.assign({},i);return delete e.value,e}class Mb extends aa{constructor(e,t){super(e,t),this.tag=t.tag}importState(e){return $i(e,t=>super.importState(N0(e)),t=>({tag:t.optional.string}),t=>(this.tag=t.tag,!0))}exportState(){return Ji(()=>N0(super.exportState()),{binding:{key:this.value.binding.target.key,value:this.value.binding.target.read()},tag:this.tag})}}function xN(i){return jo(i)&&wb(i.value)}class wN extends Mb{importState(e){return $i(e,t=>super.importState(t),t=>({binding:t.required.object({value:t.required.raw})}),t=>(this.value.binding.inject(t.binding.value),this.value.fetch(),!0))}}function bN(i){return jo(i)&&lN(i.value)}function Tb(i,e){for(;i.length<e;)i.push(void 0)}function EN(i){const e=[];return Tb(e,i),e}function CN(i){const e=i.indexOf(void 0);return e<0?i:i.slice(0,e)}function SN(i,e){const t=[...CN(i),e];return t.length>i.length?t.splice(0,t.length-i.length):Tb(t,i.length),t}class IN{constructor(e){this.emitter=new Un,this.onTick_=this.onTick_.bind(this),this.onValueBeforeChange_=this.onValueBeforeChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.binding=e.binding,this.value_=An(EN(e.bufferSize)),this.value_.emitter.on("beforechange",this.onValueBeforeChange_),this.value_.emitter.on("change",this.onValueChange_),this.ticker=e.ticker,this.ticker.emitter.on("tick",this.onTick_),this.fetch()}get rawValue(){return this.value_.rawValue}set rawValue(e){this.value_.rawValue=e}setRawValue(e,t){this.value_.setRawValue(e,t)}fetch(){this.value_.rawValue=SN(this.value_.rawValue,this.binding.read())}onTick_(){this.fetch()}onValueBeforeChange_(e){this.emitter.emit("beforechange",Object.assign(Object.assign({},e),{sender:this}))}onValueChange_(e){this.emitter.emit("change",Object.assign(Object.assign({},e),{sender:this}))}}function MN(i){if(!("binding"in i))return!1;const e=i.binding;return Mg(e)&&"read"in e&&!("write"in e)}class TN extends Mb{exportState(){return Ji(()=>super.exportState(),{binding:{readonly:!0}})}}function BN(i){return jo(i)&&MN(i.value)}class RN extends da{get label(){return this.controller.labelController.props.get("label")}set label(e){this.controller.labelController.props.set("label",e)}get title(){var e;return(e=this.controller.buttonController.props.get("title"))!==null&&e!==void 0?e:""}set title(e){this.controller.buttonController.props.set("title",e)}on(e,t){const n=t.bind(this);return this.controller.buttonController.emitter.on(e,r=>{n(new oN(this,r.nativeEvent))}),this}off(e,t){return this.controller.buttonController.emitter.off(e,t),this}}function PN(i,e,t){t?i.classList.add(e):i.classList.remove(e)}function Fl(i,e){return t=>{PN(i,e,t)}}function Lg(i,e){_r(i,t=>{e.textContent=t!=null?t:""})}const gp=zt("btn");class DN{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(gp()),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("button");n.classList.add(gp("b")),t.viewProps.bindDisabled(n),this.element.appendChild(n),this.buttonElement=n;const s=e.createElement("div");s.classList.add(gp("t")),Lg(t.props.value("title"),s),this.buttonElement.appendChild(s)}}class LN{constructor(e,t){this.emitter=new Un,this.onClick_=this.onClick_.bind(this),this.props=t.props,this.viewProps=t.viewProps,this.view=new DN(e,{props:this.props,viewProps:this.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}importProps(e){return $i(e,null,t=>({title:t.optional.string}),t=>(this.props.set("title",t.title),!0))}exportProps(){return Ji(null,{title:this.props.get("title")})}onClick_(e){this.emitter.emit("click",{nativeEvent:e,sender:this})}}class k0 extends ef{constructor(e,t){const n=new LN(e,{props:t.buttonProps,viewProps:t.viewProps}),s=new Ib(e,{blade:t.blade,props:t.labelProps,valueController:n});super({blade:t.blade,view:s.view,viewProps:t.viewProps}),this.buttonController=n,this.labelController=s}importState(e){return $i(e,t=>super.importState(t)&&this.buttonController.importProps(t)&&this.labelController.importProps(t),()=>({}),()=>!0)}exportState(){return Ji(()=>super.exportState(),Object.assign(Object.assign({},this.buttonController.exportProps()),this.labelController.exportProps()))}}class Bb{constructor(e){const[t,n]=e.split("-"),s=t.split(".");this.major=parseInt(s[0],10),this.minor=parseInt(s[1],10),this.patch=parseInt(s[2],10),this.prerelease=n!=null?n:null}toString(){const e=[this.major,this.minor,this.patch].join(".");return this.prerelease!==null?[e,this.prerelease].join("-"):e}}const Nl=new Bb("2.0.5");function Ei(i){return Object.assign({core:Nl},i)}const FN=Ei({id:"button",type:"blade",accept(i){const e=xn(i,t=>({title:t.required.string,view:t.required.constant("button"),label:t.optional.string}));return e?{params:e}:null},controller(i){return new k0(i.document,{blade:i.blade,buttonProps:Dt.fromObject({title:i.params.title}),labelProps:Dt.fromObject({label:i.params.label}),viewProps:i.viewProps})},api(i){return i.controller instanceof k0?new RN(i.controller):null}});function NN(i,e){return i.addBlade(Object.assign(Object.assign({},e),{view:"button"}))}function kN(i,e){return i.addBlade(Object.assign(Object.assign({},e),{view:"folder"}))}function ON(i,e){return i.addBlade(Object.assign(Object.assign({},e),{view:"tab"}))}function UN(i){return Ig(i)?"refresh"in i&&typeof i.refresh=="function":!1}function QN(i,e){if(!pd.isBindable(i))throw Cn.notBindable();return new pd(i,e)}class VN{constructor(e,t){this.onRackValueChange_=this.onRackValueChange_.bind(this),this.controller_=e,this.emitter_=new Un,this.pool_=t,this.controller_.rack.emitter.on("valuechange",this.onRackValueChange_)}get children(){return this.controller_.rack.children.map(e=>this.pool_.createApi(e))}addBinding(e,t,n){const s=n!=null?n:{},r=this.controller_.element.ownerDocument,o=this.pool_.createBinding(r,QN(e,t),s),a=this.pool_.createBindingApi(o);return this.add(a,s.index)}addFolder(e){return kN(this,e)}addButton(e){return NN(this,e)}addTab(e){return ON(this,e)}add(e,t){const n=e.controller;return this.controller_.rack.add(n,t),e}remove(e){this.controller_.rack.remove(e.controller)}addBlade(e){const t=this.controller_.element.ownerDocument,n=this.pool_.createBlade(t,e),s=this.pool_.createApi(n);return this.add(s,e.index)}on(e,t){const n=t.bind(this);return this.emitter_.on(e,s=>{n(s)},{key:t}),this}off(e,t){return this.emitter_.off(e,t),this}refresh(){this.children.forEach(e=>{UN(e)&&e.refresh()})}onRackValueChange_(e){const t=e.bladeController,n=this.pool_.createApi(t),s=wb(t.value)?t.value.binding:null;this.emitter_.emit("change",new bh(n,s?s.target.read():t.value.rawValue,e.options.last))}}class Fg extends da{constructor(e,t){super(e),this.rackApi_=new VN(e.rackController,t)}refresh(){this.rackApi_.refresh()}}class Ng extends ef{constructor(e){super({blade:e.blade,view:e.view,viewProps:e.rackController.viewProps}),this.rackController=e.rackController}importState(e){return $i(e,t=>super.importState(t),t=>({children:t.required.array(t.required.raw)}),t=>this.rackController.rack.children.every((n,s)=>n.importState(t.children[s])))}exportState(){return Ji(()=>super.exportState(),{children:this.rackController.rack.children.map(e=>e.exportState())})}}function iA(i){return"rackController"in i}class zN{constructor(e){this.emitter=new Un,this.items_=[],this.cache_=new Set,this.onSubListAdd_=this.onSubListAdd_.bind(this),this.onSubListRemove_=this.onSubListRemove_.bind(this),this.extract_=e}get items(){return this.items_}allItems(){return Array.from(this.cache_)}find(e){for(const t of this.allItems())if(e(t))return t;return null}includes(e){return this.cache_.has(e)}add(e,t){if(this.includes(e))throw Cn.shouldNeverHappen();const n=t!==void 0?t:this.items_.length;this.items_.splice(n,0,e),this.cache_.add(e);const s=this.extract_(e);s&&(s.emitter.on("add",this.onSubListAdd_),s.emitter.on("remove",this.onSubListRemove_),s.allItems().forEach(r=>{this.cache_.add(r)})),this.emitter.emit("add",{index:n,item:e,root:this,target:this})}remove(e){const t=this.items_.indexOf(e);if(t<0)return;this.items_.splice(t,1),this.cache_.delete(e);const n=this.extract_(e);n&&(n.allItems().forEach(s=>{this.cache_.delete(s)}),n.emitter.off("add",this.onSubListAdd_),n.emitter.off("remove",this.onSubListRemove_)),this.emitter.emit("remove",{index:t,item:e,root:this,target:this})}onSubListAdd_(e){this.cache_.add(e.item),this.emitter.emit("add",{index:e.index,item:e.item,root:this,target:e.target})}onSubListRemove_(e){this.cache_.delete(e.item),this.emitter.emit("remove",{index:e.index,item:e.item,root:this,target:e.target})}}function GN(i,e){for(let t=0;t<i.length;t++){const n=i[t];if(jo(n)&&n.value===e)return n}return null}function HN(i){return iA(i)?i.rackController.rack.bcSet_:null}class WN{constructor(e){var t,n;this.emitter=new Un,this.onBladePositionsChange_=this.onBladePositionsChange_.bind(this),this.onSetAdd_=this.onSetAdd_.bind(this),this.onSetRemove_=this.onSetRemove_.bind(this),this.onChildDispose_=this.onChildDispose_.bind(this),this.onChildPositionsChange_=this.onChildPositionsChange_.bind(this),this.onChildValueChange_=this.onChildValueChange_.bind(this),this.onChildViewPropsChange_=this.onChildViewPropsChange_.bind(this),this.onRackLayout_=this.onRackLayout_.bind(this),this.onRackValueChange_=this.onRackValueChange_.bind(this),this.blade_=(t=e.blade)!==null&&t!==void 0?t:null,(n=this.blade_)===null||n===void 0||n.value("positions").emitter.on("change",this.onBladePositionsChange_),this.viewProps=e.viewProps,this.bcSet_=new zN(HN),this.bcSet_.emitter.on("add",this.onSetAdd_),this.bcSet_.emitter.on("remove",this.onSetRemove_)}get children(){return this.bcSet_.items}add(e,t){var n;(n=e.parent)===null||n===void 0||n.remove(e),e.parent=this,this.bcSet_.add(e,t)}remove(e){e.parent=null,this.bcSet_.remove(e)}find(e){return this.bcSet_.allItems().filter(e)}onSetAdd_(e){this.updatePositions_();const t=e.target===e.root;if(this.emitter.emit("add",{bladeController:e.item,index:e.index,root:t,sender:this}),!t)return;const n=e.item;if(n.viewProps.emitter.on("change",this.onChildViewPropsChange_),n.blade.value("positions").emitter.on("change",this.onChildPositionsChange_),n.viewProps.handleDispose(this.onChildDispose_),jo(n))n.value.emitter.on("change",this.onChildValueChange_);else if(iA(n)){const s=n.rackController.rack;if(s){const r=s.emitter;r.on("layout",this.onRackLayout_),r.on("valuechange",this.onRackValueChange_)}}}onSetRemove_(e){this.updatePositions_();const t=e.target===e.root;if(this.emitter.emit("remove",{bladeController:e.item,root:t,sender:this}),!t)return;const n=e.item;if(jo(n))n.value.emitter.off("change",this.onChildValueChange_);else if(iA(n)){const s=n.rackController.rack;if(s){const r=s.emitter;r.off("layout",this.onRackLayout_),r.off("valuechange",this.onRackValueChange_)}}}updatePositions_(){const e=this.bcSet_.items.filter(s=>!s.viewProps.get("hidden")),t=e[0],n=e[e.length-1];this.bcSet_.items.forEach(s=>{const r=[];s===t&&(r.push("first"),(!this.blade_||this.blade_.get("positions").includes("veryfirst"))&&r.push("veryfirst")),s===n&&(r.push("last"),(!this.blade_||this.blade_.get("positions").includes("verylast"))&&r.push("verylast")),s.blade.set("positions",r)})}onChildPositionsChange_(){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildViewPropsChange_(e){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildDispose_(){this.bcSet_.items.filter(t=>t.viewProps.get("disposed")).forEach(t=>{this.bcSet_.remove(t)})}onChildValueChange_(e){const t=GN(this.find(jo),e.sender);if(!t)throw Cn.alreadyDisposed();this.emitter.emit("valuechange",{bladeController:t,options:e.options,sender:this})}onRackLayout_(e){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onRackValueChange_(e){this.emitter.emit("valuechange",{bladeController:e.bladeController,options:e.options,sender:this})}onBladePositionsChange_(){this.updatePositions_()}}class kg{constructor(e){this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this),this.element=e.element,this.viewProps=e.viewProps;const t=new WN({blade:e.root?void 0:e.blade,viewProps:e.viewProps});t.emitter.on("add",this.onRackAdd_),t.emitter.on("remove",this.onRackRemove_),this.rack=t,this.viewProps.handleDispose(()=>{for(let n=this.rack.children.length-1;n>=0;n--)this.rack.children[n].viewProps.set("disposed",!0)})}onRackAdd_(e){e.root&&bb(this.element,e.bladeController.view.element,e.index)}onRackRemove_(e){e.root&&Dg(e.bladeController.view.element)}}function kl(){return new Dt({positions:An([],{equals:wF})})}class Eh extends Dt{constructor(e){super(e)}static create(e){const t={completed:!0,expanded:e,expandedHeight:null,shouldFixHeight:!1,temporaryExpanded:null},n=Dt.createCore(t);return new Eh(n)}get styleExpanded(){var e;return(e=this.get("temporaryExpanded"))!==null&&e!==void 0?e:this.get("expanded")}get styleHeight(){if(!this.styleExpanded)return"0";const e=this.get("expandedHeight");return this.get("shouldFixHeight")&&!hn(e)?"".concat(e,"px"):"auto"}bindExpandedClass(e,t){const n=()=>{this.styleExpanded?e.classList.add(t):e.classList.remove(t)};Ws(this,"expanded",n),Ws(this,"temporaryExpanded",n)}cleanUpTransition(){this.set("shouldFixHeight",!1),this.set("expandedHeight",null),this.set("completed",!0)}}function qN(i,e){let t=0;return dN(e,()=>{i.set("expandedHeight",null),i.set("temporaryExpanded",!0),md(e),t=e.clientHeight,i.set("temporaryExpanded",null),md(e)}),t}function O0(i,e){e.style.height=i.styleHeight}function Og(i,e){i.value("expanded").emitter.on("beforechange",()=>{if(i.set("completed",!1),hn(i.get("expandedHeight"))){const t=qN(i,e);t>0&&i.set("expandedHeight",t)}i.set("shouldFixHeight",!0),md(e)}),i.emitter.on("change",()=>{O0(i,e)}),O0(i,e),e.addEventListener("transitionend",t=>{t.propertyName==="height"&&i.cleanUpTransition()})}class Rb extends Fg{constructor(e,t){super(e,t),this.emitter_=new Un,this.controller.foldable.value("expanded").emitter.on("change",n=>{this.emitter_.emit("fold",new sN(this,n.sender.rawValue))}),this.rackApi_.on("change",n=>{this.emitter_.emit("change",n)})}get expanded(){return this.controller.foldable.get("expanded")}set expanded(e){this.controller.foldable.set("expanded",e)}get title(){return this.controller.props.get("title")}set title(e){this.controller.props.set("title",e)}get children(){return this.rackApi_.children}addBinding(e,t,n){return this.rackApi_.addBinding(e,t,n)}addFolder(e){return this.rackApi_.addFolder(e)}addButton(e){return this.rackApi_.addButton(e)}addTab(e){return this.rackApi_.addTab(e)}add(e,t){return this.rackApi_.add(e,t)}remove(e){this.rackApi_.remove(e)}addBlade(e){return this.rackApi_.addBlade(e)}on(e,t){const n=t.bind(this);return this.emitter_.on(e,s=>{n(s)},{key:t}),this}off(e,t){return this.emitter_.off(e,t),this}}const Pb=zt("cnt");class jN{constructor(e,t){var n;this.className_=zt((n=t.viewName)!==null&&n!==void 0?n:"fld"),this.element=e.createElement("div"),this.element.classList.add(this.className_(),Pb()),t.viewProps.bindClassModifiers(this.element),this.foldable_=t.foldable,this.foldable_.bindExpandedClass(this.element,this.className_(void 0,"expanded")),Ws(this.foldable_,"completed",Fl(this.element,this.className_(void 0,"cpl")));const s=e.createElement("button");s.classList.add(this.className_("b")),Ws(t.props,"title",c=>{hn(c)?this.element.classList.add(this.className_(void 0,"not")):this.element.classList.remove(this.className_(void 0,"not"))}),t.viewProps.bindDisabled(s),this.element.appendChild(s),this.buttonElement=s;const r=e.createElement("div");r.classList.add(this.className_("i")),this.element.appendChild(r);const o=e.createElement("div");o.classList.add(this.className_("t")),Lg(t.props.value("title"),o),this.buttonElement.appendChild(o),this.titleElement=o;const a=e.createElement("div");a.classList.add(this.className_("m")),this.buttonElement.appendChild(a);const l=e.createElement("div");l.classList.add(this.className_("c")),this.element.appendChild(l),this.containerElement=l}}class sA extends Ng{constructor(e,t){var n;const s=Eh.create((n=t.expanded)!==null&&n!==void 0?n:!0),r=new jN(e,{foldable:s,props:t.props,viewName:t.root?"rot":void 0,viewProps:t.viewProps});super(Object.assign(Object.assign({},t),{rackController:new kg({blade:t.blade,element:r.containerElement,root:t.root,viewProps:t.viewProps}),view:r})),this.onTitleClick_=this.onTitleClick_.bind(this),this.props=t.props,this.foldable=s,Og(this.foldable,this.view.containerElement),this.rackController.rack.emitter.on("add",()=>{this.foldable.cleanUpTransition()}),this.rackController.rack.emitter.on("remove",()=>{this.foldable.cleanUpTransition()}),this.view.buttonElement.addEventListener("click",this.onTitleClick_)}get document(){return this.view.element.ownerDocument}importState(e){return $i(e,t=>super.importState(t),t=>({expanded:t.required.boolean,title:t.optional.string}),t=>(this.foldable.set("expanded",t.expanded),this.props.set("title",t.title),!0))}exportState(){return Ji(()=>super.exportState(),{expanded:this.foldable.get("expanded"),title:this.props.get("title")})}onTitleClick_(){this.foldable.set("expanded",!this.foldable.get("expanded"))}}const XN=Ei({id:"folder",type:"blade",accept(i){const e=xn(i,t=>({title:t.required.string,view:t.required.constant("folder"),expanded:t.optional.boolean}));return e?{params:e}:null},controller(i){return new sA(i.document,{blade:i.blade,expanded:i.params.expanded,props:Dt.fromObject({title:i.params.title}),viewProps:i.viewProps})},api(i){return i.controller instanceof sA?new Rb(i.controller,i.pool):null}}),YN=zt("");function U0(i,e){return Fl(i,YN(void 0,e))}class Sr extends Dt{constructor(e){var t;super(e),this.onDisabledChange_=this.onDisabledChange_.bind(this),this.onParentChange_=this.onParentChange_.bind(this),this.onParentGlobalDisabledChange_=this.onParentGlobalDisabledChange_.bind(this),[this.globalDisabled_,this.setGlobalDisabled_]=IF(An(this.getGlobalDisabled_())),this.value("disabled").emitter.on("change",this.onDisabledChange_),this.value("parent").emitter.on("change",this.onParentChange_),(t=this.get("parent"))===null||t===void 0||t.globalDisabled.emitter.on("change",this.onParentGlobalDisabledChange_)}static create(e){var t,n,s;const r=e!=null?e:{};return new Sr(Dt.createCore({disabled:(t=r.disabled)!==null&&t!==void 0?t:!1,disposed:!1,hidden:(n=r.hidden)!==null&&n!==void 0?n:!1,parent:(s=r.parent)!==null&&s!==void 0?s:null}))}get globalDisabled(){return this.globalDisabled_}bindClassModifiers(e){_r(this.globalDisabled_,U0(e,"disabled")),Ws(this,"hidden",U0(e,"hidden"))}bindDisabled(e){_r(this.globalDisabled_,t=>{e.disabled=t})}bindTabIndex(e){_r(this.globalDisabled_,t=>{e.tabIndex=t?-1:0})}handleDispose(e){this.value("disposed").emitter.on("change",t=>{t&&e()})}importState(e){this.set("disabled",e.disabled),this.set("hidden",e.hidden)}exportState(){return{disabled:this.get("disabled"),hidden:this.get("hidden")}}getGlobalDisabled_(){const e=this.get("parent");return(e?e.globalDisabled.rawValue:!1)||this.get("disabled")}updateGlobalDisabled_(){this.setGlobalDisabled_(this.getGlobalDisabled_())}onDisabledChange_(){this.updateGlobalDisabled_()}onParentGlobalDisabledChange_(){this.updateGlobalDisabled_()}onParentChange_(e){var t;const n=e.previousRawValue;n==null||n.globalDisabled.emitter.off("change",this.onParentGlobalDisabledChange_),(t=this.get("parent"))===null||t===void 0||t.globalDisabled.emitter.on("change",this.onParentGlobalDisabledChange_),this.updateGlobalDisabled_()}}const Q0=zt("tbp");class KN{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Q0()),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("div");n.classList.add(Q0("c")),this.element.appendChild(n),this.containerElement=n}}const Jl=zt("tbi");class $N{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Jl()),t.viewProps.bindClassModifiers(this.element),Ws(t.props,"selected",r=>{r?this.element.classList.add(Jl(void 0,"sel")):this.element.classList.remove(Jl(void 0,"sel"))});const n=e.createElement("button");n.classList.add(Jl("b")),t.viewProps.bindDisabled(n),this.element.appendChild(n),this.buttonElement=n;const s=e.createElement("div");s.classList.add(Jl("t")),Lg(t.props.value("title"),s),this.buttonElement.appendChild(s),this.titleElement=s}}class JN{constructor(e,t){this.emitter=new Un,this.onClick_=this.onClick_.bind(this),this.props=t.props,this.viewProps=t.viewProps,this.view=new $N(e,{props:t.props,viewProps:t.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}onClick_(){this.emitter.emit("click",{sender:this})}}class rA extends Ng{constructor(e,t){const n=new KN(e,{viewProps:t.viewProps});super(Object.assign(Object.assign({},t),{rackController:new kg({blade:t.blade,element:n.containerElement,viewProps:t.viewProps}),view:n})),this.onItemClick_=this.onItemClick_.bind(this),this.ic_=new JN(e,{props:t.itemProps,viewProps:Sr.create()}),this.ic_.emitter.on("click",this.onItemClick_),this.props=t.props,Ws(this.props,"selected",s=>{this.itemController.props.set("selected",s),this.viewProps.set("hidden",!s)})}get itemController(){return this.ic_}importState(e){return $i(e,t=>super.importState(t),t=>({selected:t.required.boolean,title:t.required.string}),t=>(this.ic_.props.set("selected",t.selected),this.ic_.props.set("title",t.title),!0))}exportState(){return Ji(()=>super.exportState(),{selected:this.ic_.props.get("selected"),title:this.ic_.props.get("title")})}onItemClick_(){this.props.set("selected",!0)}}class ZN extends Fg{constructor(e,t){super(e,t),this.emitter_=new Un,this.onSelect_=this.onSelect_.bind(this),this.pool_=t,this.rackApi_.on("change",n=>{this.emitter_.emit("change",n)}),this.controller.tab.selectedIndex.emitter.on("change",this.onSelect_)}get pages(){return this.rackApi_.children}addPage(e){const t=this.controller.view.element.ownerDocument,n=new rA(t,{blade:kl(),itemProps:Dt.fromObject({selected:!1,title:e.title}),props:Dt.fromObject({selected:!1}),viewProps:Sr.create()}),s=this.pool_.createApi(n);return this.rackApi_.add(s,e.index)}removePage(e){this.rackApi_.remove(this.rackApi_.children[e])}on(e,t){const n=t.bind(this);return this.emitter_.on(e,s=>{n(s)},{key:t}),this}off(e,t){return this.emitter_.off(e,t),this}onSelect_(e){this.emitter_.emit("select",new rN(this,e.rawValue))}}class ek extends Fg{get title(){var e;return(e=this.controller.itemController.props.get("title"))!==null&&e!==void 0?e:""}set title(e){this.controller.itemController.props.set("title",e)}get selected(){return this.controller.props.get("selected")}set selected(e){this.controller.props.set("selected",e)}get children(){return this.rackApi_.children}addButton(e){return this.rackApi_.addButton(e)}addFolder(e){return this.rackApi_.addFolder(e)}addTab(e){return this.rackApi_.addTab(e)}add(e,t){this.rackApi_.add(e,t)}remove(e){this.rackApi_.remove(e)}addBinding(e,t,n){return this.rackApi_.addBinding(e,t,n)}addBlade(e){return this.rackApi_.addBlade(e)}}const V0=-1;class tk{constructor(){this.onItemSelectedChange_=this.onItemSelectedChange_.bind(this),this.empty=An(!0),this.selectedIndex=An(V0),this.items_=[]}add(e,t){const n=t!=null?t:this.items_.length;this.items_.splice(n,0,e),e.emitter.on("change",this.onItemSelectedChange_),this.keepSelection_()}remove(e){const t=this.items_.indexOf(e);t<0||(this.items_.splice(t,1),e.emitter.off("change",this.onItemSelectedChange_),this.keepSelection_())}keepSelection_(){if(this.items_.length===0){this.selectedIndex.rawValue=V0,this.empty.rawValue=!0;return}const e=this.items_.findIndex(t=>t.rawValue);e<0?(this.items_.forEach((t,n)=>{t.rawValue=n===0}),this.selectedIndex.rawValue=0):(this.items_.forEach((t,n)=>{t.rawValue=n===e}),this.selectedIndex.rawValue=e),this.empty.rawValue=!1}onItemSelectedChange_(e){if(e.rawValue){const t=this.items_.findIndex(n=>n===e.sender);this.items_.forEach((n,s)=>{n.rawValue=s===t}),this.selectedIndex.rawValue=t}else this.keepSelection_()}}const Zl=zt("tab");class nk{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Zl(),Pb()),t.viewProps.bindClassModifiers(this.element),_r(t.empty,Fl(this.element,Zl(void 0,"nop")));const n=e.createElement("div");n.classList.add(Zl("t")),this.element.appendChild(n),this.itemsElement=n;const s=e.createElement("div");s.classList.add(Zl("i")),this.element.appendChild(s);const r=e.createElement("div");r.classList.add(Zl("c")),this.element.appendChild(r),this.contentsElement=r}}class z0 extends Ng{constructor(e,t){const n=new tk,s=new nk(e,{empty:n.empty,viewProps:t.viewProps});super({blade:t.blade,rackController:new kg({blade:t.blade,element:s.contentsElement,viewProps:t.viewProps}),view:s}),this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this);const r=this.rackController.rack;r.emitter.on("add",this.onRackAdd_),r.emitter.on("remove",this.onRackRemove_),this.tab=n}add(e,t){this.rackController.rack.add(e,t)}remove(e){this.rackController.rack.remove(this.rackController.rack.children[e])}onRackAdd_(e){if(!e.root)return;const t=e.bladeController;bb(this.view.itemsElement,t.itemController.view.element,e.index),t.itemController.viewProps.set("parent",this.viewProps),this.tab.add(t.props.value("selected"))}onRackRemove_(e){if(!e.root)return;const t=e.bladeController;Dg(t.itemController.view.element),t.itemController.viewProps.set("parent",null),this.tab.remove(t.props.value("selected"))}}const Db=Ei({id:"tab",type:"blade",accept(i){const e=xn(i,t=>({pages:t.required.array(t.required.object({title:t.required.string})),view:t.required.constant("tab")}));return!e||e.pages.length===0?null:{params:e}},controller(i){const e=new z0(i.document,{blade:i.blade,viewProps:i.viewProps});return i.params.pages.forEach(t=>{const n=new rA(i.document,{blade:kl(),itemProps:Dt.fromObject({selected:!1,title:t.title}),props:Dt.fromObject({selected:!1}),viewProps:Sr.create()});e.add(n)}),e},api(i){return i.controller instanceof z0?new ZN(i.controller,i.pool):i.controller instanceof rA?new ek(i.controller,i.pool):null}});function ik(i,e){const t=i.accept(e.params);if(!t)return null;const n=xn(e.params,s=>({disabled:s.optional.boolean,hidden:s.optional.boolean}));return i.controller({blade:kl(),document:e.document,params:Object.assign(Object.assign({},t.params),{disabled:n==null?void 0:n.disabled,hidden:n==null?void 0:n.hidden}),viewProps:Sr.create({disabled:n==null?void 0:n.disabled,hidden:n==null?void 0:n.hidden})})}class Ug extends nh{get options(){return this.controller.valueController.props.get("options")}set options(e){this.controller.valueController.props.set("options",e)}}class sk{constructor(){this.disabled=!1,this.emitter=new Un}dispose(){}tick(){this.disabled||this.emitter.emit("tick",{sender:this})}}class rk{constructor(e,t){this.disabled_=!1,this.timerId_=null,this.onTick_=this.onTick_.bind(this),this.doc_=e,this.emitter=new Un,this.interval_=t,this.setTimer_()}get disabled(){return this.disabled_}set disabled(e){this.disabled_=e,this.disabled_?this.clearTimer_():this.setTimer_()}dispose(){this.clearTimer_()}clearTimer_(){if(this.timerId_===null)return;const e=this.doc_.defaultView;e&&e.clearInterval(this.timerId_),this.timerId_=null}setTimer_(){if(this.clearTimer_(),this.interval_<=0)return;const e=this.doc_.defaultView;e&&(this.timerId_=e.setInterval(this.onTick_,this.interval_))}onTick_(){this.disabled_||this.emitter.emit("tick",{sender:this})}}class Ch{constructor(e){this.constraints=e}constrain(e){return this.constraints.reduce((t,n)=>n.constrain(t),e)}}function Ad(i,e){if(i instanceof e)return i;if(i instanceof Ch){const t=i.constraints.reduce((n,s)=>n||(s instanceof e?s:null),null);if(t)return t}return null}class Sh{constructor(e){this.values=Dt.fromObject({options:e})}constrain(e){const t=this.values.get("options");return t.length===0||t.filter(s=>s.value===e).length>0?e:t[0].value}}function Ih(i){var e;const t=nA;if(Array.isArray(i))return(e=xn({items:i},n=>({items:n.required.array(n.required.object({text:n.required.string,value:n.required.raw}))})))===null||e===void 0?void 0:e.items;if(typeof i=="object")return t.required.raw(i).value}function Qg(i){if(Array.isArray(i))return i;const e=[];return Object.keys(i).forEach(t=>{e.push({text:t,value:i[t]})}),e}function Vg(i){return hn(i)?null:new Sh(Qg(i))}const vp=zt("lst");class ok{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.props_=t.props,this.element=e.createElement("div"),this.element.classList.add(vp()),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("select");n.classList.add(vp("s")),t.viewProps.bindDisabled(n),this.element.appendChild(n),this.selectElement=n;const s=e.createElement("div");s.classList.add(vp("m")),s.appendChild(Zd(e,"dropdown")),this.element.appendChild(s),t.value.emitter.on("change",this.onValueChange_),this.value_=t.value,Ws(this.props_,"options",r=>{Eb(this.selectElement),r.forEach(o=>{const a=e.createElement("option");a.textContent=o.text,this.selectElement.appendChild(a)}),this.update_()})}update_(){const e=this.props_.get("options").map(t=>t.value);this.selectElement.selectedIndex=e.indexOf(this.value_.rawValue)}onValueChange_(){this.update_()}}class uo{constructor(e,t){this.onSelectChange_=this.onSelectChange_.bind(this),this.props=t.props,this.value=t.value,this.viewProps=t.viewProps,this.view=new ok(e,{props:this.props,value:this.value,viewProps:this.viewProps}),this.view.selectElement.addEventListener("change",this.onSelectChange_)}onSelectChange_(e){const t=e.currentTarget;this.value.rawValue=this.props.get("options")[t.selectedIndex].value}importProps(e){return $i(e,null,t=>({options:t.required.custom(Ih)}),t=>(this.props.set("options",Qg(t.options)),!0))}exportProps(){return Ji(null,{options:this.props.get("options")})}}const G0=zt("pop");class ak{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(G0()),t.viewProps.bindClassModifiers(this.element),_r(t.shows,Fl(this.element,G0(void 0,"v")))}}class Lb{constructor(e,t){this.shows=An(!1),this.viewProps=t.viewProps,this.view=new ak(e,{shows:this.shows,viewProps:this.viewProps})}}const H0=zt("txt");class lk{constructor(e,t){this.onChange_=this.onChange_.bind(this),this.element=e.createElement("div"),this.element.classList.add(H0()),t.viewProps.bindClassModifiers(this.element),this.props_=t.props,this.props_.emitter.on("change",this.onChange_);const n=e.createElement("input");n.classList.add(H0("i")),n.type="text",t.viewProps.bindDisabled(n),this.element.appendChild(n),this.inputElement=n,t.value.emitter.on("change",this.onChange_),this.value_=t.value,this.refresh()}refresh(){const e=this.props_.get("formatter");this.inputElement.value=e(this.value_.rawValue)}onChange_(){this.refresh()}}class ih{constructor(e,t){this.onInputChange_=this.onInputChange_.bind(this),this.parser_=t.parser,this.props=t.props,this.value=t.value,this.viewProps=t.viewProps,this.view=new lk(e,{props:t.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(e){const n=e.currentTarget.value,s=this.parser_(n);hn(s)||(this.value.rawValue=s),this.view.refresh()}}function ck(i){return String(i)}function Fb(i){return i==="false"?!1:!!i}function W0(i){return ck(i)}function hk(i){return e=>i.reduce((t,n)=>t!==null?t:n(e),null)}const uk=Li(0);function gd(i){return uk(i)+"%"}function Nb(i){return String(i)}function oA(i){return i}function Ol({primary:i,secondary:e,forward:t,backward:n}){let s=!1;function r(o){s||(s=!0,o(),s=!1)}i.emitter.on("change",o=>{r(()=>{e.setRawValue(t(i.rawValue,e.rawValue),o.options)})}),e.emitter.on("change",o=>{r(()=>{i.setRawValue(n(i.rawValue,e.rawValue),o.options)}),r(()=>{e.setRawValue(t(i.rawValue,e.rawValue),o.options)})}),r(()=>{e.setRawValue(t(i.rawValue,e.rawValue),{forceEmit:!1,last:!0})})}function Mi(i,e){const t=i*(e.altKey?.1:1)*(e.shiftKey?10:1);return e.upKey?+t:e.downKey?-t:0}function sh(i){return{altKey:i.altKey,downKey:i.key==="ArrowDown",shiftKey:i.shiftKey,upKey:i.key==="ArrowUp"}}function wr(i){return{altKey:i.altKey,downKey:i.key==="ArrowLeft",shiftKey:i.shiftKey,upKey:i.key==="ArrowRight"}}function dk(i){return i==="ArrowUp"||i==="ArrowDown"}function kb(i){return dk(i)||i==="ArrowLeft"||i==="ArrowRight"}function _p(i,e){var t,n;const s=e.ownerDocument.defaultView,r=e.getBoundingClientRect();return{x:i.pageX-(((t=s&&s.scrollX)!==null&&t!==void 0?t:0)+r.left),y:i.pageY-(((n=s&&s.scrollY)!==null&&n!==void 0?n:0)+r.top)}}class fa{constructor(e){this.lastTouch_=null,this.onDocumentMouseMove_=this.onDocumentMouseMove_.bind(this),this.onDocumentMouseUp_=this.onDocumentMouseUp_.bind(this),this.onMouseDown_=this.onMouseDown_.bind(this),this.onTouchEnd_=this.onTouchEnd_.bind(this),this.onTouchMove_=this.onTouchMove_.bind(this),this.onTouchStart_=this.onTouchStart_.bind(this),this.elem_=e,this.emitter=new Un,e.addEventListener("touchstart",this.onTouchStart_,{passive:!1}),e.addEventListener("touchmove",this.onTouchMove_,{passive:!0}),e.addEventListener("touchend",this.onTouchEnd_),e.addEventListener("mousedown",this.onMouseDown_)}computePosition_(e){const t=this.elem_.getBoundingClientRect();return{bounds:{width:t.width,height:t.height},point:e?{x:e.x,y:e.y}:null}}onMouseDown_(e){var t;e.preventDefault(),(t=e.currentTarget)===null||t===void 0||t.focus();const n=this.elem_.ownerDocument;n.addEventListener("mousemove",this.onDocumentMouseMove_),n.addEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("down",{altKey:e.altKey,data:this.computePosition_(_p(e,this.elem_)),sender:this,shiftKey:e.shiftKey})}onDocumentMouseMove_(e){this.emitter.emit("move",{altKey:e.altKey,data:this.computePosition_(_p(e,this.elem_)),sender:this,shiftKey:e.shiftKey})}onDocumentMouseUp_(e){const t=this.elem_.ownerDocument;t.removeEventListener("mousemove",this.onDocumentMouseMove_),t.removeEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("up",{altKey:e.altKey,data:this.computePosition_(_p(e,this.elem_)),sender:this,shiftKey:e.shiftKey})}onTouchStart_(e){e.preventDefault();const t=e.targetTouches.item(0),n=this.elem_.getBoundingClientRect();this.emitter.emit("down",{altKey:e.altKey,data:this.computePosition_(t?{x:t.clientX-n.left,y:t.clientY-n.top}:void 0),sender:this,shiftKey:e.shiftKey}),this.lastTouch_=t}onTouchMove_(e){const t=e.targetTouches.item(0),n=this.elem_.getBoundingClientRect();this.emitter.emit("move",{altKey:e.altKey,data:this.computePosition_(t?{x:t.clientX-n.left,y:t.clientY-n.top}:void 0),sender:this,shiftKey:e.shiftKey}),this.lastTouch_=t}onTouchEnd_(e){var t;const n=(t=e.targetTouches.item(0))!==null&&t!==void 0?t:this.lastTouch_,s=this.elem_.getBoundingClientRect();this.emitter.emit("up",{altKey:e.altKey,data:this.computePosition_(n?{x:n.clientX-s.left,y:n.clientY-s.top}:void 0),sender:this,shiftKey:e.shiftKey})}}const es=zt("txt");class fk{constructor(e,t){this.onChange_=this.onChange_.bind(this),this.props_=t.props,this.props_.emitter.on("change",this.onChange_),this.element=e.createElement("div"),this.element.classList.add(es(),es(void 0,"num")),t.arrayPosition&&this.element.classList.add(es(void 0,t.arrayPosition)),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("input");n.classList.add(es("i")),n.type="text",t.viewProps.bindDisabled(n),this.element.appendChild(n),this.inputElement=n,this.onDraggingChange_=this.onDraggingChange_.bind(this),this.dragging_=t.dragging,this.dragging_.emitter.on("change",this.onDraggingChange_),this.element.classList.add(es()),this.inputElement.classList.add(es("i"));const s=e.createElement("div");s.classList.add(es("k")),this.element.appendChild(s),this.knobElement=s;const r=e.createElementNS(Us,"svg");r.classList.add(es("g")),this.knobElement.appendChild(r);const o=e.createElementNS(Us,"path");o.classList.add(es("gb")),r.appendChild(o),this.guideBodyElem_=o;const a=e.createElementNS(Us,"path");a.classList.add(es("gh")),r.appendChild(a),this.guideHeadElem_=a;const l=e.createElement("div");l.classList.add(zt("tt")()),this.knobElement.appendChild(l),this.tooltipElem_=l,t.value.emitter.on("change",this.onChange_),this.value=t.value,this.refresh()}onDraggingChange_(e){if(e.rawValue===null){this.element.classList.remove(es(void 0,"drg"));return}this.element.classList.add(es(void 0,"drg"));const t=e.rawValue/this.props_.get("pointerScale"),n=t+(t>0?-1:t<0?1:0),s=Wn(-n,-4,4);this.guideHeadElem_.setAttributeNS(null,"d",["M ".concat(n+s,",0 L").concat(n,",4 L").concat(n+s,",8"),"M ".concat(t,",-1 L").concat(t,",9")].join(" ")),this.guideBodyElem_.setAttributeNS(null,"d","M 0,4 L".concat(t,",4"));const r=this.props_.get("formatter");this.tooltipElem_.textContent=r(this.value.rawValue),this.tooltipElem_.style.left="".concat(t,"px")}refresh(){const e=this.props_.get("formatter");this.inputElement.value=e(this.value.rawValue)}onChange_(){this.refresh()}}class Mh{constructor(e,t){var n;this.originRawValue_=0,this.onInputChange_=this.onInputChange_.bind(this),this.onInputKeyDown_=this.onInputKeyDown_.bind(this),this.onInputKeyUp_=this.onInputKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.parser_=t.parser,this.props=t.props,this.sliderProps_=(n=t.sliderProps)!==null&&n!==void 0?n:null,this.value=t.value,this.viewProps=t.viewProps,this.dragging_=An(null),this.view=new fk(e,{arrayPosition:t.arrayPosition,dragging:this.dragging_,props:this.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_),this.view.inputElement.addEventListener("keydown",this.onInputKeyDown_),this.view.inputElement.addEventListener("keyup",this.onInputKeyUp_);const s=new fa(this.view.knobElement);s.emitter.on("down",this.onPointerDown_),s.emitter.on("move",this.onPointerMove_),s.emitter.on("up",this.onPointerUp_)}constrainValue_(e){var t,n;const s=(t=this.sliderProps_)===null||t===void 0?void 0:t.get("min"),r=(n=this.sliderProps_)===null||n===void 0?void 0:n.get("max");let o=e;return s!==void 0&&(o=Math.max(o,s)),r!==void 0&&(o=Math.min(o,r)),o}onInputChange_(e){const n=e.currentTarget.value,s=this.parser_(n);hn(s)||(this.value.rawValue=this.constrainValue_(s)),this.view.refresh()}onInputKeyDown_(e){const t=Mi(this.props.get("keyScale"),sh(e));t!==0&&this.value.setRawValue(this.constrainValue_(this.value.rawValue+t),{forceEmit:!1,last:!1})}onInputKeyUp_(e){Mi(this.props.get("keyScale"),sh(e))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}onPointerDown_(){this.originRawValue_=this.value.rawValue,this.dragging_.rawValue=0}computeDraggingValue_(e){if(!e.point)return null;const t=e.point.x-e.bounds.width/2;return this.constrainValue_(this.originRawValue_+t*this.props.get("pointerScale"))}onPointerMove_(e){const t=this.computeDraggingValue_(e.data);t!==null&&(this.value.setRawValue(t,{forceEmit:!1,last:!1}),this.dragging_.rawValue=this.value.rawValue-this.originRawValue_)}onPointerUp_(e){const t=this.computeDraggingValue_(e.data);t!==null&&(this.value.setRawValue(t,{forceEmit:!0,last:!0}),this.dragging_.rawValue=null)}}const yp=zt("sld");class pk{constructor(e,t){this.onChange_=this.onChange_.bind(this),this.props_=t.props,this.props_.emitter.on("change",this.onChange_),this.element=e.createElement("div"),this.element.classList.add(yp()),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("div");n.classList.add(yp("t")),t.viewProps.bindTabIndex(n),this.element.appendChild(n),this.trackElement=n;const s=e.createElement("div");s.classList.add(yp("k")),this.trackElement.appendChild(s),this.knobElement=s,t.value.emitter.on("change",this.onChange_),this.value=t.value,this.update_()}update_(){const e=Wn(Xt(this.value.rawValue,this.props_.get("min"),this.props_.get("max"),0,100),0,100);this.knobElement.style.width="".concat(e,"%")}onChange_(){this.update_()}}class mk{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDownOrMove_=this.onPointerDownOrMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.props=t.props,this.view=new pk(e,{props:this.props,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new fa(this.view.trackElement),this.ptHandler_.emitter.on("down",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("move",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.trackElement.addEventListener("keydown",this.onKeyDown_),this.view.trackElement.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){e.point&&this.value.setRawValue(Xt(Wn(e.point.x,0,e.bounds.width),0,e.bounds.width,this.props.get("min"),this.props.get("max")),t)}onPointerDownOrMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){const t=Mi(this.props.get("keyScale"),wr(e));t!==0&&this.value.setRawValue(this.value.rawValue+t,{forceEmit:!1,last:!1})}onKeyUp_(e){Mi(this.props.get("keyScale"),wr(e))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const xp=zt("sldtxt");class Ak{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(xp());const n=e.createElement("div");n.classList.add(xp("s")),this.sliderView_=t.sliderView,n.appendChild(this.sliderView_.element),this.element.appendChild(n);const s=e.createElement("div");s.classList.add(xp("t")),this.textView_=t.textView,s.appendChild(this.textView_.element),this.element.appendChild(s)}}class vd{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.sliderC_=new mk(e,{props:t.sliderProps,value:t.value,viewProps:this.viewProps}),this.textC_=new Mh(e,{parser:t.parser,props:t.textProps,sliderProps:t.sliderProps,value:t.value,viewProps:t.viewProps}),this.view=new Ak(e,{sliderView:this.sliderC_.view,textView:this.textC_.view})}get sliderController(){return this.sliderC_}get textController(){return this.textC_}importProps(e){return $i(e,null,t=>({max:t.required.number,min:t.required.number}),t=>{const n=this.sliderC_.props;return n.set("max",t.max),n.set("min",t.min),!0})}exportProps(){const e=this.sliderC_.props;return Ji(null,{max:e.get("max"),min:e.get("min")})}}function Ob(i){return{sliderProps:new Dt({keyScale:i.keyScale,max:i.max,min:i.min}),textProps:new Dt({formatter:An(i.formatter),keyScale:i.keyScale,pointerScale:An(i.pointerScale)})}}const gk={containerUnitSize:"cnt-usz"};function Ub(i){return"--".concat(gk[i])}function rh(i){return xb(i)}function Yr(i){if(tA(i))return xn(i,rh)}function Ar(i,e){if(!i)return;const t=[],n=vb(i,e);n&&t.push(n);const s=_b(i);return s&&t.push(s),new Ch(t)}function vk(i){return i?i.major===Nl.major:!1}function Qb(i){if(i==="inline"||i==="popup")return i}function Th(i,e){i.write(e)}const wu=zt("ckb");class _k{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.element=e.createElement("div"),this.element.classList.add(wu()),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("label");n.classList.add(wu("l")),this.element.appendChild(n),this.labelElement=n;const s=e.createElement("input");s.classList.add(wu("i")),s.type="checkbox",this.labelElement.appendChild(s),this.inputElement=s,t.viewProps.bindDisabled(this.inputElement);const r=e.createElement("div");r.classList.add(wu("w")),this.labelElement.appendChild(r);const o=Zd(e,"check");r.appendChild(o),t.value.emitter.on("change",this.onValueChange_),this.value=t.value,this.update_()}update_(){this.inputElement.checked=this.value.rawValue}onValueChange_(){this.update_()}}class yk{constructor(e,t){this.onInputChange_=this.onInputChange_.bind(this),this.onLabelMouseDown_=this.onLabelMouseDown_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new _k(e,{value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_),this.view.labelElement.addEventListener("mousedown",this.onLabelMouseDown_)}onInputChange_(e){const t=e.currentTarget;this.value.rawValue=t.checked,e.preventDefault(),e.stopPropagation()}onLabelMouseDown_(e){e.preventDefault()}}function xk(i){const e=[],t=Vg(i.options);return t&&e.push(t),new Ch(e)}const wk=Ei({id:"input-bool",type:"input",accept:(i,e)=>{if(typeof i!="boolean")return null;const t=xn(e,n=>({options:n.optional.custom(Ih),readonly:n.optional.constant(!1)}));return t?{initialValue:i,params:t}:null},binding:{reader:i=>Fb,constraint:i=>xk(i.params),writer:i=>Th},controller:i=>{const e=i.document,t=i.value,n=i.constraint,s=n&&Ad(n,Sh);return s?new uo(e,{props:new Dt({options:s.values.value("options")}),value:t,viewProps:i.viewProps}):new yk(e,{value:t,viewProps:i.viewProps})},api(i){return typeof i.controller.value.rawValue!="boolean"?null:i.controller.valueController instanceof uo?new Ug(i.controller):null}}),Mo=zt("col");class bk{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Mo()),t.foldable.bindExpandedClass(this.element,Mo(void 0,"expanded")),Ws(t.foldable,"completed",Fl(this.element,Mo(void 0,"cpl")));const n=e.createElement("div");n.classList.add(Mo("h")),this.element.appendChild(n);const s=e.createElement("div");s.classList.add(Mo("s")),n.appendChild(s),this.swatchElement=s;const r=e.createElement("div");if(r.classList.add(Mo("t")),n.appendChild(r),this.textElement=r,t.pickerLayout==="inline"){const o=e.createElement("div");o.classList.add(Mo("p")),this.element.appendChild(o),this.pickerElement=o}else this.pickerElement=null}}function Ek(i,e,t){const n=Wn(i/255,0,1),s=Wn(e/255,0,1),r=Wn(t/255,0,1),o=Math.max(n,s,r),a=Math.min(n,s,r),l=o-a;let c=0,h=0;const u=(a+o)/2;return l!==0&&(h=l/(1-Math.abs(o+a-1)),n===o?c=(s-r)/l:s===o?c=2+(r-n)/l:c=4+(n-s)/l,c=c/6+(c<0?1:0)),[c*360,h*100,u*100]}function Ck(i,e,t){const n=(i%360+360)%360,s=Wn(e/100,0,1),r=Wn(t/100,0,1),o=(1-Math.abs(2*r-1))*s,a=o*(1-Math.abs(n/60%2-1)),l=r-o/2;let c,h,u;return n>=0&&n<60?[c,h,u]=[o,a,0]:n>=60&&n<120?[c,h,u]=[a,o,0]:n>=120&&n<180?[c,h,u]=[0,o,a]:n>=180&&n<240?[c,h,u]=[0,a,o]:n>=240&&n<300?[c,h,u]=[a,0,o]:[c,h,u]=[o,0,a],[(c+l)*255,(h+l)*255,(u+l)*255]}function Sk(i,e,t){const n=Wn(i/255,0,1),s=Wn(e/255,0,1),r=Wn(t/255,0,1),o=Math.max(n,s,r),a=Math.min(n,s,r),l=o-a;let c;l===0?c=0:o===n?c=60*(((s-r)/l%6+6)%6):o===s?c=60*((r-n)/l+2):c=60*((n-s)/l+4);const h=o===0?0:l/o,u=o;return[c,h*100,u*100]}function Vb(i,e,t){const n=mb(i,360),s=Wn(e/100,0,1),r=Wn(t/100,0,1),o=r*s,a=o*(1-Math.abs(n/60%2-1)),l=r-o;let c,h,u;return n>=0&&n<60?[c,h,u]=[o,a,0]:n>=60&&n<120?[c,h,u]=[a,o,0]:n>=120&&n<180?[c,h,u]=[0,o,a]:n>=180&&n<240?[c,h,u]=[0,a,o]:n>=240&&n<300?[c,h,u]=[a,0,o]:[c,h,u]=[o,0,a],[(c+l)*255,(h+l)*255,(u+l)*255]}function Ik(i,e,t){const n=t+e*(100-Math.abs(2*t-100))/200;return[i,n!==0?e*(100-Math.abs(2*t-100))/n:0,t+e*(100-Math.abs(2*t-100))/(2*100)]}function Mk(i,e,t){const n=100-Math.abs(t*(200-e)/100-100);return[i,n!==0?e*t/n:0,t*(200-e)/(2*100)]}function qs(i){return[i[0],i[1],i[2]]}function tf(i,e){return[i[0],i[1],i[2],e]}const Tk={hsl:{hsl:(i,e,t)=>[i,e,t],hsv:Ik,rgb:Ck},hsv:{hsl:Mk,hsv:(i,e,t)=>[i,e,t],rgb:Vb},rgb:{hsl:Ek,hsv:Sk,rgb:(i,e,t)=>[i,e,t]}};function wl(i,e){return[e==="float"?1:i==="rgb"?255:360,e==="float"?1:i==="rgb"?255:100,e==="float"?1:i==="rgb"?255:100]}function Bk(i,e){return i===e?e:mb(i,e)}function zb(i,e,t){var n;const s=wl(e,t);return[e==="rgb"?Wn(i[0],0,s[0]):Bk(i[0],s[0]),Wn(i[1],0,s[1]),Wn(i[2],0,s[2]),Wn((n=i[3])!==null&&n!==void 0?n:1,0,1)]}function q0(i,e,t,n){const s=wl(e,t),r=wl(e,n);return i.map((o,a)=>o/s[a]*r[a])}function Gb(i,e,t){const n=q0(i,e.mode,e.type,"int"),s=Tk[e.mode][t.mode](...n);return q0(s,t.mode,"int",t.type)}class Gt{static black(){return new Gt([0,0,0],"rgb")}constructor(e,t){this.type="int",this.mode=t,this.comps_=zb(e,t,this.type)}getComponents(e){return tf(Gb(qs(this.comps_),{mode:this.mode,type:this.type},{mode:e!=null?e:this.mode,type:this.type}),this.comps_[3])}toRgbaObject(){const e=this.getComponents("rgb");return{r:e[0],g:e[1],b:e[2],a:e[3]}}}const Lr=zt("colp");class Rk{constructor(e,t){this.alphaViews_=null,this.element=e.createElement("div"),this.element.classList.add(Lr()),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("div");n.classList.add(Lr("hsv"));const s=e.createElement("div");s.classList.add(Lr("sv")),this.svPaletteView_=t.svPaletteView,s.appendChild(this.svPaletteView_.element),n.appendChild(s);const r=e.createElement("div");r.classList.add(Lr("h")),this.hPaletteView_=t.hPaletteView,r.appendChild(this.hPaletteView_.element),n.appendChild(r),this.element.appendChild(n);const o=e.createElement("div");if(o.classList.add(Lr("rgb")),this.textsView_=t.textsView,o.appendChild(this.textsView_.element),this.element.appendChild(o),t.alphaViews){this.alphaViews_={palette:t.alphaViews.palette,text:t.alphaViews.text};const a=e.createElement("div");a.classList.add(Lr("a"));const l=e.createElement("div");l.classList.add(Lr("ap")),l.appendChild(this.alphaViews_.palette.element),a.appendChild(l);const c=e.createElement("div");c.classList.add(Lr("at")),c.appendChild(this.alphaViews_.text.element),a.appendChild(c),this.element.appendChild(a)}}get allFocusableElements(){const e=[this.svPaletteView_.element,this.hPaletteView_.element,this.textsView_.modeSelectElement,...this.textsView_.inputViews.map(t=>t.inputElement)];return this.alphaViews_&&e.push(this.alphaViews_.palette.element,this.alphaViews_.text.inputElement),e}}function Pk(i){return i==="int"?"int":i==="float"?"float":void 0}function zg(i){return xn(i,e=>({color:e.optional.object({alpha:e.optional.boolean,type:e.optional.custom(Pk)}),expanded:e.optional.boolean,picker:e.optional.custom(Qb),readonly:e.optional.constant(!1)}))}function la(i){return i?.1:1}function Hb(i){var e;return(e=i.color)===null||e===void 0?void 0:e.type}class Gg{constructor(e,t){this.type="float",this.mode=t,this.comps_=zb(e,t,this.type)}getComponents(e){return tf(Gb(qs(this.comps_),{mode:this.mode,type:this.type},{mode:e!=null?e:this.mode,type:this.type}),this.comps_[3])}toRgbaObject(){const e=this.getComponents("rgb");return{r:e[0],g:e[1],b:e[2],a:e[3]}}}const Dk={int:(i,e)=>new Gt(i,e),float:(i,e)=>new Gg(i,e)};function Hg(i,e,t){return Dk[t](i,e)}function Lk(i){return i.type==="float"}function Fk(i){return i.type==="int"}function Nk(i){const e=i.getComponents(),t=wl(i.mode,"int");return new Gt([Math.round(Xt(e[0],0,1,0,t[0])),Math.round(Xt(e[1],0,1,0,t[1])),Math.round(Xt(e[2],0,1,0,t[2])),e[3]],i.mode)}function kk(i){const e=i.getComponents(),t=wl(i.mode,"int");return new Gg([Xt(e[0],0,t[0],0,1),Xt(e[1],0,t[1],0,1),Xt(e[2],0,t[2],0,1),e[3]],i.mode)}function wi(i,e){if(i.type===e)return i;if(Fk(i)&&e==="float")return kk(i);if(Lk(i)&&e==="int")return Nk(i);throw Cn.shouldNeverHappen()}function Ok(i,e){return i.alpha===e.alpha&&i.mode===e.mode&&i.notation===e.notation&&i.type===e.type}function as(i,e){const t=i.match(/^(.+)%$/);return Math.min(t?parseFloat(t[1])*.01*e:parseFloat(i),e)}const Uk={deg:i=>i,grad:i=>i*360/400,rad:i=>i*360/(2*Math.PI),turn:i=>i*360};function Wb(i){const e=i.match(/^([0-9.]+?)(deg|grad|rad|turn)$/);if(!e)return parseFloat(i);const t=parseFloat(e[1]),n=e[2];return Uk[n](t)}function qb(i){const e=i.match(/^rgb\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const t=[as(e[1],255),as(e[2],255),as(e[3],255)];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])?null:t}function Qk(i){const e=qb(i);return e?new Gt(e,"rgb"):null}function jb(i){const e=i.match(/^rgba\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const t=[as(e[1],255),as(e[2],255),as(e[3],255),as(e[4],1)];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])||isNaN(t[3])?null:t}function Vk(i){const e=jb(i);return e?new Gt(e,"rgb"):null}function Xb(i){const e=i.match(/^hsl\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const t=[Wb(e[1]),as(e[2],100),as(e[3],100)];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])?null:t}function zk(i){const e=Xb(i);return e?new Gt(e,"hsl"):null}function Yb(i){const e=i.match(/^hsla\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const t=[Wb(e[1]),as(e[2],100),as(e[3],100),as(e[4],1)];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])||isNaN(t[3])?null:t}function Gk(i){const e=Yb(i);return e?new Gt(e,"hsl"):null}function Kb(i){const e=i.match(/^#([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(e)return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16)];const t=i.match(/^(?:#|0x)([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return t?[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)]:null}function Hk(i){const e=Kb(i);return e?new Gt(e,"rgb"):null}function $b(i){const e=i.match(/^#([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(e)return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16),Xt(parseInt(e[4]+e[4],16),0,255,0,1)];const t=i.match(/^(?:#|0x)?([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return t?[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16),Xt(parseInt(t[4],16),0,255,0,1)]:null}function Wk(i){const e=$b(i);return e?new Gt(e,"rgb"):null}function Jb(i){const e=i.match(/^\{\s*r\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*g\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*b\s*:\s*([0-9A-Fa-f.]+%?)\s*\}$/);if(!e)return null;const t=[parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3])];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])?null:t}function qk(i){return e=>{const t=Jb(e);return t?Hg(t,"rgb",i):null}}function Zb(i){const e=i.match(/^\{\s*r\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*g\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*b\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*a\s*:\s*([0-9A-Fa-f.]+%?)\s*\}$/);if(!e)return null;const t=[parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3]),parseFloat(e[4])];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])||isNaN(t[3])?null:t}function jk(i){return e=>{const t=Zb(e);return t?Hg(t,"rgb",i):null}}const Xk=[{parser:Kb,result:{alpha:!1,mode:"rgb",notation:"hex"}},{parser:$b,result:{alpha:!0,mode:"rgb",notation:"hex"}},{parser:qb,result:{alpha:!1,mode:"rgb",notation:"func"}},{parser:jb,result:{alpha:!0,mode:"rgb",notation:"func"}},{parser:Xb,result:{alpha:!1,mode:"hsl",notation:"func"}},{parser:Yb,result:{alpha:!0,mode:"hsl",notation:"func"}},{parser:Jb,result:{alpha:!1,mode:"rgb",notation:"object"}},{parser:Zb,result:{alpha:!0,mode:"rgb",notation:"object"}}];function Yk(i){return Xk.reduce((e,{parser:t,result:n})=>e||(t(i)?n:null),null)}function Kk(i,e="int"){const t=Yk(i);return t?t.notation==="hex"&&e!=="float"?Object.assign(Object.assign({},t),{type:"int"}):t.notation==="func"?Object.assign(Object.assign({},t),{type:e}):null:null}function Bh(i){const e=[Hk,Wk,Qk,Vk,zk,Gk];e.push(qk("int"),jk("int"));const t=hk(e);return n=>{const s=t(n);return s?wi(s,i):null}}function $k(i){const e=Bh("int");if(typeof i!="string")return Gt.black();const t=e(i);return t!=null?t:Gt.black()}function eE(i){const e=Wn(Math.floor(i),0,255).toString(16);return e.length===1?"0".concat(e):e}function Wg(i,e="#"){const t=qs(i.getComponents("rgb")).map(eE).join("");return"".concat(e).concat(t)}function qg(i,e="#"){const t=i.getComponents("rgb"),n=[t[0],t[1],t[2],t[3]*255].map(eE).join("");return"".concat(e).concat(n)}function tE(i){const e=Li(0),t=wi(i,"int"),n=qs(t.getComponents("rgb")).map(s=>e(s));return"rgb(".concat(n.join(", "),")")}function Qu(i){const e=Li(2),t=Li(0),s=wi(i,"int").getComponents("rgb").map((r,o)=>(o===3?e:t)(r));return"rgba(".concat(s.join(", "),")")}function Jk(i){const e=[Li(0),gd,gd],t=wi(i,"int"),n=qs(t.getComponents("hsl")).map((s,r)=>e[r](s));return"hsl(".concat(n.join(", "),")")}function Zk(i){const e=[Li(0),gd,gd,Li(2)],n=wi(i,"int").getComponents("hsl").map((s,r)=>e[r](s));return"hsla(".concat(n.join(", "),")")}function nE(i,e){const t=Li(e==="float"?2:0),n=["r","g","b"],s=wi(i,e),r=qs(s.getComponents("rgb")).map((o,a)=>"".concat(n[a],": ").concat(t(o)));return"{".concat(r.join(", "),"}")}function eO(i){return e=>nE(e,i)}function iE(i,e){const t=Li(2),n=Li(e==="float"?2:0),s=["r","g","b","a"],o=wi(i,e).getComponents("rgb").map((a,l)=>{const c=l===3?t:n;return"".concat(s[l],": ").concat(c(a))});return"{".concat(o.join(", "),"}")}function tO(i){return e=>iE(e,i)}const nO=[{format:{alpha:!1,mode:"rgb",notation:"hex",type:"int"},stringifier:Wg},{format:{alpha:!0,mode:"rgb",notation:"hex",type:"int"},stringifier:qg},{format:{alpha:!1,mode:"rgb",notation:"func",type:"int"},stringifier:tE},{format:{alpha:!0,mode:"rgb",notation:"func",type:"int"},stringifier:Qu},{format:{alpha:!1,mode:"hsl",notation:"func",type:"int"},stringifier:Jk},{format:{alpha:!0,mode:"hsl",notation:"func",type:"int"},stringifier:Zk},...["int","float"].reduce((i,e)=>[...i,{format:{alpha:!1,mode:"rgb",notation:"object",type:e},stringifier:eO(e)},{format:{alpha:!0,mode:"rgb",notation:"object",type:e},stringifier:tO(e)}],[])];function sE(i){return nO.reduce((e,t)=>e||(Ok(t.format,i)?t.stringifier:null),null)}const ec=zt("apl");class iO{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.value=t.value,this.value.emitter.on("change",this.onValueChange_),this.element=e.createElement("div"),this.element.classList.add(ec()),t.viewProps.bindClassModifiers(this.element),t.viewProps.bindTabIndex(this.element);const n=e.createElement("div");n.classList.add(ec("b")),this.element.appendChild(n);const s=e.createElement("div");s.classList.add(ec("c")),n.appendChild(s),this.colorElem_=s;const r=e.createElement("div");r.classList.add(ec("m")),this.element.appendChild(r),this.markerElem_=r;const o=e.createElement("div");o.classList.add(ec("p")),this.markerElem_.appendChild(o),this.previewElem_=o,this.update_()}update_(){const e=this.value.rawValue,t=e.getComponents("rgb"),n=new Gt([t[0],t[1],t[2],0],"rgb"),s=new Gt([t[0],t[1],t[2],255],"rgb"),r=["to right",Qu(n),Qu(s)];this.colorElem_.style.background="linear-gradient(".concat(r.join(","),")"),this.previewElem_.style.backgroundColor=Qu(e);const o=Xt(t[3],0,1,0,100);this.markerElem_.style.left="".concat(o,"%")}onValueChange_(){this.update_()}}class sO{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new iO(e,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new fa(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const n=e.point.x/e.bounds.width,s=this.value.rawValue,[r,o,a]=s.getComponents("hsv");this.value.setRawValue(new Gt([r,o,a,n],"hsv"),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){const t=Mi(la(!0),wr(e));if(t===0)return;const n=this.value.rawValue,[s,r,o,a]=n.getComponents("hsv");this.value.setRawValue(new Gt([s,r,o,a+t],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(e){Mi(la(!0),wr(e))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const La=zt("coltxt");function rO(i){const e=i.createElement("select"),t=[{text:"RGB",value:"rgb"},{text:"HSL",value:"hsl"},{text:"HSV",value:"hsv"},{text:"HEX",value:"hex"}];return e.appendChild(t.reduce((n,s)=>{const r=i.createElement("option");return r.textContent=s.text,r.value=s.value,n.appendChild(r),n},i.createDocumentFragment())),e}class oO{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(La()),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("div");n.classList.add(La("m")),this.modeElem_=rO(e),this.modeElem_.classList.add(La("ms")),n.appendChild(this.modeSelectElement),t.viewProps.bindDisabled(this.modeElem_);const s=e.createElement("div");s.classList.add(La("mm")),s.appendChild(Zd(e,"dropdown")),n.appendChild(s),this.element.appendChild(n);const r=e.createElement("div");r.classList.add(La("w")),this.element.appendChild(r),this.inputsElem_=r,this.inputViews_=t.inputViews,this.applyInputViews_(),_r(t.mode,o=>{this.modeElem_.value=o})}get modeSelectElement(){return this.modeElem_}get inputViews(){return this.inputViews_}set inputViews(e){this.inputViews_=e,this.applyInputViews_()}applyInputViews_(){Eb(this.inputsElem_);const e=this.element.ownerDocument;this.inputViews_.forEach(t=>{const n=e.createElement("div");n.classList.add(La("c")),n.appendChild(t.element),this.inputsElem_.appendChild(n)})}}function aO(i){return Li(i==="float"?2:0)}function lO(i,e,t){const n=wl(i,e)[t];return new wh({min:0,max:n})}function cO(i,e,t){return new Mh(i,{arrayPosition:t===0?"fst":t===2?"lst":"mid",parser:e.parser,props:Dt.fromObject({formatter:aO(e.colorType),keyScale:la(!1),pointerScale:e.colorType==="float"?.01:1}),value:An(0,{constraint:lO(e.colorMode,e.colorType,t)}),viewProps:e.viewProps})}function hO(i,e){const t={colorMode:e.colorMode,colorType:e.colorType,parser:xr,viewProps:e.viewProps};return[0,1,2].map(n=>{const s=cO(i,t,n);return Ol({primary:e.value,secondary:s.value,forward(r){return wi(r,e.colorType).getComponents(e.colorMode)[n]},backward(r,o){const a=e.colorMode,c=wi(r,e.colorType).getComponents(a);c[n]=o;const h=Hg(tf(qs(c),c[3]),a,e.colorType);return wi(h,"int")}}),s})}function uO(i,e){const t=new ih(i,{parser:Bh("int"),props:Dt.fromObject({formatter:Wg}),value:An(Gt.black()),viewProps:e.viewProps});return Ol({primary:e.value,secondary:t.value,forward:n=>new Gt(qs(n.getComponents()),n.mode),backward:(n,s)=>new Gt(tf(qs(s.getComponents(n.mode)),n.getComponents()[3]),n.mode)}),[t]}function dO(i){return i!=="hex"}class fO{constructor(e,t){this.onModeSelectChange_=this.onModeSelectChange_.bind(this),this.colorType_=t.colorType,this.value=t.value,this.viewProps=t.viewProps,this.colorMode=An(this.value.rawValue.mode),this.ccs_=this.createComponentControllers_(e),this.view=new oO(e,{mode:this.colorMode,inputViews:[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view],viewProps:this.viewProps}),this.view.modeSelectElement.addEventListener("change",this.onModeSelectChange_)}createComponentControllers_(e){const t=this.colorMode.rawValue;return dO(t)?hO(e,{colorMode:t,colorType:this.colorType_,value:this.value,viewProps:this.viewProps}):uO(e,{value:this.value,viewProps:this.viewProps})}onModeSelectChange_(e){const t=e.currentTarget;this.colorMode.rawValue=t.value,this.ccs_=this.createComponentControllers_(this.view.element.ownerDocument),this.view.inputViews=this.ccs_.map(n=>n.view)}}const wp=zt("hpl");class pO{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.value=t.value,this.value.emitter.on("change",this.onValueChange_),this.element=e.createElement("div"),this.element.classList.add(wp()),t.viewProps.bindClassModifiers(this.element),t.viewProps.bindTabIndex(this.element);const n=e.createElement("div");n.classList.add(wp("c")),this.element.appendChild(n);const s=e.createElement("div");s.classList.add(wp("m")),this.element.appendChild(s),this.markerElem_=s,this.update_()}update_(){const e=this.value.rawValue,[t]=e.getComponents("hsv");this.markerElem_.style.backgroundColor=tE(new Gt([t,100,100],"hsv"));const n=Xt(t,0,360,0,100);this.markerElem_.style.left="".concat(n,"%")}onValueChange_(){this.update_()}}class mO{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new pO(e,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new fa(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const n=Xt(Wn(e.point.x,0,e.bounds.width),0,e.bounds.width,0,360),s=this.value.rawValue,[,r,o,a]=s.getComponents("hsv");this.value.setRawValue(new Gt([n,r,o,a],"hsv"),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){const t=Mi(la(!1),wr(e));if(t===0)return;const n=this.value.rawValue,[s,r,o,a]=n.getComponents("hsv");this.value.setRawValue(new Gt([s+t,r,o,a],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(e){Mi(la(!1),wr(e))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const bp=zt("svp"),j0=64;class AO{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.value=t.value,this.value.emitter.on("change",this.onValueChange_),this.element=e.createElement("div"),this.element.classList.add(bp()),t.viewProps.bindClassModifiers(this.element),t.viewProps.bindTabIndex(this.element);const n=e.createElement("canvas");n.height=j0,n.width=j0,n.classList.add(bp("c")),this.element.appendChild(n),this.canvasElement=n;const s=e.createElement("div");s.classList.add(bp("m")),this.element.appendChild(s),this.markerElem_=s,this.update_()}update_(){const e=mN(this.canvasElement);if(!e)return;const n=this.value.rawValue.getComponents("hsv"),s=this.canvasElement.width,r=this.canvasElement.height,o=e.getImageData(0,0,s,r),a=o.data;for(let h=0;h<r;h++)for(let u=0;u<s;u++){const d=Xt(u,0,s,0,100),f=Xt(h,0,r,100,0),p=Vb(n[0],d,f),A=(h*s+u)*4;a[A]=p[0],a[A+1]=p[1],a[A+2]=p[2],a[A+3]=255}e.putImageData(o,0,0);const l=Xt(n[1],0,100,0,100);this.markerElem_.style.left="".concat(l,"%");const c=Xt(n[2],0,100,100,0);this.markerElem_.style.top="".concat(c,"%")}onValueChange_(){this.update_()}}class gO{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new AO(e,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new fa(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const n=Xt(e.point.x,0,e.bounds.width,0,100),s=Xt(e.point.y,0,e.bounds.height,100,0),[r,,,o]=this.value.rawValue.getComponents("hsv");this.value.setRawValue(new Gt([r,n,s,o],"hsv"),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){kb(e.key)&&e.preventDefault();const[t,n,s,r]=this.value.rawValue.getComponents("hsv"),o=la(!1),a=Mi(o,wr(e)),l=Mi(o,sh(e));a===0&&l===0||this.value.setRawValue(new Gt([t,n+a,s+l,r],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(e){const t=la(!1),n=Mi(t,wr(e)),s=Mi(t,sh(e));n===0&&s===0||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}class vO{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.hPaletteC_=new mO(e,{value:this.value,viewProps:this.viewProps}),this.svPaletteC_=new gO(e,{value:this.value,viewProps:this.viewProps}),this.alphaIcs_=t.supportsAlpha?{palette:new sO(e,{value:this.value,viewProps:this.viewProps}),text:new Mh(e,{parser:xr,props:Dt.fromObject({pointerScale:.01,keyScale:.1,formatter:Li(2)}),value:An(0,{constraint:new wh({min:0,max:1})}),viewProps:this.viewProps})}:null,this.alphaIcs_&&Ol({primary:this.value,secondary:this.alphaIcs_.text.value,forward:n=>n.getComponents()[3],backward:(n,s)=>{const r=n.getComponents();return r[3]=s,new Gt(r,n.mode)}}),this.textsC_=new fO(e,{colorType:t.colorType,value:this.value,viewProps:this.viewProps}),this.view=new Rk(e,{alphaViews:this.alphaIcs_?{palette:this.alphaIcs_.palette.view,text:this.alphaIcs_.text.view}:null,hPaletteView:this.hPaletteC_.view,supportsAlpha:t.supportsAlpha,svPaletteView:this.svPaletteC_.view,textsView:this.textsC_.view,viewProps:this.viewProps})}get textsController(){return this.textsC_}}const Ep=zt("colsw");class _O{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),t.value.emitter.on("change",this.onValueChange_),this.value=t.value,this.element=e.createElement("div"),this.element.classList.add(Ep()),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("div");n.classList.add(Ep("sw")),this.element.appendChild(n),this.swatchElem_=n;const s=e.createElement("button");s.classList.add(Ep("b")),t.viewProps.bindDisabled(s),this.element.appendChild(s),this.buttonElement=s,this.update_()}update_(){const e=this.value.rawValue;this.swatchElem_.style.backgroundColor=qg(e)}onValueChange_(){this.update_()}}class yO{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.view=new _O(e,{value:this.value,viewProps:this.viewProps})}}class jg{constructor(e,t){this.onButtonBlur_=this.onButtonBlur_.bind(this),this.onButtonClick_=this.onButtonClick_.bind(this),this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.foldable_=Eh.create(t.expanded),this.swatchC_=new yO(e,{value:this.value,viewProps:this.viewProps});const n=this.swatchC_.view.buttonElement;n.addEventListener("blur",this.onButtonBlur_),n.addEventListener("click",this.onButtonClick_),this.textC_=new ih(e,{parser:t.parser,props:Dt.fromObject({formatter:t.formatter}),value:this.value,viewProps:this.viewProps}),this.view=new bk(e,{foldable:this.foldable_,pickerLayout:t.pickerLayout}),this.view.swatchElement.appendChild(this.swatchC_.view.element),this.view.textElement.appendChild(this.textC_.view.element),this.popC_=t.pickerLayout==="popup"?new Lb(e,{viewProps:this.viewProps}):null;const s=new vO(e,{colorType:t.colorType,supportsAlpha:t.supportsAlpha,value:this.value,viewProps:this.viewProps});s.view.allFocusableElements.forEach(r=>{r.addEventListener("blur",this.onPopupChildBlur_),r.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=s,this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(s.view.element),Ol({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:r=>r,backward:(r,o)=>o})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),Og(this.foldable_,this.view.pickerElement))}get textController(){return this.textC_}onButtonBlur_(e){if(!this.popC_)return;const t=this.view.element,n=e.relatedTarget;(!n||!t.contains(n))&&(this.popC_.shows.rawValue=!1)}onButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(e){if(!this.popC_)return;const t=this.popC_.view.element,n=Cb(e);n&&t.contains(n)||n&&n===this.swatchC_.view.buttonElement&&!Pg(t.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(e){this.popC_?e.key==="Escape"&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&e.key==="Escape"&&this.swatchC_.view.buttonElement.focus()}}function xO(i){return qs(i.getComponents("rgb")).reduce((e,t)=>e<<8|Math.floor(t)&255,0)}function wO(i){return i.getComponents("rgb").reduce((e,t,n)=>{const s=Math.floor(n===3?t*255:t)&255;return e<<8|s},0)>>>0}function bO(i){return new Gt([i>>16&255,i>>8&255,i&255],"rgb")}function EO(i){return new Gt([i>>24&255,i>>16&255,i>>8&255,Xt(i&255,0,255,0,1)],"rgb")}function CO(i){return typeof i!="number"?Gt.black():bO(i)}function SO(i){return typeof i!="number"?Gt.black():EO(i)}function Vu(i,e){return typeof i!="object"||hn(i)?!1:e in i&&typeof i[e]=="number"}function rE(i){return Vu(i,"r")&&Vu(i,"g")&&Vu(i,"b")}function oE(i){return rE(i)&&Vu(i,"a")}function aE(i){return rE(i)}function Xg(i,e){if(i.mode!==e.mode||i.type!==e.type)return!1;const t=i.getComponents(),n=e.getComponents();for(let s=0;s<t.length;s++)if(t[s]!==n[s])return!1;return!0}function X0(i){return"a"in i?[i.r,i.g,i.b,i.a]:[i.r,i.g,i.b]}function IO(i){const e=sE(i);return e?(t,n)=>{Th(t,e(n))}:null}function MO(i){const e=i?wO:xO;return(t,n)=>{Th(t,e(n))}}function TO(i,e,t){const s=wi(e,t).toRgbaObject();i.writeProperty("r",s.r),i.writeProperty("g",s.g),i.writeProperty("b",s.b),i.writeProperty("a",s.a)}function BO(i,e,t){const s=wi(e,t).toRgbaObject();i.writeProperty("r",s.r),i.writeProperty("g",s.g),i.writeProperty("b",s.b)}function RO(i,e){return(t,n)=>{i?TO(t,n,e):BO(t,n,e)}}function PO(i){var e;return!!(!((e=i==null?void 0:i.color)===null||e===void 0)&&e.alpha)}function DO(i){return i?e=>qg(e,"0x"):e=>Wg(e,"0x")}function LO(i){return"color"in i||i.view==="color"}const FO=Ei({id:"input-color-number",type:"input",accept:(i,e)=>{if(typeof i!="number"||!LO(e))return null;const t=zg(e);return t?{initialValue:i,params:Object.assign(Object.assign({},t),{supportsAlpha:PO(e)})}:null},binding:{reader:i=>i.params.supportsAlpha?SO:CO,equals:Xg,writer:i=>MO(i.params.supportsAlpha)},controller:i=>{var e,t;return new jg(i.document,{colorType:"int",expanded:(e=i.params.expanded)!==null&&e!==void 0?e:!1,formatter:DO(i.params.supportsAlpha),parser:Bh("int"),pickerLayout:(t=i.params.picker)!==null&&t!==void 0?t:"popup",supportsAlpha:i.params.supportsAlpha,value:i.value,viewProps:i.viewProps})}});function NO(i,e){if(!aE(i))return wi(Gt.black(),e);if(e==="int"){const t=X0(i);return new Gt(t,"rgb")}if(e==="float"){const t=X0(i);return new Gg(t,"rgb")}return wi(Gt.black(),"int")}function kO(i){return oE(i)}function OO(i){return e=>{const t=NO(e,i);return wi(t,"int")}}function UO(i,e){return t=>i?iE(t,e):nE(t,e)}const QO=Ei({id:"input-color-object",type:"input",accept:(i,e)=>{var t;if(!aE(i))return null;const n=zg(e);return n?{initialValue:i,params:Object.assign(Object.assign({},n),{colorType:(t=Hb(e))!==null&&t!==void 0?t:"int"})}:null},binding:{reader:i=>OO(i.params.colorType),equals:Xg,writer:i=>RO(kO(i.initialValue),i.params.colorType)},controller:i=>{var e,t;const n=oE(i.initialValue);return new jg(i.document,{colorType:i.params.colorType,expanded:(e=i.params.expanded)!==null&&e!==void 0?e:!1,formatter:UO(n,i.params.colorType),parser:Bh("int"),pickerLayout:(t=i.params.picker)!==null&&t!==void 0?t:"popup",supportsAlpha:n,value:i.value,viewProps:i.viewProps})}}),VO=Ei({id:"input-color-string",type:"input",accept:(i,e)=>{if(typeof i!="string"||e.view==="text")return null;const t=Kk(i,Hb(e));if(!t)return null;const n=sE(t);if(!n)return null;const s=zg(e);return s?{initialValue:i,params:Object.assign(Object.assign({},s),{format:t,stringifier:n})}:null},binding:{reader:()=>$k,equals:Xg,writer:i=>{const e=IO(i.params.format);if(!e)throw Cn.notBindable();return e}},controller:i=>{var e,t;return new jg(i.document,{colorType:i.params.format.type,expanded:(e=i.params.expanded)!==null&&e!==void 0?e:!1,formatter:i.params.stringifier,parser:Bh("int"),pickerLayout:(t=i.params.picker)!==null&&t!==void 0?t:"popup",supportsAlpha:i.params.format.alpha,value:i.value,viewProps:i.viewProps})}});class Yg{constructor(e){this.components=e.components,this.asm_=e.assembly}constrain(e){const t=this.asm_.toComponents(e).map((n,s)=>{var r,o;return(o=(r=this.components[s])===null||r===void 0?void 0:r.constrain(n))!==null&&o!==void 0?o:n});return this.asm_.fromComponents(t)}}const Y0=zt("pndtxt");class zO{constructor(e,t){this.textViews=t.textViews,this.element=e.createElement("div"),this.element.classList.add(Y0()),this.textViews.forEach(n=>{const s=e.createElement("div");s.classList.add(Y0("a")),s.appendChild(n.element),this.element.appendChild(s)})}}function GO(i,e,t){return new Mh(i,{arrayPosition:t===0?"fst":t===e.axes.length-1?"lst":"mid",parser:e.parser,props:e.axes[t].textProps,value:An(0,{constraint:e.axes[t].constraint}),viewProps:e.viewProps})}class Kg{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.acs_=t.axes.map((n,s)=>GO(e,t,s)),this.acs_.forEach((n,s)=>{Ol({primary:this.value,secondary:n.value,forward:r=>t.assembly.toComponents(r)[s],backward:(r,o)=>{const a=t.assembly.toComponents(r);return a[s]=o,t.assembly.fromComponents(a)}})}),this.view=new zO(e,{textViews:this.acs_.map(n=>n.view)})}get textControllers(){return this.acs_}}class HO extends nh{get max(){return this.controller.valueController.sliderController.props.get("max")}set max(e){this.controller.valueController.sliderController.props.set("max",e)}get min(){return this.controller.valueController.sliderController.props.get("min")}set min(e){this.controller.valueController.sliderController.props.set("min",e)}}function WO(i,e){const t=[],n=vb(i,e);n&&t.push(n);const s=_b(i);s&&t.push(s);const r=Vg(i.options);return r&&t.push(r),new Ch(t)}const qO=Ei({id:"input-number",type:"input",accept:(i,e)=>{if(typeof i!="number")return null;const t=xn(e,n=>Object.assign(Object.assign({},xb(n)),{options:n.optional.custom(Ih),readonly:n.optional.constant(!1)}));return t?{initialValue:i,params:t}:null},binding:{reader:i=>pb,constraint:i=>WO(i.params,i.initialValue),writer:i=>Th},controller:i=>{const e=i.value,t=i.constraint,n=t&&Ad(t,Sh);if(n)return new uo(i.document,{props:new Dt({options:n.values.value("options")}),value:e,viewProps:i.viewProps});const s=yb(i.params,e.rawValue),r=t&&Ad(t,wh);return r?new vd(i.document,Object.assign(Object.assign({},Ob(Object.assign(Object.assign({},s),{keyScale:An(s.keyScale),max:r.values.value("max"),min:r.values.value("min")}))),{parser:xr,value:e,viewProps:i.viewProps})):new Mh(i.document,{parser:xr,props:Dt.fromObject(s),value:e,viewProps:i.viewProps})},api(i){return typeof i.controller.value.rawValue!="number"?null:i.controller.valueController instanceof vd?new HO(i.controller):i.controller.valueController instanceof uo?new Ug(i.controller):null}});class so{constructor(e=0,t=0){this.x=e,this.y=t}getComponents(){return[this.x,this.y]}static isObject(e){if(hn(e))return!1;const t=e.x,n=e.y;return!(typeof t!="number"||typeof n!="number")}static equals(e,t){return e.x===t.x&&e.y===t.y}toObject(){return{x:this.x,y:this.y}}}const lE={toComponents:i=>i.getComponents(),fromComponents:i=>new so(...i)},Fa=zt("p2d");class jO{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Fa()),t.viewProps.bindClassModifiers(this.element),_r(t.expanded,Fl(this.element,Fa(void 0,"expanded")));const n=e.createElement("div");n.classList.add(Fa("h")),this.element.appendChild(n);const s=e.createElement("button");s.classList.add(Fa("b")),s.appendChild(Zd(e,"p2dpad")),t.viewProps.bindDisabled(s),n.appendChild(s),this.buttonElement=s;const r=e.createElement("div");if(r.classList.add(Fa("t")),n.appendChild(r),this.textElement=r,t.pickerLayout==="inline"){const o=e.createElement("div");o.classList.add(Fa("p")),this.element.appendChild(o),this.pickerElement=o}else this.pickerElement=null}}const Fr=zt("p2dp");class XO{constructor(e,t){this.onFoldableChange_=this.onFoldableChange_.bind(this),this.onPropsChange_=this.onPropsChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.props_=t.props,this.props_.emitter.on("change",this.onPropsChange_),this.element=e.createElement("div"),this.element.classList.add(Fr()),t.layout==="popup"&&this.element.classList.add(Fr(void 0,"p")),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("div");n.classList.add(Fr("p")),t.viewProps.bindTabIndex(n),this.element.appendChild(n),this.padElement=n;const s=e.createElementNS(Us,"svg");s.classList.add(Fr("g")),this.padElement.appendChild(s),this.svgElem_=s;const r=e.createElementNS(Us,"line");r.classList.add(Fr("ax")),r.setAttributeNS(null,"x1","0"),r.setAttributeNS(null,"y1","50%"),r.setAttributeNS(null,"x2","100%"),r.setAttributeNS(null,"y2","50%"),this.svgElem_.appendChild(r);const o=e.createElementNS(Us,"line");o.classList.add(Fr("ax")),o.setAttributeNS(null,"x1","50%"),o.setAttributeNS(null,"y1","0"),o.setAttributeNS(null,"x2","50%"),o.setAttributeNS(null,"y2","100%"),this.svgElem_.appendChild(o);const a=e.createElementNS(Us,"line");a.classList.add(Fr("l")),a.setAttributeNS(null,"x1","50%"),a.setAttributeNS(null,"y1","50%"),this.svgElem_.appendChild(a),this.lineElem_=a;const l=e.createElement("div");l.classList.add(Fr("m")),this.padElement.appendChild(l),this.markerElem_=l,t.value.emitter.on("change",this.onValueChange_),this.value=t.value,this.update_()}get allFocusableElements(){return[this.padElement]}update_(){const[e,t]=this.value.rawValue.getComponents(),n=this.props_.get("max"),s=Xt(e,-n,+n,0,100),r=Xt(t,-n,+n,0,100),o=this.props_.get("invertsY")?100-r:r;this.lineElem_.setAttributeNS(null,"x2","".concat(s,"%")),this.lineElem_.setAttributeNS(null,"y2","".concat(o,"%")),this.markerElem_.style.left="".concat(s,"%"),this.markerElem_.style.top="".concat(o,"%")}onValueChange_(){this.update_()}onPropsChange_(){this.update_()}onFoldableChange_(){this.update_()}}function K0(i,e,t){return[Mi(e[0],wr(i)),Mi(e[1],sh(i))*(t?1:-1)]}class YO{constructor(e,t){this.onPadKeyDown_=this.onPadKeyDown_.bind(this),this.onPadKeyUp_=this.onPadKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.props=t.props,this.value=t.value,this.viewProps=t.viewProps,this.view=new XO(e,{layout:t.layout,props:this.props,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new fa(this.view.padElement),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.padElement.addEventListener("keydown",this.onPadKeyDown_),this.view.padElement.addEventListener("keyup",this.onPadKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const n=this.props.get("max"),s=Xt(e.point.x,0,e.bounds.width,-n,+n),r=Xt(this.props.get("invertsY")?e.bounds.height-e.point.y:e.point.y,0,e.bounds.height,-n,+n);this.value.setRawValue(new so(s,r),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onPadKeyDown_(e){kb(e.key)&&e.preventDefault();const[t,n]=K0(e,[this.props.get("xKeyScale"),this.props.get("yKeyScale")],this.props.get("invertsY"));t===0&&n===0||this.value.setRawValue(new so(this.value.rawValue.x+t,this.value.rawValue.y+n),{forceEmit:!1,last:!1})}onPadKeyUp_(e){const[t,n]=K0(e,[this.props.get("xKeyScale"),this.props.get("yKeyScale")],this.props.get("invertsY"));t===0&&n===0||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}class KO{constructor(e,t){var n,s;this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.onPadButtonBlur_=this.onPadButtonBlur_.bind(this),this.onPadButtonClick_=this.onPadButtonClick_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.foldable_=Eh.create(t.expanded),this.popC_=t.pickerLayout==="popup"?new Lb(e,{viewProps:this.viewProps}):null;const r=new YO(e,{layout:t.pickerLayout,props:new Dt({invertsY:An(t.invertsY),max:An(t.max),xKeyScale:t.axes[0].textProps.value("keyScale"),yKeyScale:t.axes[1].textProps.value("keyScale")}),value:this.value,viewProps:this.viewProps});r.view.allFocusableElements.forEach(o=>{o.addEventListener("blur",this.onPopupChildBlur_),o.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=r,this.textC_=new Kg(e,{assembly:lE,axes:t.axes,parser:t.parser,value:this.value,viewProps:this.viewProps}),this.view=new jO(e,{expanded:this.foldable_.value("expanded"),pickerLayout:t.pickerLayout,viewProps:this.viewProps}),this.view.textElement.appendChild(this.textC_.view.element),(n=this.view.buttonElement)===null||n===void 0||n.addEventListener("blur",this.onPadButtonBlur_),(s=this.view.buttonElement)===null||s===void 0||s.addEventListener("click",this.onPadButtonClick_),this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(this.pickerC_.view.element),Ol({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:o=>o,backward:(o,a)=>a})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),Og(this.foldable_,this.view.pickerElement))}get textController(){return this.textC_}onPadButtonBlur_(e){if(!this.popC_)return;const t=this.view.element,n=e.relatedTarget;(!n||!t.contains(n))&&(this.popC_.shows.rawValue=!1)}onPadButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(e){if(!this.popC_)return;const t=this.popC_.view.element,n=Cb(e);n&&t.contains(n)||n&&n===this.view.buttonElement&&!Pg(t.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(e){this.popC_?e.key==="Escape"&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&e.key==="Escape"&&this.view.buttonElement.focus()}}function $O(i){return so.isObject(i)?new so(i.x,i.y):new so}function JO(i,e){i.writeProperty("x",e.x),i.writeProperty("y",e.y)}function ZO(i,e){return new Yg({assembly:lE,components:[Ar(Object.assign(Object.assign({},i),i.x),e.x),Ar(Object.assign(Object.assign({},i),i.y),e.y)]})}function $0(i,e){var t,n;if(!hn(i.min)||!hn(i.max))return Math.max(Math.abs((t=i.min)!==null&&t!==void 0?t:0),Math.abs((n=i.max)!==null&&n!==void 0?n:0));const s=Ab(i);return Math.max(Math.abs(s)*10,Math.abs(e)*10)}function eU(i,e){var t,n;const s=$0(oa(i,(t=i.x)!==null&&t!==void 0?t:{}),e.x),r=$0(oa(i,(n=i.y)!==null&&n!==void 0?n:{}),e.y);return Math.max(s,r)}function tU(i){if(!("y"in i))return!1;const e=i.y;return e&&"inverted"in e?!!e.inverted:!1}const nU=Ei({id:"input-point2d",type:"input",accept:(i,e)=>{if(!so.isObject(i))return null;const t=xn(e,n=>Object.assign(Object.assign({},rh(n)),{expanded:n.optional.boolean,picker:n.optional.custom(Qb),readonly:n.optional.constant(!1),x:n.optional.custom(Yr),y:n.optional.object(Object.assign(Object.assign({},rh(n)),{inverted:n.optional.boolean}))}));return t?{initialValue:i,params:t}:null},binding:{reader:()=>$O,constraint:i=>ZO(i.params,i.initialValue),equals:so.equals,writer:()=>JO},controller:i=>{var e,t;const n=i.document,s=i.value,r=i.constraint,o=[i.params.x,i.params.y];return new KO(n,{axes:s.rawValue.getComponents().map((a,l)=>{var c;return Rg({constraint:r.components[l],initialValue:a,params:oa(i.params,(c=o[l])!==null&&c!==void 0?c:{})})}),expanded:(e=i.params.expanded)!==null&&e!==void 0?e:!1,invertsY:tU(i.params),max:eU(i.params,s.rawValue),parser:xr,pickerLayout:(t=i.params.picker)!==null&&t!==void 0?t:"popup",value:s,viewProps:i.viewProps})}});class ll{constructor(e=0,t=0,n=0){this.x=e,this.y=t,this.z=n}getComponents(){return[this.x,this.y,this.z]}static isObject(e){if(hn(e))return!1;const t=e.x,n=e.y,s=e.z;return!(typeof t!="number"||typeof n!="number"||typeof s!="number")}static equals(e,t){return e.x===t.x&&e.y===t.y&&e.z===t.z}toObject(){return{x:this.x,y:this.y,z:this.z}}}const cE={toComponents:i=>i.getComponents(),fromComponents:i=>new ll(...i)};function iU(i){return ll.isObject(i)?new ll(i.x,i.y,i.z):new ll}function sU(i,e){i.writeProperty("x",e.x),i.writeProperty("y",e.y),i.writeProperty("z",e.z)}function rU(i,e){return new Yg({assembly:cE,components:[Ar(Object.assign(Object.assign({},i),i.x),e.x),Ar(Object.assign(Object.assign({},i),i.y),e.y),Ar(Object.assign(Object.assign({},i),i.z),e.z)]})}const oU=Ei({id:"input-point3d",type:"input",accept:(i,e)=>{if(!ll.isObject(i))return null;const t=xn(e,n=>Object.assign(Object.assign({},rh(n)),{readonly:n.optional.constant(!1),x:n.optional.custom(Yr),y:n.optional.custom(Yr),z:n.optional.custom(Yr)}));return t?{initialValue:i,params:t}:null},binding:{reader:i=>iU,constraint:i=>rU(i.params,i.initialValue),equals:ll.equals,writer:i=>sU},controller:i=>{const e=i.value,t=i.constraint,n=[i.params.x,i.params.y,i.params.z];return new Kg(i.document,{assembly:cE,axes:e.rawValue.getComponents().map((s,r)=>{var o;return Rg({constraint:t.components[r],initialValue:s,params:oa(i.params,(o=n[r])!==null&&o!==void 0?o:{})})}),parser:xr,value:e,viewProps:i.viewProps})}});class cl{constructor(e=0,t=0,n=0,s=0){this.x=e,this.y=t,this.z=n,this.w=s}getComponents(){return[this.x,this.y,this.z,this.w]}static isObject(e){if(hn(e))return!1;const t=e.x,n=e.y,s=e.z,r=e.w;return!(typeof t!="number"||typeof n!="number"||typeof s!="number"||typeof r!="number")}static equals(e,t){return e.x===t.x&&e.y===t.y&&e.z===t.z&&e.w===t.w}toObject(){return{x:this.x,y:this.y,z:this.z,w:this.w}}}const hE={toComponents:i=>i.getComponents(),fromComponents:i=>new cl(...i)};function aU(i){return cl.isObject(i)?new cl(i.x,i.y,i.z,i.w):new cl}function lU(i,e){i.writeProperty("x",e.x),i.writeProperty("y",e.y),i.writeProperty("z",e.z),i.writeProperty("w",e.w)}function cU(i,e){return new Yg({assembly:hE,components:[Ar(Object.assign(Object.assign({},i),i.x),e.x),Ar(Object.assign(Object.assign({},i),i.y),e.y),Ar(Object.assign(Object.assign({},i),i.z),e.z),Ar(Object.assign(Object.assign({},i),i.w),e.w)]})}const hU=Ei({id:"input-point4d",type:"input",accept:(i,e)=>{if(!cl.isObject(i))return null;const t=xn(e,n=>Object.assign(Object.assign({},rh(n)),{readonly:n.optional.constant(!1),w:n.optional.custom(Yr),x:n.optional.custom(Yr),y:n.optional.custom(Yr),z:n.optional.custom(Yr)}));return t?{initialValue:i,params:t}:null},binding:{reader:i=>aU,constraint:i=>cU(i.params,i.initialValue),equals:cl.equals,writer:i=>lU},controller:i=>{const e=i.value,t=i.constraint,n=[i.params.x,i.params.y,i.params.z,i.params.w];return new Kg(i.document,{assembly:hE,axes:e.rawValue.getComponents().map((s,r)=>{var o;return Rg({constraint:t.components[r],initialValue:s,params:oa(i.params,(o=n[r])!==null&&o!==void 0?o:{})})}),parser:xr,value:e,viewProps:i.viewProps})}});function uU(i){const e=[],t=Vg(i.options);return t&&e.push(t),new Ch(e)}const dU=Ei({id:"input-string",type:"input",accept:(i,e)=>{if(typeof i!="string")return null;const t=xn(e,n=>({readonly:n.optional.constant(!1),options:n.optional.custom(Ih)}));return t?{initialValue:i,params:t}:null},binding:{reader:i=>Nb,constraint:i=>uU(i.params),writer:i=>Th},controller:i=>{const e=i.document,t=i.value,n=i.constraint,s=n&&Ad(n,Sh);return s?new uo(e,{props:new Dt({options:s.values.value("options")}),value:t,viewProps:i.viewProps}):new ih(e,{parser:r=>r,props:Dt.fromObject({formatter:oA}),value:t,viewProps:i.viewProps})},api(i){return typeof i.controller.value.rawValue!="string"?null:i.controller.valueController instanceof uo?new Ug(i.controller):null}}),Rh={monitor:{defaultInterval:200,defaultRows:3}},J0=zt("mll");class fU{constructor(e,t){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=t.formatter,this.element=e.createElement("div"),this.element.classList.add(J0()),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("textarea");n.classList.add(J0("i")),n.style.height="calc(var(".concat(Ub("containerUnitSize"),") * ").concat(t.rows,")"),n.readOnly=!0,t.viewProps.bindDisabled(n),this.element.appendChild(n),this.textareaElem_=n,t.value.emitter.on("change",this.onValueUpdate_),this.value=t.value,this.update_()}update_(){const e=this.textareaElem_,t=e.scrollTop===e.scrollHeight-e.clientHeight,n=[];this.value.rawValue.forEach(s=>{s!==void 0&&n.push(this.formatter_(s))}),e.textContent=n.join("\n"),t&&(e.scrollTop=e.scrollHeight)}onValueUpdate_(){this.update_()}}class $g{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.view=new fU(e,{formatter:t.formatter,rows:t.rows,value:this.value,viewProps:this.viewProps})}}const Z0=zt("sgl");class pU{constructor(e,t){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=t.formatter,this.element=e.createElement("div"),this.element.classList.add(Z0()),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("input");n.classList.add(Z0("i")),n.readOnly=!0,n.type="text",t.viewProps.bindDisabled(n),this.element.appendChild(n),this.inputElement=n,t.value.emitter.on("change",this.onValueUpdate_),this.value=t.value,this.update_()}update_(){const e=this.value.rawValue,t=e[e.length-1];this.inputElement.value=t!==void 0?this.formatter_(t):""}onValueUpdate_(){this.update_()}}class Jg{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.view=new pU(e,{formatter:t.formatter,value:this.value,viewProps:this.viewProps})}}const mU=Ei({id:"monitor-bool",type:"monitor",accept:(i,e)=>{if(typeof i!="boolean")return null;const t=xn(e,n=>({readonly:n.required.constant(!0),rows:n.optional.number}));return t?{initialValue:i,params:t}:null},binding:{reader:i=>Fb},controller:i=>{var e;return i.value.rawValue.length===1?new Jg(i.document,{formatter:W0,value:i.value,viewProps:i.viewProps}):new $g(i.document,{formatter:W0,rows:(e=i.params.rows)!==null&&e!==void 0?e:Rh.monitor.defaultRows,value:i.value,viewProps:i.viewProps})}});class AU extends nh{get max(){return this.controller.valueController.props.get("max")}set max(e){this.controller.valueController.props.set("max",e)}get min(){return this.controller.valueController.props.get("min")}set min(e){this.controller.valueController.props.set("min",e)}}const Nr=zt("grl");class gU{constructor(e,t){this.onCursorChange_=this.onCursorChange_.bind(this),this.onValueUpdate_=this.onValueUpdate_.bind(this),this.element=e.createElement("div"),this.element.classList.add(Nr()),t.viewProps.bindClassModifiers(this.element),this.formatter_=t.formatter,this.props_=t.props,this.cursor_=t.cursor,this.cursor_.emitter.on("change",this.onCursorChange_);const n=e.createElementNS(Us,"svg");n.classList.add(Nr("g")),n.style.height="calc(var(".concat(Ub("containerUnitSize"),") * ").concat(t.rows,")"),this.element.appendChild(n),this.svgElem_=n;const s=e.createElementNS(Us,"polyline");this.svgElem_.appendChild(s),this.lineElem_=s;const r=e.createElement("div");r.classList.add(Nr("t"),zt("tt")()),this.element.appendChild(r),this.tooltipElem_=r,t.value.emitter.on("change",this.onValueUpdate_),this.value=t.value,this.update_()}get graphElement(){return this.svgElem_}update_(){const{clientWidth:e,clientHeight:t}=this.element,n=this.value.rawValue.length-1,s=this.props_.get("min"),r=this.props_.get("max"),o=[];this.value.rawValue.forEach((u,d)=>{if(u===void 0)return;const f=Xt(d,0,n,0,e),p=Xt(u,s,r,t,0);o.push([f,p].join(","))}),this.lineElem_.setAttributeNS(null,"points",o.join(" "));const a=this.tooltipElem_,l=this.value.rawValue[this.cursor_.rawValue];if(l===void 0){a.classList.remove(Nr("t","a"));return}const c=Xt(this.cursor_.rawValue,0,n,0,e),h=Xt(l,s,r,t,0);a.style.left="".concat(c,"px"),a.style.top="".concat(h,"px"),a.textContent="".concat(this.formatter_(l)),a.classList.contains(Nr("t","a"))||(a.classList.add(Nr("t","a"),Nr("t","in")),md(a),a.classList.remove(Nr("t","in")))}onValueUpdate_(){this.update_()}onCursorChange_(){this.update_()}}class uE{constructor(e,t){if(this.onGraphMouseMove_=this.onGraphMouseMove_.bind(this),this.onGraphMouseLeave_=this.onGraphMouseLeave_.bind(this),this.onGraphPointerDown_=this.onGraphPointerDown_.bind(this),this.onGraphPointerMove_=this.onGraphPointerMove_.bind(this),this.onGraphPointerUp_=this.onGraphPointerUp_.bind(this),this.props=t.props,this.value=t.value,this.viewProps=t.viewProps,this.cursor_=An(-1),this.view=new gU(e,{cursor:this.cursor_,formatter:t.formatter,rows:t.rows,props:this.props,value:this.value,viewProps:this.viewProps}),!Pg(e))this.view.element.addEventListener("mousemove",this.onGraphMouseMove_),this.view.element.addEventListener("mouseleave",this.onGraphMouseLeave_);else{const n=new fa(this.view.element);n.emitter.on("down",this.onGraphPointerDown_),n.emitter.on("move",this.onGraphPointerMove_),n.emitter.on("up",this.onGraphPointerUp_)}}importProps(e){return $i(e,null,t=>({max:t.required.number,min:t.required.number}),t=>(this.props.set("max",t.max),this.props.set("min",t.min),!0))}exportProps(){return Ji(null,{max:this.props.get("max"),min:this.props.get("min")})}onGraphMouseLeave_(){this.cursor_.rawValue=-1}onGraphMouseMove_(e){const{clientWidth:t}=this.view.element;this.cursor_.rawValue=Math.floor(Xt(e.offsetX,0,t,0,this.value.rawValue.length))}onGraphPointerDown_(e){this.onGraphPointerMove_(e)}onGraphPointerMove_(e){if(!e.data.point){this.cursor_.rawValue=-1;return}this.cursor_.rawValue=Math.floor(Xt(e.data.point.x,0,e.data.bounds.width,0,this.value.rawValue.length))}onGraphPointerUp_(){this.cursor_.rawValue=-1}}function aA(i){return hn(i.format)?Li(2):i.format}function vU(i){var e;return i.value.rawValue.length===1?new Jg(i.document,{formatter:aA(i.params),value:i.value,viewProps:i.viewProps}):new $g(i.document,{formatter:aA(i.params),rows:(e=i.params.rows)!==null&&e!==void 0?e:Rh.monitor.defaultRows,value:i.value,viewProps:i.viewProps})}function _U(i){var e,t,n;return new uE(i.document,{formatter:aA(i.params),rows:(e=i.params.rows)!==null&&e!==void 0?e:Rh.monitor.defaultRows,props:Dt.fromObject({max:(t=i.params.max)!==null&&t!==void 0?t:100,min:(n=i.params.min)!==null&&n!==void 0?n:0}),value:i.value,viewProps:i.viewProps})}function ey(i){return i.view==="graph"}const yU=Ei({id:"monitor-number",type:"monitor",accept:(i,e)=>{if(typeof i!="number")return null;const t=xn(e,n=>({format:n.optional.function,max:n.optional.number,min:n.optional.number,readonly:n.required.constant(!0),rows:n.optional.number,view:n.optional.string}));return t?{initialValue:i,params:t}:null},binding:{defaultBufferSize:i=>ey(i)?64:1,reader:i=>pb},controller:i=>ey(i.params)?_U(i):vU(i),api:i=>i.controller.valueController instanceof uE?new AU(i.controller):null}),xU=Ei({id:"monitor-string",type:"monitor",accept:(i,e)=>{if(typeof i!="string")return null;const t=xn(e,n=>({multiline:n.optional.boolean,readonly:n.required.constant(!0),rows:n.optional.number}));return t?{initialValue:i,params:t}:null},binding:{reader:i=>Nb},controller:i=>{var e;const t=i.value;return t.rawValue.length>1||i.params.multiline?new $g(i.document,{formatter:oA,rows:(e=i.params.rows)!==null&&e!==void 0?e:Rh.monitor.defaultRows,value:t,viewProps:i.viewProps}):new Jg(i.document,{formatter:oA,value:t,viewProps:i.viewProps})}});class wU{constructor(){this.map_=new Map}get(e){var t;return(t=this.map_.get(e))!==null&&t!==void 0?t:null}has(e){return this.map_.has(e)}add(e,t){return this.map_.set(e,t),e.viewProps.handleDispose(()=>{this.map_.delete(e)}),t}}class bU{constructor(e){this.target=e.target,this.reader_=e.reader,this.writer_=e.writer}read(){return this.reader_(this.target.read())}write(e){this.writer_(this.target,e)}inject(e){this.write(this.reader_(e))}}function EU(i,e){var t;const n=i.accept(e.target.read(),e.params);if(hn(n))return null;const s={target:e.target,initialValue:n.initialValue,params:n.params},r=xn(e.params,u=>({disabled:u.optional.boolean,hidden:u.optional.boolean,label:u.optional.string,tag:u.optional.string})),o=i.binding.reader(s),a=i.binding.constraint?i.binding.constraint(s):void 0,l=new bU({reader:o,target:e.target,writer:i.binding.writer(s)}),c=new aN(An(o(n.initialValue),{constraint:a,equals:i.binding.equals}),l),h=i.controller({constraint:a,document:e.document,initialValue:n.initialValue,params:n.params,value:c,viewProps:Sr.create({disabled:r==null?void 0:r.disabled,hidden:r==null?void 0:r.hidden})});return new wN(e.document,{blade:kl(),props:Dt.fromObject({label:"label"in e.params?(t=r==null?void 0:r.label)!==null&&t!==void 0?t:null:e.target.key}),tag:r==null?void 0:r.tag,value:c,valueController:h})}class CU{constructor(e){this.target=e.target,this.reader_=e.reader}read(){return this.reader_(this.target.read())}}function SU(i,e){return e===0?new sk:new rk(i,e!=null?e:Rh.monitor.defaultInterval)}function IU(i,e){var t,n,s;const r=i.accept(e.target.read(),e.params);if(hn(r))return null;const o={target:e.target,initialValue:r.initialValue,params:r.params},a=xn(e.params,d=>({bufferSize:d.optional.number,disabled:d.optional.boolean,hidden:d.optional.boolean,interval:d.optional.number,label:d.optional.string})),l=i.binding.reader(o),c=(n=(t=a==null?void 0:a.bufferSize)!==null&&t!==void 0?t:i.binding.defaultBufferSize&&i.binding.defaultBufferSize(r.params))!==null&&n!==void 0?n:1,h=new IN({binding:new CU({reader:l,target:e.target}),bufferSize:c,ticker:SU(e.document,a==null?void 0:a.interval)}),u=i.controller({document:e.document,params:r.params,value:h,viewProps:Sr.create({disabled:a==null?void 0:a.disabled,hidden:a==null?void 0:a.hidden})});return u.viewProps.bindDisabled(h.ticker),u.viewProps.handleDispose(()=>{h.ticker.dispose()}),new TN(e.document,{blade:kl(),props:Dt.fromObject({label:"label"in e.params?(s=a==null?void 0:a.label)!==null&&s!==void 0?s:null:e.target.key}),value:h,valueController:u})}class MU{constructor(e){this.pluginsMap_={blades:[],inputs:[],monitors:[]},this.apiCache_=e}getAll(){return[...this.pluginsMap_.blades,...this.pluginsMap_.inputs,...this.pluginsMap_.monitors]}register(e,t){if(!vk(t.core))throw Cn.notCompatible(e,t.id);t.type==="blade"?this.pluginsMap_.blades.unshift(t):t.type==="input"?this.pluginsMap_.inputs.unshift(t):t.type==="monitor"&&this.pluginsMap_.monitors.unshift(t)}createInput_(e,t,n){return this.pluginsMap_.inputs.reduce((s,r)=>s!=null?s:EU(r,{document:e,target:t,params:n}),null)}createMonitor_(e,t,n){return this.pluginsMap_.monitors.reduce((s,r)=>s!=null?s:IU(r,{document:e,params:n,target:t}),null)}createBinding(e,t,n){const s=t.read();if(hn(s))throw new Cn({context:{key:t.key},type:"nomatchingcontroller"});const r=this.createInput_(e,t,n);if(r)return r;const o=this.createMonitor_(e,t,n);if(o)return o;throw new Cn({context:{key:t.key},type:"nomatchingcontroller"})}createBlade(e,t){const n=this.pluginsMap_.blades.reduce((s,r)=>s!=null?s:ik(r,{document:e,params:t}),null);if(!n)throw new Cn({type:"nomatchingview",context:{params:t}});return n}createInputBindingApi_(e){const t=this.pluginsMap_.inputs.reduce((n,s)=>{var r,o;return n||((o=(r=s.api)===null||r===void 0?void 0:r.call(s,{controller:e}))!==null&&o!==void 0?o:null)},null);return this.apiCache_.add(e,t!=null?t:new nh(e))}createMonitorBindingApi_(e){const t=this.pluginsMap_.monitors.reduce((n,s)=>{var r,o;return n||((o=(r=s.api)===null||r===void 0?void 0:r.call(s,{controller:e}))!==null&&o!==void 0?o:null)},null);return this.apiCache_.add(e,t!=null?t:new nh(e))}createBindingApi(e){if(this.apiCache_.has(e))return this.apiCache_.get(e);if(bN(e))return this.createInputBindingApi_(e);if(BN(e))return this.createMonitorBindingApi_(e);throw Cn.shouldNeverHappen()}createApi(e){if(this.apiCache_.has(e))return this.apiCache_.get(e);if(xN(e))return this.createBindingApi(e);const t=this.pluginsMap_.blades.reduce((n,s)=>n!=null?n:s.api({controller:e,pool:this}),null);if(!t)throw Cn.shouldNeverHappen();return this.apiCache_.add(e,t)}}const TU=new wU;function BU(){const i=new MU(TU);return[nU,oU,hU,dU,qO,VO,QO,FO,wk,mU,xU,yU,FN,XN,Db].forEach(e=>{i.register("core",e)}),i}class RU extends da{constructor(e){super(e),this.emitter_=new Un,this.controller.value.emitter.on("change",t=>{this.emitter_.emit("change",new bh(this,t.rawValue))})}get label(){return this.controller.labelController.props.get("label")}set label(e){this.controller.labelController.props.set("label",e)}get options(){return this.controller.valueController.props.get("options")}set options(e){this.controller.valueController.props.set("options",e)}get value(){return this.controller.value.rawValue}set value(e){this.controller.value.rawValue=e}on(e,t){const n=t.bind(this);return this.emitter_.on(e,s=>{n(s)},{key:t}),this}off(e,t){return this.emitter_.off(e,t),this}}class PU extends da{}class DU extends da{constructor(e){super(e),this.emitter_=new Un,this.controller.value.emitter.on("change",t=>{this.emitter_.emit("change",new bh(this,t.rawValue))})}get label(){return this.controller.labelController.props.get("label")}set label(e){this.controller.labelController.props.set("label",e)}get max(){return this.controller.valueController.sliderController.props.get("max")}set max(e){this.controller.valueController.sliderController.props.set("max",e)}get min(){return this.controller.valueController.sliderController.props.get("min")}set min(e){this.controller.valueController.sliderController.props.set("min",e)}get value(){return this.controller.value.rawValue}set value(e){this.controller.value.rawValue=e}on(e,t){const n=t.bind(this);return this.emitter_.on(e,s=>{n(s)},{key:t}),this}off(e,t){return this.emitter_.off(e,t),this}}class LU extends da{constructor(e){super(e),this.emitter_=new Un,this.controller.value.emitter.on("change",t=>{this.emitter_.emit("change",new bh(this,t.rawValue))})}get label(){return this.controller.labelController.props.get("label")}set label(e){this.controller.labelController.props.set("label",e)}get formatter(){return this.controller.valueController.props.get("formatter")}set formatter(e){this.controller.valueController.props.set("formatter",e)}get value(){return this.controller.value.rawValue}set value(e){this.controller.value.rawValue=e}on(e,t){const n=t.bind(this);return this.emitter_.on(e,s=>{n(s)},{key:t}),this}off(e,t){return this.emitter_.off(e,t),this}}const FU=function(){return{id:"list",type:"blade",core:Nl,accept(i){const e=xn(i,t=>({options:t.required.custom(Ih),value:t.required.raw,view:t.required.constant("list"),label:t.optional.string}));return e?{params:e}:null},controller(i){const e=new Sh(Qg(i.params.options)),t=An(i.params.value,{constraint:e}),n=new uo(i.document,{props:new Dt({options:e.values.value("options")}),value:t,viewProps:i.viewProps});return new aa(i.document,{blade:i.blade,props:Dt.fromObject({label:i.params.label}),value:t,valueController:n})},api(i){return!(i.controller instanceof aa)||!(i.controller.valueController instanceof uo)?null:new RU(i.controller)}}}();class NU extends Rb{constructor(e,t){super(e,t)}get element(){return this.controller.view.element}}class kU extends sA{constructor(e,t){super(e,{expanded:t.expanded,blade:t.blade,props:t.props,root:!0,viewProps:t.viewProps})}}const ty=zt("spr");class OU{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(ty()),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("hr");n.classList.add(ty("r")),this.element.appendChild(n)}}class ny extends ef{constructor(e,t){super(Object.assign(Object.assign({},t),{view:new OU(e,{viewProps:t.viewProps})}))}}const UU={id:"separator",type:"blade",core:Nl,accept(i){const e=xn(i,t=>({view:t.required.constant("separator")}));return e?{params:e}:null},controller(i){return new ny(i.document,{blade:i.blade,viewProps:i.viewProps})},api(i){return i.controller instanceof ny?new PU(i.controller):null}},QU={id:"slider",type:"blade",core:Nl,accept(i){const e=xn(i,t=>({max:t.required.number,min:t.required.number,view:t.required.constant("slider"),format:t.optional.function,label:t.optional.string,value:t.optional.number}));return e?{params:e}:null},controller(i){var e,t;const n=(e=i.params.value)!==null&&e!==void 0?e:0,s=new wh({max:i.params.max,min:i.params.min}),r=An(n,{constraint:s}),o=new vd(i.document,Object.assign(Object.assign({},Ob({formatter:(t=i.params.format)!==null&&t!==void 0?t:nN,keyScale:An(1),max:s.values.value("max"),min:s.values.value("min"),pointerScale:gb(i.params,n)})),{parser:xr,value:r,viewProps:i.viewProps}));return new aa(i.document,{blade:i.blade,props:Dt.fromObject({label:i.params.label}),value:r,valueController:o})},api(i){return!(i.controller instanceof aa)||!(i.controller.valueController instanceof vd)?null:new DU(i.controller)}},VU=function(){return{id:"text",type:"blade",core:Nl,accept(i){const e=xn(i,t=>({parse:t.required.function,value:t.required.raw,view:t.required.constant("text"),format:t.optional.function,label:t.optional.string}));return e?{params:e}:null},controller(i){var e;const t=An(i.params.value),n=new ih(i.document,{parser:i.params.parse,props:Dt.fromObject({formatter:(e=i.params.format)!==null&&e!==void 0?e:s=>String(s)}),value:t,viewProps:i.viewProps});return new aa(i.document,{blade:i.blade,props:Dt.fromObject({label:i.params.label}),value:t,valueController:n})},api(i){return!(i.controller instanceof aa)||!(i.controller.valueController instanceof ih)?null:new LU(i.controller)}}}();function zU(i){const e=i.createElement("div");return e.classList.add(zt("dfw")()),i.body&&i.body.appendChild(e),e}function GU(i,e,t){if(i.querySelector("style[data-tp-style=".concat(e,"]")))return;const n=i.createElement("style");n.dataset.tpStyle=e,n.textContent=t,i.head.appendChild(n)}class HU extends NU{constructor(e){var t,n;const s=e!=null?e:{},r=(t=s.document)!==null&&t!==void 0?t:pN(),o=BU(),a=new kU(r,{expanded:s.expanded,blade:kl(),props:Dt.fromObject({title:s.title}),viewProps:Sr.create()});super(a,o),this.pool_=o,this.containerElem_=(n=s.container)!==null&&n!==void 0?n:zU(r),this.containerElem_.appendChild(this.element),this.doc_=r,this.usesDefaultWrapper_=!s.container,this.setUpDefaultPlugins_()}get document(){if(!this.doc_)throw Cn.alreadyDisposed();return this.doc_}dispose(){const e=this.containerElem_;if(!e)throw Cn.alreadyDisposed();if(this.usesDefaultWrapper_){const t=e.parentElement;t&&t.removeChild(e)}this.containerElem_=null,this.doc_=null,super.dispose()}registerPlugin(e){e.css&&GU(this.document,"plugin-".concat(e.id),e.css),("plugin"in e?[e.plugin]:"plugins"in e?e.plugins:[]).forEach(n=>{this.pool_.register(e.id,n)})}setUpDefaultPlugins_(){this.registerPlugin({id:"default",css:'.tp-tbiv_b,.tp-coltxtv_ms,.tp-colswv_b,.tp-ckbv_i,.tp-sglv_i,.tp-mllv_i,.tp-grlv_g,.tp-txtv_i,.tp-p2dpv_p,.tp-colswv_sw,.tp-rotv_b,.tp-fldv_b,.tp-p2dv_b,.tp-btnv_b,.tp-lstv_s{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:rgba(0,0,0,0);border-width:0;font-family:inherit;font-size:inherit;font-weight:inherit;margin:0;outline:none;padding:0}.tp-p2dv_b,.tp-btnv_b,.tp-lstv_s{background-color:var(--btn-bg);border-radius:var(--bld-br);color:var(--btn-fg);cursor:pointer;display:block;font-weight:bold;height:var(--cnt-usz);line-height:var(--cnt-usz);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.tp-p2dv_b:hover,.tp-btnv_b:hover,.tp-lstv_s:hover{background-color:var(--btn-bg-h)}.tp-p2dv_b:focus,.tp-btnv_b:focus,.tp-lstv_s:focus{background-color:var(--btn-bg-f)}.tp-p2dv_b:active,.tp-btnv_b:active,.tp-lstv_s:active{background-color:var(--btn-bg-a)}.tp-p2dv_b:disabled,.tp-btnv_b:disabled,.tp-lstv_s:disabled{opacity:.5}.tp-rotv_c>.tp-cntv.tp-v-lst,.tp-tbpv_c>.tp-cntv.tp-v-lst,.tp-fldv_c>.tp-cntv.tp-v-lst{margin-bottom:calc(-1*var(--cnt-vp))}.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-tbpv_c>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_c{border-bottom-left-radius:0}.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-tbpv_c>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_b{border-bottom-left-radius:0}.tp-rotv_c>*:not(.tp-v-fst),.tp-tbpv_c>*:not(.tp-v-fst),.tp-fldv_c>*:not(.tp-v-fst){margin-top:var(--cnt-usp)}.tp-rotv_c>.tp-sprv:not(.tp-v-fst),.tp-tbpv_c>.tp-sprv:not(.tp-v-fst),.tp-fldv_c>.tp-sprv:not(.tp-v-fst),.tp-rotv_c>.tp-cntv:not(.tp-v-fst),.tp-tbpv_c>.tp-cntv:not(.tp-v-fst),.tp-fldv_c>.tp-cntv:not(.tp-v-fst){margin-top:var(--cnt-vp)}.tp-rotv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-tbpv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-fldv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-rotv_c>.tp-cntv+*:not(.tp-v-hidden),.tp-tbpv_c>.tp-cntv+*:not(.tp-v-hidden),.tp-fldv_c>.tp-cntv+*:not(.tp-v-hidden){margin-top:var(--cnt-vp)}.tp-rotv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-tbpv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-fldv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-rotv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-tbpv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-fldv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv{margin-top:0}.tp-tbpv_c>.tp-cntv,.tp-fldv_c>.tp-cntv{margin-left:4px}.tp-tbpv_c>.tp-fldv>.tp-fldv_b,.tp-fldv_c>.tp-fldv>.tp-fldv_b{border-top-left-radius:var(--bld-br);border-bottom-left-radius:var(--bld-br)}.tp-tbpv_c>.tp-fldv.tp-fldv-expanded>.tp-fldv_b,.tp-fldv_c>.tp-fldv.tp-fldv-expanded>.tp-fldv_b{border-bottom-left-radius:0}.tp-tbpv_c .tp-fldv>.tp-fldv_c,.tp-fldv_c .tp-fldv>.tp-fldv_c{border-bottom-left-radius:var(--bld-br)}.tp-tbpv_c>.tp-cntv+.tp-fldv>.tp-fldv_b,.tp-fldv_c>.tp-cntv+.tp-fldv>.tp-fldv_b{border-top-left-radius:0}.tp-tbpv_c>.tp-cntv+.tp-tabv>.tp-tabv_t,.tp-fldv_c>.tp-cntv+.tp-tabv>.tp-tabv_t{border-top-left-radius:0}.tp-tbpv_c>.tp-tabv>.tp-tabv_t,.tp-fldv_c>.tp-tabv>.tp-tabv_t{border-top-left-radius:var(--bld-br)}.tp-tbpv_c .tp-tabv>.tp-tabv_c,.tp-fldv_c .tp-tabv>.tp-tabv_c{border-bottom-left-radius:var(--bld-br)}.tp-rotv_b,.tp-fldv_b{background-color:var(--cnt-bg);color:var(--cnt-fg);cursor:pointer;display:block;height:calc(var(--cnt-usz) + 4px);line-height:calc(var(--cnt-usz) + 4px);overflow:hidden;padding-left:var(--cnt-hp);padding-right:calc(4px + var(--cnt-usz) + var(--cnt-hp));position:relative;text-align:left;text-overflow:ellipsis;white-space:nowrap;width:100%;transition:border-radius .2s ease-in-out .2s}.tp-rotv_b:hover,.tp-fldv_b:hover{background-color:var(--cnt-bg-h)}.tp-rotv_b:focus,.tp-fldv_b:focus{background-color:var(--cnt-bg-f)}.tp-rotv_b:active,.tp-fldv_b:active{background-color:var(--cnt-bg-a)}.tp-rotv_b:disabled,.tp-fldv_b:disabled{opacity:.5}.tp-rotv_m,.tp-fldv_m{background:linear-gradient(to left, var(--cnt-fg), var(--cnt-fg) 2px, transparent 2px, transparent 4px, var(--cnt-fg) 4px);border-radius:2px;bottom:0;content:"";display:block;height:6px;right:calc(var(--cnt-hp) + (var(--cnt-usz) + 4px - 6px)/2 - 2px);margin:auto;opacity:.5;position:absolute;top:0;transform:rotate(90deg);transition:transform .2s ease-in-out;width:6px}.tp-rotv.tp-rotv-expanded .tp-rotv_m,.tp-fldv.tp-fldv-expanded>.tp-fldv_b>.tp-fldv_m{transform:none}.tp-rotv_c,.tp-fldv_c{box-sizing:border-box;height:0;opacity:0;overflow:hidden;padding-bottom:0;padding-top:0;position:relative;transition:height .2s ease-in-out,opacity .2s linear,padding .2s ease-in-out}.tp-rotv.tp-rotv-cpl:not(.tp-rotv-expanded) .tp-rotv_c,.tp-fldv.tp-fldv-cpl:not(.tp-fldv-expanded)>.tp-fldv_c{display:none}.tp-rotv.tp-rotv-expanded .tp-rotv_c,.tp-fldv.tp-fldv-expanded>.tp-fldv_c{opacity:1;padding-bottom:var(--cnt-vp);padding-top:var(--cnt-vp);transform:none;overflow:visible;transition:height .2s ease-in-out,opacity .2s linear .2s,padding .2s ease-in-out}.tp-txtv_i,.tp-p2dpv_p,.tp-colswv_sw{background-color:var(--in-bg);border-radius:var(--bld-br);box-sizing:border-box;color:var(--in-fg);font-family:inherit;height:var(--cnt-usz);line-height:var(--cnt-usz);min-width:0;width:100%}.tp-txtv_i:hover,.tp-p2dpv_p:hover,.tp-colswv_sw:hover{background-color:var(--in-bg-h)}.tp-txtv_i:focus,.tp-p2dpv_p:focus,.tp-colswv_sw:focus{background-color:var(--in-bg-f)}.tp-txtv_i:active,.tp-p2dpv_p:active,.tp-colswv_sw:active{background-color:var(--in-bg-a)}.tp-txtv_i:disabled,.tp-p2dpv_p:disabled,.tp-colswv_sw:disabled{opacity:.5}.tp-lstv,.tp-coltxtv_m{position:relative}.tp-lstv_s{padding:0 20px 0 4px;width:100%}.tp-lstv_m,.tp-coltxtv_mm{bottom:0;margin:auto;pointer-events:none;position:absolute;right:2px;top:0}.tp-lstv_m svg,.tp-coltxtv_mm svg{bottom:0;height:16px;margin:auto;position:absolute;right:0;top:0;width:16px}.tp-lstv_m svg path,.tp-coltxtv_mm svg path{fill:currentColor}.tp-sglv_i,.tp-mllv_i,.tp-grlv_g{background-color:var(--mo-bg);border-radius:var(--bld-br);box-sizing:border-box;color:var(--mo-fg);height:var(--cnt-usz);scrollbar-color:currentColor rgba(0,0,0,0);scrollbar-width:thin;width:100%}.tp-sglv_i::-webkit-scrollbar,.tp-mllv_i::-webkit-scrollbar,.tp-grlv_g::-webkit-scrollbar{height:8px;width:8px}.tp-sglv_i::-webkit-scrollbar-corner,.tp-mllv_i::-webkit-scrollbar-corner,.tp-grlv_g::-webkit-scrollbar-corner{background-color:rgba(0,0,0,0)}.tp-sglv_i::-webkit-scrollbar-thumb,.tp-mllv_i::-webkit-scrollbar-thumb,.tp-grlv_g::-webkit-scrollbar-thumb{background-clip:padding-box;background-color:currentColor;border:rgba(0,0,0,0) solid 2px;border-radius:4px}.tp-pndtxtv,.tp-coltxtv_w{display:flex}.tp-pndtxtv_a,.tp-coltxtv_c{width:100%}.tp-pndtxtv_a+.tp-pndtxtv_a,.tp-coltxtv_c+.tp-pndtxtv_a,.tp-pndtxtv_a+.tp-coltxtv_c,.tp-coltxtv_c+.tp-coltxtv_c{margin-left:2px}.tp-rotv{--bs-bg: var(--tp-base-background-color, hsl(230, 7%, 17%));--bs-br: var(--tp-base-border-radius, 6px);--bs-ff: var(--tp-base-font-family, Roboto Mono, Source Code Pro, Menlo, Courier, monospace);--bs-sh: var(--tp-base-shadow-color, rgba(0, 0, 0, 0.2));--bld-br: var(--tp-blade-border-radius, 2px);--bld-hp: var(--tp-blade-horizontal-padding, 4px);--bld-vw: var(--tp-blade-value-width, 160px);--btn-bg: var(--tp-button-background-color, hsl(230, 7%, 70%));--btn-bg-a: var(--tp-button-background-color-active, #d6d7db);--btn-bg-f: var(--tp-button-background-color-focus, #c8cad0);--btn-bg-h: var(--tp-button-background-color-hover, #bbbcc4);--btn-fg: var(--tp-button-foreground-color, hsl(230, 7%, 17%));--cnt-bg: var(--tp-container-background-color, rgba(187, 188, 196, 0.1));--cnt-bg-a: var(--tp-container-background-color-active, rgba(187, 188, 196, 0.25));--cnt-bg-f: var(--tp-container-background-color-focus, rgba(187, 188, 196, 0.2));--cnt-bg-h: var(--tp-container-background-color-hover, rgba(187, 188, 196, 0.15));--cnt-fg: var(--tp-container-foreground-color, hsl(230, 7%, 75%));--cnt-hp: var(--tp-container-horizontal-padding, 4px);--cnt-vp: var(--tp-container-vertical-padding, 4px);--cnt-usp: var(--tp-container-unit-spacing, 4px);--cnt-usz: var(--tp-container-unit-size, 20px);--in-bg: var(--tp-input-background-color, rgba(187, 188, 196, 0.1));--in-bg-a: var(--tp-input-background-color-active, rgba(187, 188, 196, 0.25));--in-bg-f: var(--tp-input-background-color-focus, rgba(187, 188, 196, 0.2));--in-bg-h: var(--tp-input-background-color-hover, rgba(187, 188, 196, 0.15));--in-fg: var(--tp-input-foreground-color, hsl(230, 7%, 75%));--lbl-fg: var(--tp-label-foreground-color, rgba(187, 188, 196, 0.7));--mo-bg: var(--tp-monitor-background-color, rgba(0, 0, 0, 0.2));--mo-fg: var(--tp-monitor-foreground-color, rgba(187, 188, 196, 0.7));--grv-fg: var(--tp-groove-foreground-color, rgba(187, 188, 196, 0.1))}.tp-btnv_b{width:100%}.tp-btnv_t{text-align:center}.tp-ckbv_l{display:block;position:relative}.tp-ckbv_i{left:0;opacity:0;position:absolute;top:0}.tp-ckbv_w{background-color:var(--in-bg);border-radius:var(--bld-br);cursor:pointer;display:block;height:var(--cnt-usz);position:relative;width:var(--cnt-usz)}.tp-ckbv_w svg{display:block;height:16px;inset:0;margin:auto;opacity:0;position:absolute;width:16px}.tp-ckbv_w svg path{fill:none;stroke:var(--in-fg);stroke-width:2}.tp-ckbv_i:hover+.tp-ckbv_w{background-color:var(--in-bg-h)}.tp-ckbv_i:focus+.tp-ckbv_w{background-color:var(--in-bg-f)}.tp-ckbv_i:active+.tp-ckbv_w{background-color:var(--in-bg-a)}.tp-ckbv_i:checked+.tp-ckbv_w svg{opacity:1}.tp-ckbv.tp-v-disabled .tp-ckbv_w{opacity:.5}.tp-colv{position:relative}.tp-colv_h{display:flex}.tp-colv_s{flex-grow:0;flex-shrink:0;width:var(--cnt-usz)}.tp-colv_t{flex:1;margin-left:4px}.tp-colv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-colv.tp-colv-expanded.tp-colv-cpl .tp-colv_p{overflow:visible}.tp-colv.tp-colv-expanded .tp-colv_p{margin-top:var(--cnt-usp);opacity:1}.tp-colv .tp-popv{left:calc(-1*var(--cnt-hp));right:calc(-1*var(--cnt-hp));top:var(--cnt-usz)}.tp-colpv_h,.tp-colpv_ap{margin-left:6px;margin-right:6px}.tp-colpv_h{margin-top:var(--cnt-usp)}.tp-colpv_rgb{display:flex;margin-top:var(--cnt-usp);width:100%}.tp-colpv_a{display:flex;margin-top:var(--cnt-vp);padding-top:calc(var(--cnt-vp) + 2px);position:relative}.tp-colpv_a::before{background-color:var(--grv-fg);content:"";height:2px;left:calc(-1*var(--cnt-hp));position:absolute;right:calc(-1*var(--cnt-hp));top:0}.tp-colpv.tp-v-disabled .tp-colpv_a::before{opacity:.5}.tp-colpv_ap{align-items:center;display:flex;flex:3}.tp-colpv_at{flex:1;margin-left:4px}.tp-svpv{border-radius:var(--bld-br);outline:none;overflow:hidden;position:relative}.tp-svpv.tp-v-disabled{opacity:.5}.tp-svpv_c{cursor:crosshair;display:block;height:calc(var(--cnt-usz)*4);width:100%}.tp-svpv_m{border-radius:100%;border:rgba(255,255,255,.75) solid 2px;box-sizing:border-box;filter:drop-shadow(0 0 1px rgba(0, 0, 0, 0.3));height:12px;margin-left:-6px;margin-top:-6px;pointer-events:none;position:absolute;width:12px}.tp-svpv:focus .tp-svpv_m{border-color:#fff}.tp-hplv{cursor:pointer;height:var(--cnt-usz);outline:none;position:relative}.tp-hplv.tp-v-disabled{opacity:.5}.tp-hplv_c{background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAABCAYAAABubagXAAAAQ0lEQVQoU2P8z8Dwn0GCgQEDi2OK/RBgYHjBgIpfovFh8j8YBIgzFGQxuqEgPhaDOT5gOhPkdCxOZeBg+IDFZZiGAgCaSSMYtcRHLgAAAABJRU5ErkJggg==);background-position:left top;background-repeat:no-repeat;background-size:100% 100%;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;position:absolute;top:50%;width:100%}.tp-hplv_m{border-radius:var(--bld-br);border:rgba(255,255,255,.75) solid 2px;box-shadow:0 0 2px rgba(0,0,0,.1);box-sizing:border-box;height:12px;left:50%;margin-left:-6px;margin-top:-6px;position:absolute;top:50%;width:12px}.tp-hplv:focus .tp-hplv_m{border-color:#fff}.tp-aplv{cursor:pointer;height:var(--cnt-usz);outline:none;position:relative;width:100%}.tp-aplv.tp-v-disabled{opacity:.5}.tp-aplv_b{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:4px 4px;background-position:0 0,2px 2px;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;overflow:hidden;position:absolute;top:50%;width:100%}.tp-aplv_c{inset:0;position:absolute}.tp-aplv_m{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:12px 12px;background-position:0 0,6px 6px;border-radius:var(--bld-br);box-shadow:0 0 2px rgba(0,0,0,.1);height:12px;left:50%;margin-left:-6px;margin-top:-6px;overflow:hidden;position:absolute;top:50%;width:12px}.tp-aplv_p{border-radius:var(--bld-br);border:rgba(255,255,255,.75) solid 2px;box-sizing:border-box;inset:0;position:absolute}.tp-aplv:focus .tp-aplv_p{border-color:#fff}.tp-colswv{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:10px 10px;background-position:0 0,5px 5px;border-radius:var(--bld-br);overflow:hidden}.tp-colswv.tp-v-disabled{opacity:.5}.tp-colswv_sw{border-radius:0}.tp-colswv_b{cursor:pointer;display:block;height:var(--cnt-usz);left:0;position:absolute;top:0;width:var(--cnt-usz)}.tp-colswv_b:focus::after{border:rgba(255,255,255,.75) solid 2px;border-radius:var(--bld-br);content:"";display:block;inset:0;position:absolute}.tp-coltxtv{display:flex;width:100%}.tp-coltxtv_m{margin-right:4px}.tp-coltxtv_ms{border-radius:var(--bld-br);color:var(--lbl-fg);cursor:pointer;height:var(--cnt-usz);line-height:var(--cnt-usz);padding:0 18px 0 4px}.tp-coltxtv_ms:hover{background-color:var(--in-bg-h)}.tp-coltxtv_ms:focus{background-color:var(--in-bg-f)}.tp-coltxtv_ms:active{background-color:var(--in-bg-a)}.tp-coltxtv_mm{color:var(--lbl-fg)}.tp-coltxtv.tp-v-disabled .tp-coltxtv_mm{opacity:.5}.tp-coltxtv_w{flex:1}.tp-dfwv{position:absolute;top:8px;right:8px;width:256px}.tp-fldv{position:relative}.tp-fldv_t{padding-left:4px}.tp-fldv_b:disabled .tp-fldv_m{display:none}.tp-fldv_c{padding-left:4px}.tp-fldv_i{bottom:0;color:var(--cnt-bg);left:0;overflow:hidden;position:absolute;top:calc(var(--cnt-usz) + 4px);width:max(var(--bs-br),4px)}.tp-fldv_i::before{background-color:currentColor;bottom:0;content:"";left:0;position:absolute;top:0;width:4px}.tp-fldv_b:hover+.tp-fldv_i{color:var(--cnt-bg-h)}.tp-fldv_b:focus+.tp-fldv_i{color:var(--cnt-bg-f)}.tp-fldv_b:active+.tp-fldv_i{color:var(--cnt-bg-a)}.tp-fldv.tp-v-disabled>.tp-fldv_i{opacity:.5}.tp-grlv{position:relative}.tp-grlv_g{display:block;height:calc(var(--cnt-usz)*3)}.tp-grlv_g polyline{fill:none;stroke:var(--mo-fg);stroke-linejoin:round}.tp-grlv_t{margin-top:-4px;transition:left .05s,top .05s;visibility:hidden}.tp-grlv_t.tp-grlv_t-a{visibility:visible}.tp-grlv_t.tp-grlv_t-in{transition:none}.tp-grlv.tp-v-disabled .tp-grlv_g{opacity:.5}.tp-grlv .tp-ttv{background-color:var(--mo-fg)}.tp-grlv .tp-ttv::before{border-top-color:var(--mo-fg)}.tp-lblv{align-items:center;display:flex;line-height:1.3;padding-left:var(--cnt-hp);padding-right:var(--cnt-hp)}.tp-lblv.tp-lblv-nol{display:block}.tp-lblv_l{color:var(--lbl-fg);flex:1;-webkit-hyphens:auto;hyphens:auto;overflow:hidden;padding-left:4px;padding-right:16px}.tp-lblv.tp-v-disabled .tp-lblv_l{opacity:.5}.tp-lblv.tp-lblv-nol .tp-lblv_l{display:none}.tp-lblv_v{align-self:flex-start;flex-grow:0;flex-shrink:0;width:var(--bld-vw)}.tp-lblv.tp-lblv-nol .tp-lblv_v{width:100%}.tp-lstv_s{padding:0 20px 0 var(--bld-hp);width:100%}.tp-lstv_m{color:var(--btn-fg)}.tp-sglv_i{padding-left:var(--bld-hp);padding-right:var(--bld-hp)}.tp-sglv.tp-v-disabled .tp-sglv_i{opacity:.5}.tp-mllv_i{display:block;height:calc(var(--cnt-usz)*3);line-height:var(--cnt-usz);padding-left:var(--bld-hp);padding-right:var(--bld-hp);resize:none;white-space:pre}.tp-mllv.tp-v-disabled .tp-mllv_i{opacity:.5}.tp-p2dv{position:relative}.tp-p2dv_h{display:flex}.tp-p2dv_b{height:var(--cnt-usz);margin-right:4px;position:relative;width:var(--cnt-usz)}.tp-p2dv_b svg{display:block;height:16px;left:50%;margin-left:-8px;margin-top:-8px;position:absolute;top:50%;width:16px}.tp-p2dv_b svg path{stroke:currentColor;stroke-width:2}.tp-p2dv_b svg circle{fill:currentColor}.tp-p2dv_t{flex:1}.tp-p2dv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-p2dv.tp-p2dv-expanded .tp-p2dv_p{margin-top:var(--cnt-usp);opacity:1}.tp-p2dv .tp-popv{left:calc(-1*var(--cnt-hp));right:calc(-1*var(--cnt-hp));top:var(--cnt-usz)}.tp-p2dpv{padding-left:calc(var(--cnt-usz) + 4px)}.tp-p2dpv_p{cursor:crosshair;height:0;overflow:hidden;padding-bottom:100%;position:relative}.tp-p2dpv.tp-v-disabled .tp-p2dpv_p{opacity:.5}.tp-p2dpv_g{display:block;height:100%;left:0;pointer-events:none;position:absolute;top:0;width:100%}.tp-p2dpv_ax{opacity:.1;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_l{opacity:.5;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_m{border:var(--in-fg) solid 1px;border-radius:50%;box-sizing:border-box;height:4px;margin-left:-2px;margin-top:-2px;position:absolute;width:4px}.tp-p2dpv_p:focus .tp-p2dpv_m{background-color:var(--in-fg);border-width:0}.tp-popv{background-color:var(--bs-bg);border-radius:var(--bs-br);box-shadow:0 2px 4px var(--bs-sh);display:none;max-width:var(--bld-vw);padding:var(--cnt-vp) var(--cnt-hp);position:absolute;visibility:hidden;z-index:1000}.tp-popv.tp-popv-v{display:block;visibility:visible}.tp-sldv.tp-v-disabled{opacity:.5}.tp-sldv_t{box-sizing:border-box;cursor:pointer;height:var(--cnt-usz);margin:0 6px;outline:none;position:relative}.tp-sldv_t::before{background-color:var(--in-bg);border-radius:1px;content:"";display:block;height:2px;inset:0;margin:auto;position:absolute}.tp-sldv_k{height:100%;left:0;position:absolute;top:0}.tp-sldv_k::before{background-color:var(--in-fg);border-radius:1px;content:"";display:block;height:2px;inset:0;margin-bottom:auto;margin-top:auto;position:absolute}.tp-sldv_k::after{background-color:var(--btn-bg);border-radius:var(--bld-br);bottom:0;content:"";display:block;height:12px;margin-bottom:auto;margin-top:auto;position:absolute;right:-6px;top:0;width:12px}.tp-sldv_t:hover .tp-sldv_k::after{background-color:var(--btn-bg-h)}.tp-sldv_t:focus .tp-sldv_k::after{background-color:var(--btn-bg-f)}.tp-sldv_t:active .tp-sldv_k::after{background-color:var(--btn-bg-a)}.tp-sldtxtv{display:flex}.tp-sldtxtv_s{flex:2}.tp-sldtxtv_t{flex:1;margin-left:4px}.tp-tabv{position:relative}.tp-tabv_t{align-items:flex-end;color:var(--cnt-bg);display:flex;overflow:hidden;position:relative}.tp-tabv_t:hover{color:var(--cnt-bg-h)}.tp-tabv_t:has(*:focus){color:var(--cnt-bg-f)}.tp-tabv_t:has(*:active){color:var(--cnt-bg-a)}.tp-tabv_t::before{background-color:currentColor;bottom:0;content:"";height:2px;left:0;pointer-events:none;position:absolute;right:0}.tp-tabv.tp-v-disabled .tp-tabv_t::before{opacity:.5}.tp-tabv.tp-tabv-nop .tp-tabv_t{height:calc(var(--cnt-usz) + 4px);position:relative}.tp-tabv.tp-tabv-nop .tp-tabv_t::before{background-color:var(--cnt-bg);bottom:0;content:"";height:2px;left:0;position:absolute;right:0}.tp-tabv_i{bottom:0;color:var(--cnt-bg);left:0;overflow:hidden;position:absolute;top:calc(var(--cnt-usz) + 4px);width:max(var(--bs-br),4px)}.tp-tabv_i::before{background-color:currentColor;bottom:0;content:"";left:0;position:absolute;top:0;width:4px}.tp-tabv_t:hover+.tp-tabv_i{color:var(--cnt-bg-h)}.tp-tabv_t:has(*:focus)+.tp-tabv_i{color:var(--cnt-bg-f)}.tp-tabv_t:has(*:active)+.tp-tabv_i{color:var(--cnt-bg-a)}.tp-tabv.tp-v-disabled>.tp-tabv_i{opacity:.5}.tp-tbiv{flex:1;min-width:0;position:relative}.tp-tbiv+.tp-tbiv{margin-left:2px}.tp-tbiv+.tp-tbiv.tp-v-disabled::before{opacity:.5}.tp-tbiv_b{display:block;padding-left:calc(var(--cnt-hp) + 4px);padding-right:calc(var(--cnt-hp) + 4px);position:relative;width:100%}.tp-tbiv_b:disabled{opacity:.5}.tp-tbiv_b::before{background-color:var(--cnt-bg);content:"";inset:0 0 2px;pointer-events:none;position:absolute}.tp-tbiv_b:hover::before{background-color:var(--cnt-bg-h)}.tp-tbiv_b:focus::before{background-color:var(--cnt-bg-f)}.tp-tbiv_b:active::before{background-color:var(--cnt-bg-a)}.tp-tbiv_t{color:var(--cnt-fg);height:calc(var(--cnt-usz) + 4px);line-height:calc(var(--cnt-usz) + 4px);opacity:.5;overflow:hidden;position:relative;text-overflow:ellipsis}.tp-tbiv.tp-tbiv-sel .tp-tbiv_t{opacity:1}.tp-tbpv_c{padding-bottom:var(--cnt-vp);padding-left:4px;padding-top:var(--cnt-vp)}.tp-txtv{position:relative}.tp-txtv_i{padding-left:var(--bld-hp);padding-right:var(--bld-hp)}.tp-txtv.tp-txtv-fst .tp-txtv_i{border-bottom-right-radius:0;border-top-right-radius:0}.tp-txtv.tp-txtv-mid .tp-txtv_i{border-radius:0}.tp-txtv.tp-txtv-lst .tp-txtv_i{border-bottom-left-radius:0;border-top-left-radius:0}.tp-txtv.tp-txtv-num .tp-txtv_i{text-align:right}.tp-txtv.tp-txtv-drg .tp-txtv_i{opacity:.3}.tp-txtv_k{cursor:pointer;height:100%;left:calc(var(--bld-hp) - 5px);position:absolute;top:0;width:12px}.tp-txtv_k::before{background-color:var(--in-fg);border-radius:1px;bottom:0;content:"";height:calc(var(--cnt-usz) - 4px);left:50%;margin-bottom:auto;margin-left:-1px;margin-top:auto;opacity:.1;position:absolute;top:0;transition:border-radius .1s,height .1s,transform .1s,width .1s;width:2px}.tp-txtv_k:hover::before,.tp-txtv.tp-txtv-drg .tp-txtv_k::before{opacity:1}.tp-txtv.tp-txtv-drg .tp-txtv_k::before{border-radius:50%;height:4px;transform:translateX(-1px);width:4px}.tp-txtv_g{bottom:0;display:block;height:8px;left:50%;margin:auto;overflow:visible;pointer-events:none;position:absolute;top:0;visibility:hidden;width:100%}.tp-txtv.tp-txtv-drg .tp-txtv_g{visibility:visible}.tp-txtv_gb{fill:none;stroke:var(--in-fg);stroke-dasharray:1}.tp-txtv_gh{fill:none;stroke:var(--in-fg)}.tp-txtv .tp-ttv{margin-left:6px;visibility:hidden}.tp-txtv.tp-txtv-drg .tp-ttv{visibility:visible}.tp-ttv{background-color:var(--in-fg);border-radius:var(--bld-br);color:var(--bs-bg);padding:2px 4px;pointer-events:none;position:absolute;transform:translate(-50%, -100%)}.tp-ttv::before{border-color:var(--in-fg) rgba(0,0,0,0) rgba(0,0,0,0) rgba(0,0,0,0);border-style:solid;border-width:2px;box-sizing:border-box;content:"";font-size:.9em;height:4px;left:50%;margin-left:-2px;position:absolute;top:100%;width:4px}.tp-rotv{background-color:var(--bs-bg);border-radius:var(--bs-br);box-shadow:0 2px 4px var(--bs-sh);font-family:var(--bs-ff);font-size:11px;font-weight:500;line-height:1;text-align:left}.tp-rotv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br);border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br);padding-left:calc(4px + var(--cnt-usz) + var(--cnt-hp));text-align:center}.tp-rotv.tp-rotv-expanded .tp-rotv_b{border-bottom-left-radius:0;border-bottom-right-radius:0;transition-delay:0s;transition-duration:0s}.tp-rotv.tp-rotv-not>.tp-rotv_b{display:none}.tp-rotv_b:disabled .tp-rotv_m{display:none}.tp-rotv_c>.tp-fldv.tp-v-lst>.tp-fldv_c{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c>.tp-fldv.tp-v-lst>.tp-fldv_i{border-bottom-left-radius:var(--bs-br)}.tp-rotv_c>.tp-fldv.tp-v-lst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c>.tp-fldv.tp-v-lst.tp-fldv-expanded>.tp-fldv_b{transition-delay:0s;transition-duration:0s}.tp-rotv_c .tp-fldv.tp-v-vlst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-right-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst{margin-top:calc(-1*var(--cnt-vp))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst>.tp-fldv_b{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv_c>.tp-tabv.tp-v-lst>.tp-tabv_c{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c>.tp-tabv.tp-v-lst>.tp-tabv_i{border-bottom-left-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst{margin-top:calc(-1*var(--cnt-vp))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst>.tp-tabv_t{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv.tp-v-disabled,.tp-rotv .tp-v-disabled{pointer-events:none}.tp-rotv.tp-v-hidden,.tp-rotv .tp-v-hidden{display:none}.tp-sprv_r{background-color:var(--grv-fg);border-width:0;display:block;height:2px;margin:0;width:100%}.tp-sprv.tp-v-disabled .tp-sprv_r{opacity:.5}',plugins:[FU,UU,QU,Db,VU]})}}new Bb("4.0.5");class WU{constructor(){if(this.active=window.location.hash==="#debug",this.active){this.ui=new HU;const e=document.querySelector(".tp-dfwv");e&&(e.style.zIndex="9999")}}}class nf{constructor(){this.callbacks={},this.callbacks.base={}}on(e,t){if(e===void 0||e==="")return console.warn("wrong names"),!1;if(t===void 0)return console.warn("wrong callback"),!1;const n=this.resolveNames(e);for(const s of n){const r=this.resolveName(s);this.callbacks[r.namespace]instanceof Object||(this.callbacks[r.namespace]={}),Array.isArray(this.callbacks[r.namespace][r.value])||(this.callbacks[r.namespace][r.value]=[]),this.callbacks[r.namespace][r.value].push(t)}return this}off(e){if(e===void 0||e==="")return console.warn("wrong name"),!1;const t=this.resolveNames(e);for(const n of t){const s=this.resolveName(n);if(s.namespace!=="base"&&s.value==="")delete this.callbacks[s.namespace];else if(s.namespace==="base")for(const r in this.callbacks)this.callbacks[r]instanceof Object&&Array.isArray(this.callbacks[r][s.value])&&(delete this.callbacks[r][s.value],Object.keys(this.callbacks[r]).length===0&&delete this.callbacks[r]);else this.callbacks[s.namespace]instanceof Object&&Array.isArray(this.callbacks[s.namespace][s.value])&&(delete this.callbacks[s.namespace][s.value],Object.keys(this.callbacks[s.namespace]).length===0&&delete this.callbacks[s.namespace])}return this}trigger(e,t){if(e===void 0||e==="")return console.warn("wrong name"),!1;let n,s;const r=Array.isArray(t)?t:[];let o=this.resolveNames(e);if(o=this.resolveName(o[0]),o.namespace==="base"){for(const a in this.callbacks)if(this.callbacks[a]instanceof Object&&Array.isArray(this.callbacks[a][o.value])){const l=this.callbacks[a][o.value];for(const c of l)s=c.apply(this,r),n===void 0&&(n=s)}}else if(this.callbacks[o.namespace]instanceof Object){if(o.value==="")return console.warn("wrong name"),this;const a=this.callbacks[o.namespace][o.value];for(const l of a)s=l.apply(this,r),n===void 0&&(n=s)}return n}resolveNames(e){let t=e;return t=t.replaceAll(/[^\d ,./A-Z]/gi,""),t=t.replaceAll(/[,/]+/g," "),t=t.split(" "),t}resolveName(e){const t={},n=e.split(".");return t.original=e,t.value=n[0],t.namespace="base",n.length>1&&n[1]!==""&&(t.namespace=n[1]),t}}function qU(){return/android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini/i.test(navigator.userAgent)?"Mobile":"Desktop"}class jU{constructor(){this.experience=new ti,this.sizes=this.experience.sizes,this.mouse=new Me(0,0),this.normalizedMouse=new Me(0,0),this.mouseDOM=new Me(0,0),this.mouseScreen=new Me(0,0),this.prevMouseDOM=new Me(0,0),this.mouseDOMDelta=new Me(0,0),this.isMouseMoving=!1,this.mouseMoveOffset=4,this.listenForMouse()}getMouse(e,t){return new Me(e,this.sizes.height-t)}getNormalizedMouse(e,t){const s=this.getMouse(e,t).clone();return s.x/=this.sizes.width/2,s.y/=this.sizes.height/2,s.x-=1,s.y-=1,s}getMouseDOM(e,t){return new Me(e,t)}getMouseScreen(e,t){return new Me(e-this.sizes.width/2,-(t-this.sizes.height/2))}listenForMouse(){const e=qU();e==="Desktop"?this.listenForDesktop():e==="Mobile"&&this.listenForMobile()}listenForDesktop(){window.addEventListener("mousemove",e=>{this.mouse=this.getMouse(e.clientX,e.clientY),this.mouseDOM=this.getMouseDOM(e.clientX,e.clientY),this.mouseScreen=this.getMouseScreen(e.clientX,e.clientY),this.normalizedMouse=this.getNormalizedMouse(e.clientX,e.clientY)})}listenForMobile(){window.addEventListener("touchstart",e=>{this.updateTouchPosition(e.touches[0])}),window.addEventListener("touchmove",e=>{this.updateTouchPosition(e.touches[0])})}updateTouchPosition(e){this.mouse=this.getMouse(e.clientX,e.clientY),this.mouseDOM=this.getMouseDOM(e.clientX,e.clientY),this.mouseScreen=this.getMouseScreen(e.clientX,e.clientY),this.normalizedMouse=this.getNormalizedMouse(e.clientX,e.clientY)}syncMouseDOM(){this.prevMouseDOM.copy(this.mouseDOM)}judgeIsMouseMoving(){this.isMouseMoving=Math.abs(this.mouseDOMDelta.x)>=this.mouseMoveOffset||Math.abs(this.mouseDOMDelta.y)>=this.mouseMoveOffset}getMouseDOMDelta(){this.mouseDOMDelta.subVectors(this.mouseDOM,this.prevMouseDOM)}update(){this.getMouseDOMDelta(),this.judgeIsMouseMoving(),this.syncMouseDOM()}}const Cp=new WeakMap;class XU extends ni{constructor(e){super(e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(e){return this.decoderPath=e,this}setDecoderConfig(e){return this.decoderConfig=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,t,n,s){const r=new ji(this.manager);r.setPath(this.path),r.setResponseType("arraybuffer"),r.setRequestHeader(this.requestHeader),r.setWithCredentials(this.withCredentials),r.load(e,o=>{this.parse(o,t,s)},n,s)}parse(e,t,n=()=>{}){this.decodeDracoFile(e,t,null,null,Ft,n).catch(n)}decodeDracoFile(e,t,n,s,r=On,o=()=>{}){const a={attributeIDs:n||this.defaultAttributeIDs,attributeTypes:s||this.defaultAttributeTypes,useUniqueIDs:!!n,vertexColorSpace:r};return this.decodeGeometry(e,a).then(t).catch(o)}decodeGeometry(e,t){const n=JSON.stringify(t);if(Cp.has(e)){const l=Cp.get(e);if(l.key===n)return l.promise;if(e.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let s;const r=this.workerNextTaskID++,o=e.byteLength,a=this._getWorker(r,o).then(l=>(s=l,new Promise((c,h)=>{s._callbacks[r]={resolve:c,reject:h},s.postMessage({type:"decode",id:r,taskConfig:t,buffer:e},[e])}))).then(l=>this._createGeometry(l.geometry));return a.catch(()=>!0).then(()=>{s&&r&&this._releaseTask(s,r)}),Cp.set(e,{key:n,promise:a}),a}_createGeometry(e){const t=new Nn;e.index&&t.setIndex(new Zn(e.index.array,1));for(let n=0;n<e.attributes.length;n++){const s=e.attributes[n],r=s.name,o=s.array,a=s.itemSize,l=new Zn(o,a);r==="color"&&(this._assignVertexColorSpace(l,s.vertexColorSpace),l.normalized=!(o instanceof Float32Array)),t.setAttribute(r,l)}return t}_assignVertexColorSpace(e,t){if(t!==Ft)return;const n=new at;for(let s=0,r=e.count;s<r;s++)n.fromBufferAttribute(e,s),St.toWorkingColorSpace(n,Ft),e.setXYZ(s,n.r,n.g,n.b)}_loadLibrary(e,t){const n=new ji(this.manager);return n.setPath(this.decoderPath),n.setResponseType(t),n.setWithCredentials(this.withCredentials),new Promise((s,r)=>{n.load(e,s,void 0,r)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const e=typeof WebAssembly!="object"||this.decoderConfig.type==="js",t=[];return e?t.push(this._loadLibrary("draco_decoder.js","text")):(t.push(this._loadLibrary("draco_wasm_wrapper.js","text")),t.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(t).then(n=>{const s=n[0];e||(this.decoderConfig.wasmBinary=n[1]);const r=YU.toString(),o=["/* draco decoder */",s,"","/* worker */",r.substring(r.indexOf("{")+1,r.lastIndexOf("}"))].join("\n");this.workerSourceURL=URL.createObjectURL(new Blob([o]))}),this.decoderPending}_getWorker(e,t){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){const s=new Worker(this.workerSourceURL);s._callbacks={},s._taskCosts={},s._taskLoad=0,s.postMessage({type:"init",decoderConfig:this.decoderConfig}),s.onmessage=function(r){const o=r.data;switch(o.type){case"decode":s._callbacks[o.id].resolve(o);break;case"error":s._callbacks[o.id].reject(o);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+o.type+'"')}},this.workerPool.push(s)}else this.workerPool.sort(function(s,r){return s._taskLoad>r._taskLoad?-1:1});const n=this.workerPool[this.workerPool.length-1];return n._taskCosts[e]=t,n._taskLoad+=t,n})}_releaseTask(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]}debug(){console.log("Task load: ",this.workerPool.map(e=>e._taskLoad))}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this.workerSourceURL!==""&&URL.revokeObjectURL(this.workerSourceURL),this}}function YU(){let i,e;onmessage=function(o){const a=o.data;switch(a.type){case"init":i=a.decoderConfig,e=new Promise(function(h){i.onModuleLoaded=function(u){h({draco:u})},DracoDecoderModule(i)});break;case"decode":const l=a.buffer,c=a.taskConfig;e.then(h=>{const u=h.draco,d=new u.Decoder;try{const f=t(u,d,new Int8Array(l),c),p=f.attributes.map(A=>A.array.buffer);f.index&&p.push(f.index.array.buffer),self.postMessage({type:"decode",id:a.id,geometry:f},p)}catch(f){console.error(f),self.postMessage({type:"error",id:a.id,error:f.message})}finally{u.destroy(d)}});break}};function t(o,a,l,c){const h=c.attributeIDs,u=c.attributeTypes;let d,f;const p=a.GetEncodedGeometryType(l);if(p===o.TRIANGULAR_MESH)d=new o.Mesh,f=a.DecodeArrayToMesh(l,l.byteLength,d);else if(p===o.POINT_CLOUD)d=new o.PointCloud,f=a.DecodeArrayToPointCloud(l,l.byteLength,d);else throw new Error("THREE.DRACOLoader: Unexpected geometry type.");if(!f.ok()||d.ptr===0)throw new Error("THREE.DRACOLoader: Decoding failed: "+f.error_msg());const A={index:null,attributes:[]};for(const m in h){const g=self[u[m]];let y,_;if(c.useUniqueIDs)_=h[m],y=a.GetAttributeByUniqueId(d,_);else{if(_=a.GetAttributeId(d,o[h[m]]),_===-1)continue;y=a.GetAttribute(d,_)}const v=s(o,a,d,m,g,y);m==="color"&&(v.vertexColorSpace=c.vertexColorSpace),A.attributes.push(v)}return p===o.TRIANGULAR_MESH&&(A.index=n(o,a,d)),o.destroy(d),A}function n(o,a,l){const h=l.num_faces()*3,u=h*4,d=o._malloc(u);a.GetTrianglesUInt32Array(l,u,d);const f=new Uint32Array(o.HEAPF32.buffer,d,h).slice();return o._free(d),{array:f,itemSize:1}}function s(o,a,l,c,h,u){const d=u.num_components(),p=l.num_points()*d,A=p*h.BYTES_PER_ELEMENT,m=r(o,h),g=o._malloc(A);a.GetAttributeDataArrayForAllPoints(l,u,m,A,g);const y=new h(o.HEAPF32.buffer,g,p).slice();return o._free(g),{name:c,array:y,itemSize:d}}function r(o,a){switch(a){case Float32Array:return o.DT_FLOAT32;case Int8Array:return o.DT_INT8;case Int16Array:return o.DT_INT16;case Int32Array:return o.DT_INT32;case Uint8Array:return o.DT_UINT8;case Uint16Array:return o.DT_UINT16;case Uint32Array:return o.DT_UINT32}}}/*!
fflate - fast JavaScript compression/decompression
<https://101arrowz.github.io/fflate>
Licensed under MIT. https://github.com/101arrowz/fflate/blob/master/LICENSE
version 0.8.2
*/var ss=Uint8Array,Ya=Uint16Array,KU=Int32Array,dE=new ss([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),fE=new ss([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),$U=new ss([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),pE=function(i,e){for(var t=new Ya(31),n=0;n<31;++n)t[n]=e+=1<<i[n-1];for(var s=new KU(t[30]),n=1;n<30;++n)for(var r=t[n];r<t[n+1];++r)s[r]=r-t[n]<<5|n;return{b:t,r:s}},mE=pE(dE,2),AE=mE.b,JU=mE.r;AE[28]=258,JU[258]=28;var ZU=pE(fE,0),e3=ZU.b,lA=new Ya(32768);for(var fn=0;fn<32768;++fn){var kr=(fn&43690)>>1|(fn&21845)<<1;kr=(kr&52428)>>2|(kr&13107)<<2,kr=(kr&61680)>>4|(kr&3855)<<4,lA[fn]=((kr&65280)>>8|(kr&255)<<8)>>1}var Rc=function(i,e,t){for(var n=i.length,s=0,r=new Ya(e);s<n;++s)i[s]&&++r[i[s]-1];var o=new Ya(e);for(s=1;s<e;++s)o[s]=o[s-1]+r[s-1]<<1;var a;if(t){a=new Ya(1<<e);var l=15-e;for(s=0;s<n;++s)if(i[s])for(var c=s<<4|i[s],h=e-i[s],u=o[i[s]-1]++<<h,d=u|(1<<h)-1;u<=d;++u)a[lA[u]>>l]=c}else for(a=new Ya(n),s=0;s<n;++s)i[s]&&(a[s]=lA[o[i[s]-1]++]>>15-i[s]);return a},Ph=new ss(288);for(var fn=0;fn<144;++fn)Ph[fn]=8;for(var fn=144;fn<256;++fn)Ph[fn]=9;for(var fn=256;fn<280;++fn)Ph[fn]=7;for(var fn=280;fn<288;++fn)Ph[fn]=8;var gE=new ss(32);for(var fn=0;fn<32;++fn)gE[fn]=5;var t3=Rc(Ph,9,1),n3=Rc(gE,5,1),Sp=function(i){for(var e=i[0],t=1;t<i.length;++t)i[t]>e&&(e=i[t]);return e},_s=function(i,e,t){var n=e/8|0;return(i[n]|i[n+1]<<8)>>(e&7)&t},Ip=function(i,e){var t=e/8|0;return(i[t]|i[t+1]<<8|i[t+2]<<16)>>(e&7)},i3=function(i){return(i+7)/8|0},s3=function(i,e,t){return(t==null||t>i.length)&&(t=i.length),new ss(i.subarray(e,t))},r3=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],ys=function(i,e,t){var n=new Error(e||r3[i]);if(n.code=i,Error.captureStackTrace&&Error.captureStackTrace(n,ys),!t)throw n;return n},o3=function(i,e,t,n){var s=i.length,r=0;if(!s||e.f&&!e.l)return t||new ss(0);var o=!t,a=o||e.i!=2,l=e.i;o&&(t=new ss(s*3));var c=function(me){var F=t.length;if(me>F){var Q=new ss(Math.max(F*2,me));Q.set(t),t=Q}},h=e.f||0,u=e.p||0,d=e.b||0,f=e.l,p=e.d,A=e.m,m=e.n,g=s*8;do{if(!f){h=_s(i,u,1);var y=_s(i,u+1,3);if(u+=3,y)if(y==1)f=t3,p=n3,A=9,m=5;else if(y==2){var T=_s(i,u,31)+257,L=_s(i,u+10,15)+4,I=T+_s(i,u+5,31)+1;u+=14;for(var x=new ss(I),w=new ss(19),P=0;P<L;++P)w[$U[P]]=_s(i,u+P*3,7);u+=L*3;for(var z=Sp(w),H=(1<<z)-1,K=Rc(w,z,1),P=0;P<I;){var le=K[_s(i,u,H)];u+=le&15;var _=le>>4;if(_<16)x[P++]=_;else{var J=0,W=0;for(_==16?(W=3+_s(i,u,3),u+=2,J=x[P-1]):_==17?(W=3+_s(i,u,7),u+=3):_==18&&(W=11+_s(i,u,127),u+=7);W--;)x[P++]=J}}var O=x.subarray(0,T),fe=x.subarray(T);A=Sp(O),m=Sp(fe),f=Rc(O,A,1),p=Rc(fe,m,1)}else ys(1);else{var _=i3(u)+4,v=i[_-4]|i[_-3]<<8,b=_+v;if(b>s){l&&ys(0);break}a&&c(d+v),t.set(i.subarray(_,b),d),e.b=d+=v,e.p=u=b*8,e.f=h;continue}if(u>g){l&&ys(0);break}}a&&c(d+131072);for(var ue=(1<<A)-1,ee=(1<<m)-1,de=u;;de=u){var J=f[Ip(i,u)&ue],ae=J>>4;if(u+=J&15,u>g){l&&ys(0);break}if(J||ys(2),ae<256)t[d++]=ae;else if(ae==256){de=u,f=null;break}else{var R=ae-254;if(ae>264){var P=ae-257,M=dE[P];R=_s(i,u,(1<<M)-1)+AE[P],u+=M}var B=p[Ip(i,u)&ee],D=B>>4;B||ys(3),u+=B&15;var fe=e3[D];if(D>3){var M=fE[D];fe+=Ip(i,u)&(1<<M)-1,u+=M}if(u>g){l&&ys(0);break}a&&c(d+131072);var te=d+R;if(d<fe){var ie=r-fe,Z=Math.min(fe,te);for(ie+d<0&&ys(3);d<Z;++d)t[d]=n[ie+d]}for(;d<te;++d)t[d]=t[d-fe]}}e.l=f,e.p=de,e.b=d,e.f=h,f&&(h=1,e.m=A,e.d=p,e.n=m)}while(!h);return d!=t.length&&o?s3(t,0,d):t.subarray(0,d)},a3=new ss(0),l3=function(i,e){return((i[0]&15)!=8||i[0]>>4>7||(i[0]<<8|i[1])%31)&&ys(6,"invalid zlib data"),(i[1]>>5&1)==1&&ys(6,"invalid zlib data: "+(i[1]&32?"need":"unexpected")+" dictionary"),(i[1]>>3&4)+2};function lc(i,e){return o3(i.subarray(l3(i),-4),{i:2},e,e)}var c3=typeof TextDecoder<"u"&&new TextDecoder,h3=0;try{c3.decode(a3,{stream:!0}),h3=1}catch(i){}class u3 extends $w{constructor(e){super(e),this.type=Gn}parse(e){const x=Math.pow(2.7182818,2.2);function w(C,U){let ne=0;for(let Y=0;Y<65536;++Y)(Y==0||C[Y>>3]&1<<(Y&7))&&(U[ne++]=Y);const S=ne-1;for(;ne<65536;)U[ne++]=0;return S}function P(C){for(let U=0;U<16384;U++)C[U]={},C[U].len=0,C[U].lit=0,C[U].p=null}const z={l:0,c:0,lc:0};function H(C,U,ne,S,Y){for(;ne<C;)U=U<<8|je(S,Y),ne+=8;ne-=C,z.l=U>>ne&(1<<C)-1,z.c=U,z.lc=ne}const K=new Array(59);function le(C){for(let ne=0;ne<=58;++ne)K[ne]=0;for(let ne=0;ne<65537;++ne)K[C[ne]]+=1;let U=0;for(let ne=58;ne>0;--ne){const S=U+K[ne]>>1;K[ne]=U,U=S}for(let ne=0;ne<65537;++ne){const S=C[ne];S>0&&(C[ne]=S|K[S]++<<6)}}function J(C,U,ne,S,Y,X){const se=U;let $=0,Ae=0;for(;S<=Y;S++){if(se.value-U.value>ne)return!1;H(6,$,Ae,C,se);const _e=z.l;if($=z.c,Ae=z.lc,X[S]=_e,_e==63){if(se.value-U.value>ne)throw new Error("Something wrong with hufUnpackEncTable");H(8,$,Ae,C,se);let ye=z.l+6;if($=z.c,Ae=z.lc,S+ye>Y+1)throw new Error("Something wrong with hufUnpackEncTable");for(;ye--;)X[S++]=0;S--}else if(_e>=59){let ye=_e-59+2;if(S+ye>Y+1)throw new Error("Something wrong with hufUnpackEncTable");for(;ye--;)X[S++]=0;S--}}le(X)}function W(C){return C&63}function O(C){return C>>6}function fe(C,U,ne,S){for(;U<=ne;U++){const Y=O(C[U]),X=W(C[U]);if(Y>>X)throw new Error("Invalid table entry");if(X>14){const se=S[Y>>X-14];if(se.len)throw new Error("Invalid table entry");if(se.lit++,se.p){const $=se.p;se.p=new Array(se.lit);for(let Ae=0;Ae<se.lit-1;++Ae)se.p[Ae]=$[Ae]}else se.p=new Array(1);se.p[se.lit-1]=U}else if(X){let se=0;for(let $=1<<14-X;$>0;$--){const Ae=S[(Y<<14-X)+se];if(Ae.len||Ae.p)throw new Error("Invalid table entry");Ae.len=X,Ae.lit=U,se++}}}return!0}const ue={c:0,lc:0};function ee(C,U,ne,S){C=C<<8|je(ne,S),U+=8,ue.c=C,ue.lc=U}const de={c:0,lc:0};function ae(C,U,ne,S,Y,X,se,$,Ae){if(C==U){S<8&&(ee(ne,S,Y,X),ne=ue.c,S=ue.lc),S-=8;let _e=ne>>S;if(_e=new Uint8Array([_e])[0],$.value+_e>Ae)return!1;const ye=se[$.value-1];for(;_e-- >0;)se[$.value++]=ye}else if($.value<Ae)se[$.value++]=C;else return!1;de.c=ne,de.lc=S}function R(C){return C&65535}function M(C){const U=R(C);return U>32767?U-65536:U}const B={a:0,b:0};function D(C,U){const ne=M(C),Y=M(U),X=ne+(Y&1)+(Y>>1),se=X,$=X-Y;B.a=se,B.b=$}function te(C,U){const ne=R(C),S=R(U),Y=ne-(S>>1)&65535,X=S+Y-32768&65535;B.a=X,B.b=Y}function ie(C,U,ne,S,Y,X,se){const $=se<16384,Ae=ne>Y?Y:ne;let _e=1,ye,Ee;for(;_e<=Ae;)_e<<=1;for(_e>>=1,ye=_e,_e>>=1;_e>=1;){Ee=0;const Re=Ee+X*(Y-ye),Ie=X*_e,Fe=X*ye,De=S*_e,Ve=S*ye;let tt,ht,rt,nt;for(;Ee<=Re;Ee+=Fe){let gt=Ee;const ke=Ee+S*(ne-ye);for(;gt<=ke;gt+=Ve){const bt=gt+De,Lt=gt+Ie,Bt=Lt+De;$?(D(C[gt+U],C[Lt+U]),tt=B.a,rt=B.b,D(C[bt+U],C[Bt+U]),ht=B.a,nt=B.b,D(tt,ht),C[gt+U]=B.a,C[bt+U]=B.b,D(rt,nt),C[Lt+U]=B.a,C[Bt+U]=B.b):(te(C[gt+U],C[Lt+U]),tt=B.a,rt=B.b,te(C[bt+U],C[Bt+U]),ht=B.a,nt=B.b,te(tt,ht),C[gt+U]=B.a,C[bt+U]=B.b,te(rt,nt),C[Lt+U]=B.a,C[Bt+U]=B.b)}if(ne&_e){const bt=gt+Ie;$?D(C[gt+U],C[bt+U]):te(C[gt+U],C[bt+U]),tt=B.a,C[bt+U]=B.b,C[gt+U]=tt}}if(Y&_e){let gt=Ee;const ke=Ee+S*(ne-ye);for(;gt<=ke;gt+=Ve){const bt=gt+De;$?D(C[gt+U],C[bt+U]):te(C[gt+U],C[bt+U]),tt=B.a,C[bt+U]=B.b,C[gt+U]=tt}}ye=_e,_e>>=1}return Ee}function Z(C,U,ne,S,Y,X,se,$,Ae){let _e=0,ye=0;const Ee=se,Re=Math.trunc(S.value+(Y+7)/8);for(;S.value<Re;)for(ee(_e,ye,ne,S),_e=ue.c,ye=ue.lc;ye>=14;){const Fe=_e>>ye-14&16383,De=U[Fe];if(De.len)ye-=De.len,ae(De.lit,X,_e,ye,ne,S,$,Ae,Ee),_e=de.c,ye=de.lc;else{if(!De.p)throw new Error("hufDecode issues");let Ve;for(Ve=0;Ve<De.lit;Ve++){const tt=W(C[De.p[Ve]]);for(;ye<tt&&S.value<Re;)ee(_e,ye,ne,S),_e=ue.c,ye=ue.lc;if(ye>=tt&&O(C[De.p[Ve]])==(_e>>ye-tt&(1<<tt)-1)){ye-=tt,ae(De.p[Ve],X,_e,ye,ne,S,$,Ae,Ee),_e=de.c,ye=de.lc;break}}if(Ve==De.lit)throw new Error("hufDecode issues")}}const Ie=8-Y&7;for(_e>>=Ie,ye-=Ie;ye>0;){const Fe=U[_e<<14-ye&16383];if(Fe.len)ye-=Fe.len,ae(Fe.lit,X,_e,ye,ne,S,$,Ae,Ee),_e=de.c,ye=de.lc;else throw new Error("hufDecode issues")}return!0}function me(C,U,ne,S,Y,X){const se={value:0},$=ne.value,Ae=it(U,ne),_e=it(U,ne);ne.value+=4;const ye=it(U,ne);if(ne.value+=4,Ae<0||Ae>=65537||_e<0||_e>=65537)throw new Error("Something wrong with HUF_ENCSIZE");const Ee=new Array(65537),Re=new Array(16384);P(Re);const Ie=S-(ne.value-$);if(J(C,ne,Ie,Ae,_e,Ee),ye>8*(S-(ne.value-$)))throw new Error("Something wrong with hufUncompress");fe(Ee,Ae,_e,Re),Z(Ee,Re,C,ne,ye,_e,X,Y,se)}function F(C,U,ne){for(let S=0;S<ne;++S)U[S]=C[U[S]]}function Q(C){for(let U=1;U<C.length;U++){const ne=C[U-1]+C[U]-128;C[U]=ne}}function E(C,U){let ne=0,S=Math.floor((C.length+1)/2),Y=0;const X=C.length-1;for(;!(Y>X||(U[Y++]=C[ne++],Y>X));)U[Y++]=C[S++]}function j(C){let U=C.byteLength;const ne=new Array;let S=0;const Y=new DataView(C);for(;U>0;){const X=Y.getInt8(S++);if(X<0){const se=-X;U-=se+1;for(let $=0;$<se;$++)ne.push(Y.getUint8(S++))}else{const se=X;U-=2;const $=Y.getUint8(S++);for(let Ae=0;Ae<se+1;Ae++)ne.push($)}}return ne}function q(C,U,ne,S,Y,X){let se=new DataView(X.buffer);const $=ne[C.idx[0]].width,Ae=ne[C.idx[0]].height,_e=3,ye=Math.floor($/8),Ee=Math.ceil($/8),Re=Math.ceil(Ae/8),Ie=$-(Ee-1)*8,Fe=Ae-(Re-1)*8,De={value:0},Ve=new Array(_e),tt=new Array(_e),ht=new Array(_e),rt=new Array(_e),nt=new Array(_e);for(let ke=0;ke<_e;++ke)nt[ke]=U[C.idx[ke]],Ve[ke]=ke<1?0:Ve[ke-1]+Ee*Re,tt[ke]=new Float32Array(64),ht[ke]=new Uint16Array(64),rt[ke]=new Uint16Array(Ee*64);for(let ke=0;ke<Re;++ke){let bt=8;ke==Re-1&&(bt=Fe);let Lt=8;for(let Et=0;Et<Ee;++Et){Et==Ee-1&&(Lt=Ie);for(let vt=0;vt<_e;++vt)ht[vt].fill(0),ht[vt][0]=Y[Ve[vt]++],ce(De,S,ht[vt]),G(ht[vt],tt[vt]),V(tt[vt]);re(tt);for(let vt=0;vt<_e;++vt)k(tt[vt],rt[vt],Et*64)}let Bt=0;for(let Et=0;Et<_e;++Et){const vt=ne[C.idx[Et]].type;for(let pn=8*ke;pn<8*ke+bt;++pn){Bt=nt[Et][pn];for(let Ct=0;Ct<ye;++Ct){const rn=Ct*64+(pn&7)*8;se.setUint16(Bt+0*2*vt,rt[Et][rn+0],!0),se.setUint16(Bt+1*2*vt,rt[Et][rn+1],!0),se.setUint16(Bt+2*2*vt,rt[Et][rn+2],!0),se.setUint16(Bt+3*2*vt,rt[Et][rn+3],!0),se.setUint16(Bt+4*2*vt,rt[Et][rn+4],!0),se.setUint16(Bt+5*2*vt,rt[Et][rn+5],!0),se.setUint16(Bt+6*2*vt,rt[Et][rn+6],!0),se.setUint16(Bt+7*2*vt,rt[Et][rn+7],!0),Bt+=8*2*vt}}if(ye!=Ee)for(let pn=8*ke;pn<8*ke+bt;++pn){const Ct=nt[Et][pn]+8*ye*2*vt,rn=ye*64+(pn&7)*8;for(let Qn=0;Qn<Lt;++Qn)se.setUint16(Ct+Qn*2*vt,rt[Et][rn+Qn],!0)}}}const gt=new Uint16Array($);se=new DataView(X.buffer);for(let ke=0;ke<_e;++ke){ne[C.idx[ke]].decoded=!0;const bt=ne[C.idx[ke]].type;if(ne[ke].type==2)for(let Lt=0;Lt<Ae;++Lt){const Bt=nt[ke][Lt];for(let Et=0;Et<$;++Et)gt[Et]=se.getUint16(Bt+Et*2*bt,!0);for(let Et=0;Et<$;++Et)se.setFloat32(Bt+Et*2*bt,be(gt[Et]),!0)}}}function ce(C,U,ne){let S,Y=1;for(;Y<64;)S=U[C.value],S==65280?Y=64:S>>8==255?Y+=S&255:(ne[Y]=S,Y++),C.value++}function G(C,U){U[0]=be(C[0]),U[1]=be(C[1]),U[2]=be(C[5]),U[3]=be(C[6]),U[4]=be(C[14]),U[5]=be(C[15]),U[6]=be(C[27]),U[7]=be(C[28]),U[8]=be(C[2]),U[9]=be(C[4]),U[10]=be(C[7]),U[11]=be(C[13]),U[12]=be(C[16]),U[13]=be(C[26]),U[14]=be(C[29]),U[15]=be(C[42]),U[16]=be(C[3]),U[17]=be(C[8]),U[18]=be(C[12]),U[19]=be(C[17]),U[20]=be(C[25]),U[21]=be(C[30]),U[22]=be(C[41]),U[23]=be(C[43]),U[24]=be(C[9]),U[25]=be(C[11]),U[26]=be(C[18]),U[27]=be(C[24]),U[28]=be(C[31]),U[29]=be(C[40]),U[30]=be(C[44]),U[31]=be(C[53]),U[32]=be(C[10]),U[33]=be(C[19]),U[34]=be(C[23]),U[35]=be(C[32]),U[36]=be(C[39]),U[37]=be(C[45]),U[38]=be(C[52]),U[39]=be(C[54]),U[40]=be(C[20]),U[41]=be(C[22]),U[42]=be(C[33]),U[43]=be(C[38]),U[44]=be(C[46]),U[45]=be(C[51]),U[46]=be(C[55]),U[47]=be(C[60]),U[48]=be(C[21]),U[49]=be(C[34]),U[50]=be(C[37]),U[51]=be(C[47]),U[52]=be(C[50]),U[53]=be(C[56]),U[54]=be(C[59]),U[55]=be(C[61]),U[56]=be(C[35]),U[57]=be(C[36]),U[58]=be(C[48]),U[59]=be(C[49]),U[60]=be(C[57]),U[61]=be(C[58]),U[62]=be(C[62]),U[63]=be(C[63])}function V(C){const U=.5*Math.cos(.7853975),ne=.5*Math.cos(3.14159/16),S=.5*Math.cos(3.14159/8),Y=.5*Math.cos(3*3.14159/16),X=.5*Math.cos(5*3.14159/16),se=.5*Math.cos(3*3.14159/8),$=.5*Math.cos(7*3.14159/16),Ae=new Array(4),_e=new Array(4),ye=new Array(4),Ee=new Array(4);for(let Re=0;Re<8;++Re){const Ie=Re*8;Ae[0]=S*C[Ie+2],Ae[1]=se*C[Ie+2],Ae[2]=S*C[Ie+6],Ae[3]=se*C[Ie+6],_e[0]=ne*C[Ie+1]+Y*C[Ie+3]+X*C[Ie+5]+$*C[Ie+7],_e[1]=Y*C[Ie+1]-$*C[Ie+3]-ne*C[Ie+5]-X*C[Ie+7],_e[2]=X*C[Ie+1]-ne*C[Ie+3]+$*C[Ie+5]+Y*C[Ie+7],_e[3]=$*C[Ie+1]-X*C[Ie+3]+Y*C[Ie+5]-ne*C[Ie+7],ye[0]=U*(C[Ie+0]+C[Ie+4]),ye[3]=U*(C[Ie+0]-C[Ie+4]),ye[1]=Ae[0]+Ae[3],ye[2]=Ae[1]-Ae[2],Ee[0]=ye[0]+ye[1],Ee[1]=ye[3]+ye[2],Ee[2]=ye[3]-ye[2],Ee[3]=ye[0]-ye[1],C[Ie+0]=Ee[0]+_e[0],C[Ie+1]=Ee[1]+_e[1],C[Ie+2]=Ee[2]+_e[2],C[Ie+3]=Ee[3]+_e[3],C[Ie+4]=Ee[3]-_e[3],C[Ie+5]=Ee[2]-_e[2],C[Ie+6]=Ee[1]-_e[1],C[Ie+7]=Ee[0]-_e[0]}for(let Re=0;Re<8;++Re)Ae[0]=S*C[16+Re],Ae[1]=se*C[16+Re],Ae[2]=S*C[48+Re],Ae[3]=se*C[48+Re],_e[0]=ne*C[8+Re]+Y*C[24+Re]+X*C[40+Re]+$*C[56+Re],_e[1]=Y*C[8+Re]-$*C[24+Re]-ne*C[40+Re]-X*C[56+Re],_e[2]=X*C[8+Re]-ne*C[24+Re]+$*C[40+Re]+Y*C[56+Re],_e[3]=$*C[8+Re]-X*C[24+Re]+Y*C[40+Re]-ne*C[56+Re],ye[0]=U*(C[Re]+C[32+Re]),ye[3]=U*(C[Re]-C[32+Re]),ye[1]=Ae[0]+Ae[3],ye[2]=Ae[1]-Ae[2],Ee[0]=ye[0]+ye[1],Ee[1]=ye[3]+ye[2],Ee[2]=ye[3]-ye[2],Ee[3]=ye[0]-ye[1],C[0+Re]=Ee[0]+_e[0],C[8+Re]=Ee[1]+_e[1],C[16+Re]=Ee[2]+_e[2],C[24+Re]=Ee[3]+_e[3],C[32+Re]=Ee[3]-_e[3],C[40+Re]=Ee[2]-_e[2],C[48+Re]=Ee[1]-_e[1],C[56+Re]=Ee[0]-_e[0]}function re(C){for(let U=0;U<64;++U){const ne=C[0][U],S=C[1][U],Y=C[2][U];C[0][U]=ne+1.5747*Y,C[1][U]=ne-.1873*S-.4682*Y,C[2][U]=ne+1.8556*S}}function k(C,U,ne){for(let S=0;S<64;++S)U[ne+S]=Wa.toHalfFloat(N(C[S]))}function N(C){return C<=1?Math.sign(C)*Math.pow(Math.abs(C),2.2):Math.sign(C)*Math.pow(x,Math.abs(C)-1)}function oe(C){return new DataView(C.array.buffer,C.offset.value,C.size)}function pe(C){const U=C.viewer.buffer.slice(C.offset.value,C.offset.value+C.size),ne=new Uint8Array(j(U)),S=new Uint8Array(ne.length);return Q(ne),E(ne,S),new DataView(S.buffer)}function ve(C){const U=C.array.slice(C.offset.value,C.offset.value+C.size),ne=lc(U),S=new Uint8Array(ne.length);return Q(ne),E(ne,S),new DataView(S.buffer)}function xe(C){const U=C.viewer,ne={value:C.offset.value},S=new Uint16Array(C.columns*C.lines*(C.inputChannels.length*C.type)),Y=new Uint8Array(8192);let X=0;const se=new Array(C.inputChannels.length);for(let Fe=0,De=C.inputChannels.length;Fe<De;Fe++)se[Fe]={},se[Fe].start=X,se[Fe].end=se[Fe].start,se[Fe].nx=C.columns,se[Fe].ny=C.lines,se[Fe].size=C.type,X+=se[Fe].nx*se[Fe].ny*se[Fe].size;const $=Ce(U,ne),Ae=Ce(U,ne);if(Ae>=8192)throw new Error("Something is wrong with PIZ_COMPRESSION BITMAP_SIZE");if($<=Ae)for(let Fe=0;Fe<Ae-$+1;Fe++)Y[Fe+$]=dt(U,ne);const _e=new Uint16Array(65536),ye=w(Y,_e),Ee=it(U,ne);me(C.array,U,ne,Ee,S,X);for(let Fe=0;Fe<C.inputChannels.length;++Fe){const De=se[Fe];for(let Ve=0;Ve<se[Fe].size;++Ve)ie(S,De.start+Ve,De.nx,De.size,De.ny,De.nx*De.size,ye)}F(_e,S,X);let Re=0;const Ie=new Uint8Array(S.buffer.byteLength);for(let Fe=0;Fe<C.lines;Fe++)for(let De=0;De<C.inputChannels.length;De++){const Ve=se[De],tt=Ve.nx*Ve.size,ht=new Uint8Array(S.buffer,Ve.end*2,tt*2);Ie.set(ht,Re),Re+=tt*2,Ve.end+=tt}return new DataView(Ie.buffer)}function Pe(C){const U=C.array.slice(C.offset.value,C.offset.value+C.size),ne=lc(U),S=C.inputChannels.length*C.lines*C.columns*C.totalBytes,Y=new ArrayBuffer(S),X=new DataView(Y);let se=0,$=0;const Ae=new Array(4);for(let _e=0;_e<C.lines;_e++)for(let ye=0;ye<C.inputChannels.length;ye++){let Ee=0;switch(C.inputChannels[ye].pixelType){case 1:Ae[0]=se,Ae[1]=Ae[0]+C.columns,se=Ae[1]+C.columns;for(let Ie=0;Ie<C.columns;++Ie){const Fe=ne[Ae[0]++]<<8|ne[Ae[1]++];Ee+=Fe,X.setUint16($,Ee,!0),$+=2}break;case 2:Ae[0]=se,Ae[1]=Ae[0]+C.columns,Ae[2]=Ae[1]+C.columns,se=Ae[2]+C.columns;for(let Ie=0;Ie<C.columns;++Ie){const Fe=ne[Ae[0]++]<<24|ne[Ae[1]++]<<16|ne[Ae[2]++]<<8;Ee+=Fe,X.setUint32($,Ee,!0),$+=4}break}}return X}function Te(C){const U=C.viewer,ne={value:C.offset.value},S=new Uint8Array(C.columns*C.lines*(C.inputChannels.length*C.type*2)),Y={version:ct(U,ne),unknownUncompressedSize:ct(U,ne),unknownCompressedSize:ct(U,ne),acCompressedSize:ct(U,ne),dcCompressedSize:ct(U,ne),rleCompressedSize:ct(U,ne),rleUncompressedSize:ct(U,ne),rleRawSize:ct(U,ne),totalAcUncompressedCount:ct(U,ne),totalDcUncompressedCount:ct(U,ne),acCompression:ct(U,ne)};if(Y.version<2)throw new Error("EXRLoader.parse: "+We.compression+" version "+Y.version+" is unsupported");const X=new Array;let se=Ce(U,ne)-2;for(;se>0;){const De=Qe(U.buffer,ne),Ve=dt(U,ne),tt=Ve>>2&3,ht=(Ve>>4)-1,rt=new Int8Array([ht])[0],nt=dt(U,ne);X.push({name:De,index:rt,type:nt,compression:tt}),se-=De.length+3}const $=We.channels,Ae=new Array(C.inputChannels.length);for(let De=0;De<C.inputChannels.length;++De){const Ve=Ae[De]={},tt=$[De];Ve.name=tt.name,Ve.compression=0,Ve.decoded=!1,Ve.type=tt.pixelType,Ve.pLinear=tt.pLinear,Ve.width=C.columns,Ve.height=C.lines}const _e={idx:new Array(3)};for(let De=0;De<C.inputChannels.length;++De){const Ve=Ae[De];for(let tt=0;tt<X.length;++tt){const ht=X[tt];Ve.name==ht.name&&(Ve.compression=ht.compression,ht.index>=0&&(_e.idx[ht.index]=De),Ve.offset=De)}}let ye,Ee,Re;if(Y.acCompressedSize>0)switch(Y.acCompression){case 0:ye=new Uint16Array(Y.totalAcUncompressedCount),me(C.array,U,ne,Y.acCompressedSize,ye,Y.totalAcUncompressedCount);break;case 1:const De=C.array.slice(ne.value,ne.value+Y.totalAcUncompressedCount),Ve=lc(De);ye=new Uint16Array(Ve.buffer),ne.value+=Y.totalAcUncompressedCount;break}if(Y.dcCompressedSize>0){const De={array:C.array,offset:ne,size:Y.dcCompressedSize};Ee=new Uint16Array(ve(De).buffer),ne.value+=Y.dcCompressedSize}if(Y.rleRawSize>0){const De=C.array.slice(ne.value,ne.value+Y.rleCompressedSize),Ve=lc(De);Re=j(Ve.buffer),ne.value+=Y.rleCompressedSize}let Ie=0;const Fe=new Array(Ae.length);for(let De=0;De<Fe.length;++De)Fe[De]=new Array;for(let De=0;De<C.lines;++De)for(let Ve=0;Ve<Ae.length;++Ve)Fe[Ve].push(Ie),Ie+=Ae[Ve].width*C.type*2;q(_e,Fe,Ae,ye,Ee,S);for(let De=0;De<Ae.length;++De){const Ve=Ae[De];if(!Ve.decoded)switch(Ve.compression){case 2:let tt=0,ht=0;for(let rt=0;rt<C.lines;++rt){let nt=Fe[De][tt];for(let gt=0;gt<Ve.width;++gt){for(let ke=0;ke<2*Ve.type;++ke)S[nt++]=Re[ht+ke*Ve.width*Ve.height];ht++}tt++}break;case 1:default:throw new Error("EXRLoader.parse: unsupported channel compression")}}return new DataView(S.buffer)}function Qe(C,U){const ne=new Uint8Array(C);let S=0;for(;ne[U.value+S]!=0;)S+=1;const Y=new TextDecoder().decode(ne.slice(U.value,U.value+S));return U.value=U.value+S+1,Y}function lt(C,U,ne){const S=new TextDecoder().decode(new Uint8Array(C).slice(U.value,U.value+ne));return U.value=U.value+ne,S}function Ne(C,U){const ne=Ke(C,U),S=it(C,U);return[ne,S]}function qe(C,U){const ne=it(C,U),S=it(C,U);return[ne,S]}function Ke(C,U){const ne=C.getInt32(U.value,!0);return U.value=U.value+4,ne}function it(C,U){const ne=C.getUint32(U.value,!0);return U.value=U.value+4,ne}function je(C,U){const ne=C[U.value];return U.value=U.value+1,ne}function dt(C,U){const ne=C.getUint8(U.value);return U.value=U.value+1,ne}const ct=function(C,U){let ne;return"getBigInt64"in DataView.prototype?ne=Number(C.getBigInt64(U.value,!0)):ne=C.getUint32(U.value+4,!0)+Number(C.getUint32(U.value,!0)<<32),U.value+=8,ne};function At(C,U){const ne=C.getFloat32(U.value,!0);return U.value+=4,ne}function ge(C,U){return Wa.toHalfFloat(At(C,U))}function be(C){const U=(C&31744)>>10,ne=C&1023;return(C>>15?-1:1)*(U?U===31?ne?NaN:1/0:Math.pow(2,U-15)*(1+ne/1024):6103515625e-14*(ne/1024))}function Ce(C,U){const ne=C.getUint16(U.value,!0);return U.value+=2,ne}function Le(C,U){return be(Ce(C,U))}function et(C,U,ne,S){const Y=ne.value,X=[];for(;ne.value<Y+S-1;){const se=Qe(U,ne),$=Ke(C,ne),Ae=dt(C,ne);ne.value+=3;const _e=Ke(C,ne),ye=Ke(C,ne);X.push({name:se,pixelType:$,pLinear:Ae,xSampling:_e,ySampling:ye})}return ne.value+=1,X}function Ze(C,U){const ne=At(C,U),S=At(C,U),Y=At(C,U),X=At(C,U),se=At(C,U),$=At(C,U),Ae=At(C,U),_e=At(C,U);return{redX:ne,redY:S,greenX:Y,greenY:X,blueX:se,blueY:$,whiteX:Ae,whiteY:_e}}function _t(C,U){const ne=["NO_COMPRESSION","RLE_COMPRESSION","ZIPS_COMPRESSION","ZIP_COMPRESSION","PIZ_COMPRESSION","PXR24_COMPRESSION","B44_COMPRESSION","B44A_COMPRESSION","DWAA_COMPRESSION","DWAB_COMPRESSION"],S=dt(C,U);return ne[S]}function Ht(C,U){const ne=Ke(C,U),S=Ke(C,U),Y=Ke(C,U),X=Ke(C,U);return{xMin:ne,yMin:S,xMax:Y,yMax:X}}function dn(C,U){const ne=["INCREASING_Y","DECREASING_Y","RANDOM_Y"],S=dt(C,U);return ne[S]}function yt(C,U){const ne=["ENVMAP_LATLONG","ENVMAP_CUBE"],S=dt(C,U);return ne[S]}function Se(C,U){const ne=["ONE_LEVEL","MIPMAP_LEVELS","RIPMAP_LEVELS"],S=["ROUND_DOWN","ROUND_UP"],Y=it(C,U),X=it(C,U),se=dt(C,U);return{xSize:Y,ySize:X,levelMode:ne[se&15],roundingMode:S[se>>4]}}function Be(C,U){const ne=At(C,U),S=At(C,U);return[ne,S]}function Oe(C,U){const ne=At(C,U),S=At(C,U),Y=At(C,U);return[ne,S,Y]}function Ue(C,U,ne,S,Y){if(S==="string"||S==="stringvector"||S==="iccProfile")return lt(U,ne,Y);if(S==="chlist")return et(C,U,ne,Y);if(S==="chromaticities")return Ze(C,ne);if(S==="compression")return _t(C,ne);if(S==="box2i")return Ht(C,ne);if(S==="envmap")return yt(C,ne);if(S==="tiledesc")return Se(C,ne);if(S==="lineOrder")return dn(C,ne);if(S==="float")return At(C,ne);if(S==="v2f")return Be(C,ne);if(S==="v3f")return Oe(C,ne);if(S==="int")return Ke(C,ne);if(S==="rational")return Ne(C,ne);if(S==="timecode")return qe(C,ne);if(S==="preview")return ne.value+=Y,"skipped";ne.value+=Y}function mt(C,U){const ne=Math.log2(C);return U=="ROUND_DOWN"?Math.floor(ne):Math.ceil(ne)}function Je(C,U,ne){let S=0;switch(C.levelMode){case"ONE_LEVEL":S=1;break;case"MIPMAP_LEVELS":S=mt(Math.max(U,ne),C.roundingMode)+1;break;case"RIPMAP_LEVELS":throw new Error("THREE.EXRLoader: RIPMAP_LEVELS tiles currently unsupported.")}return S}function Ge(C,U,ne,S){const Y=new Array(C);for(let X=0;X<C;X++){const se=1<<X;let $=U/se|0;S=="ROUND_UP"&&$*se<U&&($+=1);const Ae=Math.max($,1);Y[X]=(Ae+ne-1)/ne|0}return Y}function $e(){const C=this,U=C.offset,ne={value:0};for(let S=0;S<C.tileCount;S++){const Y=Ke(C.viewer,U),X=Ke(C.viewer,U);U.value+=8,C.size=it(C.viewer,U);const se=Y*C.blockWidth,$=X*C.blockHeight;C.columns=se+C.blockWidth>C.width?C.width-se:C.blockWidth,C.lines=$+C.blockHeight>C.height?C.height-$:C.blockHeight;const Ae=C.columns*C.totalBytes,ye=C.size<C.lines*Ae?C.uncompress(C):oe(C);U.value+=C.size;for(let Ee=0;Ee<C.lines;Ee++){const Re=Ee*C.columns*C.totalBytes;for(let Ie=0;Ie<C.inputChannels.length;Ie++){const Fe=We.channels[Ie].name,De=C.channelByteOffsets[Fe]*C.columns,Ve=C.decodeChannels[Fe];if(Ve===void 0)continue;ne.value=Re+De;const tt=(C.height-(1+$+Ee))*C.outLineWidth;for(let ht=0;ht<C.columns;ht++){const rt=tt+(ht+se)*C.outputChannels+Ve;C.byteArray[rt]=C.getter(ye,ne)}}}}}function we(){const C=this,U=C.offset,ne={value:0};for(let S=0;S<C.height/C.blockHeight;S++){const Y=Ke(C.viewer,U)-We.dataWindow.yMin;C.size=it(C.viewer,U),C.lines=Y+C.blockHeight>C.height?C.height-Y:C.blockHeight;const X=C.columns*C.totalBytes,$=C.size<C.lines*X?C.uncompress(C):oe(C);U.value+=C.size;for(let Ae=0;Ae<C.blockHeight;Ae++){const _e=S*C.blockHeight,ye=Ae+C.scanOrder(_e);if(ye>=C.height)continue;const Ee=Ae*X,Re=(C.height-1-ye)*C.outLineWidth;for(let Ie=0;Ie<C.inputChannels.length;Ie++){const Fe=We.channels[Ie].name,De=C.channelByteOffsets[Fe]*C.columns,Ve=C.decodeChannels[Fe];if(Ve!==void 0){ne.value=Ee+De;for(let tt=0;tt<C.columns;tt++){const ht=Re+tt*C.outputChannels+Ve;C.byteArray[ht]=C.getter($,ne)}}}}}}function He(C,U,ne){const S={};if(C.getUint32(0,!0)!=20000630)throw new Error("THREE.EXRLoader: Provided file doesn't appear to be in OpenEXR format.");S.version=C.getUint8(4);const Y=C.getUint8(5);S.spec={singleTile:!!(Y&2),longName:!!(Y&4),deepFormat:!!(Y&8),multiPart:!!(Y&16)},ne.value=8;let X=!0;for(;X;){const se=Qe(U,ne);if(se==0)X=!1;else{const $=Qe(U,ne),Ae=it(C,ne),_e=Ue(C,U,ne,$,Ae);_e===void 0?console.warn("THREE.EXRLoader: Skipped unknown header attribute type '".concat($,"'.")):S[se]=_e}}if(Y&-7)throw console.error("THREE.EXRHeader:",S),new Error("THREE.EXRLoader: Provided file is currently unsupported.");return S}function Ye(C,U,ne,S,Y){const X={size:0,viewer:U,array:ne,offset:S,width:C.dataWindow.xMax-C.dataWindow.xMin+1,height:C.dataWindow.yMax-C.dataWindow.yMin+1,inputChannels:C.channels,channelByteOffsets:{},scanOrder:null,totalBytes:null,columns:null,lines:null,type:null,uncompress:null,getter:null,format:null,colorSpace:On};switch(C.compression){case"NO_COMPRESSION":X.blockHeight=1,X.uncompress=oe;break;case"RLE_COMPRESSION":X.blockHeight=1,X.uncompress=pe;break;case"ZIPS_COMPRESSION":X.blockHeight=1,X.uncompress=ve;break;case"ZIP_COMPRESSION":X.blockHeight=16,X.uncompress=ve;break;case"PIZ_COMPRESSION":X.blockHeight=32,X.uncompress=xe;break;case"PXR24_COMPRESSION":X.blockHeight=16,X.uncompress=Pe;break;case"DWAA_COMPRESSION":X.blockHeight=32,X.uncompress=Te;break;case"DWAB_COMPRESSION":X.blockHeight=256,X.uncompress=Te;break;default:throw new Error("EXRLoader.parse: "+C.compression+" is unsupported")}const se={};for(const ye of C.channels)switch(ye.name){case"Y":case"R":case"G":case"B":case"A":se[ye.name]=!0,X.type=ye.pixelType}let $=!1;if(se.R&&se.G&&se.B)$=!se.A,X.outputChannels=4,X.decodeChannels={R:0,G:1,B:2,A:3};else if(se.Y)X.outputChannels=1,X.decodeChannels={Y:0};else throw new Error("EXRLoader.parse: file contains unsupported data channels.");if(X.type==1)switch(Y){case Sn:X.getter=Le;break;case Gn:X.getter=Ce;break}else if(X.type==2)switch(Y){case Sn:X.getter=At;break;case Gn:X.getter=ge}else throw new Error("EXRLoader.parse: unsupported pixelType "+X.type+" for "+C.compression+".");X.columns=X.width;const Ae=X.width*X.height*X.outputChannels;switch(Y){case Sn:X.byteArray=new Float32Array(Ae),$&&X.byteArray.fill(1,0,Ae);break;case Gn:X.byteArray=new Uint16Array(Ae),$&&X.byteArray.fill(15360,0,Ae);break;default:console.error("THREE.EXRLoader: unsupported type: ",Y);break}let _e=0;for(const ye of C.channels)X.decodeChannels[ye.name]!==void 0&&(X.channelByteOffsets[ye.name]=_e),_e+=ye.pixelType*2;if(X.totalBytes=_e,X.outLineWidth=X.width*X.outputChannels,C.lineOrder==="INCREASING_Y"?X.scanOrder=ye=>ye:X.scanOrder=ye=>X.height-1-ye,X.outputChannels==4?(X.format=Hn,X.colorSpace=On):(X.format=mr,X.colorSpace=bs),C.spec.singleTile){X.blockHeight=C.tiles.ySize,X.blockWidth=C.tiles.xSize;const ye=Je(C.tiles,X.width,X.height),Ee=Ge(ye,X.width,C.tiles.xSize,C.tiles.roundingMode),Re=Ge(ye,X.height,C.tiles.ySize,C.tiles.roundingMode);X.tileCount=Ee[0]*Re[0];for(let Ie=0;Ie<ye;Ie++)for(let Fe=0;Fe<Re[Ie];Fe++)for(let De=0;De<Ee[Ie];De++)ct(U,S);X.decode=$e.bind(X)}else{X.blockWidth=X.width;const ye=Math.ceil(X.height/X.blockHeight);for(let Ee=0;Ee<ye;Ee++)ct(U,S);X.decode=we.bind(X)}return X}const ot={value:0},Xe=new DataView(e),ze=new Uint8Array(e),We=He(Xe,e,ot),ut=Ye(We,Xe,ze,ot,this.type);return ut.decode(),{header:We,width:ut.width,height:ut.height,data:ut.byteArray,format:ut.format,colorSpace:ut.colorSpace,type:this.type}}setDataType(e){return this.type=e,this}load(e,t,n,s){function r(o,a){o.colorSpace=a.colorSpace,o.minFilter=Zt,o.magFilter=Zt,o.generateMipmaps=!1,o.flipY=!1,t&&t(o,a)}return super.load(e,r,n,s)}}function vE(i,e,t){const n=t.length-i-1;if(e>=t[n])return n-1;if(e<=t[i])return i;let s=i,r=n,o=Math.floor((s+r)/2);for(;e<t[o]||e>=t[o+1];)e<t[o]?r=o:s=o,o=Math.floor((s+r)/2);return o}function d3(i,e,t,n){const s=[],r=[],o=[];s[0]=1;for(let a=1;a<=t;++a){r[a]=e-n[i+1-a],o[a]=n[i+a]-e;let l=0;for(let c=0;c<a;++c){const h=o[c+1],u=r[a-c],d=s[c]/(h+u);s[c]=l+h*d,l=u*d}s[a]=l}return s}function f3(i,e,t,n){const s=vE(i,n,e),r=d3(s,n,i,e),o=new Ot(0,0,0,0);for(let a=0;a<=i;++a){const l=t[s-i+a],c=r[a],h=l.w*c;o.x+=l.x*h,o.y+=l.y*h,o.z+=l.z*h,o.w+=l.w*c}return o}function p3(i,e,t,n,s){const r=[];for(let u=0;u<=t;++u)r[u]=0;const o=[];for(let u=0;u<=n;++u)o[u]=r.slice(0);const a=[];for(let u=0;u<=t;++u)a[u]=r.slice(0);a[0][0]=1;const l=r.slice(0),c=r.slice(0);for(let u=1;u<=t;++u){l[u]=e-s[i+1-u],c[u]=s[i+u]-e;let d=0;for(let f=0;f<u;++f){const p=c[f+1],A=l[u-f];a[u][f]=p+A;const m=a[f][u-1]/a[u][f];a[f][u]=d+p*m,d=A*m}a[u][u]=d}for(let u=0;u<=t;++u)o[0][u]=a[u][t];for(let u=0;u<=t;++u){let d=0,f=1;const p=[];for(let A=0;A<=t;++A)p[A]=r.slice(0);p[0][0]=1;for(let A=1;A<=n;++A){let m=0;const g=u-A,y=t-A;u>=A&&(p[f][0]=p[d][0]/a[y+1][g],m=p[f][0]*a[g][y]);const _=g>=-1?1:-g,v=u-1<=y?A-1:t-u;for(let T=_;T<=v;++T)p[f][T]=(p[d][T]-p[d][T-1])/a[y+1][g+T],m+=p[f][T]*a[g+T][y];u<=y&&(p[f][A]=-p[d][A-1]/a[y+1][u],m+=p[f][A]*a[u][y]),o[A][u]=m;const b=d;d=f,f=b}}let h=t;for(let u=1;u<=n;++u){for(let d=0;d<=t;++d)o[u][d]*=h;h*=t-u}return o}function m3(i,e,t,n,s){const r=s<i?s:i,o=[],a=vE(i,n,e),l=p3(a,n,i,r,e),c=[];for(let h=0;h<t.length;++h){const u=t[h].clone(),d=u.w;u.x*=d,u.y*=d,u.z*=d,c[h]=u}for(let h=0;h<=r;++h){const u=c[a-i].clone().multiplyScalar(l[h][0]);for(let d=1;d<=i;++d)u.add(c[a-i+d].clone().multiplyScalar(l[h][d]));o[h]=u}for(let h=r+1;h<=s+1;++h)o[h]=new Ot(0,0,0);return o}function A3(i,e){let t=1;for(let s=2;s<=i;++s)t*=s;let n=1;for(let s=2;s<=e;++s)n*=s;for(let s=2;s<=i-e;++s)n*=s;return t/n}function g3(i){const e=i.length,t=[],n=[];for(let r=0;r<e;++r){const o=i[r];t[r]=new he(o.x,o.y,o.z),n[r]=o.w}const s=[];for(let r=0;r<e;++r){const o=t[r].clone();for(let a=1;a<=r;++a)o.sub(s[r-a].clone().multiplyScalar(A3(r,a)*n[a]));s[r]=o.divideScalar(n[0])}return s}function v3(i,e,t,n,s){const r=m3(i,e,t,n,s);return g3(r)}class _3 extends Is{constructor(e,t,n,s,r){super();const o=t?t.length-1:0,a=n?n.length:0;this.degree=e,this.knots=t,this.controlPoints=[],this.startKnot=s||0,this.endKnot=r||o;for(let l=0;l<a;++l){const c=n[l];this.controlPoints[l]=new Ot(c.x,c.y,c.z,c.w)}}getPoint(e,t=new he){const n=t,s=this.knots[this.startKnot]+e*(this.knots[this.endKnot]-this.knots[this.startKnot]),r=f3(this.degree,this.knots,this.controlPoints,s);return r.w!==1&&r.divideScalar(r.w),n.set(r.x,r.y,r.z)}getTangent(e,t=new he){const n=t,s=this.knots[0]+e*(this.knots[this.knots.length-1]-this.knots[0]),r=v3(this.degree,this.knots,this.controlPoints,s,1);return n.copy(r[1]).normalize(),n}toJSON(){const e=super.toJSON();return e.degree=this.degree,e.knots=[...this.knots],e.controlPoints=this.controlPoints.map(t=>t.toArray()),e.startKnot=this.startKnot,e.endKnot=this.endKnot,e}fromJSON(e){return super.fromJSON(e),this.degree=e.degree,this.knots=[...e.knots],this.controlPoints=e.controlPoints.map(t=>new Ot(t[0],t[1],t[2],t[3])),this.startKnot=e.startKnot,this.endKnot=e.endKnot,this}}let Pt,Tn,Ai;class y3 extends ni{constructor(e){super(e)}load(e,t,n,s){const r=this,o=r.path===""?al.extractUrlBase(e):r.path,a=new ji(this.manager);a.setPath(r.path),a.setResponseType("arraybuffer"),a.setRequestHeader(r.requestHeader),a.setWithCredentials(r.withCredentials),a.load(e,function(l){try{t(r.parse(l,o))}catch(c){s?s(c):console.error(c),r.manager.itemError(e)}},n,s)}parse(e,t){if(S3(e))Pt=new C3().parse(e);else{const s=xE(e);if(!I3(s))throw new Error("THREE.FBXLoader: Unknown format.");if(sy(s)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+sy(s));Pt=new E3().parse(s)}const n=new vg(this.manager).setPath(this.resourcePath||t).setCrossOrigin(this.crossOrigin);return new x3(n,this.manager).parse(Pt)}}class x3{constructor(e,t){this.textureLoader=e,this.manager=t}parse(){Tn=this.parseConnections();const e=this.parseImages(),t=this.parseTextures(e),n=this.parseMaterials(t),s=this.parseDeformers(),r=new w3().parse(s);return this.parseScene(s,r,n),Ai}parseConnections(){const e=new Map;return"Connections"in Pt&&Pt.Connections.connections.forEach(function(n){const s=n[0],r=n[1],o=n[2];e.has(s)||e.set(s,{parents:[],children:[]});const a={ID:r,relationship:o};e.get(s).parents.push(a),e.has(r)||e.set(r,{parents:[],children:[]});const l={ID:s,relationship:o};e.get(r).children.push(l)}),e}parseImages(){const e={},t={};if("Video"in Pt.Objects){const n=Pt.Objects.Video;for(const s in n){const r=n[s],o=parseInt(s);if(e[o]=r.RelativeFilename||r.Filename,"Content"in r){const a=r.Content instanceof ArrayBuffer&&r.Content.byteLength>0,l=typeof r.Content=="string"&&r.Content!=="";if(a||l){const c=this.parseImage(n[s]);t[r.RelativeFilename||r.Filename]=c}}}}for(const n in e){const s=e[n];t[s]!==void 0?e[n]=t[s]:e[n]=e[n].split("\\").pop()}return e}parseImage(e){const t=e.Content,n=e.RelativeFilename||e.Filename,s=n.slice(n.lastIndexOf(".")+1).toLowerCase();let r;switch(s){case"bmp":r="image/bmp";break;case"jpg":case"jpeg":r="image/jpeg";break;case"png":r="image/png";break;case"tif":r="image/tiff";break;case"tga":this.manager.getHandler(".tga")===null&&console.warn("FBXLoader: TGA loader not found, skipping ",n),r="image/tga";break;default:console.warn('FBXLoader: Image type "'+s+'" is not supported.');return}if(typeof t=="string")return"data:"+r+";base64,"+t;{const o=new Uint8Array(t);return window.URL.createObjectURL(new Blob([o],{type:r}))}}parseTextures(e){const t=new Map;if("Texture"in Pt.Objects){const n=Pt.Objects.Texture;for(const s in n){const r=this.parseTexture(n[s],e);t.set(parseInt(s),r)}}return t}parseTexture(e,t){const n=this.loadTexture(e,t);n.ID=e.id,n.name=e.attrName;const s=e.WrapModeU,r=e.WrapModeV,o=s!==void 0?s.value:0,a=r!==void 0?r.value:0;if(n.wrapS=o===0?lo:Hi,n.wrapT=a===0?lo:Hi,"Scaling"in e){const l=e.Scaling.value;n.repeat.x=l[0],n.repeat.y=l[1]}if("Translation"in e){const l=e.Translation.value;n.offset.x=l[0],n.offset.y=l[1]}return n}loadTexture(e,t){const n=new Set(["tga","tif","tiff","exr","dds","hdr","ktx2"]),s=e.FileName.split(".").pop().toLowerCase(),r=n.has(s)?this.manager.getHandler(".".concat(s)):this.textureLoader;if(!r)return console.warn("FBXLoader: ".concat(s.toUpperCase()," loader not found, creating placeholder texture for"),e.RelativeFilename),new Pn;const o=r.path;o||r.setPath(this.textureLoader.path);const a=Tn.get(e.id).children;let l;a!==void 0&&a.length>0&&t[a[0].ID]!==void 0&&(l=t[a[0].ID],(l.indexOf("blob:")===0||l.indexOf("data:")===0)&&r.setPath(void 0));const c=r.load(l);return r.setPath(o),c}parseMaterials(e){const t=new Map;if("Material"in Pt.Objects){const n=Pt.Objects.Material;for(const s in n){const r=this.parseMaterial(n[s],e);r!==null&&t.set(parseInt(s),r)}}return t}parseMaterial(e,t){const n=e.id,s=e.attrName;let r=e.ShadingModel;if(typeof r=="object"&&(r=r.value),!Tn.has(n))return null;const o=this.parseParameters(e,t,n);let a;switch(r.toLowerCase()){case"phong":a=new Ou;break;case"lambert":a=new hB;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',r),a=new Ou;break}return a.setValues(o),a.name=s,a}parseParameters(e,t,n){const s={};e.BumpFactor&&(s.bumpScale=e.BumpFactor.value),e.Diffuse?s.color=St.toWorkingColorSpace(new at().fromArray(e.Diffuse.value),Ft):e.DiffuseColor&&(e.DiffuseColor.type==="Color"||e.DiffuseColor.type==="ColorRGB")&&(s.color=St.toWorkingColorSpace(new at().fromArray(e.DiffuseColor.value),Ft)),e.DisplacementFactor&&(s.displacementScale=e.DisplacementFactor.value),e.Emissive?s.emissive=St.toWorkingColorSpace(new at().fromArray(e.Emissive.value),Ft):e.EmissiveColor&&(e.EmissiveColor.type==="Color"||e.EmissiveColor.type==="ColorRGB")&&(s.emissive=St.toWorkingColorSpace(new at().fromArray(e.EmissiveColor.value),Ft)),e.EmissiveFactor&&(s.emissiveIntensity=parseFloat(e.EmissiveFactor.value)),s.opacity=1-(e.TransparencyFactor?parseFloat(e.TransparencyFactor.value):0),(s.opacity===1||s.opacity===0)&&(s.opacity=e.Opacity?parseFloat(e.Opacity.value):null,s.opacity===null&&(s.opacity=1-(e.TransparentColor?parseFloat(e.TransparentColor.value[0]):0))),s.opacity<1&&(s.transparent=!0),e.ReflectionFactor&&(s.reflectivity=e.ReflectionFactor.value),e.Shininess&&(s.shininess=e.Shininess.value),e.Specular?s.specular=St.toWorkingColorSpace(new at().fromArray(e.Specular.value),Ft):e.SpecularColor&&e.SpecularColor.type==="Color"&&(s.specular=St.toWorkingColorSpace(new at().fromArray(e.SpecularColor.value),Ft));const r=this;return Tn.get(n).children.forEach(function(o){const a=o.relationship;switch(a){case"Bump":s.bumpMap=r.getTexture(t,o.ID);break;case"Maya|TEX_ao_map":s.aoMap=r.getTexture(t,o.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":s.map=r.getTexture(t,o.ID),s.map!==void 0&&(s.map.colorSpace=Ft);break;case"DisplacementColor":s.displacementMap=r.getTexture(t,o.ID);break;case"EmissiveColor":s.emissiveMap=r.getTexture(t,o.ID),s.emissiveMap!==void 0&&(s.emissiveMap.colorSpace=Ft);break;case"NormalMap":case"Maya|TEX_normal_map":s.normalMap=r.getTexture(t,o.ID);break;case"ReflectionColor":s.envMap=r.getTexture(t,o.ID),s.envMap!==void 0&&(s.envMap.mapping=ed,s.envMap.colorSpace=Ft);break;case"SpecularColor":s.specularMap=r.getTexture(t,o.ID),s.specularMap!==void 0&&(s.specularMap.colorSpace=Ft);break;case"TransparentColor":case"TransparencyFactor":s.alphaMap=r.getTexture(t,o.ID),s.transparent=!0;break;case"AmbientColor":case"ShininessExponent":case"SpecularFactor":case"VectorDisplacementColor":default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",a);break}}),s}getTexture(e,t){return"LayeredTexture"in Pt.Objects&&t in Pt.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),t=Tn.get(t).children[0].ID),e.get(t)}parseDeformers(){const e={},t={};if("Deformer"in Pt.Objects){const n=Pt.Objects.Deformer;for(const s in n){const r=n[s],o=Tn.get(parseInt(s));if(r.attrType==="Skin"){const a=this.parseSkeleton(o,n);a.ID=s,o.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),a.geometryID=o.parents[0].ID,e[s]=a}else if(r.attrType==="BlendShape"){const a={id:s};a.rawTargets=this.parseMorphTargets(o,n),a.id=s,o.parents.length>1&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),t[s]=a}}}return{skeletons:e,morphTargets:t}}parseSkeleton(e,t){const n=[];return e.children.forEach(function(s){const r=t[s.ID];if(r.attrType!=="Cluster")return;const o={ID:s.ID,indices:[],weights:[],transformLink:new pt().fromArray(r.TransformLink.a)};"Indexes"in r&&(o.indices=r.Indexes.a,o.weights=r.Weights.a),n.push(o)}),{rawBones:n,bones:[]}}parseMorphTargets(e,t){const n=[];for(let s=0;s<e.children.length;s++){const r=e.children[s],o=t[r.ID],a={name:o.attrName,initialWeight:o.DeformPercent,id:o.id,fullWeights:o.FullWeights.a};if(o.attrType!=="BlendShapeChannel")return;a.geoID=Tn.get(parseInt(r.ID)).children.filter(function(l){return l.relationship===void 0})[0].ID,n.push(a)}return n}parseScene(e,t,n){Ai=new Wi;const s=this.parseModels(e.skeletons,t,n),r=Pt.Objects.Model,o=this;s.forEach(function(l){const c=r[l.ID];o.setLookAtProperties(l,c),Tn.get(l.ID).parents.forEach(function(u){const d=s.get(u.ID);d!==void 0&&d.add(l)}),l.parent===null&&Ai.add(l)}),this.bindSkeleton(e.skeletons,t,s),this.addGlobalSceneSettings(),Ai.traverse(function(l){if(l.userData.transformData){l.parent&&(l.userData.transformData.parentMatrix=l.parent.matrix,l.userData.transformData.parentMatrixWorld=l.parent.matrixWorld);const c=yE(l.userData.transformData);l.applyMatrix4(c),l.updateWorldMatrix()}});const a=new b3().parse();Ai.children.length===1&&Ai.children[0].isGroup&&(Ai.children[0].animations=a,Ai=Ai.children[0]),Ai.animations=a}parseModels(e,t,n){const s=new Map,r=Pt.Objects.Model;for(const o in r){const a=parseInt(o),l=r[o],c=Tn.get(a);let h=this.buildSkeleton(c,e,a,l.attrName);if(!h){switch(l.attrType){case"Camera":h=this.createCamera(c);break;case"Light":h=this.createLight(c);break;case"Mesh":h=this.createMesh(c,t,n);break;case"NurbsCurve":h=this.createCurve(c,t);break;case"LimbNode":case"Root":h=new hd;break;case"Null":default:h=new Wi;break}h.name=l.attrName?Vt.sanitizeNodeName(l.attrName):"",h.userData.originalName=l.attrName,h.ID=a}this.getTransformData(h,l),s.set(a,h)}return s}buildSkeleton(e,t,n,s){let r=null;return e.parents.forEach(function(o){for(const a in t){const l=t[a];l.rawBones.forEach(function(c,h){if(c.ID===o.ID){const u=r;r=new hd,r.matrixWorld.copy(c.transformLink),r.name=s?Vt.sanitizeNodeName(s):"",r.userData.originalName=s,r.ID=n,l.bones[h]=r,u!==null&&r.add(u)}})}}),r}createCamera(e){let t,n;if(e.children.forEach(function(s){const r=Pt.Objects.NodeAttribute[s.ID];r!==void 0&&(n=r)}),n===void 0)t=new en;else{let s=0;n.CameraProjectionType!==void 0&&n.CameraProjectionType.value===1&&(s=1);let r=1;n.NearPlane!==void 0&&(r=n.NearPlane.value/1e3);let o=1e3;n.FarPlane!==void 0&&(o=n.FarPlane.value/1e3);let a=window.innerWidth,l=window.innerHeight;n.AspectWidth!==void 0&&n.AspectHeight!==void 0&&(a=n.AspectWidth.value,l=n.AspectHeight.value);const c=a/l;let h=45;n.FieldOfView!==void 0&&(h=n.FieldOfView.value);const u=n.FocalLength?n.FocalLength.value:null;switch(s){case 0:t=new ai(h,c,r,o),u!==null&&t.setFocalLength(u);break;case 1:console.warn("THREE.FBXLoader: Orthographic cameras not supported yet."),t=new en;break;default:console.warn("THREE.FBXLoader: Unknown camera type "+s+"."),t=new en;break}}return t}createLight(e){let t,n;if(e.children.forEach(function(s){const r=Pt.Objects.NodeAttribute[s.ID];r!==void 0&&(n=r)}),n===void 0)t=new en;else{let s;n.LightType===void 0?s=0:s=n.LightType.value;let r=16777215;n.Color!==void 0&&(r=St.toWorkingColorSpace(new at().fromArray(n.Color.value),Ft));let o=n.Intensity===void 0?1:n.Intensity.value/100;n.CastLightOnObject!==void 0&&n.CastLightOnObject.value===0&&(o=0);let a=0;n.FarAttenuationEnd!==void 0&&(n.EnableFarAttenuation!==void 0&&n.EnableFarAttenuation.value===0?a=0:a=n.FarAttenuationEnd.value);const l=1;switch(s){case 0:t=new $m(r,o,a,l);break;case 1:t=new yg(r,o);break;case 2:let c=Math.PI/3;n.InnerAngle!==void 0&&(c=bn.degToRad(n.InnerAngle.value));let h=0;n.OuterAngle!==void 0&&(h=bn.degToRad(n.OuterAngle.value),h=Math.max(h,1)),t=new Jw(r,o,a,c,h,l);break;default:console.warn("THREE.FBXLoader: Unknown light type "+n.LightType.value+", defaulting to a PointLight."),t=new $m(r,o);break}n.CastShadows!==void 0&&n.CastShadows.value===1&&(t.castShadow=!0)}return t}createMesh(e,t,n){let s,r=null,o=null;const a=[];return e.children.forEach(function(l){t.has(l.ID)&&(r=t.get(l.ID)),n.has(l.ID)&&a.push(n.get(l.ID))}),a.length>1?o=a:a.length>0?o=a[0]:(o=new Ou({name:ni.DEFAULT_MATERIAL_NAME,color:13421772}),a.push(o)),"color"in r.attributes&&a.forEach(function(l){l.vertexColors=!0}),r.FBX_Deformer?(s=new Ow(r,o),s.normalizeSkinWeights()):s=new $n(r,o),s}createCurve(e,t){const n=e.children.reduce(function(r,o){return t.has(o.ID)&&(r=t.get(o.ID)),r},null),s=new no({name:ni.DEFAULT_MATERIAL_NAME,color:3342591,linewidth:1});return new Wd(n,s)}getTransformData(e,t){const n={};"InheritType"in t&&(n.inheritType=parseInt(t.InheritType.value)),"RotationOrder"in t?n.eulerOrder=oh(t.RotationOrder.value):n.eulerOrder=oh(0),"Lcl_Translation"in t&&(n.translation=t.Lcl_Translation.value),"PreRotation"in t&&(n.preRotation=t.PreRotation.value),"Lcl_Rotation"in t&&(n.rotation=t.Lcl_Rotation.value),"PostRotation"in t&&(n.postRotation=t.PostRotation.value),"Lcl_Scaling"in t&&(n.scale=t.Lcl_Scaling.value),"ScalingOffset"in t&&(n.scalingOffset=t.ScalingOffset.value),"ScalingPivot"in t&&(n.scalingPivot=t.ScalingPivot.value),"RotationOffset"in t&&(n.rotationOffset=t.RotationOffset.value),"RotationPivot"in t&&(n.rotationPivot=t.RotationPivot.value),e.userData.transformData=n}setLookAtProperties(e,t){"LookAtProperty"in t&&Tn.get(e.ID).children.forEach(function(s){if(s.relationship==="LookAtProperty"){const r=Pt.Objects.Model[s.ID];if("Lcl_Translation"in r){const o=r.Lcl_Translation.value;e.target!==void 0?(e.target.position.fromArray(o),Ai.add(e.target)):e.lookAt(new he().fromArray(o))}}})}bindSkeleton(e,t,n){const s=this.parsePoseNodes();for(const r in e){const o=e[r];Tn.get(parseInt(o.ID)).parents.forEach(function(l){if(t.has(l.ID)){const c=l.ID;Tn.get(c).parents.forEach(function(u){n.has(u.ID)&&n.get(u.ID).bind(new Hd(o.bones),s[u.ID])})}})}}parsePoseNodes(){const e={};if("Pose"in Pt.Objects){const t=Pt.Objects.Pose;for(const n in t)if(t[n].attrType==="BindPose"&&t[n].NbPoseNodes>0){const s=t[n].PoseNode;Array.isArray(s)?s.forEach(function(r){e[r.Node]=new pt().fromArray(r.Matrix.a)}):e[s.Node]=new pt().fromArray(s.Matrix.a)}}return e}addGlobalSceneSettings(){if("GlobalSettings"in Pt){if("AmbientColor"in Pt.GlobalSettings){const e=Pt.GlobalSettings.AmbientColor.value,t=e[0],n=e[1],s=e[2];if(t!==0||n!==0||s!==0){const r=new at().setRGB(t,n,s,Ft);Ai.add(new Zw(r,1))}}"UnitScaleFactor"in Pt.GlobalSettings&&(Ai.userData.unitScaleFactor=Pt.GlobalSettings.UnitScaleFactor.value)}}}class w3{constructor(){this.negativeMaterialIndices=!1}parse(e){const t=new Map;if("Geometry"in Pt.Objects){const n=Pt.Objects.Geometry;for(const s in n){const r=Tn.get(parseInt(s)),o=this.parseGeometry(r,n[s],e);t.set(parseInt(s),o)}}return this.negativeMaterialIndices===!0&&console.warn("THREE.FBXLoader: The FBX file contains invalid (negative) material indices. The asset might not render as expected."),t}parseGeometry(e,t,n){switch(t.attrType){case"Mesh":return this.parseMeshGeometry(e,t,n);case"NurbsCurve":return this.parseNurbsGeometry(t)}}parseMeshGeometry(e,t,n){const s=n.skeletons,r=[],o=e.parents.map(function(u){return Pt.Objects.Model[u.ID]});if(o.length===0)return;const a=e.children.reduce(function(u,d){return s[d.ID]!==void 0&&(u=s[d.ID]),u},null);e.children.forEach(function(u){n.morphTargets[u.ID]!==void 0&&r.push(n.morphTargets[u.ID])});const l=o[0],c={};"RotationOrder"in l&&(c.eulerOrder=oh(l.RotationOrder.value)),"InheritType"in l&&(c.inheritType=parseInt(l.InheritType.value)),"GeometricTranslation"in l&&(c.translation=l.GeometricTranslation.value),"GeometricRotation"in l&&(c.rotation=l.GeometricRotation.value),"GeometricScaling"in l&&(c.scale=l.GeometricScaling.value);const h=yE(c);return this.genGeometry(t,a,r,h)}genGeometry(e,t,n,s){const r=new Nn;e.attrName&&(r.name=e.attrName);const o=this.parseGeoNode(e,t),a=this.genBuffers(o),l=new jt(a.vertex,3);if(l.applyMatrix4(s),r.setAttribute("position",l),a.colors.length>0&&r.setAttribute("color",new jt(a.colors,3)),t&&(r.setAttribute("skinIndex",new cg(a.weightsIndices,4)),r.setAttribute("skinWeight",new jt(a.vertexWeights,4)),r.FBX_Deformer=t),a.normal.length>0){const c=new wt().getNormalMatrix(s),h=new jt(a.normal,3);h.applyNormalMatrix(c),r.setAttribute("normal",h)}if(a.uvs.forEach(function(c,h){const u=h===0?"uv":"uv".concat(h);r.setAttribute(u,new jt(a.uvs[h],2))}),o.material&&o.material.mappingType!=="AllSame"){let c=a.materialIndex[0],h=0;if(a.materialIndex.forEach(function(u,d){u!==c&&(r.addGroup(h,d-h,c),c=u,h=d)}),r.groups.length>0){const u=r.groups[r.groups.length-1],d=u.start+u.count;d!==a.materialIndex.length&&r.addGroup(d,a.materialIndex.length-d,c)}r.groups.length===0&&r.addGroup(0,a.materialIndex.length,a.materialIndex[0])}return this.addMorphTargets(r,e,n,s),r}parseGeoNode(e,t){const n={};if(n.vertexPositions=e.Vertices!==void 0?e.Vertices.a:[],n.vertexIndices=e.PolygonVertexIndex!==void 0?e.PolygonVertexIndex.a:[],e.LayerElementColor&&(n.color=this.parseVertexColors(e.LayerElementColor[0])),e.LayerElementMaterial&&(n.material=this.parseMaterialIndices(e.LayerElementMaterial[0])),e.LayerElementNormal&&(n.normal=this.parseNormals(e.LayerElementNormal[0])),e.LayerElementUV){n.uv=[];let s=0;for(;e.LayerElementUV[s];)e.LayerElementUV[s].UV&&n.uv.push(this.parseUVs(e.LayerElementUV[s])),s++}return n.weightTable={},t!==null&&(n.skeleton=t,t.rawBones.forEach(function(s,r){s.indices.forEach(function(o,a){n.weightTable[o]===void 0&&(n.weightTable[o]=[]),n.weightTable[o].push({id:r,weight:s.weights[a]})})})),n}genBuffers(e){const t={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]};let n=0,s=0,r=!1,o=[],a=[],l=[],c=[],h=[],u=[];const d=this;return e.vertexIndices.forEach(function(f,p){let A,m=!1;f<0&&(f=f^-1,m=!0);let g=[],y=[];if(o.push(f*3,f*3+1,f*3+2),e.color){const _=bu(p,n,f,e.color);l.push(_[0],_[1],_[2])}if(e.skeleton){if(e.weightTable[f]!==void 0&&e.weightTable[f].forEach(function(_){y.push(_.weight),g.push(_.id)}),y.length>4){r||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),r=!0);const _=[0,0,0,0],v=[0,0,0,0];y.forEach(function(b,T){let L=b,I=g[T];v.forEach(function(x,w,P){if(L>x){P[w]=L,L=x;const z=_[w];_[w]=I,I=z}})}),g=_,y=v}for(;y.length<4;)y.push(0),g.push(0);for(let _=0;_<4;++_)h.push(y[_]),u.push(g[_])}if(e.normal){const _=bu(p,n,f,e.normal);a.push(_[0],_[1],_[2])}e.material&&e.material.mappingType!=="AllSame"&&(A=bu(p,n,f,e.material)[0],A<0&&(d.negativeMaterialIndices=!0,A=0)),e.uv&&e.uv.forEach(function(_,v){const b=bu(p,n,f,_);c[v]===void 0&&(c[v]=[]),c[v].push(b[0]),c[v].push(b[1])}),s++,m&&(d.genFace(t,e,o,A,a,l,c,h,u,s),n++,s=0,o=[],a=[],l=[],c=[],h=[],u=[])}),t}getNormalNewell(e){const t=new he(0,0,0);for(let n=0;n<e.length;n++){const s=e[n],r=e[(n+1)%e.length];t.x+=(s.y-r.y)*(s.z+r.z),t.y+=(s.z-r.z)*(s.x+r.x),t.z+=(s.x-r.x)*(s.y+r.y)}return t.normalize(),t}getNormalTangentAndBitangent(e){const t=this.getNormalNewell(e),s=(Math.abs(t.z)>.5?new he(0,1,0):new he(0,0,1)).cross(t).normalize(),r=t.clone().cross(s).normalize();return{normal:t,tangent:s,bitangent:r}}flattenVertex(e,t,n){return new Me(e.dot(t),e.dot(n))}genFace(e,t,n,s,r,o,a,l,c,h){let u;if(h>3){const d=[],f=t.baseVertexPositions||t.vertexPositions;for(let g=0;g<n.length;g+=3)d.push(new he(f[n[g]],f[n[g+1]],f[n[g+2]]));const{tangent:p,bitangent:A}=this.getNormalTangentAndBitangent(d),m=[];for(const g of d)m.push(this.flattenVertex(g,p,A));u=io.triangulateShape(m,[])}else u=[[0,1,2]];for(const[d,f,p]of u)e.vertex.push(t.vertexPositions[n[d*3]]),e.vertex.push(t.vertexPositions[n[d*3+1]]),e.vertex.push(t.vertexPositions[n[d*3+2]]),e.vertex.push(t.vertexPositions[n[f*3]]),e.vertex.push(t.vertexPositions[n[f*3+1]]),e.vertex.push(t.vertexPositions[n[f*3+2]]),e.vertex.push(t.vertexPositions[n[p*3]]),e.vertex.push(t.vertexPositions[n[p*3+1]]),e.vertex.push(t.vertexPositions[n[p*3+2]]),t.skeleton&&(e.vertexWeights.push(l[d*4]),e.vertexWeights.push(l[d*4+1]),e.vertexWeights.push(l[d*4+2]),e.vertexWeights.push(l[d*4+3]),e.vertexWeights.push(l[f*4]),e.vertexWeights.push(l[f*4+1]),e.vertexWeights.push(l[f*4+2]),e.vertexWeights.push(l[f*4+3]),e.vertexWeights.push(l[p*4]),e.vertexWeights.push(l[p*4+1]),e.vertexWeights.push(l[p*4+2]),e.vertexWeights.push(l[p*4+3]),e.weightsIndices.push(c[d*4]),e.weightsIndices.push(c[d*4+1]),e.weightsIndices.push(c[d*4+2]),e.weightsIndices.push(c[d*4+3]),e.weightsIndices.push(c[f*4]),e.weightsIndices.push(c[f*4+1]),e.weightsIndices.push(c[f*4+2]),e.weightsIndices.push(c[f*4+3]),e.weightsIndices.push(c[p*4]),e.weightsIndices.push(c[p*4+1]),e.weightsIndices.push(c[p*4+2]),e.weightsIndices.push(c[p*4+3])),t.color&&(e.colors.push(o[d*3]),e.colors.push(o[d*3+1]),e.colors.push(o[d*3+2]),e.colors.push(o[f*3]),e.colors.push(o[f*3+1]),e.colors.push(o[f*3+2]),e.colors.push(o[p*3]),e.colors.push(o[p*3+1]),e.colors.push(o[p*3+2])),t.material&&t.material.mappingType!=="AllSame"&&(e.materialIndex.push(s),e.materialIndex.push(s),e.materialIndex.push(s)),t.normal&&(e.normal.push(r[d*3]),e.normal.push(r[d*3+1]),e.normal.push(r[d*3+2]),e.normal.push(r[f*3]),e.normal.push(r[f*3+1]),e.normal.push(r[f*3+2]),e.normal.push(r[p*3]),e.normal.push(r[p*3+1]),e.normal.push(r[p*3+2])),t.uv&&t.uv.forEach(function(A,m){e.uvs[m]===void 0&&(e.uvs[m]=[]),e.uvs[m].push(a[m][d*2]),e.uvs[m].push(a[m][d*2+1]),e.uvs[m].push(a[m][f*2]),e.uvs[m].push(a[m][f*2+1]),e.uvs[m].push(a[m][p*2]),e.uvs[m].push(a[m][p*2+1])})}addMorphTargets(e,t,n,s){if(n.length===0)return;e.morphTargetsRelative=!0,e.morphAttributes.position=[];const r=this;n.forEach(function(o){o.rawTargets.forEach(function(a){const l=Pt.Objects.Geometry[a.geoID];l!==void 0&&r.genMorphGeometry(e,t,l,s,a.name)})})}genMorphGeometry(e,t,n,s,r){const o=t.Vertices!==void 0?t.Vertices.a:[],a=t.PolygonVertexIndex!==void 0?t.PolygonVertexIndex.a:[],l=n.Vertices!==void 0?n.Vertices.a:[],c=n.Indexes!==void 0?n.Indexes.a:[],h=e.attributes.position.count*3,u=new Float32Array(h);for(let A=0;A<c.length;A++){const m=c[A]*3;u[m]=l[A*3],u[m+1]=l[A*3+1],u[m+2]=l[A*3+2]}const d={vertexIndices:a,vertexPositions:u,baseVertexPositions:o},f=this.genBuffers(d),p=new jt(f.vertex,3);p.name=r||n.attrName,p.applyMatrix4(s),e.morphAttributes.position.push(p)}parseNormals(e){const t=e.MappingInformationType,n=e.ReferenceInformationType,s=e.Normals.a;let r=[];return n==="IndexToDirect"&&("NormalIndex"in e?r=e.NormalIndex.a:"NormalsIndex"in e&&(r=e.NormalsIndex.a)),{dataSize:3,buffer:s,indices:r,mappingType:t,referenceType:n}}parseUVs(e){const t=e.MappingInformationType,n=e.ReferenceInformationType,s=e.UV.a;let r=[];return n==="IndexToDirect"&&(r=e.UVIndex.a),{dataSize:2,buffer:s,indices:r,mappingType:t,referenceType:n}}parseVertexColors(e){const t=e.MappingInformationType,n=e.ReferenceInformationType,s=e.Colors.a;let r=[];n==="IndexToDirect"&&(r=e.ColorIndex.a);for(let o=0,a=new at;o<s.length;o+=4)a.fromArray(s,o),St.toWorkingColorSpace(a,Ft),a.toArray(s,o);return{dataSize:4,buffer:s,indices:r,mappingType:t,referenceType:n}}parseMaterialIndices(e){const t=e.MappingInformationType,n=e.ReferenceInformationType;if(t==="NoMappingInformation")return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:n};const s=e.Materials.a,r=[];for(let o=0;o<s.length;++o)r.push(o);return{dataSize:1,buffer:s,indices:r,mappingType:t,referenceType:n}}parseNurbsGeometry(e){const t=parseInt(e.Order);if(isNaN(t))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",e.Order,e.id),new Nn;const n=t-1,s=e.KnotVector.a,r=[],o=e.Points.a;for(let u=0,d=o.length;u<d;u+=4)r.push(new Ot().fromArray(o,u));let a,l;if(e.Form==="Closed")r.push(r[0]);else if(e.Form==="Periodic"){a=n,l=s.length-1-a;for(let u=0;u<n;++u)r.push(r[u])}const h=new _3(n,s,r,a,l).getPoints(r.length*12);return new Nn().setFromPoints(h)}}class b3{parse(){const e=[],t=this.parseClips();if(t!==void 0)for(const n in t){const s=t[n],r=this.addClip(s);e.push(r)}return e}parseClips(){if(Pt.Objects.AnimationCurve===void 0)return;const e=this.parseAnimationCurveNodes();this.parseAnimationCurves(e);const t=this.parseAnimationLayers(e);return this.parseAnimStacks(t)}parseAnimationCurveNodes(){const e=Pt.Objects.AnimationCurveNode,t=new Map;for(const n in e){const s=e[n];if(s.attrName.match(/S|R|T|DeformPercent/)!==null){const r={id:s.id,attr:s.attrName,curves:{}};t.set(r.id,r)}}return t}parseAnimationCurves(e){const t=Pt.Objects.AnimationCurve;for(const n in t){const s={id:t[n].id,times:t[n].KeyTime.a.map(M3),values:t[n].KeyValueFloat.a},r=Tn.get(s.id);if(r!==void 0){const o=r.parents[0].ID,a=r.parents[0].relationship;a.match(/X/)?e.get(o).curves.x=s:a.match(/Y/)?e.get(o).curves.y=s:a.match(/Z/)?e.get(o).curves.z=s:a.match(/DeformPercent/)&&e.has(o)&&(e.get(o).curves.morph=s)}}}parseAnimationLayers(e){const t=Pt.Objects.AnimationLayer,n=new Map;for(const s in t){const r=[],o=Tn.get(parseInt(s));o!==void 0&&(o.children.forEach(function(l,c){if(e.has(l.ID)){const h=e.get(l.ID);if(h.curves.x!==void 0||h.curves.y!==void 0||h.curves.z!==void 0){if(r[c]===void 0){const u=Tn.get(l.ID).parents.filter(function(d){return d.relationship!==void 0})[0].ID;if(u!==void 0){const d=Pt.Objects.Model[u.toString()];if(d===void 0){console.warn("THREE.FBXLoader: Encountered a unused curve.",l);return}const f={modelName:d.attrName?Vt.sanitizeNodeName(d.attrName):"",ID:d.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};Ai.traverse(function(p){p.ID===d.id&&(f.transform=p.matrix,p.userData.transformData&&(f.eulerOrder=p.userData.transformData.eulerOrder))}),f.transform||(f.transform=new pt),"PreRotation"in d&&(f.preRotation=d.PreRotation.value),"PostRotation"in d&&(f.postRotation=d.PostRotation.value),r[c]=f}}r[c]&&(r[c][h.attr]=h)}else if(h.curves.morph!==void 0){if(r[c]===void 0){const u=Tn.get(l.ID).parents.filter(function(g){return g.relationship!==void 0})[0].ID,d=Tn.get(u).parents[0].ID,f=Tn.get(d).parents[0].ID,p=Tn.get(f).parents[0].ID,A=Pt.Objects.Model[p],m={modelName:A.attrName?Vt.sanitizeNodeName(A.attrName):"",morphName:Pt.Objects.Deformer[u].attrName};r[c]=m}r[c][h.attr]=h}}}),n.set(parseInt(s),r))}return n}parseAnimStacks(e){const t=Pt.Objects.AnimationStack,n={};for(const s in t){const r=Tn.get(parseInt(s)).children;r.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");const o=e.get(r[0].ID);n[s]={name:t[s].attrName,layer:o}}return n}addClip(e){let t=[];const n=this;return e.layer.forEach(function(s){t=t.concat(n.generateTracks(s))}),new Yw(e.name,-1,t)}generateTracks(e){const t=[];let n=new he,s=new he;if(e.transform&&e.transform.decompose(n,new zn,s),n=n.toArray(),s=s.toArray(),e.T!==void 0&&Object.keys(e.T.curves).length>0){const r=this.generateVectorTrack(e.modelName,e.T.curves,n,"position");r!==void 0&&t.push(r)}if(e.R!==void 0&&Object.keys(e.R.curves).length>0){const r=this.generateRotationTrack(e.modelName,e.R.curves,e.preRotation,e.postRotation,e.eulerOrder);r!==void 0&&t.push(r)}if(e.S!==void 0&&Object.keys(e.S.curves).length>0){const r=this.generateVectorTrack(e.modelName,e.S.curves,s,"scale");r!==void 0&&t.push(r)}if(e.DeformPercent!==void 0){const r=this.generateMorphTrack(e);r!==void 0&&t.push(r)}return t}generateVectorTrack(e,t,n,s){const r=this.getTimesForAllAxes(t),o=this.getKeyframeTrackValues(r,t,n);return new ra(e+"."+s,r,o)}generateRotationTrack(e,t,n,s,r){let o,a;if(t.x!==void 0&&t.y!==void 0&&t.z!==void 0){const d=this.interpolateRotations(t.x,t.y,t.z,r);o=d[0],a=d[1]}const l=oh(0);n!==void 0&&(n=n.map(bn.degToRad),n.push(l),n=new Rn().fromArray(n),n=new zn().setFromEuler(n)),s!==void 0&&(s=s.map(bn.degToRad),s.push(l),s=new Rn().fromArray(s),s=new zn().setFromEuler(s).invert());const c=new zn,h=new Rn,u=[];if(!a||!o)return new ho(e+".quaternion",[0],[0]);for(let d=0;d<a.length;d+=3)h.set(a[d],a[d+1],a[d+2],r),c.setFromEuler(h),n!==void 0&&c.premultiply(n),s!==void 0&&c.multiply(s),d>2&&new zn().fromArray(u,(d-3)/3*4).dot(c)<0&&c.set(-c.x,-c.y,-c.z,-c.w),c.toArray(u,d/3*4);return new ho(e+".quaternion",o,u)}generateMorphTrack(e){const t=e.DeformPercent.curves.morph,n=t.values.map(function(r){return r/100}),s=Ai.getObjectByName(e.modelName).morphTargetDictionary[e.morphName];return new sa(e.modelName+".morphTargetInfluences["+s+"]",t.times,n)}getTimesForAllAxes(e){let t=[];if(e.x!==void 0&&(t=t.concat(e.x.times)),e.y!==void 0&&(t=t.concat(e.y.times)),e.z!==void 0&&(t=t.concat(e.z.times)),t=t.sort(function(n,s){return n-s}),t.length>1){let n=1,s=t[0];for(let r=1;r<t.length;r++){const o=t[r];o!==s&&(t[n]=o,s=o,n++)}t=t.slice(0,n)}return t}getKeyframeTrackValues(e,t,n){const s=n,r=[];let o=-1,a=-1,l=-1;return e.forEach(function(c){if(t.x&&(o=t.x.times.indexOf(c)),t.y&&(a=t.y.times.indexOf(c)),t.z&&(l=t.z.times.indexOf(c)),o!==-1){const h=t.x.values[o];r.push(h),s[0]=h}else r.push(s[0]);if(a!==-1){const h=t.y.values[a];r.push(h),s[1]=h}else r.push(s[1]);if(l!==-1){const h=t.z.values[l];r.push(h),s[2]=h}else r.push(s[2])}),r}interpolateRotations(e,t,n,s){const r=[],o=[];r.push(e.times[0]),o.push(bn.degToRad(e.values[0])),o.push(bn.degToRad(t.values[0])),o.push(bn.degToRad(n.values[0]));for(let a=1;a<e.values.length;a++){const l=[e.values[a-1],t.values[a-1],n.values[a-1]];if(isNaN(l[0])||isNaN(l[1])||isNaN(l[2]))continue;const c=l.map(bn.degToRad),h=[e.values[a],t.values[a],n.values[a]];if(isNaN(h[0])||isNaN(h[1])||isNaN(h[2]))continue;const u=h.map(bn.degToRad),d=[h[0]-l[0],h[1]-l[1],h[2]-l[2]],f=[Math.abs(d[0]),Math.abs(d[1]),Math.abs(d[2])];if(f[0]>=180||f[1]>=180||f[2]>=180){const A=Math.max(...f)/180,m=new Rn(...c,s),g=new Rn(...u,s),y=new zn().setFromEuler(m),_=new zn().setFromEuler(g);y.dot(_)&&_.set(-_.x,-_.y,-_.z,-_.w);const v=e.times[a-1],b=e.times[a]-v,T=new zn,L=new Rn;for(let I=0;I<1;I+=1/A)T.copy(y.clone().slerp(_.clone(),I)),r.push(v+I*b),L.setFromQuaternion(T,s),o.push(L.x),o.push(L.y),o.push(L.z)}else r.push(e.times[a]),o.push(bn.degToRad(e.values[a])),o.push(bn.degToRad(t.values[a])),o.push(bn.degToRad(n.values[a]))}return[r,o]}}class E3{getPrevNode(){return this.nodeStack[this.currentIndent-2]}getCurrentNode(){return this.nodeStack[this.currentIndent-1]}getCurrentProp(){return this.currentProp}pushStack(e){this.nodeStack.push(e),this.currentIndent+=1}popStack(){this.nodeStack.pop(),this.currentIndent-=1}setCurrentProp(e,t){this.currentProp=e,this.currentPropName=t}parse(e){this.currentIndent=0,this.allNodes=new _E,this.nodeStack=[],this.currentProp=[],this.currentPropName="";const t=this,n=e.split(/[\r\n]+/);return n.forEach(function(s,r){const o=s.match(/^[\s\t]*;/),a=s.match(/^[\s\t]*$/);if(o||a)return;const l=s.match("^\\t{"+t.currentIndent+"}(\\w+):(.*){",""),c=s.match("^\\t{"+t.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),h=s.match("^\\t{"+(t.currentIndent-1)+"}}");l?t.parseNodeBegin(s,l):c?t.parseNodeProperty(s,c,n[++r]):h?t.popStack():s.match(/^[^\s\t}]/)&&t.parseNodePropertyContinued(s)}),this.allNodes}parseNodeBegin(e,t){const n=t[1].trim().replace(/^"/,"").replace(/"$/,""),s=t[2].split(",").map(function(l){return l.trim().replace(/^"/,"").replace(/"$/,"")}),r={name:n},o=this.parseNodeAttr(s),a=this.getCurrentNode();this.currentIndent===0?this.allNodes.add(n,r):n in a?(n==="PoseNode"?a.PoseNode.push(r):a[n].id!==void 0&&(a[n]={},a[n][a[n].id]=a[n]),o.id!==""&&(a[n][o.id]=r)):typeof o.id=="number"?(a[n]={},a[n][o.id]=r):n!=="Properties70"&&(n==="PoseNode"?a[n]=[r]:a[n]=r),typeof o.id=="number"&&(r.id=o.id),o.name!==""&&(r.attrName=o.name),o.type!==""&&(r.attrType=o.type),this.pushStack(r)}parseNodeAttr(e){let t=e[0];e[0]!==""&&(t=parseInt(e[0]),isNaN(t)&&(t=e[0]));let n="",s="";return e.length>1&&(n=e[1].replace(/^(\w+)::/,""),s=e[2]),{id:t,name:n,type:s}}parseNodeProperty(e,t,n){let s=t[1].replace(/^"/,"").replace(/"$/,"").trim(),r=t[2].replace(/^"/,"").replace(/"$/,"").trim();s==="Content"&&r===","&&(r=n.replace(/"/g,"").replace(/,$/,"").trim());const o=this.getCurrentNode();if(o.name==="Properties70"){this.parseNodeSpecialProperty(e,s,r);return}if(s==="C"){const l=r.split(",").slice(1),c=parseInt(l[0]),h=parseInt(l[1]);let u=r.split(",").slice(3);u=u.map(function(d){return d.trim().replace(/^"/,"")}),s="connections",r=[c,h],B3(r,u),o[s]===void 0&&(o[s]=[])}s==="Node"&&(o.id=r),s in o&&Array.isArray(o[s])?o[s].push(r):s!=="a"?o[s]=r:o.a=r,this.setCurrentProp(o,s),s==="a"&&r.slice(-1)!==","&&(o.a=Tp(r))}parseNodePropertyContinued(e){const t=this.getCurrentNode();t.a+=e,e.slice(-1)!==","&&(t.a=Tp(t.a))}parseNodeSpecialProperty(e,t,n){const s=n.split('",').map(function(h){return h.trim().replace(/^\"/,"").replace(/\s/,"_")}),r=s[0],o=s[1],a=s[2],l=s[3];let c=s[4];switch(o){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":c=parseFloat(c);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":c=Tp(c);break}this.getPrevNode()[r]={type:o,type2:a,flag:l,value:c},this.setCurrentProp(this.getPrevNode(),r)}}class C3{parse(e){const t=new iy(e);t.skip(23);const n=t.getUint32();if(n<6400)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+n);const s=new _E;for(;!this.endOfContent(t);){const r=this.parseNode(t,n);r!==null&&s.add(r.name,r)}return s}endOfContent(e){return e.size()%16===0?(e.getOffset()+160+16&-16)>=e.size():e.getOffset()+160+16>=e.size()}parseNode(e,t){const n={},s=t>=7500?e.getUint64():e.getUint32(),r=t>=7500?e.getUint64():e.getUint32();t>=7500?e.getUint64():e.getUint32();const o=e.getUint8(),a=e.getString(o);if(s===0)return null;const l=[];for(let d=0;d<r;d++)l.push(this.parseProperty(e));const c=l.length>0?l[0]:"",h=l.length>1?l[1]:"",u=l.length>2?l[2]:"";for(n.singleProperty=r===1&&e.getOffset()===s;s>e.getOffset();){const d=this.parseNode(e,t);d!==null&&this.parseSubNode(a,n,d)}return n.propertyList=l,typeof c=="number"&&(n.id=c),h!==""&&(n.attrName=h),u!==""&&(n.attrType=u),a!==""&&(n.name=a),n}parseSubNode(e,t,n){if(n.singleProperty===!0){const s=n.propertyList[0];Array.isArray(s)?(t[n.name]=n,n.a=s):t[n.name]=s}else if(e==="Connections"&&n.name==="C"){const s=[];n.propertyList.forEach(function(r,o){o!==0&&s.push(r)}),t.connections===void 0&&(t.connections=[]),t.connections.push(s)}else if(n.name==="Properties70")Object.keys(n).forEach(function(r){t[r]=n[r]});else if(e==="Properties70"&&n.name==="P"){let s=n.propertyList[0],r=n.propertyList[1];const o=n.propertyList[2],a=n.propertyList[3];let l;s.indexOf("Lcl ")===0&&(s=s.replace("Lcl ","Lcl_")),r.indexOf("Lcl ")===0&&(r=r.replace("Lcl ","Lcl_")),r==="Color"||r==="ColorRGB"||r==="Vector"||r==="Vector3D"||r.indexOf("Lcl_")===0?l=[n.propertyList[4],n.propertyList[5],n.propertyList[6]]:l=n.propertyList[4],t[s]={type:r,type2:o,flag:a,value:l}}else t[n.name]===void 0?typeof n.id=="number"?(t[n.name]={},t[n.name][n.id]=n):t[n.name]=n:n.name==="PoseNode"?(Array.isArray(t[n.name])||(t[n.name]=[t[n.name]]),t[n.name].push(n)):t[n.name][n.id]===void 0&&(t[n.name][n.id]=n)}parseProperty(e){const t=e.getString(1);let n;switch(t){case"C":return e.getBoolean();case"D":return e.getFloat64();case"F":return e.getFloat32();case"I":return e.getInt32();case"L":return e.getInt64();case"R":return n=e.getUint32(),e.getArrayBuffer(n);case"S":return n=e.getUint32(),e.getString(n);case"Y":return e.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":const s=e.getUint32(),r=e.getUint32(),o=e.getUint32();if(r===0)switch(t){case"b":case"c":return e.getBooleanArray(s);case"d":return e.getFloat64Array(s);case"f":return e.getFloat32Array(s);case"i":return e.getInt32Array(s);case"l":return e.getInt64Array(s)}const a=lc(new Uint8Array(e.getArrayBuffer(o))),l=new iy(a.buffer);switch(t){case"b":case"c":return l.getBooleanArray(s);case"d":return l.getFloat64Array(s);case"f":return l.getFloat32Array(s);case"i":return l.getInt32Array(s);case"l":return l.getInt64Array(s)}break;default:throw new Error("THREE.FBXLoader: Unknown property type "+t)}}}class iy{constructor(e,t){this.dv=new DataView(e),this.offset=0,this.littleEndian=t!==void 0?t:!0,this._textDecoder=new TextDecoder}getOffset(){return this.offset}size(){return this.dv.buffer.byteLength}skip(e){this.offset+=e}getBoolean(){return(this.getUint8()&1)===1}getBooleanArray(e){const t=[];for(let n=0;n<e;n++)t.push(this.getBoolean());return t}getUint8(){const e=this.dv.getUint8(this.offset);return this.offset+=1,e}getInt16(){const e=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,e}getInt32(){const e=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,e}getInt32Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getInt32());return t}getUint32(){const e=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,e}getInt64(){let e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),t&2147483648?(t=~t&4294967295,e=~e&4294967295,e===4294967295&&(t=t+1&4294967295),e=e+1&4294967295,-(t*4294967296+e)):t*4294967296+e}getInt64Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getInt64());return t}getUint64(){let e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),t*4294967296+e}getFloat32(){const e=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e}getFloat32Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getFloat32());return t}getFloat64(){const e=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e}getFloat64Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getFloat64());return t}getArrayBuffer(e){const t=this.dv.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t}getString(e){const t=this.offset;let n=new Uint8Array(this.dv.buffer,t,e);this.skip(e);const s=n.indexOf(0);return s>=0&&(n=new Uint8Array(this.dv.buffer,t,s)),this._textDecoder.decode(n)}}class _E{add(e,t){this[e]=t}}function S3(i){const e="Kaydara FBX Binary  \0";return i.byteLength>=e.length&&e===xE(i,0,e.length)}function I3(i){const e=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"];let t=0;function n(s){const r=i[s-1];return i=i.slice(t+s),t++,r}for(let s=0;s<e.length;++s)if(n(1)===e[s])return!1;return!0}function sy(i){const e=/FBXVersion: (\d+)/,t=i.match(e);if(t)return parseInt(t[1]);throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function M3(i){return i/46186158e3}const T3=[];function bu(i,e,t,n){let s;switch(n.mappingType){case"ByPolygonVertex":s=i;break;case"ByPolygon":s=e;break;case"ByVertice":s=t;break;case"AllSame":s=n.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+n.mappingType)}n.referenceType==="IndexToDirect"&&(s=n.indices[s]);const r=s*n.dataSize,o=r+n.dataSize;return R3(T3,n.buffer,r,o)}const Mp=new Rn,Na=new he;function yE(i){const e=new pt,t=new pt,n=new pt,s=new pt,r=new pt,o=new pt,a=new pt,l=new pt,c=new pt,h=new pt,u=new pt,d=new pt,f=i.inheritType?i.inheritType:0;i.translation&&e.setPosition(Na.fromArray(i.translation));const p=oh(0);if(i.preRotation){const P=i.preRotation.map(bn.degToRad);P.push(p),t.makeRotationFromEuler(Mp.fromArray(P))}if(i.rotation){const P=i.rotation.map(bn.degToRad);P.push(i.eulerOrder||p),n.makeRotationFromEuler(Mp.fromArray(P))}if(i.postRotation){const P=i.postRotation.map(bn.degToRad);P.push(p),s.makeRotationFromEuler(Mp.fromArray(P)),s.invert()}i.scale&&r.scale(Na.fromArray(i.scale)),i.scalingOffset&&a.setPosition(Na.fromArray(i.scalingOffset)),i.scalingPivot&&o.setPosition(Na.fromArray(i.scalingPivot)),i.rotationOffset&&l.setPosition(Na.fromArray(i.rotationOffset)),i.rotationPivot&&c.setPosition(Na.fromArray(i.rotationPivot)),i.parentMatrixWorld&&(u.copy(i.parentMatrix),h.copy(i.parentMatrixWorld));const A=t.clone().multiply(n).multiply(s),m=new pt;m.extractRotation(h);const g=new pt;g.copyPosition(h);const y=g.clone().invert().multiply(h),_=m.clone().invert().multiply(y),v=r,b=new pt;if(f===0)b.copy(m).multiply(A).multiply(_).multiply(v);else if(f===1)b.copy(m).multiply(_).multiply(A).multiply(v);else{const z=new pt().scale(new he().setFromMatrixScale(u)).clone().invert(),H=_.clone().multiply(z);b.copy(m).multiply(A).multiply(H).multiply(v)}const T=c.clone().invert(),L=o.clone().invert();let I=e.clone().multiply(l).multiply(c).multiply(t).multiply(n).multiply(s).multiply(T).multiply(a).multiply(o).multiply(r).multiply(L);const x=new pt().copyPosition(I),w=h.clone().multiply(x);return d.copyPosition(w),I=d.clone().multiply(b),I.premultiply(h.invert()),I}function oh(i){i=i||0;const e=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return i===6?(console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),e[0]):e[i]}function Tp(i){return i.split(",").map(function(t){return parseFloat(t)})}function xE(i,e,t){return e===void 0&&(e=0),t===void 0&&(t=i.byteLength),new TextDecoder().decode(new Uint8Array(i,e,t))}function B3(i,e){for(let t=0,n=i.length,s=e.length;t<s;t++,n++)i[n]=e[t]}function R3(i,e,t,n){for(let s=t,r=0;s<n;s++,r++)i[r]=e[s];return i}class P3 extends ni{constructor(e){super(e)}load(e,t,n,s){const r=this,o=new ji(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,function(a){const l=r.parse(JSON.parse(a));t&&t(l)},n,s)}parse(e){return new D3(e)}}class D3{constructor(e){this.isFont=!0,this.type="Font",this.data=e}generateShapes(e,t=100){const n=[],s=L3(e,t,this.data);for(let r=0,o=s.length;r<o;r++)n.push(...s[r].toShapes());return n}}function L3(i,e,t){const n=Array.from(i),s=e/t.resolution,r=(t.boundingBox.yMax-t.boundingBox.yMin+t.underlineThickness)*s,o=[];let a=0,l=0;for(let c=0;c<n.length;c++){const h=n[c];if(h==="\n")a=0,l-=r;else{const u=F3(h,s,a,l,t);a+=u.offsetX,o.push(u.path)}}return o}function F3(i,e,t,n,s){const r=s.glyphs[i]||s.glyphs["?"];if(!r){console.error('THREE.Font: character "'+i+'" does not exists in font family '+s.familyName+".");return}const o=new Qr;let a,l,c,h,u,d,f,p;if(r.o){const A=r._cachedOutline||(r._cachedOutline=r.o.split(" "));for(let m=0,g=A.length;m<g;)switch(A[m++]){case"m":a=A[m++]*e+t,l=A[m++]*e+n,o.moveTo(a,l);break;case"l":a=A[m++]*e+t,l=A[m++]*e+n,o.lineTo(a,l);break;case"q":c=A[m++]*e+t,h=A[m++]*e+n,u=A[m++]*e+t,d=A[m++]*e+n,o.quadraticCurveTo(u,d,c,h);break;case"b":c=A[m++]*e+t,h=A[m++]*e+n,u=A[m++]*e+t,d=A[m++]*e+n,f=A[m++]*e+t,p=A[m++]*e+n,o.bezierCurveTo(u,d,f,p,c,h);break}}return{offsetX:r.ha*e,path:o}}function ry(i,e){if(e===_T)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),i;if(e===Hm||e===Mw){let t=i.getIndex();if(t===null){const o=[],a=i.getAttribute("position");if(a!==void 0){for(let l=0;l<a.count;l++)o.push(l);i.setIndex(o),t=i.getIndex()}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),i}const n=t.count-2,s=[];if(e===Hm)for(let o=1;o<=n;o++)s.push(t.getX(0)),s.push(t.getX(o)),s.push(t.getX(o+1));else for(let o=0;o<n;o++)o%2===0?(s.push(t.getX(o)),s.push(t.getX(o+1)),s.push(t.getX(o+2))):(s.push(t.getX(o+2)),s.push(t.getX(o+1)),s.push(t.getX(o)));s.length/3!==n&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const r=i.clone();return r.setIndex(s),r.clearGroups(),r}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",e),i}class N3 extends ni{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(t){return new V3(t)}),this.register(function(t){return new z3(t)}),this.register(function(t){return new $3(t)}),this.register(function(t){return new J3(t)}),this.register(function(t){return new Z3(t)}),this.register(function(t){return new H3(t)}),this.register(function(t){return new W3(t)}),this.register(function(t){return new q3(t)}),this.register(function(t){return new j3(t)}),this.register(function(t){return new Q3(t)}),this.register(function(t){return new X3(t)}),this.register(function(t){return new G3(t)}),this.register(function(t){return new K3(t)}),this.register(function(t){return new Y3(t)}),this.register(function(t){return new O3(t)}),this.register(function(t){return new eQ(t)}),this.register(function(t){return new tQ(t)})}load(e,t,n,s){const r=this;let o;if(this.resourcePath!=="")o=this.resourcePath;else if(this.path!==""){const c=al.extractUrlBase(e);o=al.resolveURL(c,this.path)}else o=al.extractUrlBase(e);this.manager.itemStart(e);const a=function(c){s?s(c):console.error(c),r.manager.itemError(e),r.manager.itemEnd(e)},l=new ji(this.manager);l.setPath(this.path),l.setResponseType("arraybuffer"),l.setRequestHeader(this.requestHeader),l.setWithCredentials(this.withCredentials),l.load(e,function(c){try{r.parse(c,o,function(h){t(h),r.manager.itemEnd(e)},a)}catch(h){a(h)}},n,a)}setDRACOLoader(e){return this.dracoLoader=e,this}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,n,s){let r;const o={},a={},l=new TextDecoder;if(typeof e=="string")r=JSON.parse(e);else if(e instanceof ArrayBuffer)if(l.decode(new Uint8Array(e,0,4))===wE){try{o[Nt.KHR_BINARY_GLTF]=new nQ(e)}catch(u){s&&s(u);return}r=JSON.parse(o[Nt.KHR_BINARY_GLTF].content)}else r=JSON.parse(l.decode(e));else r=e;if(r.asset===void 0||r.asset.version[0]<2){s&&s(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const c=new mQ(r,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});c.fileLoader.setRequestHeader(this.requestHeader);for(let h=0;h<this.pluginCallbacks.length;h++){const u=this.pluginCallbacks[h](c);u.name||console.error("THREE.GLTFLoader: Invalid plugin found: missing name"),a[u.name]=u,o[u.name]=!0}if(r.extensionsUsed)for(let h=0;h<r.extensionsUsed.length;++h){const u=r.extensionsUsed[h],d=r.extensionsRequired||[];switch(u){case Nt.KHR_MATERIALS_UNLIT:o[u]=new U3;break;case Nt.KHR_DRACO_MESH_COMPRESSION:o[u]=new iQ(r,this.dracoLoader);break;case Nt.KHR_TEXTURE_TRANSFORM:o[u]=new sQ;break;case Nt.KHR_MESH_QUANTIZATION:o[u]=new rQ;break;default:d.indexOf(u)>=0&&a[u]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+u+'".')}}c.setExtensions(o),c.setPlugins(a),c.parse(n,s)}parseAsync(e,t){const n=this;return new Promise(function(s,r){n.parse(e,t,s,r)})}}function k3(){let i={};return{get:function(e){return i[e]},add:function(e,t){i[e]=t},remove:function(e){delete i[e]},removeAll:function(){i={}}}}const Nt={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_DISPERSION:"KHR_materials_dispersion",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class O3{constructor(e){this.parser=e,this.name=Nt.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let n=0,s=t.length;n<s;n++){const r=t[n];r.extensions&&r.extensions[this.name]&&r.extensions[this.name].light!==void 0&&e._addNodeRef(this.cache,r.extensions[this.name].light)}}_loadLight(e){const t=this.parser,n="light:"+e;let s=t.cache.get(n);if(s)return s;const r=t.json,l=((r.extensions&&r.extensions[this.name]||{}).lights||[])[e];let c;const h=new at(16777215);l.color!==void 0&&h.setRGB(l.color[0],l.color[1],l.color[2],On);const u=l.range!==void 0?l.range:0;switch(l.type){case"directional":c=new yg(h),c.target.position.set(0,0,-1),c.add(c.target);break;case"point":c=new $m(h),c.distance=u;break;case"spot":c=new Jw(h),c.distance=u,l.spot=l.spot||{},l.spot.innerConeAngle=l.spot.innerConeAngle!==void 0?l.spot.innerConeAngle:0,l.spot.outerConeAngle=l.spot.outerConeAngle!==void 0?l.spot.outerConeAngle:Math.PI/4,c.angle=l.spot.outerConeAngle,c.penumbra=1-l.spot.innerConeAngle/l.spot.outerConeAngle,c.target.position.set(0,0,-1),c.add(c.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+l.type)}return c.position.set(0,0,0),c.decay=2,lr(c,l),l.intensity!==void 0&&(c.intensity=l.intensity),c.name=t.createUniqueName(l.name||"light_"+e),s=Promise.resolve(c),t.cache.add(n,s),s}getDependency(e,t){if(e==="light")return this._loadLight(t)}createNodeAttachment(e){const t=this,n=this.parser,r=n.json.nodes[e],a=(r.extensions&&r.extensions[this.name]||{}).light;return a===void 0?null:this._loadLight(a).then(function(l){return n._getNodeRef(t.cache,a,l)})}}class U3{constructor(){this.name=Nt.KHR_MATERIALS_UNLIT}getMaterialType(){return zo}extendParams(e,t,n){const s=[];e.color=new at(1,1,1),e.opacity=1;const r=t.pbrMetallicRoughness;if(r){if(Array.isArray(r.baseColorFactor)){const o=r.baseColorFactor;e.color.setRGB(o[0],o[1],o[2],On),e.opacity=o[3]}r.baseColorTexture!==void 0&&s.push(n.assignTexture(e,"map",r.baseColorTexture,Ft))}return Promise.all(s)}}class Q3{constructor(e){this.parser=e,this.name=Nt.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){const s=this.parser.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=s.extensions[this.name].emissiveStrength;return r!==void 0&&(t.emissiveIntensity=r),Promise.resolve()}}class V3{constructor(e){this.parser=e,this.name=Nt.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:Ys}extendMaterialParams(e,t){const n=this.parser,s=n.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],o=s.extensions[this.name];if(o.clearcoatFactor!==void 0&&(t.clearcoat=o.clearcoatFactor),o.clearcoatTexture!==void 0&&r.push(n.assignTexture(t,"clearcoatMap",o.clearcoatTexture)),o.clearcoatRoughnessFactor!==void 0&&(t.clearcoatRoughness=o.clearcoatRoughnessFactor),o.clearcoatRoughnessTexture!==void 0&&r.push(n.assignTexture(t,"clearcoatRoughnessMap",o.clearcoatRoughnessTexture)),o.clearcoatNormalTexture!==void 0&&(r.push(n.assignTexture(t,"clearcoatNormalMap",o.clearcoatNormalTexture)),o.clearcoatNormalTexture.scale!==void 0)){const a=o.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new Me(a,a)}return Promise.all(r)}}class z3{constructor(e){this.parser=e,this.name=Nt.KHR_MATERIALS_DISPERSION}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:Ys}extendMaterialParams(e,t){const s=this.parser.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=s.extensions[this.name];return t.dispersion=r.dispersion!==void 0?r.dispersion:0,Promise.resolve()}}class G3{constructor(e){this.parser=e,this.name=Nt.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:Ys}extendMaterialParams(e,t){const n=this.parser,s=n.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],o=s.extensions[this.name];return o.iridescenceFactor!==void 0&&(t.iridescence=o.iridescenceFactor),o.iridescenceTexture!==void 0&&r.push(n.assignTexture(t,"iridescenceMap",o.iridescenceTexture)),o.iridescenceIor!==void 0&&(t.iridescenceIOR=o.iridescenceIor),t.iridescenceThicknessRange===void 0&&(t.iridescenceThicknessRange=[100,400]),o.iridescenceThicknessMinimum!==void 0&&(t.iridescenceThicknessRange[0]=o.iridescenceThicknessMinimum),o.iridescenceThicknessMaximum!==void 0&&(t.iridescenceThicknessRange[1]=o.iridescenceThicknessMaximum),o.iridescenceThicknessTexture!==void 0&&r.push(n.assignTexture(t,"iridescenceThicknessMap",o.iridescenceThicknessTexture)),Promise.all(r)}}class H3{constructor(e){this.parser=e,this.name=Nt.KHR_MATERIALS_SHEEN}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:Ys}extendMaterialParams(e,t){const n=this.parser,s=n.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[];t.sheenColor=new at(0,0,0),t.sheenRoughness=0,t.sheen=1;const o=s.extensions[this.name];if(o.sheenColorFactor!==void 0){const a=o.sheenColorFactor;t.sheenColor.setRGB(a[0],a[1],a[2],On)}return o.sheenRoughnessFactor!==void 0&&(t.sheenRoughness=o.sheenRoughnessFactor),o.sheenColorTexture!==void 0&&r.push(n.assignTexture(t,"sheenColorMap",o.sheenColorTexture,Ft)),o.sheenRoughnessTexture!==void 0&&r.push(n.assignTexture(t,"sheenRoughnessMap",o.sheenRoughnessTexture)),Promise.all(r)}}class W3{constructor(e){this.parser=e,this.name=Nt.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:Ys}extendMaterialParams(e,t){const n=this.parser,s=n.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],o=s.extensions[this.name];return o.transmissionFactor!==void 0&&(t.transmission=o.transmissionFactor),o.transmissionTexture!==void 0&&r.push(n.assignTexture(t,"transmissionMap",o.transmissionTexture)),Promise.all(r)}}class q3{constructor(e){this.parser=e,this.name=Nt.KHR_MATERIALS_VOLUME}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:Ys}extendMaterialParams(e,t){const n=this.parser,s=n.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],o=s.extensions[this.name];t.thickness=o.thicknessFactor!==void 0?o.thicknessFactor:0,o.thicknessTexture!==void 0&&r.push(n.assignTexture(t,"thicknessMap",o.thicknessTexture)),t.attenuationDistance=o.attenuationDistance||1/0;const a=o.attenuationColor||[1,1,1];return t.attenuationColor=new at().setRGB(a[0],a[1],a[2],On),Promise.all(r)}}class j3{constructor(e){this.parser=e,this.name=Nt.KHR_MATERIALS_IOR}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:Ys}extendMaterialParams(e,t){const s=this.parser.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=s.extensions[this.name];return t.ior=r.ior!==void 0?r.ior:1.5,Promise.resolve()}}class X3{constructor(e){this.parser=e,this.name=Nt.KHR_MATERIALS_SPECULAR}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:Ys}extendMaterialParams(e,t){const n=this.parser,s=n.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],o=s.extensions[this.name];t.specularIntensity=o.specularFactor!==void 0?o.specularFactor:1,o.specularTexture!==void 0&&r.push(n.assignTexture(t,"specularIntensityMap",o.specularTexture));const a=o.specularColorFactor||[1,1,1];return t.specularColor=new at().setRGB(a[0],a[1],a[2],On),o.specularColorTexture!==void 0&&r.push(n.assignTexture(t,"specularColorMap",o.specularColorTexture,Ft)),Promise.all(r)}}class Y3{constructor(e){this.parser=e,this.name=Nt.EXT_MATERIALS_BUMP}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:Ys}extendMaterialParams(e,t){const n=this.parser,s=n.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],o=s.extensions[this.name];return t.bumpScale=o.bumpFactor!==void 0?o.bumpFactor:1,o.bumpTexture!==void 0&&r.push(n.assignTexture(t,"bumpMap",o.bumpTexture)),Promise.all(r)}}class K3{constructor(e){this.parser=e,this.name=Nt.KHR_MATERIALS_ANISOTROPY}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:Ys}extendMaterialParams(e,t){const n=this.parser,s=n.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],o=s.extensions[this.name];return o.anisotropyStrength!==void 0&&(t.anisotropy=o.anisotropyStrength),o.anisotropyRotation!==void 0&&(t.anisotropyRotation=o.anisotropyRotation),o.anisotropyTexture!==void 0&&r.push(n.assignTexture(t,"anisotropyMap",o.anisotropyTexture)),Promise.all(r)}}class $3{constructor(e){this.parser=e,this.name=Nt.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,n=t.json,s=n.textures[e];if(!s.extensions||!s.extensions[this.name])return null;const r=s.extensions[this.name],o=t.options.ktx2Loader;if(!o){if(n.extensionsRequired&&n.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,r.source,o)}}class J3{constructor(e){this.parser=e,this.name=Nt.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const t=this.name,n=this.parser,s=n.json,r=s.textures[e];if(!r.extensions||!r.extensions[t])return null;const o=r.extensions[t],a=s.images[o.source];let l=n.textureLoader;if(a.uri){const c=n.options.manager.getHandler(a.uri);c!==null&&(l=c)}return this.detectSupport().then(function(c){if(c)return n.loadTextureImage(e,o.source,l);if(s.extensionsRequired&&s.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return n.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}}class Z3{constructor(e){this.parser=e,this.name=Nt.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(e){const t=this.name,n=this.parser,s=n.json,r=s.textures[e];if(!r.extensions||!r.extensions[t])return null;const o=r.extensions[t],a=s.images[o.source];let l=n.textureLoader;if(a.uri){const c=n.options.manager.getHandler(a.uri);c!==null&&(l=c)}return this.detectSupport().then(function(c){if(c)return n.loadTextureImage(e,o.source,l);if(s.extensionsRequired&&s.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return n.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}}class eQ{constructor(e){this.name=Nt.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,n=t.bufferViews[e];if(n.extensions&&n.extensions[this.name]){const s=n.extensions[this.name],r=this.parser.getDependency("buffer",s.buffer),o=this.parser.options.meshoptDecoder;if(!o||!o.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return r.then(function(a){const l=s.byteOffset||0,c=s.byteLength||0,h=s.count,u=s.byteStride,d=new Uint8Array(a,l,c);return o.decodeGltfBufferAsync?o.decodeGltfBufferAsync(h,u,d,s.mode,s.filter).then(function(f){return f.buffer}):o.ready.then(function(){const f=new ArrayBuffer(h*u);return o.decodeGltfBuffer(new Uint8Array(f),h,u,d,s.mode,s.filter),f})})}else return null}}class tQ{constructor(e){this.name=Nt.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){const t=this.parser.json,n=t.nodes[e];if(!n.extensions||!n.extensions[this.name]||n.mesh===void 0)return null;const s=t.meshes[n.mesh];for(const c of s.primitives)if(c.mode!==is.TRIANGLES&&c.mode!==is.TRIANGLE_STRIP&&c.mode!==is.TRIANGLE_FAN&&c.mode!==void 0)return null;const o=n.extensions[this.name].attributes,a=[],l={};for(const c in o)a.push(this.parser.getDependency("accessor",o[c]).then(h=>(l[c]=h,l[c])));return a.length<1?null:(a.push(this.parser.createNodeMesh(e)),Promise.all(a).then(c=>{const h=c.pop(),u=h.isGroup?h.children:[h],d=c[0].count,f=[];for(const p of u){const A=new pt,m=new he,g=new zn,y=new he(1,1,1),_=new C1(p.geometry,p.material,d);for(let v=0;v<d;v++)l.TRANSLATION&&m.fromBufferAttribute(l.TRANSLATION,v),l.ROTATION&&g.fromBufferAttribute(l.ROTATION,v),l.SCALE&&y.fromBufferAttribute(l.SCALE,v),_.setMatrixAt(v,A.compose(m,g,y));for(const v in l)if(v==="_COLOR_0"){const b=l[v];_.instanceColor=new qm(b.array,b.itemSize,b.normalized)}else v!=="TRANSLATION"&&v!=="ROTATION"&&v!=="SCALE"&&p.geometry.setAttribute(v,l[v]);en.prototype.copy.call(_,p),this.parser.assignFinalMaterial(_),f.push(_)}return h.isGroup?(h.clear(),h.add(...f),h):f[0]}))}}const wE="glTF",tc=12,oy={JSON:1313821514,BIN:5130562};class nQ{constructor(e){this.name=Nt.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,tc),n=new TextDecoder;if(this.header={magic:n.decode(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==wE)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const s=this.header.length-tc,r=new DataView(e,tc);let o=0;for(;o<s;){const a=r.getUint32(o,!0);o+=4;const l=r.getUint32(o,!0);if(o+=4,l===oy.JSON){const c=new Uint8Array(e,tc+o,a);this.content=n.decode(c)}else if(l===oy.BIN){const c=tc+o;this.body=e.slice(c,c+a)}o+=a}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class iQ{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=Nt.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const n=this.json,s=this.dracoLoader,r=e.extensions[this.name].bufferView,o=e.extensions[this.name].attributes,a={},l={},c={};for(const h in o){const u=cA[h]||h.toLowerCase();a[u]=o[h]}for(const h in e.attributes){const u=cA[h]||h.toLowerCase();if(o[h]!==void 0){const d=n.accessors[e.attributes[h]],f=hl[d.componentType];c[u]=f.name,l[u]=d.normalized===!0}}return t.getDependency("bufferView",r).then(function(h){return new Promise(function(u,d){s.decodeDracoFile(h,function(f){for(const p in f.attributes){const A=f.attributes[p],m=l[p];m!==void 0&&(A.normalized=m)}u(f)},a,c,On,d)})})}}class sQ{constructor(){this.name=Nt.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return(t.texCoord===void 0||t.texCoord===e.channel)&&t.offset===void 0&&t.rotation===void 0&&t.scale===void 0||(e=e.clone(),t.texCoord!==void 0&&(e.channel=t.texCoord),t.offset!==void 0&&e.offset.fromArray(t.offset),t.rotation!==void 0&&(e.rotation=t.rotation),t.scale!==void 0&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}}class rQ{constructor(){this.name=Nt.KHR_MESH_QUANTIZATION}}class bE extends xh{constructor(e,t,n,s){super(e,t,n,s)}copySampleValue_(e){const t=this.resultBuffer,n=this.sampleValues,s=this.valueSize,r=e*s*3+s;for(let o=0;o!==s;o++)t[o]=n[r+o];return t}interpolate_(e,t,n,s){const r=this.resultBuffer,o=this.sampleValues,a=this.valueSize,l=a*2,c=a*3,h=s-t,u=(n-t)/h,d=u*u,f=d*u,p=e*c,A=p-c,m=-2*f+3*d,g=f-d,y=1-m,_=g-d+u;for(let v=0;v!==a;v++){const b=o[A+v+a],T=o[A+v+l]*h,L=o[p+v+a],I=o[p+v]*h;r[v]=y*b+_*T+m*L+g*I}return r}}const oQ=new zn;class aQ extends bE{interpolate_(e,t,n,s){const r=super.interpolate_(e,t,n,s);return oQ.fromArray(r).normalize().toArray(r),r}}const is={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},hl={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},ay={9728:yi,9729:Zt,9984:yw,9985:Lu,9986:oc,9987:os},ly={33071:Hi,33648:td,10497:lo},Bp={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},cA={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},Or={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},lQ={CUBICSPLINE:void 0,LINEAR:Xc,STEP:jc},Rp={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function cQ(i){return i.DefaultMaterial===void 0&&(i.DefaultMaterial=new gg({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:yr})),i.DefaultMaterial}function To(i,e,t){for(const n in t.extensions)i[n]===void 0&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[n]=t.extensions[n])}function lr(i,e){e.extras!==void 0&&(typeof e.extras=="object"?Object.assign(i.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function hQ(i,e,t){let n=!1,s=!1,r=!1;for(let c=0,h=e.length;c<h;c++){const u=e[c];if(u.POSITION!==void 0&&(n=!0),u.NORMAL!==void 0&&(s=!0),u.COLOR_0!==void 0&&(r=!0),n&&s&&r)break}if(!n&&!s&&!r)return Promise.resolve(i);const o=[],a=[],l=[];for(let c=0,h=e.length;c<h;c++){const u=e[c];if(n){const d=u.POSITION!==void 0?t.getDependency("accessor",u.POSITION):i.attributes.position;o.push(d)}if(s){const d=u.NORMAL!==void 0?t.getDependency("accessor",u.NORMAL):i.attributes.normal;a.push(d)}if(r){const d=u.COLOR_0!==void 0?t.getDependency("accessor",u.COLOR_0):i.attributes.color;l.push(d)}}return Promise.all([Promise.all(o),Promise.all(a),Promise.all(l)]).then(function(c){const h=c[0],u=c[1],d=c[2];return n&&(i.morphAttributes.position=h),s&&(i.morphAttributes.normal=u),r&&(i.morphAttributes.color=d),i.morphTargetsRelative=!0,i})}function uQ(i,e){if(i.updateMorphTargets(),e.weights!==void 0)for(let t=0,n=e.weights.length;t<n;t++)i.morphTargetInfluences[t]=e.weights[t];if(e.extras&&Array.isArray(e.extras.targetNames)){const t=e.extras.targetNames;if(i.morphTargetInfluences.length===t.length){i.morphTargetDictionary={};for(let n=0,s=t.length;n<s;n++)i.morphTargetDictionary[t[n]]=n}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function dQ(i){let e;const t=i.extensions&&i.extensions[Nt.KHR_DRACO_MESH_COMPRESSION];if(t?e="draco:"+t.bufferView+":"+t.indices+":"+Pp(t.attributes):e=i.indices+":"+Pp(i.attributes)+":"+i.mode,i.targets!==void 0)for(let n=0,s=i.targets.length;n<s;n++)e+=":"+Pp(i.targets[n]);return e}function Pp(i){let e="";const t=Object.keys(i).sort();for(let n=0,s=t.length;n<s;n++)e+=t[n]+":"+i[t[n]]+";";return e}function hA(i){switch(i){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function fQ(i){return i.search(/\.jpe?g($|\?)/i)>0||i.search(/^data\:image\/jpeg/)===0?"image/jpeg":i.search(/\.webp($|\?)/i)>0||i.search(/^data\:image\/webp/)===0?"image/webp":i.search(/\.ktx2($|\?)/i)>0||i.search(/^data\:image\/ktx2/)===0?"image/ktx2":"image/png"}const pQ=new pt;class mQ{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new k3,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let n=!1,s=-1,r=!1,o=-1;if(typeof navigator<"u"){const a=navigator.userAgent;n=/^((?!chrome|android).)*safari/i.test(a)===!0;const l=a.match(/Version\/(\d+)/);s=n&&l?parseInt(l[1],10):-1,r=a.indexOf("Firefox")>-1,o=r?a.match(/Firefox\/([0-9]+)\./)[1]:-1}typeof createImageBitmap>"u"||n&&s<17||r&&o<98?this.textureLoader=new vg(this.options.manager):this.textureLoader=new TB(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new ji(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const n=this,s=this.json,r=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(o){return o._markDefs&&o._markDefs()}),Promise.all(this._invokeAll(function(o){return o.beforeRoot&&o.beforeRoot()})).then(function(){return Promise.all([n.getDependencies("scene"),n.getDependencies("animation"),n.getDependencies("camera")])}).then(function(o){const a={scene:o[0][s.scene||0],scenes:o[0],animations:o[1],cameras:o[2],asset:s.asset,parser:n,userData:{}};return To(r,a,s),lr(a,s),Promise.all(n._invokeAll(function(l){return l.afterRoot&&l.afterRoot(a)})).then(function(){for(const l of a.scenes)l.updateMatrixWorld();e(a)})}).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],n=this.json.meshes||[];for(let s=0,r=t.length;s<r;s++){const o=t[s].joints;for(let a=0,l=o.length;a<l;a++)e[o[a]].isBone=!0}for(let s=0,r=e.length;s<r;s++){const o=e[s];o.mesh!==void 0&&(this._addNodeRef(this.meshCache,o.mesh),o.skin!==void 0&&(n[o.mesh].isSkinnedMesh=!0)),o.camera!==void 0&&this._addNodeRef(this.cameraCache,o.camera)}}_addNodeRef(e,t){t!==void 0&&(e.refs[t]===void 0&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,n){if(e.refs[t]<=1)return n;const s=n.clone(),r=(o,a)=>{const l=this.associations.get(o);l!=null&&this.associations.set(a,l);for(const[c,h]of o.children.entries())r(h,a.children[c])};return r(n,s),s.name+="_instance_"+e.uses[t]++,s}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let n=0;n<t.length;n++){const s=e(t[n]);if(s)return s}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const n=[];for(let s=0;s<t.length;s++){const r=e(t[s]);r&&n.push(r)}return n}getDependency(e,t){const n=e+":"+t;let s=this.cache.get(n);if(!s){switch(e){case"scene":s=this.loadScene(t);break;case"node":s=this._invokeOne(function(r){return r.loadNode&&r.loadNode(t)});break;case"mesh":s=this._invokeOne(function(r){return r.loadMesh&&r.loadMesh(t)});break;case"accessor":s=this.loadAccessor(t);break;case"bufferView":s=this._invokeOne(function(r){return r.loadBufferView&&r.loadBufferView(t)});break;case"buffer":s=this.loadBuffer(t);break;case"material":s=this._invokeOne(function(r){return r.loadMaterial&&r.loadMaterial(t)});break;case"texture":s=this._invokeOne(function(r){return r.loadTexture&&r.loadTexture(t)});break;case"skin":s=this.loadSkin(t);break;case"animation":s=this._invokeOne(function(r){return r.loadAnimation&&r.loadAnimation(t)});break;case"camera":s=this.loadCamera(t);break;default:if(s=this._invokeOne(function(r){return r!=this&&r.getDependency&&r.getDependency(e,t)}),!s)throw new Error("Unknown type: "+e);break}this.cache.add(n,s)}return s}getDependencies(e){let t=this.cache.get(e);if(!t){const n=this,s=this.json[e+(e==="mesh"?"es":"s")]||[];t=Promise.all(s.map(function(r,o){return n.getDependency(e,o)})),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],n=this.fileLoader;if(t.type&&t.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(t.uri===void 0&&e===0)return Promise.resolve(this.extensions[Nt.KHR_BINARY_GLTF].body);const s=this.options;return new Promise(function(r,o){n.load(al.resolveURL(t.uri,s.path),r,void 0,function(){o(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(n){const s=t.byteLength||0,r=t.byteOffset||0;return n.slice(r,r+s)})}loadAccessor(e){const t=this,n=this.json,s=this.json.accessors[e];if(s.bufferView===void 0&&s.sparse===void 0){const o=Bp[s.type],a=hl[s.componentType],l=s.normalized===!0,c=new a(s.count*o);return Promise.resolve(new Zn(c,o,l))}const r=[];return s.bufferView!==void 0?r.push(this.getDependency("bufferView",s.bufferView)):r.push(null),s.sparse!==void 0&&(r.push(this.getDependency("bufferView",s.sparse.indices.bufferView)),r.push(this.getDependency("bufferView",s.sparse.values.bufferView))),Promise.all(r).then(function(o){const a=o[0],l=Bp[s.type],c=hl[s.componentType],h=c.BYTES_PER_ELEMENT,u=h*l,d=s.byteOffset||0,f=s.bufferView!==void 0?n.bufferViews[s.bufferView].byteStride:void 0,p=s.normalized===!0;let A,m;if(f&&f!==u){const g=Math.floor(d/f),y="InterleavedBuffer:"+s.bufferView+":"+s.componentType+":"+g+":"+s.count;let _=t.cache.get(y);_||(A=new c(a,g*f,s.count*f/h),_=new x1(A,f/h),t.cache.add(y,_)),m=new dg(_,l,d%f/h,p)}else a===null?A=new c(s.count*l):A=new c(a,d,s.count*l),m=new Zn(A,l,p);if(s.sparse!==void 0){const g=Bp.SCALAR,y=hl[s.sparse.indices.componentType],_=s.sparse.indices.byteOffset||0,v=s.sparse.values.byteOffset||0,b=new y(o[1],_,s.sparse.count*g),T=new c(o[2],v,s.sparse.count*l);a!==null&&(m=new Zn(m.array.slice(),m.itemSize,m.normalized)),m.normalized=!1;for(let L=0,I=b.length;L<I;L++){const x=b[L];if(m.setX(x,T[L*l]),l>=2&&m.setY(x,T[L*l+1]),l>=3&&m.setZ(x,T[L*l+2]),l>=4&&m.setW(x,T[L*l+3]),l>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}m.normalized=p}return m})}loadTexture(e){const t=this.json,n=this.options,r=t.textures[e].source,o=t.images[r];let a=this.textureLoader;if(o.uri){const l=n.manager.getHandler(o.uri);l!==null&&(a=l)}return this.loadTextureImage(e,r,a)}loadTextureImage(e,t,n){const s=this,r=this.json,o=r.textures[e],a=r.images[t],l=(a.uri||a.bufferView)+":"+o.sampler;if(this.textureCache[l])return this.textureCache[l];const c=this.loadImageSource(t,n).then(function(h){h.flipY=!1,h.name=o.name||a.name||"",h.name===""&&typeof a.uri=="string"&&a.uri.startsWith("data:image/")===!1&&(h.name=a.uri);const d=(r.samplers||{})[o.sampler]||{};return h.magFilter=ay[d.magFilter]||Zt,h.minFilter=ay[d.minFilter]||os,h.wrapS=ly[d.wrapS]||lo,h.wrapT=ly[d.wrapT]||lo,h.generateMipmaps=!h.isCompressedTexture&&h.minFilter!==yi&&h.minFilter!==Zt,s.associations.set(h,{textures:e}),h}).catch(function(){return null});return this.textureCache[l]=c,c}loadImageSource(e,t){const n=this,s=this.json,r=this.options;if(this.sourceCache[e]!==void 0)return this.sourceCache[e].then(u=>u.clone());const o=s.images[e],a=self.URL||self.webkitURL;let l=o.uri||"",c=!1;if(o.bufferView!==void 0)l=n.getDependency("bufferView",o.bufferView).then(function(u){c=!0;const d=new Blob([u],{type:o.mimeType});return l=a.createObjectURL(d),l});else if(o.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const h=Promise.resolve(l).then(function(u){return new Promise(function(d,f){let p=d;t.isImageBitmapLoader===!0&&(p=function(A){const m=new Pn(A);m.needsUpdate=!0,d(m)}),t.load(al.resolveURL(u,r.path),p,void 0,f)})}).then(function(u){return c===!0&&a.revokeObjectURL(l),lr(u,o),u.userData.mimeType=o.mimeType||fQ(o.uri),u}).catch(function(u){throw console.error("THREE.GLTFLoader: Couldn't load texture",l),u});return this.sourceCache[e]=h,h}assignTexture(e,t,n,s){const r=this;return this.getDependency("texture",n.index).then(function(o){if(!o)return null;if(n.texCoord!==void 0&&n.texCoord>0&&(o=o.clone(),o.channel=n.texCoord),r.extensions[Nt.KHR_TEXTURE_TRANSFORM]){const a=n.extensions!==void 0?n.extensions[Nt.KHR_TEXTURE_TRANSFORM]:void 0;if(a){const l=r.associations.get(o);o=r.extensions[Nt.KHR_TEXTURE_TRANSFORM].extendTexture(o,a),r.associations.set(o,l)}}return s!==void 0&&(o.colorSpace=s),e[t]=o,o})}assignFinalMaterial(e){const t=e.geometry;let n=e.material;const s=t.attributes.tangent===void 0,r=t.attributes.color!==void 0,o=t.attributes.normal===void 0;if(e.isPoints){const a="PointsMaterial:"+n.uuid;let l=this.cache.get(a);l||(l=new qa,xi.prototype.copy.call(l,n),l.color.copy(n.color),l.map=n.map,l.sizeAttenuation=!1,this.cache.add(a,l)),n=l}else if(e.isLine){const a="LineBasicMaterial:"+n.uuid;let l=this.cache.get(a);l||(l=new no,xi.prototype.copy.call(l,n),l.color.copy(n.color),l.map=n.map,this.cache.add(a,l)),n=l}if(s||r||o){let a="ClonedMaterial:"+n.uuid+":";s&&(a+="derivative-tangents:"),r&&(a+="vertex-colors:"),o&&(a+="flat-shading:");let l=this.cache.get(a);l||(l=n.clone(),r&&(l.vertexColors=!0),o&&(l.flatShading=!0),s&&(l.normalScale&&(l.normalScale.y*=-1),l.clearcoatNormalScale&&(l.clearcoatNormalScale.y*=-1)),this.cache.add(a,l),this.associations.set(l,this.associations.get(n))),n=l}e.material=n}getMaterialType(){return gg}loadMaterial(e){const t=this,n=this.json,s=this.extensions,r=n.materials[e];let o;const a={},l=r.extensions||{},c=[];if(l[Nt.KHR_MATERIALS_UNLIT]){const u=s[Nt.KHR_MATERIALS_UNLIT];o=u.getMaterialType(),c.push(u.extendParams(a,r,t))}else{const u=r.pbrMetallicRoughness||{};if(a.color=new at(1,1,1),a.opacity=1,Array.isArray(u.baseColorFactor)){const d=u.baseColorFactor;a.color.setRGB(d[0],d[1],d[2],On),a.opacity=d[3]}u.baseColorTexture!==void 0&&c.push(t.assignTexture(a,"map",u.baseColorTexture,Ft)),a.metalness=u.metallicFactor!==void 0?u.metallicFactor:1,a.roughness=u.roughnessFactor!==void 0?u.roughnessFactor:1,u.metallicRoughnessTexture!==void 0&&(c.push(t.assignTexture(a,"metalnessMap",u.metallicRoughnessTexture)),c.push(t.assignTexture(a,"roughnessMap",u.metallicRoughnessTexture))),o=this._invokeOne(function(d){return d.getMaterialType&&d.getMaterialType(e)}),c.push(Promise.all(this._invokeAll(function(d){return d.extendMaterialParams&&d.extendMaterialParams(e,a)})))}r.doubleSided===!0&&(a.side=Ns);const h=r.alphaMode||Rp.OPAQUE;if(h===Rp.BLEND?(a.transparent=!0,a.depthWrite=!1):(a.transparent=!1,h===Rp.MASK&&(a.alphaTest=r.alphaCutoff!==void 0?r.alphaCutoff:.5)),r.normalTexture!==void 0&&o!==zo&&(c.push(t.assignTexture(a,"normalMap",r.normalTexture)),a.normalScale=new Me(1,1),r.normalTexture.scale!==void 0)){const u=r.normalTexture.scale;a.normalScale.set(u,u)}if(r.occlusionTexture!==void 0&&o!==zo&&(c.push(t.assignTexture(a,"aoMap",r.occlusionTexture)),r.occlusionTexture.strength!==void 0&&(a.aoMapIntensity=r.occlusionTexture.strength)),r.emissiveFactor!==void 0&&o!==zo){const u=r.emissiveFactor;a.emissive=new at().setRGB(u[0],u[1],u[2],On)}return r.emissiveTexture!==void 0&&o!==zo&&c.push(t.assignTexture(a,"emissiveMap",r.emissiveTexture,Ft)),Promise.all(c).then(function(){const u=new o(a);return r.name&&(u.name=r.name),lr(u,r),t.associations.set(u,{materials:e}),r.extensions&&To(s,u,r),u})}createUniqueName(e){const t=Vt.sanitizeNodeName(e||"");return t in this.nodeNamesUsed?t+"_"+ ++this.nodeNamesUsed[t]:(this.nodeNamesUsed[t]=0,t)}loadGeometries(e){const t=this,n=this.extensions,s=this.primitiveCache;function r(a){return n[Nt.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(a,t).then(function(l){return cy(l,a,t)})}const o=[];for(let a=0,l=e.length;a<l;a++){const c=e[a],h=dQ(c),u=s[h];if(u)o.push(u.promise);else{let d;c.extensions&&c.extensions[Nt.KHR_DRACO_MESH_COMPRESSION]?d=r(c):d=cy(new Nn,c,t),s[h]={primitive:c,promise:d},o.push(d)}}return Promise.all(o)}loadMesh(e){const t=this,n=this.json,s=this.extensions,r=n.meshes[e],o=r.primitives,a=[];for(let l=0,c=o.length;l<c;l++){const h=o[l].material===void 0?cQ(this.cache):this.getDependency("material",o[l].material);a.push(h)}return a.push(t.loadGeometries(o)),Promise.all(a).then(function(l){const c=l.slice(0,l.length-1),h=l[l.length-1],u=[];for(let f=0,p=h.length;f<p;f++){const A=h[f],m=o[f];let g;const y=c[f];if(m.mode===is.TRIANGLES||m.mode===is.TRIANGLE_STRIP||m.mode===is.TRIANGLE_FAN||m.mode===void 0)g=r.isSkinnedMesh===!0?new Ow(A,y):new $n(A,y),g.isSkinnedMesh===!0&&g.normalizeSkinWeights(),m.mode===is.TRIANGLE_STRIP?g.geometry=ry(g.geometry,Mw):m.mode===is.TRIANGLE_FAN&&(g.geometry=ry(g.geometry,Hm));else if(m.mode===is.LINES)g=new Kc(A,y);else if(m.mode===is.LINE_STRIP)g=new Wd(A,y);else if(m.mode===is.LINE_LOOP)g=new M1(A,y);else if(m.mode===is.POINTS)g=new ku(A,y);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+m.mode);Object.keys(g.geometry.morphAttributes).length>0&&uQ(g,r),g.name=t.createUniqueName(r.name||"mesh_"+e),lr(g,r),m.extensions&&To(s,g,m),t.assignFinalMaterial(g),u.push(g)}for(let f=0,p=u.length;f<p;f++)t.associations.set(u[f],{meshes:e,primitives:f});if(u.length===1)return r.extensions&&To(s,u[0],r),u[0];const d=new Wi;r.extensions&&To(s,d,r),t.associations.set(d,{meshes:e});for(let f=0,p=u.length;f<p;f++)d.add(u[f]);return d})}loadCamera(e){let t;const n=this.json.cameras[e],s=n[n.type];if(!s){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return n.type==="perspective"?t=new ai(bn.radToDeg(s.yfov),s.aspectRatio||1,s.znear||1,s.zfar||2e6):n.type==="orthographic"&&(t=new Kd(-s.xmag,s.xmag,s.ymag,-s.ymag,s.znear,s.zfar)),n.name&&(t.name=this.createUniqueName(n.name)),lr(t,n),Promise.resolve(t)}loadSkin(e){const t=this.json.skins[e],n=[];for(let s=0,r=t.joints.length;s<r;s++)n.push(this._loadNodeShallow(t.joints[s]));return t.inverseBindMatrices!==void 0?n.push(this.getDependency("accessor",t.inverseBindMatrices)):n.push(null),Promise.all(n).then(function(s){const r=s.pop(),o=s,a=[],l=[];for(let c=0,h=o.length;c<h;c++){const u=o[c];if(u){a.push(u);const d=new pt;r!==null&&d.fromArray(r.array,c*16),l.push(d)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[c])}return new Hd(a,l)})}loadAnimation(e){const t=this.json,n=this,s=t.animations[e],r=s.name?s.name:"animation_"+e,o=[],a=[],l=[],c=[],h=[];for(let u=0,d=s.channels.length;u<d;u++){const f=s.channels[u],p=s.samplers[f.sampler],A=f.target,m=A.node,g=s.parameters!==void 0?s.parameters[p.input]:p.input,y=s.parameters!==void 0?s.parameters[p.output]:p.output;A.node!==void 0&&(o.push(this.getDependency("node",m)),a.push(this.getDependency("accessor",g)),l.push(this.getDependency("accessor",y)),c.push(p),h.push(A))}return Promise.all([Promise.all(o),Promise.all(a),Promise.all(l),Promise.all(c),Promise.all(h)]).then(function(u){const d=u[0],f=u[1],p=u[2],A=u[3],m=u[4],g=[];for(let y=0,_=d.length;y<_;y++){const v=d[y],b=f[y],T=p[y],L=A[y],I=m[y];if(v===void 0)continue;v.updateMatrix&&v.updateMatrix();const x=n._createAnimationTracks(v,b,T,L,I);if(x)for(let w=0;w<x.length;w++)g.push(x[w])}return new Yw(r,void 0,g)})}createNodeMesh(e){const t=this.json,n=this,s=t.nodes[e];return s.mesh===void 0?null:n.getDependency("mesh",s.mesh).then(function(r){const o=n._getNodeRef(n.meshCache,s.mesh,r);return s.weights!==void 0&&o.traverse(function(a){if(a.isMesh)for(let l=0,c=s.weights.length;l<c;l++)a.morphTargetInfluences[l]=s.weights[l]}),o})}loadNode(e){const t=this.json,n=this,s=t.nodes[e],r=n._loadNodeShallow(e),o=[],a=s.children||[];for(let c=0,h=a.length;c<h;c++)o.push(n.getDependency("node",a[c]));const l=s.skin===void 0?Promise.resolve(null):n.getDependency("skin",s.skin);return Promise.all([r,Promise.all(o),l]).then(function(c){const h=c[0],u=c[1],d=c[2];d!==null&&h.traverse(function(f){f.isSkinnedMesh&&f.bind(d,pQ)});for(let f=0,p=u.length;f<p;f++)h.add(u[f]);return h})}_loadNodeShallow(e){const t=this.json,n=this.extensions,s=this;if(this.nodeCache[e]!==void 0)return this.nodeCache[e];const r=t.nodes[e],o=r.name?s.createUniqueName(r.name):"",a=[],l=s._invokeOne(function(c){return c.createNodeMesh&&c.createNodeMesh(e)});return l&&a.push(l),r.camera!==void 0&&a.push(s.getDependency("camera",r.camera).then(function(c){return s._getNodeRef(s.cameraCache,r.camera,c)})),s._invokeAll(function(c){return c.createNodeAttachment&&c.createNodeAttachment(e)}).forEach(function(c){a.push(c)}),this.nodeCache[e]=Promise.all(a).then(function(c){let h;if(r.isBone===!0?h=new hd:c.length>1?h=new Wi:c.length===1?h=c[0]:h=new en,h!==c[0])for(let u=0,d=c.length;u<d;u++)h.add(c[u]);if(r.name&&(h.userData.name=r.name,h.name=o),lr(h,r),r.extensions&&To(n,h,r),r.matrix!==void 0){const u=new pt;u.fromArray(r.matrix),h.applyMatrix4(u)}else r.translation!==void 0&&h.position.fromArray(r.translation),r.rotation!==void 0&&h.quaternion.fromArray(r.rotation),r.scale!==void 0&&h.scale.fromArray(r.scale);return s.associations.has(h)||s.associations.set(h,{}),s.associations.get(h).nodes=e,h}),this.nodeCache[e]}loadScene(e){const t=this.extensions,n=this.json.scenes[e],s=this,r=new Wi;n.name&&(r.name=s.createUniqueName(n.name)),lr(r,n),n.extensions&&To(t,r,n);const o=n.nodes||[],a=[];for(let l=0,c=o.length;l<c;l++)a.push(s.getDependency("node",o[l]));return Promise.all(a).then(function(l){for(let h=0,u=l.length;h<u;h++)r.add(l[h]);const c=h=>{const u=new Map;for(const[d,f]of s.associations)(d instanceof xi||d instanceof Pn)&&u.set(d,f);return h.traverse(d=>{const f=s.associations.get(d);f!=null&&u.set(d,f)}),u};return s.associations=c(r),r})}_createAnimationTracks(e,t,n,s,r){const o=[],a=e.name?e.name:e.uuid,l=[];Or[r.path]===Or.weights?e.traverse(function(d){d.morphTargetInfluences&&l.push(d.name?d.name:d.uuid)}):l.push(a);let c;switch(Or[r.path]){case Or.weights:c=sa;break;case Or.rotation:c=ho;break;case Or.position:case Or.scale:c=ra;break;default:switch(n.itemSize){case 1:c=sa;break;case 2:case 3:default:c=ra;break}break}const h=s.interpolation!==void 0?lQ[s.interpolation]:Xc,u=this._getArrayFromAccessor(n);for(let d=0,f=l.length;d<f;d++){const p=new c(l[d]+"."+Or[r.path],t.array,u,h);s.interpolation==="CUBICSPLINE"&&this._createCubicSplineTrackInterpolant(p),o.push(p)}return o}_getArrayFromAccessor(e){let t=e.array;if(e.normalized){const n=hA(t.constructor),s=new Float32Array(t.length);for(let r=0,o=t.length;r<o;r++)s[r]=t[r]*n;t=s}return t}_createCubicSplineTrackInterpolant(e){e.createInterpolant=function(n){const s=this instanceof ho?aQ:bE;return new s(this.times,this.values,this.getValueSize()/3,n)},e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function AQ(i,e,t){const n=e.attributes,s=new ps;if(n.POSITION!==void 0){const a=t.json.accessors[n.POSITION],l=a.min,c=a.max;if(l!==void 0&&c!==void 0){if(s.set(new he(l[0],l[1],l[2]),new he(c[0],c[1],c[2])),a.normalized){const h=hA(hl[a.componentType]);s.min.multiplyScalar(h),s.max.multiplyScalar(h)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const r=e.targets;if(r!==void 0){const a=new he,l=new he;for(let c=0,h=r.length;c<h;c++){const u=r[c];if(u.POSITION!==void 0){const d=t.json.accessors[u.POSITION],f=d.min,p=d.max;if(f!==void 0&&p!==void 0){if(l.setX(Math.max(Math.abs(f[0]),Math.abs(p[0]))),l.setY(Math.max(Math.abs(f[1]),Math.abs(p[1]))),l.setZ(Math.max(Math.abs(f[2]),Math.abs(p[2]))),d.normalized){const A=hA(hl[d.componentType]);l.multiplyScalar(A)}a.max(l)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}s.expandByVector(a)}i.boundingBox=s;const o=new Xs;s.getCenter(o.center),o.radius=s.min.distanceTo(s.max)/2,i.boundingSphere=o}function cy(i,e,t){const n=e.attributes,s=[];function r(o,a){return t.getDependency("accessor",o).then(function(l){i.setAttribute(a,l)})}for(const o in n){const a=cA[o]||o.toLowerCase();a in i.attributes||s.push(r(n[o],a))}if(e.indices!==void 0&&!i.index){const o=t.getDependency("accessor",e.indices).then(function(a){i.setIndex(a)});s.push(o)}return St.workingColorSpace!==On&&"COLOR_0"in n&&console.warn('THREE.GLTFLoader: Converting vertex colors from "srgb-linear" to "'.concat(St.workingColorSpace,'" not supported.')),lr(i,e),AQ(i,e,t),Promise.all(s).then(function(){return e.targets!==void 0?hQ(i,e.targets,t):i})}class gQ{constructor(e=4){this.pool=e,this.queue=[],this.workers=[],this.workersResolve=[],this.workerStatus=0}_initWorker(e){if(!this.workers[e]){const t=this.workerCreator();t.addEventListener("message",this._onMessage.bind(this,e)),this.workers[e]=t}}_getIdleWorker(){for(let e=0;e<this.pool;e++)if(!(this.workerStatus&1<<e))return e;return-1}_onMessage(e,t){const n=this.workersResolve[e];if(n&&n(t),this.queue.length){const{resolve:s,msg:r,transfer:o}=this.queue.shift();this.workersResolve[e]=s,this.workers[e].postMessage(r,o)}else this.workerStatus^=1<<e}setWorkerCreator(e){this.workerCreator=e}setWorkerLimit(e){this.pool=e}postMessage(e,t){return new Promise(n=>{const s=this._getIdleWorker();s!==-1?(this._initWorker(s),this.workerStatus|=1<<s,this.workersResolve[s]=n,this.workers[s].postMessage(e,t)):this.queue.push({resolve:n,msg:e,transfer:t})})}dispose(){this.workers.forEach(e=>e.terminate()),this.workersResolve.length=0,this.workers.length=0,this.queue.length=0,this.workerStatus=0}}const vQ=0,hy=2,_Q=1,uy=2,yQ=0,xQ=1,wQ=10,bQ=0,EE=9,CE=15,SE=16,IE=22,ME=37,TE=43,BE=76,RE=83,PE=97,DE=100,LE=103,FE=109,NE=165,kE=166,Zg=1000066e3;class EQ{constructor(){this.vkFormat=0,this.typeSize=1,this.pixelWidth=0,this.pixelHeight=0,this.pixelDepth=0,this.layerCount=0,this.faceCount=1,this.supercompressionScheme=0,this.levels=[],this.dataFormatDescriptor=[{vendorId:0,descriptorType:0,descriptorBlockSize:0,versionNumber:2,colorModel:0,colorPrimaries:1,transferFunction:2,flags:0,texelBlockDimension:[0,0,0,0],bytesPlane:[0,0,0,0,0,0,0,0],samples:[]}],this.keyValue={},this.globalData=null}}class nc{constructor(e,t,n,s){this._dataView=void 0,this._littleEndian=void 0,this._offset=void 0,this._dataView=new DataView(e.buffer,e.byteOffset+t,n),this._littleEndian=s,this._offset=0}_nextUint8(){const e=this._dataView.getUint8(this._offset);return this._offset+=1,e}_nextUint16(){const e=this._dataView.getUint16(this._offset,this._littleEndian);return this._offset+=2,e}_nextUint32(){const e=this._dataView.getUint32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint64(){const e=this._dataView.getUint32(this._offset,this._littleEndian)+4294967296*this._dataView.getUint32(this._offset+4,this._littleEndian);return this._offset+=8,e}_nextInt32(){const e=this._dataView.getInt32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint8Array(e){const t=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._offset,e);return this._offset+=e,t}_skip(e){return this._offset+=e,this}_scan(e,t){t===void 0&&(t=0);const n=this._offset;let s=0;for(;this._dataView.getUint8(this._offset)!==t&&s<e;)s++,this._offset++;return s<e&&this._offset++,new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+n,s)}}const fi=[171,75,84,88,32,50,48,187,13,10,26,10];function dy(i){return new TextDecoder().decode(i)}function CQ(i){const e=new Uint8Array(i.buffer,i.byteOffset,fi.length);if(e[0]!==fi[0]||e[1]!==fi[1]||e[2]!==fi[2]||e[3]!==fi[3]||e[4]!==fi[4]||e[5]!==fi[5]||e[6]!==fi[6]||e[7]!==fi[7]||e[8]!==fi[8]||e[9]!==fi[9]||e[10]!==fi[10]||e[11]!==fi[11])throw new Error("Missing KTX 2.0 identifier.");const t=new EQ,n=17*Uint32Array.BYTES_PER_ELEMENT,s=new nc(i,fi.length,n,!0);t.vkFormat=s._nextUint32(),t.typeSize=s._nextUint32(),t.pixelWidth=s._nextUint32(),t.pixelHeight=s._nextUint32(),t.pixelDepth=s._nextUint32(),t.layerCount=s._nextUint32(),t.faceCount=s._nextUint32();const r=s._nextUint32();t.supercompressionScheme=s._nextUint32();const o=s._nextUint32(),a=s._nextUint32(),l=s._nextUint32(),c=s._nextUint32(),h=s._nextUint64(),u=s._nextUint64(),d=new nc(i,fi.length+n,3*r*8,!0);for(let W=0;W<r;W++)t.levels.push({levelData:new Uint8Array(i.buffer,i.byteOffset+d._nextUint64(),d._nextUint64()),uncompressedByteLength:d._nextUint64()});const f=new nc(i,o,a,!0),p={vendorId:f._skip(4)._nextUint16(),descriptorType:f._nextUint16(),versionNumber:f._nextUint16(),descriptorBlockSize:f._nextUint16(),colorModel:f._nextUint8(),colorPrimaries:f._nextUint8(),transferFunction:f._nextUint8(),flags:f._nextUint8(),texelBlockDimension:[f._nextUint8(),f._nextUint8(),f._nextUint8(),f._nextUint8()],bytesPlane:[f._nextUint8(),f._nextUint8(),f._nextUint8(),f._nextUint8(),f._nextUint8(),f._nextUint8(),f._nextUint8(),f._nextUint8()],samples:[]},A=(p.descriptorBlockSize/4-6)/4;for(let W=0;W<A;W++){const O={bitOffset:f._nextUint16(),bitLength:f._nextUint8(),channelType:f._nextUint8(),samplePosition:[f._nextUint8(),f._nextUint8(),f._nextUint8(),f._nextUint8()],sampleLower:-1/0,sampleUpper:1/0};64&O.channelType?(O.sampleLower=f._nextInt32(),O.sampleUpper=f._nextInt32()):(O.sampleLower=f._nextUint32(),O.sampleUpper=f._nextUint32()),p.samples[W]=O}t.dataFormatDescriptor.length=0,t.dataFormatDescriptor.push(p);const m=new nc(i,l,c,!0);for(;m._offset<c;){const W=m._nextUint32(),O=m._scan(W),fe=dy(O);if(t.keyValue[fe]=m._nextUint8Array(W-O.byteLength-1),fe.match(/^ktx/i)){const ue=dy(t.keyValue[fe]);t.keyValue[fe]=ue.substring(0,ue.lastIndexOf("\0"))}m._skip(W%4?4-W%4:0)}if(u<=0)return t;const g=new nc(i,h,u,!0),y=g._nextUint16(),_=g._nextUint16(),v=g._nextUint32(),b=g._nextUint32(),T=g._nextUint32(),L=g._nextUint32(),I=[];for(let W=0;W<r;W++)I.push({imageFlags:g._nextUint32(),rgbSliceByteOffset:g._nextUint32(),rgbSliceByteLength:g._nextUint32(),alphaSliceByteOffset:g._nextUint32(),alphaSliceByteLength:g._nextUint32()});const x=h+g._offset,w=x+v,P=w+b,z=P+T,H=new Uint8Array(i.buffer,i.byteOffset+x,v),K=new Uint8Array(i.buffer,i.byteOffset+w,b),le=new Uint8Array(i.buffer,i.byteOffset+P,T),J=new Uint8Array(i.buffer,i.byteOffset+z,L);return t.globalData={endpointCount:y,selectorCount:_,imageDescs:I,endpointsData:H,selectorsData:K,tablesData:le,extendedData:J},t}let Dp,or,uA;const Lp={env:{emscripten_notify_memory_growth:function(i){uA=new Uint8Array(or.exports.memory.buffer)}}};class SQ{init(){return Dp||(Dp=typeof fetch<"u"?fetch("data:application/wasm;base64,"+fy).then(e=>e.arrayBuffer()).then(e=>WebAssembly.instantiate(e,Lp)).then(this._init):WebAssembly.instantiate(Buffer.from(fy,"base64"),Lp).then(this._init),Dp)}_init(e){or=e.instance,Lp.env.emscripten_notify_memory_growth(0)}decode(e,t=0){if(!or)throw new Error("ZSTDDecoder: Await .init() before decoding.");const n=e.byteLength,s=or.exports.malloc(n);uA.set(e,s),t=t||Number(or.exports.ZSTD_findDecompressedSize(s,n));const r=or.exports.malloc(t),o=or.exports.ZSTD_decompress(r,t,s,n),a=uA.slice(r,r+o);return or.exports.free(s),or.exports.free(r),a}}const fy="AGFzbQEAAAABpQEVYAF/AX9gAn9/AGADf39/AX9gBX9/f39/AX9gAX8AYAJ/fwF/YAR/f39/AX9gA39/fwBgBn9/f39/fwF/YAd/f39/f39/AX9gAn9/AX5gAn5+AX5gAABgBX9/f39/AGAGf39/f39/AGAIf39/f39/f38AYAl/f39/f39/f38AYAABf2AIf39/f39/f38Bf2ANf39/f39/f39/f39/fwF/YAF/AX4CJwEDZW52H2Vtc2NyaXB0ZW5fbm90aWZ5X21lbW9yeV9ncm93dGgABANpaAEFAAAFAgEFCwACAQABAgIFBQcAAwABDgsBAQcAEhMHAAUBDAQEAAANBwQCAgYCBAgDAwMDBgEACQkHBgICAAYGAgQUBwYGAwIGAAMCAQgBBwUGCgoEEQAEBAEIAwgDBQgDEA8IAAcABAUBcAECAgUEAQCAAgYJAX8BQaCgwAILB2AHBm1lbW9yeQIABm1hbGxvYwAoBGZyZWUAJgxaU1REX2lzRXJyb3IAaBlaU1REX2ZpbmREZWNvbXByZXNzZWRTaXplAFQPWlNURF9kZWNvbXByZXNzAEoGX3N0YXJ0ACQJBwEAQQELASQKussBaA8AIAAgACgCBCABajYCBAsZACAAKAIAIAAoAgRBH3F0QQAgAWtBH3F2CwgAIABBiH9LC34BBH9BAyEBIAAoAgQiA0EgTQRAIAAoAggiASAAKAIQTwRAIAAQDQ8LIAAoAgwiAiABRgRAQQFBAiADQSBJGw8LIAAgASABIAJrIANBA3YiBCABIARrIAJJIgEbIgJrIgQ2AgggACADIAJBA3RrNgIEIAAgBCgAADYCAAsgAQsUAQF/IAAgARACIQIgACABEAEgAgv3AQECfyACRQRAIABCADcCACAAQQA2AhAgAEIANwIIQbh/DwsgACABNgIMIAAgAUEEajYCECACQQRPBEAgACABIAJqIgFBfGoiAzYCCCAAIAMoAAA2AgAgAUF/ai0AACIBBEAgAEEIIAEQFGs2AgQgAg8LIABBADYCBEF/DwsgACABNgIIIAAgAS0AACIDNgIAIAJBfmoiBEEBTQRAIARBAWtFBEAgACABLQACQRB0IANyIgM2AgALIAAgAS0AAUEIdCADajYCAAsgASACakF/ai0AACIBRQRAIABBADYCBEFsDwsgAEEoIAEQFCACQQN0ams2AgQgAgsWACAAIAEpAAA3AAAgACABKQAINwAICy8BAX8gAUECdEGgHWooAgAgACgCAEEgIAEgACgCBGprQR9xdnEhAiAAIAEQASACCyEAIAFCz9bTvtLHq9lCfiAAfEIfiUKHla+vmLbem55/fgsdAQF/IAAoAgggACgCDEYEfyAAKAIEQSBGBUEACwuCBAEDfyACQYDAAE8EQCAAIAEgAhBnIAAPCyAAIAJqIQMCQCAAIAFzQQNxRQRAAkAgAkEBSARAIAAhAgwBCyAAQQNxRQRAIAAhAgwBCyAAIQIDQCACIAEtAAA6AAAgAUEBaiEBIAJBAWoiAiADTw0BIAJBA3ENAAsLAkAgA0F8cSIEQcAASQ0AIAIgBEFAaiIFSw0AA0AgAiABKAIANgIAIAIgASgCBDYCBCACIAEoAgg2AgggAiABKAIMNgIMIAIgASgCEDYCECACIAEoAhQ2AhQgAiABKAIYNgIYIAIgASgCHDYCHCACIAEoAiA2AiAgAiABKAIkNgIkIAIgASgCKDYCKCACIAEoAiw2AiwgAiABKAIwNgIwIAIgASgCNDYCNCACIAEoAjg2AjggAiABKAI8NgI8IAFBQGshASACQUBrIgIgBU0NAAsLIAIgBE8NAQNAIAIgASgCADYCACABQQRqIQEgAkEEaiICIARJDQALDAELIANBBEkEQCAAIQIMAQsgA0F8aiIEIABJBEAgACECDAELIAAhAgNAIAIgAS0AADoAACACIAEtAAE6AAEgAiABLQACOgACIAIgAS0AAzoAAyABQQRqIQEgAkEEaiICIARNDQALCyACIANJBEADQCACIAEtAAA6AAAgAUEBaiEBIAJBAWoiAiADRw0ACwsgAAsMACAAIAEpAAA3AAALQQECfyAAKAIIIgEgACgCEEkEQEEDDwsgACAAKAIEIgJBB3E2AgQgACABIAJBA3ZrIgE2AgggACABKAAANgIAQQALDAAgACABKAIANgAAC/cCAQJ/AkAgACABRg0AAkAgASACaiAASwRAIAAgAmoiBCABSw0BCyAAIAEgAhALDwsgACABc0EDcSEDAkACQCAAIAFJBEAgAwRAIAAhAwwDCyAAQQNxRQRAIAAhAwwCCyAAIQMDQCACRQ0EIAMgAS0AADoAACABQQFqIQEgAkF/aiECIANBAWoiA0EDcQ0ACwwBCwJAIAMNACAEQQNxBEADQCACRQ0FIAAgAkF/aiICaiIDIAEgAmotAAA6AAAgA0EDcQ0ACwsgAkEDTQ0AA0AgACACQXxqIgJqIAEgAmooAgA2AgAgAkEDSw0ACwsgAkUNAgNAIAAgAkF/aiICaiABIAJqLQAAOgAAIAINAAsMAgsgAkEDTQ0AIAIhBANAIAMgASgCADYCACABQQRqIQEgA0EEaiEDIARBfGoiBEEDSw0ACyACQQNxIQILIAJFDQADQCADIAEtAAA6AAAgA0EBaiEDIAFBAWohASACQX9qIgINAAsLIAAL8wICAn8BfgJAIAJFDQAgACACaiIDQX9qIAE6AAAgACABOgAAIAJBA0kNACADQX5qIAE6AAAgACABOgABIANBfWogAToAACAAIAE6AAIgAkEHSQ0AIANBfGogAToAACAAIAE6AAMgAkEJSQ0AIABBACAAa0EDcSIEaiIDIAFB/wFxQYGChAhsIgE2AgAgAyACIARrQXxxIgRqIgJBfGogATYCACAEQQlJDQAgAyABNgIIIAMgATYCBCACQXhqIAE2AgAgAkF0aiABNgIAIARBGUkNACADIAE2AhggAyABNgIUIAMgATYCECADIAE2AgwgAkFwaiABNgIAIAJBbGogATYCACACQWhqIAE2AgAgAkFkaiABNgIAIAQgA0EEcUEYciIEayICQSBJDQAgAa0iBUIghiAFhCEFIAMgBGohAQNAIAEgBTcDGCABIAU3AxAgASAFNwMIIAEgBTcDACABQSBqIQEgAkFgaiICQR9LDQALCyAACy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAIajYCACADCy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAFajYCACADCx8AIAAgASACKAIEEAg2AgAgARAEGiAAIAJBCGo2AgQLCAAgAGdBH3MLugUBDX8jAEEQayIKJAACfyAEQQNNBEAgCkEANgIMIApBDGogAyAEEAsaIAAgASACIApBDGpBBBAVIgBBbCAAEAMbIAAgACAESxsMAQsgAEEAIAEoAgBBAXRBAmoQECENQVQgAygAACIGQQ9xIgBBCksNABogAiAAQQVqNgIAIAMgBGoiAkF8aiEMIAJBeWohDiACQXtqIRAgAEEGaiELQQQhBSAGQQR2IQRBICAAdCIAQQFyIQkgASgCACEPQQAhAiADIQYCQANAIAlBAkggAiAPS3JFBEAgAiEHAkAgCARAA0AgBEH//wNxQf//A0YEQCAHQRhqIQcgBiAQSQR/IAZBAmoiBigAACAFdgUgBUEQaiEFIARBEHYLIQQMAQsLA0AgBEEDcSIIQQNGBEAgBUECaiEFIARBAnYhBCAHQQNqIQcMAQsLIAcgCGoiByAPSw0EIAVBAmohBQNAIAIgB0kEQCANIAJBAXRqQQA7AQAgAkEBaiECDAELCyAGIA5LQQAgBiAFQQN1aiIHIAxLG0UEQCAHKAAAIAVBB3EiBXYhBAwCCyAEQQJ2IQQLIAYhBwsCfyALQX9qIAQgAEF/anEiBiAAQQF0QX9qIgggCWsiEUkNABogBCAIcSIEQQAgESAEIABIG2shBiALCyEIIA0gAkEBdGogBkF/aiIEOwEAIAlBASAGayAEIAZBAUgbayEJA0AgCSAASARAIABBAXUhACALQX9qIQsMAQsLAn8gByAOS0EAIAcgBSAIaiIFQQN1aiIGIAxLG0UEQCAFQQdxDAELIAUgDCIGIAdrQQN0awshBSACQQFqIQIgBEUhCCAGKAAAIAVBH3F2IQQMAQsLQWwgCUEBRyAFQSBKcg0BGiABIAJBf2o2AgAgBiAFQQdqQQN1aiADawwBC0FQCyEAIApBEGokACAACwkAQQFBBSAAGwsMACAAIAEoAAA2AAALqgMBCn8jAEHwAGsiCiQAIAJBAWohDiAAQQhqIQtBgIAEIAVBf2p0QRB1IQxBACECQQEhBkEBIAV0IglBf2oiDyEIA0AgAiAORkUEQAJAIAEgAkEBdCINai8BACIHQf//A0YEQCALIAhBA3RqIAI2AgQgCEF/aiEIQQEhBwwBCyAGQQAgDCAHQRB0QRB1ShshBgsgCiANaiAHOwEAIAJBAWohAgwBCwsgACAFNgIEIAAgBjYCACAJQQN2IAlBAXZqQQNqIQxBACEAQQAhBkEAIQIDQCAGIA5GBEADQAJAIAAgCUYNACAKIAsgAEEDdGoiASgCBCIGQQF0aiICIAIvAQAiAkEBajsBACABIAUgAhAUayIIOgADIAEgAiAIQf8BcXQgCWs7AQAgASAEIAZBAnQiAmooAgA6AAIgASACIANqKAIANgIEIABBAWohAAwBCwsFIAEgBkEBdGouAQAhDUEAIQcDQCAHIA1ORQRAIAsgAkEDdGogBjYCBANAIAIgDGogD3EiAiAISw0ACyAHQQFqIQcMAQsLIAZBAWohBgwBCwsgCkHwAGokAAsjAEIAIAEQCSAAhUKHla+vmLbem55/fkLj3MqV/M7y9YV/fAsQACAAQn43AwggACABNgIACyQBAX8gAARAIAEoAgQiAgRAIAEoAgggACACEQEADwsgABAmCwsfACAAIAEgAi8BABAINgIAIAEQBBogACACQQRqNgIEC0oBAX9BoCAoAgAiASAAaiIAQX9MBEBBiCBBMDYCAEF/DwsCQCAAPwBBEHRNDQAgABBmDQBBiCBBMDYCAEF/DwtBoCAgADYCACABC9cBAQh/Qbp/IQoCQCACKAIEIgggAigCACIJaiIOIAEgAGtLDQBBbCEKIAkgBCADKAIAIgtrSw0AIAAgCWoiBCACKAIIIgxrIQ0gACABQWBqIg8gCyAJQQAQKSADIAkgC2o2AgACQAJAIAwgBCAFa00EQCANIQUMAQsgDCAEIAZrSw0CIAcgDSAFayIAaiIBIAhqIAdNBEAgBCABIAgQDxoMAgsgBCABQQAgAGsQDyEBIAIgACAIaiIINgIEIAEgAGshBAsgBCAPIAUgCEEBECkLIA4hCgsgCgubAgEBfyMAQYABayINJAAgDSADNgJ8AkAgAkEDSwRAQX8hCQwBCwJAAkACQAJAIAJBAWsOAwADAgELIAZFBEBBuH8hCQwEC0FsIQkgBS0AACICIANLDQMgACAHIAJBAnQiAmooAgAgAiAIaigCABA7IAEgADYCAEEBIQkMAwsgASAJNgIAQQAhCQwCCyAKRQRAQWwhCQwCC0EAIQkgC0UgDEEZSHINAUEIIAR0QQhqIQBBACECA0AgAiAATw0CIAJBQGshAgwAAAsAC0FsIQkgDSANQfwAaiANQfgAaiAFIAYQFSICEAMNACANKAJ4IgMgBEsNACAAIA0gDSgCfCAHIAggAxAYIAEgADYCACACIQkLIA1BgAFqJAAgCQsLACAAIAEgAhALGgsQACAALwAAIAAtAAJBEHRyCy8AAn9BuH8gAUEISQ0AGkFyIAAoAAQiAEF3Sw0AGkG4fyAAQQhqIgAgACABSxsLCwkAIAAgATsAAAsDAAELigYBBX8gACAAKAIAIgVBfnE2AgBBACAAIAVBAXZqQYQgKAIAIgQgAEYbIQECQAJAIAAoAgQiAkUNACACKAIAIgNBAXENACACQQhqIgUgA0EBdkF4aiIDQQggA0EISxtnQR9zQQJ0QYAfaiIDKAIARgRAIAMgAigCDDYCAAsgAigCCCIDBEAgAyACKAIMNgIECyACKAIMIgMEQCADIAIoAgg2AgALIAIgAigCACAAKAIAQX5xajYCAEGEICEAAkACQCABRQ0AIAEgAjYCBCABKAIAIgNBAXENASADQQF2QXhqIgNBCCADQQhLG2dBH3NBAnRBgB9qIgMoAgAgAUEIakYEQCADIAEoAgw2AgALIAEoAggiAwRAIAMgASgCDDYCBAsgASgCDCIDBEAgAyABKAIINgIAQYQgKAIAIQQLIAIgAigCACABKAIAQX5xajYCACABIARGDQAgASABKAIAQQF2akEEaiEACyAAIAI2AgALIAIoAgBBAXZBeGoiAEEIIABBCEsbZ0Efc0ECdEGAH2oiASgCACEAIAEgBTYCACACIAA2AgwgAkEANgIIIABFDQEgACAFNgIADwsCQCABRQ0AIAEoAgAiAkEBcQ0AIAJBAXZBeGoiAkEIIAJBCEsbZ0Efc0ECdEGAH2oiAigCACABQQhqRgRAIAIgASgCDDYCAAsgASgCCCICBEAgAiABKAIMNgIECyABKAIMIgIEQCACIAEoAgg2AgBBhCAoAgAhBAsgACAAKAIAIAEoAgBBfnFqIgI2AgACQCABIARHBEAgASABKAIAQQF2aiAANgIEIAAoAgAhAgwBC0GEICAANgIACyACQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgIoAgAhASACIABBCGoiAjYCACAAIAE2AgwgAEEANgIIIAFFDQEgASACNgIADwsgBUEBdkF4aiIBQQggAUEISxtnQR9zQQJ0QYAfaiICKAIAIQEgAiAAQQhqIgI2AgAgACABNgIMIABBADYCCCABRQ0AIAEgAjYCAAsLDgAgAARAIABBeGoQJQsLgAIBA38CQCAAQQ9qQXhxQYQgKAIAKAIAQQF2ayICEB1Bf0YNAAJAQYQgKAIAIgAoAgAiAUEBcQ0AIAFBAXZBeGoiAUEIIAFBCEsbZ0Efc0ECdEGAH2oiASgCACAAQQhqRgRAIAEgACgCDDYCAAsgACgCCCIBBEAgASAAKAIMNgIECyAAKAIMIgFFDQAgASAAKAIINgIAC0EBIQEgACAAKAIAIAJBAXRqIgI2AgAgAkEBcQ0AIAJBAXZBeGoiAkEIIAJBCEsbZ0Efc0ECdEGAH2oiAygCACECIAMgAEEIaiIDNgIAIAAgAjYCDCAAQQA2AgggAkUNACACIAM2AgALIAELtwIBA38CQAJAIABBASAAGyICEDgiAA0AAkACQEGEICgCACIARQ0AIAAoAgAiA0EBcQ0AIAAgA0EBcjYCACADQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgEoAgAgAEEIakYEQCABIAAoAgw2AgALIAAoAggiAQRAIAEgACgCDDYCBAsgACgCDCIBBEAgASAAKAIINgIACyACECchAkEAIQFBhCAoAgAhACACDQEgACAAKAIAQX5xNgIAQQAPCyACQQ9qQXhxIgMQHSICQX9GDQIgAkEHakF4cSIAIAJHBEAgACACaxAdQX9GDQMLAkBBhCAoAgAiAUUEQEGAICAANgIADAELIAAgATYCBAtBhCAgADYCACAAIANBAXRBAXI2AgAMAQsgAEUNAQsgAEEIaiEBCyABC7kDAQJ/IAAgA2ohBQJAIANBB0wEQANAIAAgBU8NAiAAIAItAAA6AAAgAEEBaiEAIAJBAWohAgwAAAsACyAEQQFGBEACQCAAIAJrIgZBB00EQCAAIAItAAA6AAAgACACLQABOgABIAAgAi0AAjoAAiAAIAItAAM6AAMgAEEEaiACIAZBAnQiBkHAHmooAgBqIgIQFyACIAZB4B5qKAIAayECDAELIAAgAhAMCyACQQhqIQIgAEEIaiEACwJAAkACQAJAIAUgAU0EQCAAIANqIQEgBEEBRyAAIAJrQQ9Kcg0BA0AgACACEAwgAkEIaiECIABBCGoiACABSQ0ACwwFCyAAIAFLBEAgACEBDAQLIARBAUcgACACa0EPSnINASAAIQMgAiEEA0AgAyAEEAwgBEEIaiEEIANBCGoiAyABSQ0ACwwCCwNAIAAgAhAHIAJBEGohAiAAQRBqIgAgAUkNAAsMAwsgACEDIAIhBANAIAMgBBAHIARBEGohBCADQRBqIgMgAUkNAAsLIAIgASAAa2ohAgsDQCABIAVPDQEgASACLQAAOgAAIAFBAWohASACQQFqIQIMAAALAAsLQQECfyAAIAAoArjgASIDNgLE4AEgACgCvOABIQQgACABNgK84AEgACABIAJqNgK44AEgACABIAQgA2tqNgLA4AELpgEBAX8gACAAKALs4QEQFjYCyOABIABCADcD+OABIABCADcDuOABIABBwOABakIANwMAIABBqNAAaiIBQYyAgOAANgIAIABBADYCmOIBIABCADcDiOEBIABCAzcDgOEBIABBrNABakHgEikCADcCACAAQbTQAWpB6BIoAgA2AgAgACABNgIMIAAgAEGYIGo2AgggACAAQaAwajYCBCAAIABBEGo2AgALYQEBf0G4fyEDAkAgAUEDSQ0AIAIgABAhIgFBA3YiADYCCCACIAFBAXE2AgQgAiABQQF2QQNxIgM2AgACQCADQX9qIgFBAksNAAJAIAFBAWsOAgEAAgtBbA8LIAAhAwsgAwsMACAAIAEgAkEAEC4LiAQCA38CfiADEBYhBCAAQQBBKBAQIQAgBCACSwRAIAQPCyABRQRAQX8PCwJAAkAgA0EBRg0AIAEoAAAiBkGo6r5pRg0AQXYhAyAGQXBxQdDUtMIBRw0BQQghAyACQQhJDQEgAEEAQSgQECEAIAEoAAQhASAAQQE2AhQgACABrTcDAEEADwsgASACIAMQLyIDIAJLDQAgACADNgIYQXIhAyABIARqIgVBf2otAAAiAkEIcQ0AIAJBIHEiBkUEQEFwIQMgBS0AACIFQacBSw0BIAVBB3GtQgEgBUEDdkEKaq2GIgdCA4h+IAd8IQggBEEBaiEECyACQQZ2IQMgAkECdiEFAkAgAkEDcUF/aiICQQJLBEBBACECDAELAkACQAJAIAJBAWsOAgECAAsgASAEai0AACECIARBAWohBAwCCyABIARqLwAAIQIgBEECaiEEDAELIAEgBGooAAAhAiAEQQRqIQQLIAVBAXEhBQJ+AkACQAJAIANBf2oiA0ECTQRAIANBAWsOAgIDAQtCfyAGRQ0DGiABIARqMQAADAMLIAEgBGovAACtQoACfAwCCyABIARqKAAArQwBCyABIARqKQAACyEHIAAgBTYCICAAIAI2AhwgACAHNwMAQQAhAyAAQQA2AhQgACAHIAggBhsiBzcDCCAAIAdCgIAIIAdCgIAIVBs+AhALIAMLWwEBf0G4fyEDIAIQFiICIAFNBH8gACACakF/ai0AACIAQQNxQQJ0QaAeaigCACACaiAAQQZ2IgFBAnRBsB5qKAIAaiAAQSBxIgBFaiABRSAAQQV2cWoFQbh/CwsdACAAKAKQ4gEQWiAAQQA2AqDiASAAQgA3A5DiAQu1AwEFfyMAQZACayIKJABBuH8hBgJAIAVFDQAgBCwAACIIQf8BcSEHAkAgCEF/TARAIAdBgn9qQQF2IgggBU8NAkFsIQYgB0GBf2oiBUGAAk8NAiAEQQFqIQdBACEGA0AgBiAFTwRAIAUhBiAIIQcMAwUgACAGaiAHIAZBAXZqIgQtAABBBHY6AAAgACAGQQFyaiAELQAAQQ9xOgAAIAZBAmohBgwBCwAACwALIAcgBU8NASAAIARBAWogByAKEFMiBhADDQELIAYhBEEAIQYgAUEAQTQQECEJQQAhBQNAIAQgBkcEQCAAIAZqIggtAAAiAUELSwRAQWwhBgwDBSAJIAFBAnRqIgEgASgCAEEBajYCACAGQQFqIQZBASAILQAAdEEBdSAFaiEFDAILAAsLQWwhBiAFRQ0AIAUQFEEBaiIBQQxLDQAgAyABNgIAQQFBASABdCAFayIDEBQiAXQgA0cNACAAIARqIAFBAWoiADoAACAJIABBAnRqIgAgACgCAEEBajYCACAJKAIEIgBBAkkgAEEBcXINACACIARBAWo2AgAgB0EBaiEGCyAKQZACaiQAIAYLxhEBDH8jAEHwAGsiBSQAQWwhCwJAIANBCkkNACACLwAAIQogAi8AAiEJIAIvAAQhByAFQQhqIAQQDgJAIAMgByAJIApqakEGaiIMSQ0AIAUtAAohCCAFQdgAaiACQQZqIgIgChAGIgsQAw0BIAVBQGsgAiAKaiICIAkQBiILEAMNASAFQShqIAIgCWoiAiAHEAYiCxADDQEgBUEQaiACIAdqIAMgDGsQBiILEAMNASAAIAFqIg9BfWohECAEQQRqIQZBASELIAAgAUEDakECdiIDaiIMIANqIgIgA2oiDiEDIAIhBCAMIQcDQCALIAMgEElxBEAgACAGIAVB2ABqIAgQAkECdGoiCS8BADsAACAFQdgAaiAJLQACEAEgCS0AAyELIAcgBiAFQUBrIAgQAkECdGoiCS8BADsAACAFQUBrIAktAAIQASAJLQADIQogBCAGIAVBKGogCBACQQJ0aiIJLwEAOwAAIAVBKGogCS0AAhABIAktAAMhCSADIAYgBUEQaiAIEAJBAnRqIg0vAQA7AAAgBUEQaiANLQACEAEgDS0AAyENIAAgC2oiCyAGIAVB2ABqIAgQAkECdGoiAC8BADsAACAFQdgAaiAALQACEAEgAC0AAyEAIAcgCmoiCiAGIAVBQGsgCBACQQJ0aiIHLwEAOwAAIAVBQGsgBy0AAhABIActAAMhByAEIAlqIgkgBiAFQShqIAgQAkECdGoiBC8BADsAACAFQShqIAQtAAIQASAELQADIQQgAyANaiIDIAYgBUEQaiAIEAJBAnRqIg0vAQA7AAAgBUEQaiANLQACEAEgACALaiEAIAcgCmohByAEIAlqIQQgAyANLQADaiEDIAVB2ABqEA0gBUFAaxANciAFQShqEA1yIAVBEGoQDXJFIQsMAQsLIAQgDksgByACS3INAEFsIQsgACAMSw0BIAxBfWohCQNAQQAgACAJSSAFQdgAahAEGwRAIAAgBiAFQdgAaiAIEAJBAnRqIgovAQA7AAAgBUHYAGogCi0AAhABIAAgCi0AA2oiACAGIAVB2ABqIAgQAkECdGoiCi8BADsAACAFQdgAaiAKLQACEAEgACAKLQADaiEADAEFIAxBfmohCgNAIAVB2ABqEAQgACAKS3JFBEAgACAGIAVB2ABqIAgQAkECdGoiCS8BADsAACAFQdgAaiAJLQACEAEgACAJLQADaiEADAELCwNAIAAgCk0EQCAAIAYgBUHYAGogCBACQQJ0aiIJLwEAOwAAIAVB2ABqIAktAAIQASAAIAktAANqIQAMAQsLAkAgACAMTw0AIAAgBiAFQdgAaiAIEAIiAEECdGoiDC0AADoAACAMLQADQQFGBEAgBUHYAGogDC0AAhABDAELIAUoAlxBH0sNACAFQdgAaiAGIABBAnRqLQACEAEgBSgCXEEhSQ0AIAVBIDYCXAsgAkF9aiEMA0BBACAHIAxJIAVBQGsQBBsEQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiIAIAYgBUFAayAIEAJBAnRqIgcvAQA7AAAgBUFAayAHLQACEAEgACAHLQADaiEHDAEFIAJBfmohDANAIAVBQGsQBCAHIAxLckUEQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiEHDAELCwNAIAcgDE0EQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiEHDAELCwJAIAcgAk8NACAHIAYgBUFAayAIEAIiAEECdGoiAi0AADoAACACLQADQQFGBEAgBUFAayACLQACEAEMAQsgBSgCREEfSw0AIAVBQGsgBiAAQQJ0ai0AAhABIAUoAkRBIUkNACAFQSA2AkQLIA5BfWohAgNAQQAgBCACSSAFQShqEAQbBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2oiACAGIAVBKGogCBACQQJ0aiIELwEAOwAAIAVBKGogBC0AAhABIAAgBC0AA2ohBAwBBSAOQX5qIQIDQCAFQShqEAQgBCACS3JFBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2ohBAwBCwsDQCAEIAJNBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2ohBAwBCwsCQCAEIA5PDQAgBCAGIAVBKGogCBACIgBBAnRqIgItAAA6AAAgAi0AA0EBRgRAIAVBKGogAi0AAhABDAELIAUoAixBH0sNACAFQShqIAYgAEECdGotAAIQASAFKAIsQSFJDQAgBUEgNgIsCwNAQQAgAyAQSSAFQRBqEAQbBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2oiACAGIAVBEGogCBACQQJ0aiICLwEAOwAAIAVBEGogAi0AAhABIAAgAi0AA2ohAwwBBSAPQX5qIQIDQCAFQRBqEAQgAyACS3JFBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2ohAwwBCwsDQCADIAJNBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2ohAwwBCwsCQCADIA9PDQAgAyAGIAVBEGogCBACIgBBAnRqIgItAAA6AAAgAi0AA0EBRgRAIAVBEGogAi0AAhABDAELIAUoAhRBH0sNACAFQRBqIAYgAEECdGotAAIQASAFKAIUQSFJDQAgBUEgNgIUCyABQWwgBUHYAGoQCiAFQUBrEApxIAVBKGoQCnEgBUEQahAKcRshCwwJCwAACwALAAALAAsAAAsACwAACwALQWwhCwsgBUHwAGokACALC7UEAQ5/IwBBEGsiBiQAIAZBBGogABAOQVQhBQJAIARB3AtJDQAgBi0ABCEHIANB8ARqQQBB7AAQECEIIAdBDEsNACADQdwJaiIJIAggBkEIaiAGQQxqIAEgAhAxIhAQA0UEQCAGKAIMIgQgB0sNASADQdwFaiEPIANBpAVqIREgAEEEaiESIANBqAVqIQEgBCEFA0AgBSICQX9qIQUgCCACQQJ0aigCAEUNAAsgAkEBaiEOQQEhBQNAIAUgDk9FBEAgCCAFQQJ0IgtqKAIAIQwgASALaiAKNgIAIAVBAWohBSAKIAxqIQoMAQsLIAEgCjYCAEEAIQUgBigCCCELA0AgBSALRkUEQCABIAUgCWotAAAiDEECdGoiDSANKAIAIg1BAWo2AgAgDyANQQF0aiINIAw6AAEgDSAFOgAAIAVBAWohBQwBCwtBACEBIANBADYCqAUgBEF/cyAHaiEJQQEhBQNAIAUgDk9FBEAgCCAFQQJ0IgtqKAIAIQwgAyALaiABNgIAIAwgBSAJanQgAWohASAFQQFqIQUMAQsLIAcgBEEBaiIBIAJrIgRrQQFqIQgDQEEBIQUgBCAIT0UEQANAIAUgDk9FBEAgBUECdCIJIAMgBEE0bGpqIAMgCWooAgAgBHY2AgAgBUEBaiEFDAELCyAEQQFqIQQMAQsLIBIgByAPIAogESADIAIgARBkIAZBAToABSAGIAc6AAYgACAGKAIENgIACyAQIQULIAZBEGokACAFC8ENAQt/IwBB8ABrIgUkAEFsIQkCQCADQQpJDQAgAi8AACEKIAIvAAIhDCACLwAEIQYgBUEIaiAEEA4CQCADIAYgCiAMampBBmoiDUkNACAFLQAKIQcgBUHYAGogAkEGaiICIAoQBiIJEAMNASAFQUBrIAIgCmoiAiAMEAYiCRADDQEgBUEoaiACIAxqIgIgBhAGIgkQAw0BIAVBEGogAiAGaiADIA1rEAYiCRADDQEgACABaiIOQX1qIQ8gBEEEaiEGQQEhCSAAIAFBA2pBAnYiAmoiCiACaiIMIAJqIg0hAyAMIQQgCiECA0AgCSADIA9JcQRAIAYgBUHYAGogBxACQQF0aiIILQAAIQsgBUHYAGogCC0AARABIAAgCzoAACAGIAVBQGsgBxACQQF0aiIILQAAIQsgBUFAayAILQABEAEgAiALOgAAIAYgBUEoaiAHEAJBAXRqIggtAAAhCyAFQShqIAgtAAEQASAEIAs6AAAgBiAFQRBqIAcQAkEBdGoiCC0AACELIAVBEGogCC0AARABIAMgCzoAACAGIAVB2ABqIAcQAkEBdGoiCC0AACELIAVB2ABqIAgtAAEQASAAIAs6AAEgBiAFQUBrIAcQAkEBdGoiCC0AACELIAVBQGsgCC0AARABIAIgCzoAASAGIAVBKGogBxACQQF0aiIILQAAIQsgBUEoaiAILQABEAEgBCALOgABIAYgBUEQaiAHEAJBAXRqIggtAAAhCyAFQRBqIAgtAAEQASADIAs6AAEgA0ECaiEDIARBAmohBCACQQJqIQIgAEECaiEAIAkgBUHYAGoQDUVxIAVBQGsQDUVxIAVBKGoQDUVxIAVBEGoQDUVxIQkMAQsLIAQgDUsgAiAMS3INAEFsIQkgACAKSw0BIApBfWohCQNAIAVB2ABqEAQgACAJT3JFBEAgBiAFQdgAaiAHEAJBAXRqIggtAAAhCyAFQdgAaiAILQABEAEgACALOgAAIAYgBUHYAGogBxACQQF0aiIILQAAIQsgBUHYAGogCC0AARABIAAgCzoAASAAQQJqIQAMAQsLA0AgBUHYAGoQBCAAIApPckUEQCAGIAVB2ABqIAcQAkEBdGoiCS0AACEIIAVB2ABqIAktAAEQASAAIAg6AAAgAEEBaiEADAELCwNAIAAgCkkEQCAGIAVB2ABqIAcQAkEBdGoiCS0AACEIIAVB2ABqIAktAAEQASAAIAg6AAAgAEEBaiEADAELCyAMQX1qIQADQCAFQUBrEAQgAiAAT3JFBEAgBiAFQUBrIAcQAkEBdGoiCi0AACEJIAVBQGsgCi0AARABIAIgCToAACAGIAVBQGsgBxACQQF0aiIKLQAAIQkgBUFAayAKLQABEAEgAiAJOgABIAJBAmohAgwBCwsDQCAFQUBrEAQgAiAMT3JFBEAgBiAFQUBrIAcQAkEBdGoiAC0AACEKIAVBQGsgAC0AARABIAIgCjoAACACQQFqIQIMAQsLA0AgAiAMSQRAIAYgBUFAayAHEAJBAXRqIgAtAAAhCiAFQUBrIAAtAAEQASACIAo6AAAgAkEBaiECDAELCyANQX1qIQADQCAFQShqEAQgBCAAT3JFBEAgBiAFQShqIAcQAkEBdGoiAi0AACEKIAVBKGogAi0AARABIAQgCjoAACAGIAVBKGogBxACQQF0aiICLQAAIQogBUEoaiACLQABEAEgBCAKOgABIARBAmohBAwBCwsDQCAFQShqEAQgBCANT3JFBEAgBiAFQShqIAcQAkEBdGoiAC0AACECIAVBKGogAC0AARABIAQgAjoAACAEQQFqIQQMAQsLA0AgBCANSQRAIAYgBUEoaiAHEAJBAXRqIgAtAAAhAiAFQShqIAAtAAEQASAEIAI6AAAgBEEBaiEEDAELCwNAIAVBEGoQBCADIA9PckUEQCAGIAVBEGogBxACQQF0aiIALQAAIQIgBUEQaiAALQABEAEgAyACOgAAIAYgBUEQaiAHEAJBAXRqIgAtAAAhAiAFQRBqIAAtAAEQASADIAI6AAEgA0ECaiEDDAELCwNAIAVBEGoQBCADIA5PckUEQCAGIAVBEGogBxACQQF0aiIALQAAIQIgBUEQaiAALQABEAEgAyACOgAAIANBAWohAwwBCwsDQCADIA5JBEAgBiAFQRBqIAcQAkEBdGoiAC0AACECIAVBEGogAC0AARABIAMgAjoAACADQQFqIQMMAQsLIAFBbCAFQdgAahAKIAVBQGsQCnEgBUEoahAKcSAFQRBqEApxGyEJDAELQWwhCQsgBUHwAGokACAJC8oCAQR/IwBBIGsiBSQAIAUgBBAOIAUtAAIhByAFQQhqIAIgAxAGIgIQA0UEQCAEQQRqIQIgACABaiIDQX1qIQQDQCAFQQhqEAQgACAET3JFBEAgAiAFQQhqIAcQAkEBdGoiBi0AACEIIAVBCGogBi0AARABIAAgCDoAACACIAVBCGogBxACQQF0aiIGLQAAIQggBUEIaiAGLQABEAEgACAIOgABIABBAmohAAwBCwsDQCAFQQhqEAQgACADT3JFBEAgAiAFQQhqIAcQAkEBdGoiBC0AACEGIAVBCGogBC0AARABIAAgBjoAACAAQQFqIQAMAQsLA0AgACADT0UEQCACIAVBCGogBxACQQF0aiIELQAAIQYgBUEIaiAELQABEAEgACAGOgAAIABBAWohAAwBCwsgAUFsIAVBCGoQChshAgsgBUEgaiQAIAILtgMBCX8jAEEQayIGJAAgBkEANgIMIAZBADYCCEFUIQQCQAJAIANBQGsiDCADIAZBCGogBkEMaiABIAIQMSICEAMNACAGQQRqIAAQDiAGKAIMIgcgBi0ABEEBaksNASAAQQRqIQogBkEAOgAFIAYgBzoABiAAIAYoAgQ2AgAgB0EBaiEJQQEhBANAIAQgCUkEQCADIARBAnRqIgEoAgAhACABIAU2AgAgACAEQX9qdCAFaiEFIARBAWohBAwBCwsgB0EBaiEHQQAhBSAGKAIIIQkDQCAFIAlGDQEgAyAFIAxqLQAAIgRBAnRqIgBBASAEdEEBdSILIAAoAgAiAWoiADYCACAHIARrIQhBACEEAkAgC0EDTQRAA0AgBCALRg0CIAogASAEakEBdGoiACAIOgABIAAgBToAACAEQQFqIQQMAAALAAsDQCABIABPDQEgCiABQQF0aiIEIAg6AAEgBCAFOgAAIAQgCDoAAyAEIAU6AAIgBCAIOgAFIAQgBToABCAEIAg6AAcgBCAFOgAGIAFBBGohAQwAAAsACyAFQQFqIQUMAAALAAsgAiEECyAGQRBqJAAgBAutAQECfwJAQYQgKAIAIABHIAAoAgBBAXYiAyABa0F4aiICQXhxQQhHcgR/IAIFIAMQJ0UNASACQQhqC0EQSQ0AIAAgACgCACICQQFxIAAgAWpBD2pBeHEiASAAa0EBdHI2AgAgASAANgIEIAEgASgCAEEBcSAAIAJBAXZqIAFrIgJBAXRyNgIAQYQgIAEgAkH/////B3FqQQRqQYQgKAIAIABGGyABNgIAIAEQJQsLygIBBX8CQAJAAkAgAEEIIABBCEsbZ0EfcyAAaUEBR2oiAUEESSAAIAF2cg0AIAFBAnRB/B5qKAIAIgJFDQADQCACQXhqIgMoAgBBAXZBeGoiBSAATwRAIAIgBUEIIAVBCEsbZ0Efc0ECdEGAH2oiASgCAEYEQCABIAIoAgQ2AgALDAMLIARBHksNASAEQQFqIQQgAigCBCICDQALC0EAIQMgAUEgTw0BA0AgAUECdEGAH2ooAgAiAkUEQCABQR5LIQIgAUEBaiEBIAJFDQEMAwsLIAIgAkF4aiIDKAIAQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgEoAgBGBEAgASACKAIENgIACwsgAigCACIBBEAgASACKAIENgIECyACKAIEIgEEQCABIAIoAgA2AgALIAMgAygCAEEBcjYCACADIAAQNwsgAwvhCwINfwV+IwBB8ABrIgckACAHIAAoAvDhASIINgJcIAEgAmohDSAIIAAoAoDiAWohDwJAAkAgBUUEQCABIQQMAQsgACgCxOABIRAgACgCwOABIREgACgCvOABIQ4gAEEBNgKM4QFBACEIA0AgCEEDRwRAIAcgCEECdCICaiAAIAJqQazQAWooAgA2AkQgCEEBaiEIDAELC0FsIQwgB0EYaiADIAQQBhADDQEgB0EsaiAHQRhqIAAoAgAQEyAHQTRqIAdBGGogACgCCBATIAdBPGogB0EYaiAAKAIEEBMgDUFgaiESIAEhBEEAIQwDQCAHKAIwIAcoAixBA3RqKQIAIhRCEIinQf8BcSEIIAcoAkAgBygCPEEDdGopAgAiFUIQiKdB/wFxIQsgBygCOCAHKAI0QQN0aikCACIWQiCIpyEJIBVCIIghFyAUQiCIpyECAkAgFkIQiKdB/wFxIgNBAk8EQAJAIAZFIANBGUlyRQRAIAkgB0EYaiADQSAgBygCHGsiCiAKIANLGyIKEAUgAyAKayIDdGohCSAHQRhqEAQaIANFDQEgB0EYaiADEAUgCWohCQwBCyAHQRhqIAMQBSAJaiEJIAdBGGoQBBoLIAcpAkQhGCAHIAk2AkQgByAYNwNIDAELAkAgA0UEQCACBEAgBygCRCEJDAMLIAcoAkghCQwBCwJAAkAgB0EYakEBEAUgCSACRWpqIgNBA0YEQCAHKAJEQX9qIgMgA0VqIQkMAQsgA0ECdCAHaigCRCIJIAlFaiEJIANBAUYNAQsgByAHKAJINgJMCwsgByAHKAJENgJIIAcgCTYCRAsgF6chAyALBEAgB0EYaiALEAUgA2ohAwsgCCALakEUTwRAIAdBGGoQBBoLIAgEQCAHQRhqIAgQBSACaiECCyAHQRhqEAQaIAcgB0EYaiAUQhiIp0H/AXEQCCAUp0H//wNxajYCLCAHIAdBGGogFUIYiKdB/wFxEAggFadB//8DcWo2AjwgB0EYahAEGiAHIAdBGGogFkIYiKdB/wFxEAggFqdB//8DcWo2AjQgByACNgJgIAcoAlwhCiAHIAk2AmggByADNgJkAkACQAJAIAQgAiADaiILaiASSw0AIAIgCmoiEyAPSw0AIA0gBGsgC0Egak8NAQsgByAHKQNoNwMQIAcgBykDYDcDCCAEIA0gB0EIaiAHQdwAaiAPIA4gESAQEB4hCwwBCyACIARqIQggBCAKEAcgAkERTwRAIARBEGohAgNAIAIgCkEQaiIKEAcgAkEQaiICIAhJDQALCyAIIAlrIQIgByATNgJcIAkgCCAOa0sEQCAJIAggEWtLBEBBbCELDAILIBAgAiAOayICaiIKIANqIBBNBEAgCCAKIAMQDxoMAgsgCCAKQQAgAmsQDyEIIAcgAiADaiIDNgJkIAggAmshCCAOIQILIAlBEE8EQCADIAhqIQMDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALDAELAkAgCUEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgCUECdCIDQcAeaigCAGoiAhAXIAIgA0HgHmooAgBrIQIgBygCZCEDDAELIAggAhAMCyADQQlJDQAgAyAIaiEDIAhBCGoiCCACQQhqIgJrQQ9MBEADQCAIIAIQDCACQQhqIQIgCEEIaiIIIANJDQAMAgALAAsDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALCyAHQRhqEAQaIAsgDCALEAMiAhshDCAEIAQgC2ogAhshBCAFQX9qIgUNAAsgDBADDQFBbCEMIAdBGGoQBEECSQ0BQQAhCANAIAhBA0cEQCAAIAhBAnQiAmpBrNABaiACIAdqKAJENgIAIAhBAWohCAwBCwsgBygCXCEIC0G6fyEMIA8gCGsiACANIARrSw0AIAQEfyAEIAggABALIABqBUEACyABayEMCyAHQfAAaiQAIAwLkRcCFn8FfiMAQdABayIHJAAgByAAKALw4QEiCDYCvAEgASACaiESIAggACgCgOIBaiETAkACQCAFRQRAIAEhAwwBCyAAKALE4AEhESAAKALA4AEhFSAAKAK84AEhDyAAQQE2AozhAUEAIQgDQCAIQQNHBEAgByAIQQJ0IgJqIAAgAmpBrNABaigCADYCVCAIQQFqIQgMAQsLIAcgETYCZCAHIA82AmAgByABIA9rNgJoQWwhECAHQShqIAMgBBAGEAMNASAFQQQgBUEESBshFyAHQTxqIAdBKGogACgCABATIAdBxABqIAdBKGogACgCCBATIAdBzABqIAdBKGogACgCBBATQQAhBCAHQeAAaiEMIAdB5ABqIQoDQCAHQShqEARBAksgBCAXTnJFBEAgBygCQCAHKAI8QQN0aikCACIdQhCIp0H/AXEhCyAHKAJQIAcoAkxBA3RqKQIAIh5CEIinQf8BcSEJIAcoAkggBygCREEDdGopAgAiH0IgiKchCCAeQiCIISAgHUIgiKchAgJAIB9CEIinQf8BcSIDQQJPBEACQCAGRSADQRlJckUEQCAIIAdBKGogA0EgIAcoAixrIg0gDSADSxsiDRAFIAMgDWsiA3RqIQggB0EoahAEGiADRQ0BIAdBKGogAxAFIAhqIQgMAQsgB0EoaiADEAUgCGohCCAHQShqEAQaCyAHKQJUISEgByAINgJUIAcgITcDWAwBCwJAIANFBEAgAgRAIAcoAlQhCAwDCyAHKAJYIQgMAQsCQAJAIAdBKGpBARAFIAggAkVqaiIDQQNGBEAgBygCVEF/aiIDIANFaiEIDAELIANBAnQgB2ooAlQiCCAIRWohCCADQQFGDQELIAcgBygCWDYCXAsLIAcgBygCVDYCWCAHIAg2AlQLICCnIQMgCQRAIAdBKGogCRAFIANqIQMLIAkgC2pBFE8EQCAHQShqEAQaCyALBEAgB0EoaiALEAUgAmohAgsgB0EoahAEGiAHIAcoAmggAmoiCSADajYCaCAKIAwgCCAJSxsoAgAhDSAHIAdBKGogHUIYiKdB/wFxEAggHadB//8DcWo2AjwgByAHQShqIB5CGIinQf8BcRAIIB6nQf//A3FqNgJMIAdBKGoQBBogB0EoaiAfQhiIp0H/AXEQCCEOIAdB8ABqIARBBHRqIgsgCSANaiAIazYCDCALIAg2AgggCyADNgIEIAsgAjYCACAHIA4gH6dB//8DcWo2AkQgBEEBaiEEDAELCyAEIBdIDQEgEkFgaiEYIAdB4ABqIRogB0HkAGohGyABIQMDQCAHQShqEARBAksgBCAFTnJFBEAgBygCQCAHKAI8QQN0aikCACIdQhCIp0H/AXEhCyAHKAJQIAcoAkxBA3RqKQIAIh5CEIinQf8BcSEIIAcoAkggBygCREEDdGopAgAiH0IgiKchCSAeQiCIISAgHUIgiKchDAJAIB9CEIinQf8BcSICQQJPBEACQCAGRSACQRlJckUEQCAJIAdBKGogAkEgIAcoAixrIgogCiACSxsiChAFIAIgCmsiAnRqIQkgB0EoahAEGiACRQ0BIAdBKGogAhAFIAlqIQkMAQsgB0EoaiACEAUgCWohCSAHQShqEAQaCyAHKQJUISEgByAJNgJUIAcgITcDWAwBCwJAIAJFBEAgDARAIAcoAlQhCQwDCyAHKAJYIQkMAQsCQAJAIAdBKGpBARAFIAkgDEVqaiICQQNGBEAgBygCVEF/aiICIAJFaiEJDAELIAJBAnQgB2ooAlQiCSAJRWohCSACQQFGDQELIAcgBygCWDYCXAsLIAcgBygCVDYCWCAHIAk2AlQLICCnIRQgCARAIAdBKGogCBAFIBRqIRQLIAggC2pBFE8EQCAHQShqEAQaCyALBEAgB0EoaiALEAUgDGohDAsgB0EoahAEGiAHIAcoAmggDGoiGSAUajYCaCAbIBogCSAZSxsoAgAhHCAHIAdBKGogHUIYiKdB/wFxEAggHadB//8DcWo2AjwgByAHQShqIB5CGIinQf8BcRAIIB6nQf//A3FqNgJMIAdBKGoQBBogByAHQShqIB9CGIinQf8BcRAIIB+nQf//A3FqNgJEIAcgB0HwAGogBEEDcUEEdGoiDSkDCCIdNwPIASAHIA0pAwAiHjcDwAECQAJAAkAgBygCvAEiDiAepyICaiIWIBNLDQAgAyAHKALEASIKIAJqIgtqIBhLDQAgEiADayALQSBqTw0BCyAHIAcpA8gBNwMQIAcgBykDwAE3AwggAyASIAdBCGogB0G8AWogEyAPIBUgERAeIQsMAQsgAiADaiEIIAMgDhAHIAJBEU8EQCADQRBqIQIDQCACIA5BEGoiDhAHIAJBEGoiAiAISQ0ACwsgCCAdpyIOayECIAcgFjYCvAEgDiAIIA9rSwRAIA4gCCAVa0sEQEFsIQsMAgsgESACIA9rIgJqIhYgCmogEU0EQCAIIBYgChAPGgwCCyAIIBZBACACaxAPIQggByACIApqIgo2AsQBIAggAmshCCAPIQILIA5BEE8EQCAIIApqIQoDQCAIIAIQByACQRBqIQIgCEEQaiIIIApJDQALDAELAkAgDkEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgDkECdCIKQcAeaigCAGoiAhAXIAIgCkHgHmooAgBrIQIgBygCxAEhCgwBCyAIIAIQDAsgCkEJSQ0AIAggCmohCiAIQQhqIgggAkEIaiICa0EPTARAA0AgCCACEAwgAkEIaiECIAhBCGoiCCAKSQ0ADAIACwALA0AgCCACEAcgAkEQaiECIAhBEGoiCCAKSQ0ACwsgCxADBEAgCyEQDAQFIA0gDDYCACANIBkgHGogCWs2AgwgDSAJNgIIIA0gFDYCBCAEQQFqIQQgAyALaiEDDAILAAsLIAQgBUgNASAEIBdrIQtBACEEA0AgCyAFSARAIAcgB0HwAGogC0EDcUEEdGoiAikDCCIdNwPIASAHIAIpAwAiHjcDwAECQAJAAkAgBygCvAEiDCAepyICaiIKIBNLDQAgAyAHKALEASIJIAJqIhBqIBhLDQAgEiADayAQQSBqTw0BCyAHIAcpA8gBNwMgIAcgBykDwAE3AxggAyASIAdBGGogB0G8AWogEyAPIBUgERAeIRAMAQsgAiADaiEIIAMgDBAHIAJBEU8EQCADQRBqIQIDQCACIAxBEGoiDBAHIAJBEGoiAiAISQ0ACwsgCCAdpyIGayECIAcgCjYCvAEgBiAIIA9rSwRAIAYgCCAVa0sEQEFsIRAMAgsgESACIA9rIgJqIgwgCWogEU0EQCAIIAwgCRAPGgwCCyAIIAxBACACaxAPIQggByACIAlqIgk2AsQBIAggAmshCCAPIQILIAZBEE8EQCAIIAlqIQYDQCAIIAIQByACQRBqIQIgCEEQaiIIIAZJDQALDAELAkAgBkEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgBkECdCIGQcAeaigCAGoiAhAXIAIgBkHgHmooAgBrIQIgBygCxAEhCQwBCyAIIAIQDAsgCUEJSQ0AIAggCWohBiAIQQhqIgggAkEIaiICa0EPTARAA0AgCCACEAwgAkEIaiECIAhBCGoiCCAGSQ0ADAIACwALA0AgCCACEAcgAkEQaiECIAhBEGoiCCAGSQ0ACwsgEBADDQMgC0EBaiELIAMgEGohAwwBCwsDQCAEQQNHBEAgACAEQQJ0IgJqQazQAWogAiAHaigCVDYCACAEQQFqIQQMAQsLIAcoArwBIQgLQbp/IRAgEyAIayIAIBIgA2tLDQAgAwR/IAMgCCAAEAsgAGoFQQALIAFrIRALIAdB0AFqJAAgEAslACAAQgA3AgAgAEEAOwEIIABBADoACyAAIAE2AgwgACACOgAKC7QFAQN/IwBBMGsiBCQAIABB/wFqIgVBfWohBgJAIAMvAQIEQCAEQRhqIAEgAhAGIgIQAw0BIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahASOgAAIAMgBEEIaiAEQRhqEBI6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0FIAEgBEEQaiAEQRhqEBI6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBSABIARBCGogBEEYahASOgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEjoAACABIAJqIABrIQIMAwsgAyAEQRBqIARBGGoQEjoAAiADIARBCGogBEEYahASOgADIANBBGohAwwAAAsACyAEQRhqIAEgAhAGIgIQAw0AIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahAROgAAIAMgBEEIaiAEQRhqEBE6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0EIAEgBEEQaiAEQRhqEBE6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBCABIARBCGogBEEYahAROgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEToAACABIAJqIABrIQIMAgsgAyAEQRBqIARBGGoQEToAAiADIARBCGogBEEYahAROgADIANBBGohAwwAAAsACyAEQTBqJAAgAgtpAQF/An8CQAJAIAJBB00NACABKAAAQbfIwuF+Rw0AIAAgASgABDYCmOIBQWIgAEEQaiABIAIQPiIDEAMNAhogAEKBgICAEDcDiOEBIAAgASADaiACIANrECoMAQsgACABIAIQKgtBAAsLrQMBBn8jAEGAAWsiAyQAQWIhCAJAIAJBCUkNACAAQZjQAGogAUEIaiIEIAJBeGogAEGY0AAQMyIFEAMiBg0AIANBHzYCfCADIANB/ABqIANB+ABqIAQgBCAFaiAGGyIEIAEgAmoiAiAEaxAVIgUQAw0AIAMoAnwiBkEfSw0AIAMoAngiB0EJTw0AIABBiCBqIAMgBkGAC0GADCAHEBggA0E0NgJ8IAMgA0H8AGogA0H4AGogBCAFaiIEIAIgBGsQFSIFEAMNACADKAJ8IgZBNEsNACADKAJ4IgdBCk8NACAAQZAwaiADIAZBgA1B4A4gBxAYIANBIzYCfCADIANB/ABqIANB+ABqIAQgBWoiBCACIARrEBUiBRADDQAgAygCfCIGQSNLDQAgAygCeCIHQQpPDQAgACADIAZBwBBB0BEgBxAYIAQgBWoiBEEMaiIFIAJLDQAgAiAFayEFQQAhAgNAIAJBA0cEQCAEKAAAIgZBf2ogBU8NAiAAIAJBAnRqQZzQAWogBjYCACACQQFqIQIgBEEEaiEEDAELCyAEIAFrIQgLIANBgAFqJAAgCAtGAQN/IABBCGohAyAAKAIEIQJBACEAA0AgACACdkUEQCABIAMgAEEDdGotAAJBFktqIQEgAEEBaiEADAELCyABQQggAmt0C4YDAQV/Qbh/IQcCQCADRQ0AIAItAAAiBEUEQCABQQA2AgBBAUG4fyADQQFGGw8LAn8gAkEBaiIFIARBGHRBGHUiBkF/Sg0AGiAGQX9GBEAgA0EDSA0CIAUvAABBgP4BaiEEIAJBA2oMAQsgA0ECSA0BIAItAAEgBEEIdHJBgIB+aiEEIAJBAmoLIQUgASAENgIAIAVBAWoiASACIANqIgNLDQBBbCEHIABBEGogACAFLQAAIgVBBnZBI0EJIAEgAyABa0HAEEHQEUHwEiAAKAKM4QEgACgCnOIBIAQQHyIGEAMiCA0AIABBmCBqIABBCGogBUEEdkEDcUEfQQggASABIAZqIAgbIgEgAyABa0GAC0GADEGAFyAAKAKM4QEgACgCnOIBIAQQHyIGEAMiCA0AIABBoDBqIABBBGogBUECdkEDcUE0QQkgASABIAZqIAgbIgEgAyABa0GADUHgDkGQGSAAKAKM4QEgACgCnOIBIAQQHyIAEAMNACAAIAFqIAJrIQcLIAcLrQMBCn8jAEGABGsiCCQAAn9BUiACQf8BSw0AGkFUIANBDEsNABogAkEBaiELIABBBGohCUGAgAQgA0F/anRBEHUhCkEAIQJBASEEQQEgA3QiB0F/aiIMIQUDQCACIAtGRQRAAkAgASACQQF0Ig1qLwEAIgZB//8DRgRAIAkgBUECdGogAjoAAiAFQX9qIQVBASEGDAELIARBACAKIAZBEHRBEHVKGyEECyAIIA1qIAY7AQAgAkEBaiECDAELCyAAIAQ7AQIgACADOwEAIAdBA3YgB0EBdmpBA2ohBkEAIQRBACECA0AgBCALRkUEQCABIARBAXRqLgEAIQpBACEAA0AgACAKTkUEQCAJIAJBAnRqIAQ6AAIDQCACIAZqIAxxIgIgBUsNAAsgAEEBaiEADAELCyAEQQFqIQQMAQsLQX8gAg0AGkEAIQIDfyACIAdGBH9BAAUgCCAJIAJBAnRqIgAtAAJBAXRqIgEgAS8BACIBQQFqOwEAIAAgAyABEBRrIgU6AAMgACABIAVB/wFxdCAHazsBACACQQFqIQIMAQsLCyEFIAhBgARqJAAgBQvjBgEIf0FsIQcCQCACQQNJDQACQAJAAkACQCABLQAAIgNBA3EiCUEBaw4DAwEAAgsgACgCiOEBDQBBYg8LIAJBBUkNAkEDIQYgASgAACEFAn8CQAJAIANBAnZBA3EiCEF+aiIEQQFNBEAgBEEBaw0BDAILIAVBDnZB/wdxIQQgBUEEdkH/B3EhAyAIRQwCCyAFQRJ2IQRBBCEGIAVBBHZB//8AcSEDQQAMAQsgBUEEdkH//w9xIgNBgIAISw0DIAEtAARBCnQgBUEWdnIhBEEFIQZBAAshBSAEIAZqIgogAksNAgJAIANBgQZJDQAgACgCnOIBRQ0AQQAhAgNAIAJBg4ABSw0BIAJBQGshAgwAAAsACwJ/IAlBA0YEQCABIAZqIQEgAEHw4gFqIQIgACgCDCEGIAUEQCACIAMgASAEIAYQXwwCCyACIAMgASAEIAYQXQwBCyAAQbjQAWohAiABIAZqIQEgAEHw4gFqIQYgAEGo0ABqIQggBQRAIAggBiADIAEgBCACEF4MAQsgCCAGIAMgASAEIAIQXAsQAw0CIAAgAzYCgOIBIABBATYCiOEBIAAgAEHw4gFqNgLw4QEgCUECRgRAIAAgAEGo0ABqNgIMCyAAIANqIgBBiOMBakIANwAAIABBgOMBakIANwAAIABB+OIBakIANwAAIABB8OIBakIANwAAIAoPCwJ/AkACQAJAIANBAnZBA3FBf2oiBEECSw0AIARBAWsOAgACAQtBASEEIANBA3YMAgtBAiEEIAEvAABBBHYMAQtBAyEEIAEQIUEEdgsiAyAEaiIFQSBqIAJLBEAgBSACSw0CIABB8OIBaiABIARqIAMQCyEBIAAgAzYCgOIBIAAgATYC8OEBIAEgA2oiAEIANwAYIABCADcAECAAQgA3AAggAEIANwAAIAUPCyAAIAM2AoDiASAAIAEgBGo2AvDhASAFDwsCfwJAAkACQCADQQJ2QQNxQX9qIgRBAksNACAEQQFrDgIAAgELQQEhByADQQN2DAILQQIhByABLwAAQQR2DAELIAJBBEkgARAhIgJBj4CAAUtyDQFBAyEHIAJBBHYLIQIgAEHw4gFqIAEgB2otAAAgAkEgahAQIQEgACACNgKA4gEgACABNgLw4QEgB0EBaiEHCyAHC0sAIABC+erQ0OfJoeThADcDICAAQgA3AxggAELP1tO+0ser2UI3AxAgAELW64Lu6v2J9eAANwMIIABCADcDACAAQShqQQBBKBAQGgviAgICfwV+IABBKGoiASAAKAJIaiECAn4gACkDACIDQiBaBEAgACkDECIEQgeJIAApAwgiBUIBiXwgACkDGCIGQgyJfCAAKQMgIgdCEol8IAUQGSAEEBkgBhAZIAcQGQwBCyAAKQMYQsXP2bLx5brqJ3wLIAN8IQMDQCABQQhqIgAgAk0EQEIAIAEpAAAQCSADhUIbiUKHla+vmLbem55/fkLj3MqV/M7y9YV/fCEDIAAhAQwBCwsCQCABQQRqIgAgAksEQCABIQAMAQsgASgAAK1Ch5Wvr5i23puef34gA4VCF4lCz9bTvtLHq9lCfkL5893xmfaZqxZ8IQMLA0AgACACSQRAIAAxAABCxc/ZsvHluuonfiADhUILiUKHla+vmLbem55/fiEDIABBAWohAAwBCwsgA0IhiCADhULP1tO+0ser2UJ+IgNCHYggA4VC+fPd8Zn2masWfiIDQiCIIAOFC+8CAgJ/BH4gACAAKQMAIAKtfDcDAAJAAkAgACgCSCIDIAJqIgRBH00EQCABRQ0BIAAgA2pBKGogASACECAgACgCSCACaiEEDAELIAEgAmohAgJ/IAMEQCAAQShqIgQgA2ogAUEgIANrECAgACAAKQMIIAQpAAAQCTcDCCAAIAApAxAgACkAMBAJNwMQIAAgACkDGCAAKQA4EAk3AxggACAAKQMgIABBQGspAAAQCTcDICAAKAJIIQMgAEEANgJIIAEgA2tBIGohAQsgAUEgaiACTQsEQCACQWBqIQMgACkDICEFIAApAxghBiAAKQMQIQcgACkDCCEIA0AgCCABKQAAEAkhCCAHIAEpAAgQCSEHIAYgASkAEBAJIQYgBSABKQAYEAkhBSABQSBqIgEgA00NAAsgACAFNwMgIAAgBjcDGCAAIAc3AxAgACAINwMICyABIAJPDQEgAEEoaiABIAIgAWsiBBAgCyAAIAQ2AkgLCy8BAX8gAEUEQEG2f0EAIAMbDwtBun8hBCADIAFNBH8gACACIAMQEBogAwVBun8LCy8BAX8gAEUEQEG2f0EAIAMbDwtBun8hBCADIAFNBH8gACACIAMQCxogAwVBun8LC6gCAQZ/IwBBEGsiByQAIABB2OABaikDAEKAgIAQViEIQbh/IQUCQCAEQf//B0sNACAAIAMgBBBCIgUQAyIGDQAgACgCnOIBIQkgACAHQQxqIAMgAyAFaiAGGyIKIARBACAFIAYbayIGEEAiAxADBEAgAyEFDAELIAcoAgwhBCABRQRAQbp/IQUgBEEASg0BCyAGIANrIQUgAyAKaiEDAkAgCQRAIABBADYCnOIBDAELAkACQAJAIARBBUgNACAAQdjgAWopAwBCgICACFgNAAwBCyAAQQA2ApziAQwBCyAAKAIIED8hBiAAQQA2ApziASAGQRRPDQELIAAgASACIAMgBSAEIAgQOSEFDAELIAAgASACIAMgBSAEIAgQOiEFCyAHQRBqJAAgBQtnACAAQdDgAWogASACIAAoAuzhARAuIgEQAwRAIAEPC0G4fyECAkAgAQ0AIABB7OABaigCACIBBEBBYCECIAAoApjiASABRw0BC0EAIQIgAEHw4AFqKAIARQ0AIABBkOEBahBDCyACCycBAX8QVyIERQRAQUAPCyAEIAAgASACIAMgBBBLEE8hACAEEFYgAAs/AQF/AkACQAJAIAAoAqDiAUEBaiIBQQJLDQAgAUEBaw4CAAECCyAAEDBBAA8LIABBADYCoOIBCyAAKAKU4gELvAMCB38BfiMAQRBrIgkkAEG4fyEGAkAgBCgCACIIQQVBCSAAKALs4QEiBRtJDQAgAygCACIHQQFBBSAFGyAFEC8iBRADBEAgBSEGDAELIAggBUEDakkNACAAIAcgBRBJIgYQAw0AIAEgAmohCiAAQZDhAWohCyAIIAVrIQIgBSAHaiEHIAEhBQNAIAcgAiAJECwiBhADDQEgAkF9aiICIAZJBEBBuH8hBgwCCyAJKAIAIghBAksEQEFsIQYMAgsgB0EDaiEHAn8CQAJAAkAgCEEBaw4CAgABCyAAIAUgCiAFayAHIAYQSAwCCyAFIAogBWsgByAGEEcMAQsgBSAKIAVrIActAAAgCSgCCBBGCyIIEAMEQCAIIQYMAgsgACgC8OABBEAgCyAFIAgQRQsgAiAGayECIAYgB2ohByAFIAhqIQUgCSgCBEUNAAsgACkD0OABIgxCf1IEQEFsIQYgDCAFIAFrrFINAQsgACgC8OABBEBBaiEGIAJBBEkNASALEEQhDCAHKAAAIAynRw0BIAdBBGohByACQXxqIQILIAMgBzYCACAEIAI2AgAgBSABayEGCyAJQRBqJAAgBgsuACAAECsCf0EAQQAQAw0AGiABRSACRXJFBEBBYiAAIAEgAhA9EAMNARoLQQALCzcAIAEEQCAAIAAoAsTgASABKAIEIAEoAghqRzYCnOIBCyAAECtBABADIAFFckUEQCAAIAEQWwsL0QIBB38jAEEQayIGJAAgBiAENgIIIAYgAzYCDCAFBEAgBSgCBCEKIAUoAgghCQsgASEIAkACQANAIAAoAuzhARAWIQsCQANAIAQgC0kNASADKAAAQXBxQdDUtMIBRgRAIAMgBBAiIgcQAw0EIAQgB2shBCADIAdqIQMMAQsLIAYgAzYCDCAGIAQ2AggCQCAFBEAgACAFEE5BACEHQQAQA0UNAQwFCyAAIAogCRBNIgcQAw0ECyAAIAgQUCAMQQFHQQAgACAIIAIgBkEMaiAGQQhqEEwiByIDa0EAIAMQAxtBCkdyRQRAQbh/IQcMBAsgBxADDQMgAiAHayECIAcgCGohCEEBIQwgBigCDCEDIAYoAgghBAwBCwsgBiADNgIMIAYgBDYCCEG4fyEHIAQNASAIIAFrIQcMAQsgBiADNgIMIAYgBDYCCAsgBkEQaiQAIAcLRgECfyABIAAoArjgASICRwRAIAAgAjYCxOABIAAgATYCuOABIAAoArzgASEDIAAgATYCvOABIAAgASADIAJrajYCwOABCwutAgIEfwF+IwBBQGoiBCQAAkACQCACQQhJDQAgASgAAEFwcUHQ1LTCAUcNACABIAIQIiEBIABCADcDCCAAQQA2AgQgACABNgIADAELIARBGGogASACEC0iAxADBEAgACADEBoMAQsgAwRAIABBuH8QGgwBCyACIAQoAjAiA2shAiABIANqIQMDQAJAIAAgAyACIARBCGoQLCIFEAMEfyAFBSACIAVBA2oiBU8NAUG4fwsQGgwCCyAGQQFqIQYgAiAFayECIAMgBWohAyAEKAIMRQ0ACyAEKAI4BEAgAkEDTQRAIABBuH8QGgwCCyADQQRqIQMLIAQoAighAiAEKQMYIQcgAEEANgIEIAAgAyABazYCACAAIAIgBmytIAcgB0J/URs3AwgLIARBQGskAAslAQF/IwBBEGsiAiQAIAIgACABEFEgAigCACEAIAJBEGokACAAC30BBH8jAEGQBGsiBCQAIARB/wE2AggCQCAEQRBqIARBCGogBEEMaiABIAIQFSIGEAMEQCAGIQUMAQtBVCEFIAQoAgwiB0EGSw0AIAMgBEEQaiAEKAIIIAcQQSIFEAMNACAAIAEgBmogAiAGayADEDwhBQsgBEGQBGokACAFC4cBAgJ/An5BABAWIQMCQANAIAEgA08EQAJAIAAoAABBcHFB0NS0wgFGBEAgACABECIiAhADRQ0BQn4PCyAAIAEQVSIEQn1WDQMgBCAFfCIFIARUIQJCfiEEIAINAyAAIAEQUiICEAMNAwsgASACayEBIAAgAmohAAwBCwtCfiAFIAEbIQQLIAQLPwIBfwF+IwBBMGsiAiQAAn5CfiACQQhqIAAgARAtDQAaQgAgAigCHEEBRg0AGiACKQMICyEDIAJBMGokACADC40BAQJ/IwBBMGsiASQAAkAgAEUNACAAKAKI4gENACABIABB/OEBaigCADYCKCABIAApAvThATcDICAAEDAgACgCqOIBIQIgASABKAIoNgIYIAEgASkDIDcDECACIAFBEGoQGyAAQQA2AqjiASABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALKgECfyMAQRBrIgAkACAAQQA2AgggAEIANwMAIAAQWCEBIABBEGokACABC4cBAQN/IwBBEGsiAiQAAkAgACgCAEUgACgCBEVzDQAgAiAAKAIINgIIIAIgACkCADcDAAJ/IAIoAgAiAQRAIAIoAghBqOMJIAERBQAMAQtBqOMJECgLIgFFDQAgASAAKQIANwL04QEgAUH84QFqIAAoAgg2AgAgARBZIAEhAwsgAkEQaiQAIAMLywEBAn8jAEEgayIBJAAgAEGBgIDAADYCtOIBIABBADYCiOIBIABBADYC7OEBIABCADcDkOIBIABBADYCpOMJIABBADYC3OIBIABCADcCzOIBIABBADYCvOIBIABBADYCxOABIABCADcCnOIBIABBpOIBakIANwIAIABBrOIBakEANgIAIAFCADcCECABQgA3AhggASABKQMYNwMIIAEgASkDEDcDACABKAIIQQh2QQFxIQIgAEEANgLg4gEgACACNgKM4gEgAUEgaiQAC3YBA38jAEEwayIBJAAgAARAIAEgAEHE0AFqIgIoAgA2AiggASAAKQK80AE3AyAgACgCACEDIAEgAigCADYCGCABIAApArzQATcDECADIAFBEGoQGyABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALzAEBAX8gACABKAK00AE2ApjiASAAIAEoAgQiAjYCwOABIAAgAjYCvOABIAAgAiABKAIIaiICNgK44AEgACACNgLE4AEgASgCuNABBEAgAEKBgICAEDcDiOEBIAAgAUGk0ABqNgIMIAAgAUGUIGo2AgggACABQZwwajYCBCAAIAFBDGo2AgAgAEGs0AFqIAFBqNABaigCADYCACAAQbDQAWogAUGs0AFqKAIANgIAIABBtNABaiABQbDQAWooAgA2AgAPCyAAQgA3A4jhAQs7ACACRQRAQbp/DwsgBEUEQEFsDwsgAiAEEGAEQCAAIAEgAiADIAQgBRBhDwsgACABIAIgAyAEIAUQZQtGAQF/IwBBEGsiBSQAIAVBCGogBBAOAn8gBS0ACQRAIAAgASACIAMgBBAyDAELIAAgASACIAMgBBA0CyEAIAVBEGokACAACzQAIAAgAyAEIAUQNiIFEAMEQCAFDwsgBSAESQR/IAEgAiADIAVqIAQgBWsgABA1BUG4fwsLRgEBfyMAQRBrIgUkACAFQQhqIAQQDgJ/IAUtAAkEQCAAIAEgAiADIAQQYgwBCyAAIAEgAiADIAQQNQshACAFQRBqJAAgAAtZAQF/QQ8hAiABIABJBEAgAUEEdCAAbiECCyAAQQh2IgEgAkEYbCIAQYwIaigCAGwgAEGICGooAgBqIgJBA3YgAmogAEGACGooAgAgAEGECGooAgAgAWxqSQs3ACAAIAMgBCAFQYAQEDMiBRADBEAgBQ8LIAUgBEkEfyABIAIgAyAFaiAEIAVrIAAQMgVBuH8LC78DAQN/IwBBIGsiBSQAIAVBCGogAiADEAYiAhADRQRAIAAgAWoiB0F9aiEGIAUgBBAOIARBBGohAiAFLQACIQMDQEEAIAAgBkkgBUEIahAEGwRAIAAgAiAFQQhqIAMQAkECdGoiBC8BADsAACAFQQhqIAQtAAIQASAAIAQtAANqIgQgAiAFQQhqIAMQAkECdGoiAC8BADsAACAFQQhqIAAtAAIQASAEIAAtAANqIQAMAQUgB0F+aiEEA0AgBUEIahAEIAAgBEtyRQRAIAAgAiAFQQhqIAMQAkECdGoiBi8BADsAACAFQQhqIAYtAAIQASAAIAYtAANqIQAMAQsLA0AgACAES0UEQCAAIAIgBUEIaiADEAJBAnRqIgYvAQA7AAAgBUEIaiAGLQACEAEgACAGLQADaiEADAELCwJAIAAgB08NACAAIAIgBUEIaiADEAIiA0ECdGoiAC0AADoAACAALQADQQFGBEAgBUEIaiAALQACEAEMAQsgBSgCDEEfSw0AIAVBCGogAiADQQJ0ai0AAhABIAUoAgxBIUkNACAFQSA2AgwLIAFBbCAFQQhqEAobIQILCwsgBUEgaiQAIAILkgIBBH8jAEFAaiIJJAAgCSADQTQQCyEDAkAgBEECSA0AIAMgBEECdGooAgAhCSADQTxqIAgQIyADQQE6AD8gAyACOgA+QQAhBCADKAI8IQoDQCAEIAlGDQEgACAEQQJ0aiAKNgEAIARBAWohBAwAAAsAC0EAIQkDQCAGIAlGRQRAIAMgBSAJQQF0aiIKLQABIgtBAnRqIgwoAgAhBCADQTxqIAotAABBCHQgCGpB//8DcRAjIANBAjoAPyADIAcgC2siCiACajoAPiAEQQEgASAKa3RqIQogAygCPCELA0AgACAEQQJ0aiALNgEAIARBAWoiBCAKSQ0ACyAMIAo2AgAgCUEBaiEJDAELCyADQUBrJAALowIBCX8jAEHQAGsiCSQAIAlBEGogBUE0EAsaIAcgBmshDyAHIAFrIRADQAJAIAMgCkcEQEEBIAEgByACIApBAXRqIgYtAAEiDGsiCGsiC3QhDSAGLQAAIQ4gCUEQaiAMQQJ0aiIMKAIAIQYgCyAPTwRAIAAgBkECdGogCyAIIAUgCEE0bGogCCAQaiIIQQEgCEEBShsiCCACIAQgCEECdGooAgAiCEEBdGogAyAIayAHIA4QYyAGIA1qIQgMAgsgCUEMaiAOECMgCUEBOgAPIAkgCDoADiAGIA1qIQggCSgCDCELA0AgBiAITw0CIAAgBkECdGogCzYBACAGQQFqIQYMAAALAAsgCUHQAGokAA8LIAwgCDYCACAKQQFqIQoMAAALAAs0ACAAIAMgBCAFEDYiBRADBEAgBQ8LIAUgBEkEfyABIAIgAyAFaiAEIAVrIAAQNAVBuH8LCyMAIAA/AEEQdGtB//8DakEQdkAAQX9GBEBBAA8LQQAQAEEBCzsBAX8gAgRAA0AgACABIAJBgCAgAkGAIEkbIgMQCyEAIAFBgCBqIQEgAEGAIGohACACIANrIgINAAsLCwYAIAAQAwsLqBUJAEGICAsNAQAAAAEAAAACAAAAAgBBoAgLswYBAAAAAQAAAAIAAAACAAAAJgAAAIIAAAAhBQAASgAAAGcIAAAmAAAAwAEAAIAAAABJBQAASgAAAL4IAAApAAAALAIAAIAAAABJBQAASgAAAL4IAAAvAAAAygIAAIAAAACKBQAASgAAAIQJAAA1AAAAcwMAAIAAAACdBQAASgAAAKAJAAA9AAAAgQMAAIAAAADrBQAASwAAAD4KAABEAAAAngMAAIAAAABNBgAASwAAAKoKAABLAAAAswMAAIAAAADBBgAATQAAAB8NAABNAAAAUwQAAIAAAAAjCAAAUQAAAKYPAABUAAAAmQQAAIAAAABLCQAAVwAAALESAABYAAAA2gQAAIAAAABvCQAAXQAAACMUAABUAAAARQUAAIAAAABUCgAAagAAAIwUAABqAAAArwUAAIAAAAB2CQAAfAAAAE4QAAB8AAAA0gIAAIAAAABjBwAAkQAAAJAHAACSAAAAAAAAAAEAAAABAAAABQAAAA0AAAAdAAAAPQAAAH0AAAD9AAAA/QEAAP0DAAD9BwAA/Q8AAP0fAAD9PwAA/X8AAP3/AAD9/wEA/f8DAP3/BwD9/w8A/f8fAP3/PwD9/38A/f//AP3//wH9//8D/f//B/3//w/9//8f/f//P/3//38AAAAAAQAAAAIAAAADAAAABAAAAAUAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAABEAAAASAAAAEwAAABQAAAAVAAAAFgAAABcAAAAYAAAAGQAAABoAAAAbAAAAHAAAAB0AAAAeAAAAHwAAAAMAAAAEAAAABQAAAAYAAAAHAAAACAAAAAkAAAAKAAAACwAAAAwAAAANAAAADgAAAA8AAAAQAAAAEQAAABIAAAATAAAAFAAAABUAAAAWAAAAFwAAABgAAAAZAAAAGgAAABsAAAAcAAAAHQAAAB4AAAAfAAAAIAAAACEAAAAiAAAAIwAAACUAAAAnAAAAKQAAACsAAAAvAAAAMwAAADsAAABDAAAAUwAAAGMAAACDAAAAAwEAAAMCAAADBAAAAwgAAAMQAAADIAAAA0AAAAOAAAADAAEAQeAPC1EBAAAAAQAAAAEAAAABAAAAAgAAAAIAAAADAAAAAwAAAAQAAAAEAAAABQAAAAcAAAAIAAAACQAAAAoAAAALAAAADAAAAA0AAAAOAAAADwAAABAAQcQQC4sBAQAAAAIAAAADAAAABAAAAAUAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAABIAAAAUAAAAFgAAABgAAAAcAAAAIAAAACgAAAAwAAAAQAAAAIAAAAAAAQAAAAIAAAAEAAAACAAAABAAAAAgAAAAQAAAAIAAAAAAAQBBkBIL5gQBAAAAAQAAAAEAAAABAAAAAgAAAAIAAAADAAAAAwAAAAQAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAAAEAAAAEAAAACAAAAAAAAAABAAEBBgAAAAAAAAQAAAAAEAAABAAAAAAgAAAFAQAAAAAAAAUDAAAAAAAABQQAAAAAAAAFBgAAAAAAAAUHAAAAAAAABQkAAAAAAAAFCgAAAAAAAAUMAAAAAAAABg4AAAAAAAEFEAAAAAAAAQUUAAAAAAABBRYAAAAAAAIFHAAAAAAAAwUgAAAAAAAEBTAAAAAgAAYFQAAAAAAABwWAAAAAAAAIBgABAAAAAAoGAAQAAAAADAYAEAAAIAAABAAAAAAAAAAEAQAAAAAAAAUCAAAAIAAABQQAAAAAAAAFBQAAACAAAAUHAAAAAAAABQgAAAAgAAAFCgAAAAAAAAULAAAAAAAABg0AAAAgAAEFEAAAAAAAAQUSAAAAIAABBRYAAAAAAAIFGAAAACAAAwUgAAAAAAADBSgAAAAAAAYEQAAAABAABgRAAAAAIAAHBYAAAAAAAAkGAAIAAAAACwYACAAAMAAABAAAAAAQAAAEAQAAACAAAAUCAAAAIAAABQMAAAAgAAAFBQAAACAAAAUGAAAAIAAABQgAAAAgAAAFCQAAACAAAAULAAAAIAAABQwAAAAAAAAGDwAAACAAAQUSAAAAIAABBRQAAAAgAAIFGAAAACAAAgUcAAAAIAADBSgAAAAgAAQFMAAAAAAAEAYAAAEAAAAPBgCAAAAAAA4GAEAAAAAADQYAIABBgBcLhwIBAAEBBQAAAAAAAAUAAAAAAAAGBD0AAAAAAAkF/QEAAAAADwX9fwAAAAAVBf3/HwAAAAMFBQAAAAAABwR9AAAAAAAMBf0PAAAAABIF/f8DAAAAFwX9/38AAAAFBR0AAAAAAAgE/QAAAAAADgX9PwAAAAAUBf3/DwAAAAIFAQAAABAABwR9AAAAAAALBf0HAAAAABEF/f8BAAAAFgX9/z8AAAAEBQ0AAAAQAAgE/QAAAAAADQX9HwAAAAATBf3/BwAAAAEFAQAAABAABgQ9AAAAAAAKBf0DAAAAABAF/f8AAAAAHAX9//8PAAAbBf3//wcAABoF/f//AwAAGQX9//8BAAAYBf3//wBBkBkLhgQBAAEBBgAAAAAAAAYDAAAAAAAABAQAAAAgAAAFBQAAAAAAAAUGAAAAAAAABQgAAAAAAAAFCQAAAAAAAAULAAAAAAAABg0AAAAAAAAGEAAAAAAAAAYTAAAAAAAABhYAAAAAAAAGGQAAAAAAAAYcAAAAAAAABh8AAAAAAAAGIgAAAAAAAQYlAAAAAAABBikAAAAAAAIGLwAAAAAAAwY7AAAAAAAEBlMAAAAAAAcGgwAAAAAACQYDAgAAEAAABAQAAAAAAAAEBQAAACAAAAUGAAAAAAAABQcAAAAgAAAFCQAAAAAAAAUKAAAAAAAABgwAAAAAAAAGDwAAAAAAAAYSAAAAAAAABhUAAAAAAAAGGAAAAAAAAAYbAAAAAAAABh4AAAAAAAAGIQAAAAAAAQYjAAAAAAABBicAAAAAAAIGKwAAAAAAAwYzAAAAAAAEBkMAAAAAAAUGYwAAAAAACAYDAQAAIAAABAQAAAAwAAAEBAAAABAAAAQFAAAAIAAABQcAAAAgAAAFCAAAACAAAAUKAAAAIAAABQsAAAAAAAAGDgAAAAAAAAYRAAAAAAAABhQAAAAAAAAGFwAAAAAAAAYaAAAAAAAABh0AAAAAAAAGIAAAAAAAEAYDAAEAAAAPBgOAAAAAAA4GA0AAAAAADQYDIAAAAAAMBgMQAAAAAAsGAwgAAAAACgYDBABBpB0L2QEBAAAAAwAAAAcAAAAPAAAAHwAAAD8AAAB/AAAA/wAAAP8BAAD/AwAA/wcAAP8PAAD/HwAA/z8AAP9/AAD//wAA//8BAP//AwD//wcA//8PAP//HwD//z8A//9/AP///wD///8B////A////wf///8P////H////z////9/AAAAAAEAAAACAAAABAAAAAAAAAACAAAABAAAAAgAAAAAAAAAAQAAAAIAAAABAAAABAAAAAQAAAAEAAAABAAAAAgAAAAIAAAACAAAAAcAAAAIAAAACQAAAAoAAAALAEGgIAsDwBBQ",IQ="display-p3",MQ="display-p3-linear",Fp=new WeakMap;let Np=0,kp;class rs extends ni{constructor(e){super(e),this.transcoderPath="",this.transcoderBinary=null,this.transcoderPending=null,this.workerPool=new gQ,this.workerSourceURL="",this.workerConfig=null,typeof MSC_TRANSCODER<"u"&&console.warn('THREE.KTX2Loader: Please update to latest "basis_transcoder". "msc_basis_transcoder" is no longer supported in three.js r125+.')}setTranscoderPath(e){return this.transcoderPath=e,this}setWorkerLimit(e){return this.workerPool.setWorkerLimit(e),this}async detectSupportAsync(e){return this.workerConfig={astcSupported:await e.hasFeatureAsync("texture-compression-astc"),astcHDRSupported:!1,etc1Supported:await e.hasFeatureAsync("texture-compression-etc1"),etc2Supported:await e.hasFeatureAsync("texture-compression-etc2"),dxtSupported:await e.hasFeatureAsync("texture-compression-bc"),bptcSupported:await e.hasFeatureAsync("texture-compression-bptc"),pvrtcSupported:await e.hasFeatureAsync("texture-compression-pvrtc")},this}detectSupport(e){return e.isWebGPURenderer===!0?this.workerConfig={astcSupported:e.hasFeature("texture-compression-astc"),astcHDRSupported:!1,etc1Supported:e.hasFeature("texture-compression-etc1"),etc2Supported:e.hasFeature("texture-compression-etc2"),dxtSupported:e.hasFeature("texture-compression-bc"),bptcSupported:e.hasFeature("texture-compression-bptc"),pvrtcSupported:e.hasFeature("texture-compression-pvrtc")}:this.workerConfig={astcSupported:e.extensions.has("WEBGL_compressed_texture_astc"),astcHDRSupported:e.extensions.has("WEBGL_compressed_texture_astc")&&e.extensions.get("WEBGL_compressed_texture_astc").getSupportedProfiles().includes("hdr"),etc1Supported:e.extensions.has("WEBGL_compressed_texture_etc1"),etc2Supported:e.extensions.has("WEBGL_compressed_texture_etc"),dxtSupported:e.extensions.has("WEBGL_compressed_texture_s3tc"),bptcSupported:e.extensions.has("EXT_texture_compression_bptc"),pvrtcSupported:e.extensions.has("WEBGL_compressed_texture_pvrtc")||e.extensions.has("WEBKIT_WEBGL_compressed_texture_pvrtc")},this}init(){if(!this.transcoderPending){const e=new ji(this.manager);e.setPath(this.transcoderPath),e.setWithCredentials(this.withCredentials);const t=e.loadAsync("basis_transcoder.js"),n=new ji(this.manager);n.setPath(this.transcoderPath),n.setResponseType("arraybuffer"),n.setWithCredentials(this.withCredentials);const s=n.loadAsync("basis_transcoder.wasm");this.transcoderPending=Promise.all([t,s]).then(([r,o])=>{const a=rs.BasisWorker.toString(),l=["/* constants */","let _EngineFormat = "+JSON.stringify(rs.EngineFormat),"let _EngineType = "+JSON.stringify(rs.EngineType),"let _TranscoderFormat = "+JSON.stringify(rs.TranscoderFormat),"let _BasisFormat = "+JSON.stringify(rs.BasisFormat),"/* basis_transcoder.js */",r,"/* worker */",a.substring(a.indexOf("{")+1,a.lastIndexOf("}"))].join("\n");this.workerSourceURL=URL.createObjectURL(new Blob([l])),this.transcoderBinary=o,this.workerPool.setWorkerCreator(()=>{const c=new Worker(this.workerSourceURL),h=this.transcoderBinary.slice(0);return c.postMessage({type:"init",config:this.workerConfig,transcoderBinary:h},[h]),c})}),Np>0&&console.warn("THREE.KTX2Loader: Multiple active KTX2 loaders may cause performance issues. Use a single KTX2Loader instance, or call .dispose() on old instances."),Np++}return this.transcoderPending}load(e,t,n,s){if(this.workerConfig===null)throw new Error("THREE.KTX2Loader: Missing initialization with `.detectSupport( renderer )`.");const r=new ji(this.manager);r.setResponseType("arraybuffer"),r.setWithCredentials(this.withCredentials),r.load(e,o=>{this.parse(o,t,s)},n,s)}parse(e,t,n){if(this.workerConfig===null)throw new Error("THREE.KTX2Loader: Missing initialization with `.detectSupport( renderer )`.");if(Fp.has(e))return Fp.get(e).promise.then(t).catch(n);this._createTexture(e).then(s=>t?t(s):null).catch(n)}_createTextureFrom(e,t){const{type:n,error:s,data:{faces:r,width:o,height:a,format:l,type:c,dfdFlags:h}}=e;if(n==="error")return Promise.reject(s);let u;if(t.faceCount===6)u=new R1(r,l,c);else{const d=r[0].mipmaps;u=t.layerCount>1?new B1(d,o,a,t.layerCount,l,c):new qd(d,o,a,l,c)}return u.minFilter=r[0].mipmaps.length===1?Zt:os,u.magFilter=Zt,u.generateMipmaps=!1,u.needsUpdate=!0,u.colorSpace=OE(t),u.premultiplyAlpha=!!(h&_Q),u}async _createTexture(e,t={}){const n=CQ(new Uint8Array(e)),s=n.vkFormat===Zg&&n.dataFormatDescriptor[0].colorModel===167;if(!(n.vkFormat===bQ||s&&!this.workerConfig.astcHDRSupported))return BQ(n);const o=t,a=this.init().then(()=>this.workerPool.postMessage({type:"transcode",buffer:e,taskConfig:o},[e])).then(l=>this._createTextureFrom(l.data,n));return Fp.set(e,{promise:a}),a}dispose(){return this.workerPool.dispose(),this.workerSourceURL&&URL.revokeObjectURL(this.workerSourceURL),Np--,this}}rs.BasisFormat={ETC1S:0,UASTC:1,UASTC_HDR:2};rs.TranscoderFormat={ETC1:0,ETC2:1,BC1:2,BC3:3,BC4:4,BC5:5,BC7_M6_OPAQUE_ONLY:6,BC7_M5:7,PVRTC1_4_RGB:8,PVRTC1_4_RGBA:9,ASTC_4x4:10,ATC_RGB:11,ATC_RGBA_INTERPOLATED_ALPHA:12,RGBA32:13,RGB565:14,BGR565:15,RGBA4444:16,BC6H:22,RGB_HALF:24,RGBA_HALF:25};rs.EngineFormat={RGBAFormat:Hn,RGBA_ASTC_4x4_Format:Wc,RGB_BPTC_UNSIGNED_Format:ad,RGBA_BPTC_Format:Ec,RGBA_ETC2_EAC_Format:od,RGBA_PVRTC_4BPPV1_Format:id,RGBA_S3TC_DXT5_Format:bc,RGB_ETC1_Format:sd,RGB_ETC2_Format:rd,RGB_PVRTC_4BPPV1_Format:nd,RGBA_S3TC_DXT1_Format:wc};rs.EngineType={UnsignedByteType:Kn,HalfFloatType:Gn,FloatType:Sn};rs.BasisWorker=function(){let i,e,t;const n=_EngineFormat,s=_EngineType,r=_TranscoderFormat,o=_BasisFormat;self.addEventListener("message",function(p){const A=p.data;switch(A.type){case"init":i=A.config,a(A.transcoderBinary);break;case"transcode":e.then(()=>{try{const{faces:m,buffers:g,width:y,height:_,hasAlpha:v,format:b,type:T,dfdFlags:L}=l(A.buffer);self.postMessage({type:"transcode",id:A.id,data:{faces:m,width:y,height:_,hasAlpha:v,format:b,type:T,dfdFlags:L}},g)}catch(m){console.error(m),self.postMessage({type:"error",id:A.id,error:m.message})}});break}});function a(p){e=new Promise(A=>{t={wasmBinary:p,onRuntimeInitialized:A},BASIS(t)}).then(()=>{t.initializeBasis(),t.KTX2File===void 0&&console.warn("THREE.KTX2Loader: Please update Basis Universal transcoder.")})}function l(p){const A=new t.KTX2File(new Uint8Array(p));function m(){A.close(),A.delete()}if(!A.isValid())throw m(),new Error("THREE.KTX2Loader:	Invalid or unsupported .ktx2 file");let g;if(A.isUASTC())g=o.UASTC;else if(A.isETC1S())g=o.ETC1S;else if(A.isHDR())g=o.UASTC_HDR;else throw new Error("THREE.KTX2Loader: Unknown Basis encoding");const y=A.getWidth(),_=A.getHeight(),v=A.getLayers()||1,b=A.getLevels(),T=A.getFaces(),L=A.getHasAlpha(),I=A.getDFDFlags(),{transcoderFormat:x,engineFormat:w,engineType:P}=u(g,y,_,L);if(!y||!_||!b)throw m(),new Error("THREE.KTX2Loader:	Invalid texture");if(!A.startTranscoding())throw m(),new Error("THREE.KTX2Loader: .startTranscoding failed");const z=[],H=[];for(let K=0;K<T;K++){const le=[];for(let J=0;J<b;J++){const W=[];let O,fe;for(let ee=0;ee<v;ee++){const de=A.getImageLevelInfo(J,ee,K);K===0&&J===0&&ee===0&&(de.origWidth%4!==0||de.origHeight%4!==0)&&console.warn("THREE.KTX2Loader: ETC1S and UASTC textures should use multiple-of-four dimensions."),b>1?(O=de.origWidth,fe=de.origHeight):(O=de.width,fe=de.height);let ae=new Uint8Array(A.getImageTranscodedSizeInBytes(J,ee,0,x));const R=A.transcodeImage(ae,J,ee,K,x,0,-1,-1);if(P===s.HalfFloatType&&(ae=new Uint16Array(ae.buffer,ae.byteOffset,ae.byteLength/Uint16Array.BYTES_PER_ELEMENT)),!R)throw m(),new Error("THREE.KTX2Loader: .transcodeImage failed.");W.push(ae)}const ue=f(W);le.push({data:ue,width:O,height:fe}),H.push(ue.buffer)}z.push({mipmaps:le,width:y,height:_,format:w,type:P})}return m(),{faces:z,buffers:H,width:y,height:_,hasAlpha:L,dfdFlags:I,format:w,type:P}}const c=[{if:"astcSupported",basisFormat:[o.UASTC],transcoderFormat:[r.ASTC_4x4,r.ASTC_4x4],engineFormat:[n.RGBA_ASTC_4x4_Format,n.RGBA_ASTC_4x4_Format],engineType:[s.UnsignedByteType],priorityETC1S:1/0,priorityUASTC:1,needsPowerOfTwo:!1},{if:"bptcSupported",basisFormat:[o.ETC1S,o.UASTC],transcoderFormat:[r.BC7_M5,r.BC7_M5],engineFormat:[n.RGBA_BPTC_Format,n.RGBA_BPTC_Format],engineType:[s.UnsignedByteType],priorityETC1S:3,priorityUASTC:2,needsPowerOfTwo:!1},{if:"dxtSupported",basisFormat:[o.ETC1S,o.UASTC],transcoderFormat:[r.BC1,r.BC3],engineFormat:[n.RGBA_S3TC_DXT1_Format,n.RGBA_S3TC_DXT5_Format],engineType:[s.UnsignedByteType],priorityETC1S:4,priorityUASTC:5,needsPowerOfTwo:!1},{if:"etc2Supported",basisFormat:[o.ETC1S,o.UASTC],transcoderFormat:[r.ETC1,r.ETC2],engineFormat:[n.RGB_ETC2_Format,n.RGBA_ETC2_EAC_Format],engineType:[s.UnsignedByteType],priorityETC1S:1,priorityUASTC:3,needsPowerOfTwo:!1},{if:"etc1Supported",basisFormat:[o.ETC1S,o.UASTC],transcoderFormat:[r.ETC1],engineFormat:[n.RGB_ETC1_Format],engineType:[s.UnsignedByteType],priorityETC1S:2,priorityUASTC:4,needsPowerOfTwo:!1},{if:"pvrtcSupported",basisFormat:[o.ETC1S,o.UASTC],transcoderFormat:[r.PVRTC1_4_RGB,r.PVRTC1_4_RGBA],engineFormat:[n.RGB_PVRTC_4BPPV1_Format,n.RGBA_PVRTC_4BPPV1_Format],engineType:[s.UnsignedByteType],priorityETC1S:5,priorityUASTC:6,needsPowerOfTwo:!0},{if:"bptcSupported",basisFormat:[o.UASTC_HDR],transcoderFormat:[r.BC6H],engineFormat:[n.RGB_BPTC_UNSIGNED_Format],engineType:[s.HalfFloatType],priorityHDR:1,needsPowerOfTwo:!1},{basisFormat:[o.ETC1S,o.UASTC],transcoderFormat:[r.RGBA32,r.RGBA32],engineFormat:[n.RGBAFormat,n.RGBAFormat],engineType:[s.UnsignedByteType,s.UnsignedByteType],priorityETC1S:100,priorityUASTC:100,needsPowerOfTwo:!1},{basisFormat:[o.UASTC_HDR],transcoderFormat:[r.RGBA_HALF],engineFormat:[n.RGBAFormat],engineType:[s.HalfFloatType],priorityHDR:100,needsPowerOfTwo:!1}],h={[o.ETC1S]:c.filter(p=>p.basisFormat.includes(o.ETC1S)).sort((p,A)=>p.priorityUASTC-A.priorityUASTC),[o.UASTC]:c.filter(p=>p.basisFormat.includes(o.UASTC)).sort((p,A)=>p.priorityUASTC-A.priorityUASTC),[o.UASTC_HDR]:c.filter(p=>p.basisFormat.includes(o.UASTC_HDR)).sort((p,A)=>p.priorityHDR-A.priorityHDR)};function u(p,A,m,g){const y=h[p];for(let _=0;_<y.length;_++){const v=y[_];if(v.if&&!i[v.if]||!v.basisFormat.includes(p)||g&&v.transcoderFormat.length<2||v.needsPowerOfTwo&&!(d(A)&&d(m)))continue;const b=v.transcoderFormat[g?1:0],T=v.engineFormat[g?1:0],L=v.engineType[0];return{transcoderFormat:b,engineFormat:T,engineType:L}}throw new Error("THREE.KTX2Loader: Failed to identify transcoding target.")}function d(p){return p<=2?!0:(p&p-1)===0&&p!==0}function f(p){if(p.length===1)return p[0];let A=0;for(let y=0;y<p.length;y++){const _=p[y];A+=_.byteLength}const m=new Uint8Array(A);let g=0;for(let y=0;y<p.length;y++){const _=p[y];m.set(_,g),g+=_.byteLength}return m}};const TQ=new Set([Hn,Vo,mr]),Op={[FE]:Hn,[PE]:Hn,[ME]:Hn,[TE]:Hn,[LE]:Vo,[RE]:Vo,[SE]:Vo,[IE]:Vo,[DE]:mr,[BE]:mr,[CE]:mr,[EE]:mr,[Zg]:Wc,[kE]:qc,[NE]:qc},Up={[FE]:Sn,[PE]:Gn,[ME]:Kn,[TE]:Kn,[LE]:Sn,[RE]:Gn,[SE]:Kn,[IE]:Kn,[DE]:Sn,[BE]:Gn,[CE]:Kn,[EE]:Kn,[Zg]:Gn,[kE]:Kn,[NE]:Kn};async function BQ(i){const{vkFormat:e}=i;if(Op[e]===void 0)throw new Error("THREE.KTX2Loader: Unsupported vkFormat.");let t;i.supercompressionScheme===hy&&(kp||(kp=new Promise(async r=>{const o=new SQ;await o.init(),r(o)})),t=await kp);const n=[];for(let r=0;r<i.levels.length;r++){const o=Math.max(1,i.pixelWidth>>r),a=Math.max(1,i.pixelHeight>>r),l=i.pixelDepth?Math.max(1,i.pixelDepth>>r):0,c=i.levels[r];let h;if(i.supercompressionScheme===vQ)h=c.levelData;else if(i.supercompressionScheme===hy)h=t.decode(c.levelData,c.uncompressedByteLength);else throw new Error("THREE.KTX2Loader: Unsupported supercompressionScheme.");let u;Up[e]===Sn?u=new Float32Array(h.buffer,h.byteOffset,h.byteLength/Float32Array.BYTES_PER_ELEMENT):Up[e]===Gn?u=new Uint16Array(h.buffer,h.byteOffset,h.byteLength/Uint16Array.BYTES_PER_ELEMENT):u=h,n.push({data:u,width:o,height:a,depth:l})}let s;if(TQ.has(Op[e]))s=i.pixelDepth===0?new Gd(n[0].data,i.pixelWidth,i.pixelHeight):new Dw(n[0].data,i.pixelWidth,i.pixelHeight,i.pixelDepth);else{if(i.pixelDepth>0)throw new Error("THREE.KTX2Loader: Unsupported pixelDepth.");s=new qd(n,i.pixelWidth,i.pixelHeight),s.minFilter=n.length===1?Zt:os,s.magFilter=Zt}return s.mipmaps=n,s.type=Up[e],s.format=Op[e],s.colorSpace=OE(i),s.needsUpdate=!0,Promise.resolve(s)}function OE(i){const e=i.dataFormatDescriptor[0];return e.colorPrimaries===xQ?e.transferFunction===uy?Ft:On:e.colorPrimaries===wQ?e.transferFunction===uy?IQ:MQ:(e.colorPrimaries===yQ||console.warn('THREE.KTX2Loader: Unsupported color primaries, "'.concat(e.colorPrimaries,'"')),bs)}const RQ=/^[og]\s*(.+)?/,PQ=/^mtllib /,DQ=/^usemtl /,LQ=/^usemap /,py=/\s+/,my=new he,Qp=new he,Ay=new he,gy=new he,ts=new he,Eu=new at;function FQ(){const i={objects:[],object:{},vertices:[],normals:[],colors:[],uvs:[],materials:{},materialLibraries:[],startObject:function(e,t){if(this.object&&this.object.fromDeclaration===!1){this.object.name=e,this.object.fromDeclaration=t!==!1;return}const n=this.object&&typeof this.object.currentMaterial=="function"?this.object.currentMaterial():void 0;if(this.object&&typeof this.object._finalize=="function"&&this.object._finalize(!0),this.object={name:e||"",fromDeclaration:t!==!1,geometry:{vertices:[],normals:[],colors:[],uvs:[],hasUVIndices:!1},materials:[],smooth:!0,startMaterial:function(s,r){const o=this._finalize(!1);o&&(o.inherited||o.groupCount<=0)&&this.materials.splice(o.index,1);const a={index:this.materials.length,name:s||"",mtllib:Array.isArray(r)&&r.length>0?r[r.length-1]:"",smooth:o!==void 0?o.smooth:this.smooth,groupStart:o!==void 0?o.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(l){const c={index:typeof l=="number"?l:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return c.clone=this.clone.bind(c),c}};return this.materials.push(a),a},currentMaterial:function(){if(this.materials.length>0)return this.materials[this.materials.length-1]},_finalize:function(s){const r=this.currentMaterial();if(r&&r.groupEnd===-1&&(r.groupEnd=this.geometry.vertices.length/3,r.groupCount=r.groupEnd-r.groupStart,r.inherited=!1),s&&this.materials.length>1)for(let o=this.materials.length-1;o>=0;o--)this.materials[o].groupCount<=0&&this.materials.splice(o,1);return s&&this.materials.length===0&&this.materials.push({name:"",smooth:this.smooth}),r}},n&&n.name&&typeof n.clone=="function"){const s=n.clone(0);s.inherited=!0,this.object.materials.push(s)}this.objects.push(this.object)},finalize:function(){this.object&&typeof this.object._finalize=="function"&&this.object._finalize(!0)},parseVertexIndex:function(e,t){const n=parseInt(e,10);return(n>=0?n-1:n+t/3)*3},parseNormalIndex:function(e,t){const n=parseInt(e,10);return(n>=0?n-1:n+t/3)*3},parseUVIndex:function(e,t){const n=parseInt(e,10);return(n>=0?n-1:n+t/2)*2},addVertex:function(e,t,n){const s=this.vertices,r=this.object.geometry.vertices;r.push(s[e+0],s[e+1],s[e+2]),r.push(s[t+0],s[t+1],s[t+2]),r.push(s[n+0],s[n+1],s[n+2])},addVertexPoint:function(e){const t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addVertexLine:function(e){const t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addNormal:function(e,t,n){const s=this.normals,r=this.object.geometry.normals;r.push(s[e+0],s[e+1],s[e+2]),r.push(s[t+0],s[t+1],s[t+2]),r.push(s[n+0],s[n+1],s[n+2])},addFaceNormal:function(e,t,n){const s=this.vertices,r=this.object.geometry.normals;my.fromArray(s,e),Qp.fromArray(s,t),Ay.fromArray(s,n),ts.subVectors(Ay,Qp),gy.subVectors(my,Qp),ts.cross(gy),ts.normalize(),r.push(ts.x,ts.y,ts.z),r.push(ts.x,ts.y,ts.z),r.push(ts.x,ts.y,ts.z)},addColor:function(e,t,n){const s=this.colors,r=this.object.geometry.colors;s[e]!==void 0&&r.push(s[e+0],s[e+1],s[e+2]),s[t]!==void 0&&r.push(s[t+0],s[t+1],s[t+2]),s[n]!==void 0&&r.push(s[n+0],s[n+1],s[n+2])},addUV:function(e,t,n){const s=this.uvs,r=this.object.geometry.uvs;r.push(s[e+0],s[e+1]),r.push(s[t+0],s[t+1]),r.push(s[n+0],s[n+1])},addDefaultUV:function(){const e=this.object.geometry.uvs;e.push(0,0),e.push(0,0),e.push(0,0)},addUVLine:function(e){const t=this.uvs;this.object.geometry.uvs.push(t[e+0],t[e+1])},addFace:function(e,t,n,s,r,o,a,l,c){const h=this.vertices.length;let u=this.parseVertexIndex(e,h),d=this.parseVertexIndex(t,h),f=this.parseVertexIndex(n,h);if(this.addVertex(u,d,f),this.addColor(u,d,f),a!==void 0&&a!==""){const p=this.normals.length;u=this.parseNormalIndex(a,p),d=this.parseNormalIndex(l,p),f=this.parseNormalIndex(c,p),this.addNormal(u,d,f)}else this.addFaceNormal(u,d,f);if(s!==void 0&&s!==""){const p=this.uvs.length;u=this.parseUVIndex(s,p),d=this.parseUVIndex(r,p),f=this.parseUVIndex(o,p),this.addUV(u,d,f),this.object.geometry.hasUVIndices=!0}else this.addDefaultUV()},addPointGeometry:function(e){this.object.geometry.type="Points";const t=this.vertices.length;for(let n=0,s=e.length;n<s;n++){const r=this.parseVertexIndex(e[n],t);this.addVertexPoint(r),this.addColor(r)}},addLineGeometry:function(e,t){this.object.geometry.type="Line";const n=this.vertices.length,s=this.uvs.length;for(let r=0,o=e.length;r<o;r++)this.addVertexLine(this.parseVertexIndex(e[r],n));for(let r=0,o=t.length;r<o;r++)this.addUVLine(this.parseUVIndex(t[r],s))}};return i.startObject("",!1),i}class NQ extends ni{constructor(e){super(e),this.materials=null}load(e,t,n,s){const r=this,o=new ji(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,function(a){try{t(r.parse(a))}catch(l){s?s(l):console.error(l),r.manager.itemError(e)}},n,s)}setMaterials(e){return this.materials=e,this}parse(e){const t=new FQ;e.indexOf("\r\n")!==-1&&(e=e.replace(/\r\n/g,"\n")),e.indexOf("\\\n")!==-1&&(e=e.replace(/\\\n/g,""));const n=e.split("\n");let s=[];for(let a=0,l=n.length;a<l;a++){const c=n[a].trimStart();if(c.length===0)continue;const h=c.charAt(0);if(h!=="#")if(h==="v"){const u=c.split(py);switch(u[0]){case"v":t.vertices.push(parseFloat(u[1]),parseFloat(u[2]),parseFloat(u[3])),u.length>=7?(Eu.setRGB(parseFloat(u[4]),parseFloat(u[5]),parseFloat(u[6]),Ft),t.colors.push(Eu.r,Eu.g,Eu.b)):t.colors.push(void 0,void 0,void 0);break;case"vn":t.normals.push(parseFloat(u[1]),parseFloat(u[2]),parseFloat(u[3]));break;case"vt":t.uvs.push(parseFloat(u[1]),parseFloat(u[2]));break}}else if(h==="f"){const d=c.slice(1).trim().split(py),f=[];for(let A=0,m=d.length;A<m;A++){const g=d[A];if(g.length>0){const y=g.split("/");f.push(y)}}const p=f[0];for(let A=1,m=f.length-1;A<m;A++){const g=f[A],y=f[A+1];t.addFace(p[0],g[0],y[0],p[1],g[1],y[1],p[2],g[2],y[2])}}else if(h==="l"){const u=c.substring(1).trim().split(" ");let d=[];const f=[];if(c.indexOf("/")===-1)d=u;else for(let p=0,A=u.length;p<A;p++){const m=u[p].split("/");m[0]!==""&&d.push(m[0]),m[1]!==""&&f.push(m[1])}t.addLineGeometry(d,f)}else if(h==="p"){const d=c.slice(1).trim().split(" ");t.addPointGeometry(d)}else if((s=RQ.exec(c))!==null){const u=(" "+s[0].slice(1).trim()).slice(1);t.startObject(u)}else if(DQ.test(c))t.object.startMaterial(c.substring(7).trim(),t.materialLibraries);else if(PQ.test(c))t.materialLibraries.push(c.substring(7).trim());else if(LQ.test(c))console.warn('THREE.OBJLoader: Rendering identifier "usemap" not supported. Textures must be defined in MTL files.');else if(h==="s"){if(s=c.split(" "),s.length>1){const d=s[1].trim().toLowerCase();t.object.smooth=d!=="0"&&d!=="off"}else t.object.smooth=!0;const u=t.object.currentMaterial();u&&(u.smooth=t.object.smooth)}else{if(c==="\0")continue;console.warn('THREE.OBJLoader: Unexpected line: "'+c+'"')}}t.finalize();const r=new Wi;if(r.materialLibraries=[].concat(t.materialLibraries),!(t.objects.length===1&&t.objects[0].geometry.vertices.length===0)===!0)for(let a=0,l=t.objects.length;a<l;a++){const c=t.objects[a],h=c.geometry,u=c.materials,d=h.type==="Line",f=h.type==="Points";let p=!1;if(h.vertices.length===0)continue;const A=new Nn;A.setAttribute("position",new jt(h.vertices,3)),h.normals.length>0&&A.setAttribute("normal",new jt(h.normals,3)),h.colors.length>0&&(p=!0,A.setAttribute("color",new jt(h.colors,3))),h.hasUVIndices===!0&&A.setAttribute("uv",new jt(h.uvs,2));const m=[];for(let y=0,_=u.length;y<_;y++){const v=u[y],b=v.name+"_"+v.smooth+"_"+p;let T=t.materials[b];if(this.materials!==null){if(T=this.materials.create(v.name),d&&T&&!(T instanceof no)){const L=new no;xi.prototype.copy.call(L,T),L.color.copy(T.color),T=L}else if(f&&T&&!(T instanceof qa)){const L=new qa({size:10,sizeAttenuation:!1});xi.prototype.copy.call(L,T),L.color.copy(T.color),L.map=T.map,T=L}}T===void 0&&(d?T=new no:f?T=new qa({size:1,sizeAttenuation:!1}):T=new Ou,T.name=v.name,T.flatShading=!v.smooth,T.vertexColors=p,t.materials[b]=T),m.push(T)}let g;if(m.length>1){for(let y=0,_=u.length;y<_;y++){const v=u[y];A.addGroup(v.groupStart,v.groupCount,y)}d?g=new Kc(A,m):f?g=new ku(A,m):g=new $n(A,m)}else d?g=new Kc(A,m[0]):f?g=new ku(A,m[0]):g=new $n(A,m[0]);g.name=c.name,r.add(g)}else if(t.vertices.length>0){const a=new qa({size:1,sizeAttenuation:!1}),l=new Nn;l.setAttribute("position",new jt(t.vertices,3)),t.colors.length>0&&t.colors[0]!==void 0&&(l.setAttribute("color",new jt(t.colors,3)),a.vertexColors=!0);const c=new ku(l,a);r.add(c)}return r}}class kQ extends $w{constructor(e){super(e),this.type=Gn}parse(e){const o=function(I,x){switch(I){case 1:throw new Error("THREE.RGBELoader: Read Error: "+(x||""));case 2:throw new Error("THREE.RGBELoader: Write Error: "+(x||""));case 3:throw new Error("THREE.RGBELoader: Bad File Format: "+(x||""));default:case 4:throw new Error("THREE.RGBELoader: Memory Error: "+(x||""))}},h="\n",u=function(I,x,w){x=x||1024;let z=I.pos,H=-1,K=0,le="",J=String.fromCharCode.apply(null,new Uint16Array(I.subarray(z,z+128)));for(;0>(H=J.indexOf(h))&&K<x&&z<I.byteLength;)le+=J,K+=J.length,z+=128,J+=String.fromCharCode.apply(null,new Uint16Array(I.subarray(z,z+128)));return-1<H?(I.pos+=K+H+1,le+J.slice(0,H)):!1},d=function(I){const x=/^#\?(\S+)/,w=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,P=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,z=/^\s*FORMAT=(\S+)\s*$/,H=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,K={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let le,J;for((I.pos>=I.byteLength||!(le=u(I)))&&o(1,"no header found"),(J=le.match(x))||o(3,"bad initial token"),K.valid|=1,K.programtype=J[1],K.string+=le+"\n";le=u(I),le!==!1;){if(K.string+=le+"\n",le.charAt(0)==="#"){K.comments+=le+"\n";continue}if((J=le.match(w))&&(K.gamma=parseFloat(J[1])),(J=le.match(P))&&(K.exposure=parseFloat(J[1])),(J=le.match(z))&&(K.valid|=2,K.format=J[1]),(J=le.match(H))&&(K.valid|=4,K.height=parseInt(J[1],10),K.width=parseInt(J[2],10)),K.valid&2&&K.valid&4)break}return K.valid&2||o(3,"missing format specifier"),K.valid&4||o(3,"missing image size specifier"),K},f=function(I,x,w){const P=x;if(P<8||P>32767||I[0]!==2||I[1]!==2||I[2]&128)return new Uint8Array(I);P!==(I[2]<<8|I[3])&&o(3,"wrong scanline width");const z=new Uint8Array(4*x*w);z.length||o(4,"unable to allocate buffer space");let H=0,K=0;const le=4*P,J=new Uint8Array(4),W=new Uint8Array(le);let O=w;for(;O>0&&K<I.byteLength;){K+4>I.byteLength&&o(1),J[0]=I[K++],J[1]=I[K++],J[2]=I[K++],J[3]=I[K++],(J[0]!=2||J[1]!=2||(J[2]<<8|J[3])!=P)&&o(3,"bad rgbe scanline format");let fe=0,ue;for(;fe<le&&K<I.byteLength;){ue=I[K++];const de=ue>128;if(de&&(ue-=128),(ue===0||fe+ue>le)&&o(3,"bad scanline data"),de){const ae=I[K++];for(let R=0;R<ue;R++)W[fe++]=ae}else W.set(I.subarray(K,K+ue),fe),fe+=ue,K+=ue}const ee=P;for(let de=0;de<ee;de++){let ae=0;z[H]=W[de+ae],ae+=P,z[H+1]=W[de+ae],ae+=P,z[H+2]=W[de+ae],ae+=P,z[H+3]=W[de+ae],H+=4}O--}return z},p=function(I,x,w,P){const z=I[x+3],H=Math.pow(2,z-128)/255;w[P+0]=I[x+0]*H,w[P+1]=I[x+1]*H,w[P+2]=I[x+2]*H,w[P+3]=1},A=function(I,x,w,P){const z=I[x+3],H=Math.pow(2,z-128)/255;w[P+0]=Wa.toHalfFloat(Math.min(I[x+0]*H,65504)),w[P+1]=Wa.toHalfFloat(Math.min(I[x+1]*H,65504)),w[P+2]=Wa.toHalfFloat(Math.min(I[x+2]*H,65504)),w[P+3]=Wa.toHalfFloat(1)},m=new Uint8Array(e);m.pos=0;const g=d(m),y=g.width,_=g.height,v=f(m.subarray(m.pos),y,_);let b,T,L;switch(this.type){case Sn:L=v.length/4;const I=new Float32Array(L*4);for(let w=0;w<L;w++)p(v,w*4,I,w*4);b=I,T=Sn;break;case Gn:L=v.length/4;const x=new Uint16Array(L*4);for(let w=0;w<L;w++)A(v,w*4,x,w*4);b=x,T=Gn;break;default:throw new Error("THREE.RGBELoader: Unsupported type: "+this.type)}return{width:y,height:_,data:b,header:g.string,gamma:g.gamma,exposure:g.exposure,type:T}}setDataType(e){return this.type=e,this}load(e,t,n,s){function r(o,a){switch(o.type){case Sn:case Gn:o.colorSpace=On,o.minFilter=Zt,o.magFilter=Zt,o.generateMipmaps=!1,o.flipY=!0;break}t&&t(o,a)}return super.load(e,r,n,s)}}const OQ=Ft;class ev extends ni{constructor(e){super(e),this.defaultDPI=90,this.defaultUnit="px"}load(e,t,n,s){const r=this,o=new ji(r.manager);o.setPath(r.path),o.setRequestHeader(r.requestHeader),o.setWithCredentials(r.withCredentials),o.load(e,function(a){try{t(r.parse(a))}catch(l){s?s(l):console.error(l),r.manager.itemError(e)}},n,s)}parse(e){const t=this;function n(R,M){if(R.nodeType!==1)return;const B=v(R);let D=!1,te=null;switch(R.nodeName){case"svg":M=p(R,M);break;case"style":r(R);break;case"g":M=p(R,M);break;case"path":M=p(R,M),R.hasAttribute("d")&&(te=s(R));break;case"rect":M=p(R,M),te=l(R);break;case"polygon":M=p(R,M),te=c(R);break;case"polyline":M=p(R,M),te=h(R);break;case"circle":M=p(R,M),te=u(R);break;case"ellipse":M=p(R,M),te=d(R);break;case"line":M=p(R,M),te=f(R);break;case"defs":D=!0;break;case"use":M=p(R,M);const me=(R.getAttributeNS("http://www.w3.org/1999/xlink","href")||"").substring(1),F=R.viewportElement.getElementById(me);F?n(F,M):console.warn("SVGLoader: 'use node' references non-existent node id: "+me);break}te&&(M.fill!==void 0&&M.fill!=="none"&&te.color.setStyle(M.fill,OQ),T(te,ee),z.push(te),te.userData={node:R,style:M});const ie=R.childNodes;for(let Z=0;Z<ie.length;Z++){const me=ie[Z];D&&me.nodeName!=="style"&&me.nodeName!=="defs"||n(me,M)}B&&(K.pop(),K.length>0?ee.copy(K[K.length-1]):ee.identity())}function s(R){const M=new Qr,B=new Me,D=new Me,te=new Me;let ie=!0,Z=!1;const me=R.getAttribute("d");if(me===""||me==="none")return null;const F=me.match(/[a-df-z][^a-df-z]*/ig);for(let Q=0,E=F.length;Q<E;Q++){const j=F[Q],q=j.charAt(0),ce=j.slice(1).trim();ie===!0&&(Z=!0,ie=!1);let G;switch(q){case"M":G=m(ce);for(let V=0,re=G.length;V<re;V+=2)B.x=G[V+0],B.y=G[V+1],D.x=B.x,D.y=B.y,V===0?M.moveTo(B.x,B.y):M.lineTo(B.x,B.y),V===0&&te.copy(B);break;case"H":G=m(ce);for(let V=0,re=G.length;V<re;V++)B.x=G[V],D.x=B.x,D.y=B.y,M.lineTo(B.x,B.y),V===0&&Z===!0&&te.copy(B);break;case"V":G=m(ce);for(let V=0,re=G.length;V<re;V++)B.y=G[V],D.x=B.x,D.y=B.y,M.lineTo(B.x,B.y),V===0&&Z===!0&&te.copy(B);break;case"L":G=m(ce);for(let V=0,re=G.length;V<re;V+=2)B.x=G[V+0],B.y=G[V+1],D.x=B.x,D.y=B.y,M.lineTo(B.x,B.y),V===0&&Z===!0&&te.copy(B);break;case"C":G=m(ce);for(let V=0,re=G.length;V<re;V+=6)M.bezierCurveTo(G[V+0],G[V+1],G[V+2],G[V+3],G[V+4],G[V+5]),D.x=G[V+2],D.y=G[V+3],B.x=G[V+4],B.y=G[V+5],V===0&&Z===!0&&te.copy(B);break;case"S":G=m(ce);for(let V=0,re=G.length;V<re;V+=4)M.bezierCurveTo(A(B.x,D.x),A(B.y,D.y),G[V+0],G[V+1],G[V+2],G[V+3]),D.x=G[V+0],D.y=G[V+1],B.x=G[V+2],B.y=G[V+3],V===0&&Z===!0&&te.copy(B);break;case"Q":G=m(ce);for(let V=0,re=G.length;V<re;V+=4)M.quadraticCurveTo(G[V+0],G[V+1],G[V+2],G[V+3]),D.x=G[V+0],D.y=G[V+1],B.x=G[V+2],B.y=G[V+3],V===0&&Z===!0&&te.copy(B);break;case"T":G=m(ce);for(let V=0,re=G.length;V<re;V+=2){const k=A(B.x,D.x),N=A(B.y,D.y);M.quadraticCurveTo(k,N,G[V+0],G[V+1]),D.x=k,D.y=N,B.x=G[V+0],B.y=G[V+1],V===0&&Z===!0&&te.copy(B)}break;case"A":G=m(ce,[3,4],7);for(let V=0,re=G.length;V<re;V+=7){if(G[V+5]==B.x&&G[V+6]==B.y)continue;const k=B.clone();B.x=G[V+5],B.y=G[V+6],D.x=B.x,D.y=B.y,o(M,G[V],G[V+1],G[V+2],G[V+3],G[V+4],k,B),V===0&&Z===!0&&te.copy(B)}break;case"m":G=m(ce);for(let V=0,re=G.length;V<re;V+=2)B.x+=G[V+0],B.y+=G[V+1],D.x=B.x,D.y=B.y,V===0?M.moveTo(B.x,B.y):M.lineTo(B.x,B.y),V===0&&te.copy(B);break;case"h":G=m(ce);for(let V=0,re=G.length;V<re;V++)B.x+=G[V],D.x=B.x,D.y=B.y,M.lineTo(B.x,B.y),V===0&&Z===!0&&te.copy(B);break;case"v":G=m(ce);for(let V=0,re=G.length;V<re;V++)B.y+=G[V],D.x=B.x,D.y=B.y,M.lineTo(B.x,B.y),V===0&&Z===!0&&te.copy(B);break;case"l":G=m(ce);for(let V=0,re=G.length;V<re;V+=2)B.x+=G[V+0],B.y+=G[V+1],D.x=B.x,D.y=B.y,M.lineTo(B.x,B.y),V===0&&Z===!0&&te.copy(B);break;case"c":G=m(ce);for(let V=0,re=G.length;V<re;V+=6)M.bezierCurveTo(B.x+G[V+0],B.y+G[V+1],B.x+G[V+2],B.y+G[V+3],B.x+G[V+4],B.y+G[V+5]),D.x=B.x+G[V+2],D.y=B.y+G[V+3],B.x+=G[V+4],B.y+=G[V+5],V===0&&Z===!0&&te.copy(B);break;case"s":G=m(ce);for(let V=0,re=G.length;V<re;V+=4)M.bezierCurveTo(A(B.x,D.x),A(B.y,D.y),B.x+G[V+0],B.y+G[V+1],B.x+G[V+2],B.y+G[V+3]),D.x=B.x+G[V+0],D.y=B.y+G[V+1],B.x+=G[V+2],B.y+=G[V+3],V===0&&Z===!0&&te.copy(B);break;case"q":G=m(ce);for(let V=0,re=G.length;V<re;V+=4)M.quadraticCurveTo(B.x+G[V+0],B.y+G[V+1],B.x+G[V+2],B.y+G[V+3]),D.x=B.x+G[V+0],D.y=B.y+G[V+1],B.x+=G[V+2],B.y+=G[V+3],V===0&&Z===!0&&te.copy(B);break;case"t":G=m(ce);for(let V=0,re=G.length;V<re;V+=2){const k=A(B.x,D.x),N=A(B.y,D.y);M.quadraticCurveTo(k,N,B.x+G[V+0],B.y+G[V+1]),D.x=k,D.y=N,B.x=B.x+G[V+0],B.y=B.y+G[V+1],V===0&&Z===!0&&te.copy(B)}break;case"a":G=m(ce,[3,4],7);for(let V=0,re=G.length;V<re;V+=7){if(G[V+5]==0&&G[V+6]==0)continue;const k=B.clone();B.x+=G[V+5],B.y+=G[V+6],D.x=B.x,D.y=B.y,o(M,G[V],G[V+1],G[V+2],G[V+3],G[V+4],k,B),V===0&&Z===!0&&te.copy(B)}break;case"Z":case"z":M.currentPath.autoClose=!0,M.currentPath.curves.length>0&&(B.copy(te),M.currentPath.currentPoint.copy(B),ie=!0);break;default:console.warn(j)}Z=!1}return M}function r(R){if(!(!R.sheet||!R.sheet.cssRules||!R.sheet.cssRules.length))for(let M=0;M<R.sheet.cssRules.length;M++){const B=R.sheet.cssRules[M];if(B.type!==1)continue;const D=B.selectorText.split(/,/gm).filter(Boolean).map(te=>te.trim());for(let te=0;te<D.length;te++){const ie=Object.fromEntries(Object.entries(B.style).filter(([,Z])=>Z!==""));H[D[te]]=Object.assign(H[D[te]]||{},ie)}}}function o(R,M,B,D,te,ie,Z,me){if(M==0||B==0){R.lineTo(me.x,me.y);return}D=D*Math.PI/180,M=Math.abs(M),B=Math.abs(B);const F=(Z.x-me.x)/2,Q=(Z.y-me.y)/2,E=Math.cos(D)*F+Math.sin(D)*Q,j=-Math.sin(D)*F+Math.cos(D)*Q;let q=M*M,ce=B*B;const G=E*E,V=j*j,re=G/q+V/ce;if(re>1){const lt=Math.sqrt(re);M=lt*M,B=lt*B,q=M*M,ce=B*B}const k=q*V+ce*G,N=(q*ce-k)/k;let oe=Math.sqrt(Math.max(0,N));te===ie&&(oe=-oe);const pe=oe*M*j/B,ve=-oe*B*E/M,xe=Math.cos(D)*pe-Math.sin(D)*ve+(Z.x+me.x)/2,Pe=Math.sin(D)*pe+Math.cos(D)*ve+(Z.y+me.y)/2,Te=a(1,0,(E-pe)/M,(j-ve)/B),Qe=a((E-pe)/M,(j-ve)/B,(-E-pe)/M,(-j-ve)/B)%(Math.PI*2);R.currentPath.absellipse(xe,Pe,M,B,Te,Te+Qe,ie===0,D)}function a(R,M,B,D){const te=R*B+M*D,ie=Math.sqrt(R*R+M*M)*Math.sqrt(B*B+D*D);let Z=Math.acos(Math.max(-1,Math.min(1,te/ie)));return R*D-M*B<0&&(Z=-Z),Z}function l(R){const M=_(R.getAttribute("x")||0),B=_(R.getAttribute("y")||0),D=_(R.getAttribute("rx")||R.getAttribute("ry")||0),te=_(R.getAttribute("ry")||R.getAttribute("rx")||0),ie=_(R.getAttribute("width")),Z=_(R.getAttribute("height")),me=1-.551915024494,F=new Qr;return F.moveTo(M+D,B),F.lineTo(M+ie-D,B),(D!==0||te!==0)&&F.bezierCurveTo(M+ie-D*me,B,M+ie,B+te*me,M+ie,B+te),F.lineTo(M+ie,B+Z-te),(D!==0||te!==0)&&F.bezierCurveTo(M+ie,B+Z-te*me,M+ie-D*me,B+Z,M+ie-D,B+Z),F.lineTo(M+D,B+Z),(D!==0||te!==0)&&F.bezierCurveTo(M+D*me,B+Z,M,B+Z-te*me,M,B+Z-te),F.lineTo(M,B+te),(D!==0||te!==0)&&F.bezierCurveTo(M,B+te*me,M+D*me,B,M+D,B),F}function c(R){function M(ie,Z,me){const F=_(Z),Q=_(me);te===0?D.moveTo(F,Q):D.lineTo(F,Q),te++}const B=/([+-]?\d*\.?\d+(?:e[+-]?\d+)?)(?:,|\s)([+-]?\d*\.?\d+(?:e[+-]?\d+)?)/g,D=new Qr;let te=0;return R.getAttribute("points").replace(B,M),D.currentPath.autoClose=!0,D}function h(R){function M(ie,Z,me){const F=_(Z),Q=_(me);te===0?D.moveTo(F,Q):D.lineTo(F,Q),te++}const B=/([+-]?\d*\.?\d+(?:e[+-]?\d+)?)(?:,|\s)([+-]?\d*\.?\d+(?:e[+-]?\d+)?)/g,D=new Qr;let te=0;return R.getAttribute("points").replace(B,M),D.currentPath.autoClose=!1,D}function u(R){const M=_(R.getAttribute("cx")||0),B=_(R.getAttribute("cy")||0),D=_(R.getAttribute("r")||0),te=new ol;te.absarc(M,B,D,0,Math.PI*2);const ie=new Qr;return ie.subPaths.push(te),ie}function d(R){const M=_(R.getAttribute("cx")||0),B=_(R.getAttribute("cy")||0),D=_(R.getAttribute("rx")||0),te=_(R.getAttribute("ry")||0),ie=new ol;ie.absellipse(M,B,D,te,0,Math.PI*2);const Z=new Qr;return Z.subPaths.push(ie),Z}function f(R){const M=_(R.getAttribute("x1")||0),B=_(R.getAttribute("y1")||0),D=_(R.getAttribute("x2")||0),te=_(R.getAttribute("y2")||0),ie=new Qr;return ie.moveTo(M,B),ie.lineTo(D,te),ie.currentPath.autoClose=!1,ie}function p(R,M){M=Object.assign({},M);let B={};if(R.hasAttribute("class")){const Z=R.getAttribute("class").split(/\s/).filter(Boolean).map(me=>me.trim());for(let me=0;me<Z.length;me++)B=Object.assign(B,H["."+Z[me]])}R.hasAttribute("id")&&(B=Object.assign(B,H["#"+R.getAttribute("id")]));function D(Z,me,F){F===void 0&&(F=function(E){return E.startsWith("url")&&console.warn("SVGLoader: url access in attributes is not implemented."),E}),R.hasAttribute(Z)&&(M[me]=F(R.getAttribute(Z))),B[Z]&&(M[me]=F(B[Z])),R.style&&R.style[Z]!==""&&(M[me]=F(R.style[Z]))}function te(Z){return Math.max(0,Math.min(1,_(Z)))}function ie(Z){return Math.max(0,_(Z))}return D("fill","fill"),D("fill-opacity","fillOpacity",te),D("fill-rule","fillRule"),D("opacity","opacity",te),D("stroke","stroke"),D("stroke-opacity","strokeOpacity",te),D("stroke-width","strokeWidth",ie),D("stroke-linejoin","strokeLineJoin"),D("stroke-linecap","strokeLineCap"),D("stroke-miterlimit","strokeMiterLimit",ie),D("visibility","visibility"),M}function A(R,M){return R-(M-R)}function m(R,M,B){if(typeof R!="string")throw new TypeError("Invalid input: "+typeof R);const D={WHITESPACE:/[ \t\r\n]/,DIGIT:/[\d]/,SIGN:/[-+]/,POINT:/\./,COMMA:/,/,EXP:/e/i,FLAGS:/[01]/},te=0,ie=1,Z=2,me=3;let F=te,Q=!0,E="",j="";const q=[];function ce(k,N,oe){const pe=new SyntaxError('Unexpected character "'+k+'" at index '+N+".");throw pe.partial=oe,pe}function G(){E!==""&&(j===""?q.push(Number(E)):q.push(Number(E)*Math.pow(10,Number(j)))),E="",j=""}let V;const re=R.length;for(let k=0;k<re;k++){if(V=R[k],Array.isArray(M)&&M.includes(q.length%B)&&D.FLAGS.test(V)){F=ie,E=V,G();continue}if(F===te){if(D.WHITESPACE.test(V))continue;if(D.DIGIT.test(V)||D.SIGN.test(V)){F=ie,E=V;continue}if(D.POINT.test(V)){F=Z,E=V;continue}D.COMMA.test(V)&&(Q&&ce(V,k,q),Q=!0)}if(F===ie){if(D.DIGIT.test(V)){E+=V;continue}if(D.POINT.test(V)){E+=V,F=Z;continue}if(D.EXP.test(V)){F=me;continue}D.SIGN.test(V)&&E.length===1&&D.SIGN.test(E[0])&&ce(V,k,q)}if(F===Z){if(D.DIGIT.test(V)){E+=V;continue}if(D.EXP.test(V)){F=me;continue}D.POINT.test(V)&&E[E.length-1]==="."&&ce(V,k,q)}if(F===me){if(D.DIGIT.test(V)){j+=V;continue}if(D.SIGN.test(V)){if(j===""){j+=V;continue}j.length===1&&D.SIGN.test(j)&&ce(V,k,q)}}D.WHITESPACE.test(V)?(G(),F=te,Q=!1):D.COMMA.test(V)?(G(),F=te,Q=!0):D.SIGN.test(V)?(G(),F=ie,E=V):D.POINT.test(V)?(G(),F=Z,E=V):ce(V,k,q)}return G(),q}const g=["mm","cm","in","pt","pc","px"],y={mm:{mm:1,cm:.1,in:1/25.4,pt:72/25.4,pc:6/25.4,px:-1},cm:{mm:10,cm:1,in:1/2.54,pt:72/2.54,pc:6/2.54,px:-1},in:{mm:25.4,cm:2.54,in:1,pt:72,pc:6,px:-1},pt:{mm:25.4/72,cm:2.54/72,in:1/72,pt:1,pc:6/72,px:-1},pc:{mm:25.4/6,cm:2.54/6,in:1/6,pt:72/6,pc:1,px:-1},px:{px:1}};function _(R){let M="px";if(typeof R=="string"||R instanceof String)for(let D=0,te=g.length;D<te;D++){const ie=g[D];if(R.endsWith(ie)){M=ie,R=R.substring(0,R.length-ie.length);break}}let B;return M==="px"&&t.defaultUnit!=="px"?B=y.in[t.defaultUnit]/t.defaultDPI:(B=y[M][t.defaultUnit],B<0&&(B=y[M].in*t.defaultDPI)),B*parseFloat(R)}function v(R){if(!(R.hasAttribute("transform")||R.nodeName==="use"&&(R.hasAttribute("x")||R.hasAttribute("y"))))return null;const M=b(R);return K.length>0&&M.premultiply(K[K.length-1]),ee.copy(M),K.push(M),M}function b(R){const M=new wt,B=le;if(R.nodeName==="use"&&(R.hasAttribute("x")||R.hasAttribute("y"))){const D=_(R.getAttribute("x")),te=_(R.getAttribute("y"));M.translate(D,te)}if(R.hasAttribute("transform")){const D=R.getAttribute("transform").split(")");for(let te=D.length-1;te>=0;te--){const ie=D[te].trim();if(ie==="")continue;const Z=ie.indexOf("("),me=ie.length;if(Z>0&&Z<me){const F=ie.slice(0,Z),Q=m(ie.slice(Z+1));switch(B.identity(),F){case"translate":if(Q.length>=1){const E=Q[0];let j=0;Q.length>=2&&(j=Q[1]),B.translate(E,j)}break;case"rotate":if(Q.length>=1){let E=0,j=0,q=0;E=Q[0]*Math.PI/180,Q.length>=3&&(j=Q[1],q=Q[2]),J.makeTranslation(-j,-q),W.makeRotation(E),O.multiplyMatrices(W,J),J.makeTranslation(j,q),B.multiplyMatrices(J,O)}break;case"scale":if(Q.length>=1){const E=Q[0];let j=E;Q.length>=2&&(j=Q[1]),B.scale(E,j)}break;case"skewX":Q.length===1&&B.set(1,Math.tan(Q[0]*Math.PI/180),0,0,1,0,0,0,1);break;case"skewY":Q.length===1&&B.set(1,0,0,Math.tan(Q[0]*Math.PI/180),1,0,0,0,1);break;case"matrix":Q.length===6&&B.set(Q[0],Q[2],Q[4],Q[1],Q[3],Q[5],0,0,1);break}}M.premultiply(B)}}return M}function T(R,M){function B(Z){ue.set(Z.x,Z.y,1).applyMatrix3(M),Z.set(ue.x,ue.y)}function D(Z){const me=Z.xRadius,F=Z.yRadius,Q=Math.cos(Z.aRotation),E=Math.sin(Z.aRotation),j=new he(me*Q,me*E,0),q=new he(-F*E,F*Q,0),ce=j.applyMatrix3(M),G=q.applyMatrix3(M),V=le.set(ce.x,G.x,0,ce.y,G.y,0,0,0,1),re=J.copy(V).invert(),oe=W.copy(re).transpose().multiply(re).elements,pe=P(oe[0],oe[1],oe[4]),ve=Math.sqrt(pe.rt1),xe=Math.sqrt(pe.rt2);if(Z.xRadius=1/ve,Z.yRadius=1/xe,Z.aRotation=Math.atan2(pe.sn,pe.cs),!((Z.aEndAngle-Z.aStartAngle)%(2*Math.PI)<Number.EPSILON)){const Te=J.set(ve,0,0,0,xe,0,0,0,1),Qe=W.set(pe.cs,pe.sn,0,-pe.sn,pe.cs,0,0,0,1),lt=Te.multiply(Qe).multiply(V),Ne=qe=>{const{x:Ke,y:it}=new he(Math.cos(qe),Math.sin(qe),0).applyMatrix3(lt);return Math.atan2(it,Ke)};Z.aStartAngle=Ne(Z.aStartAngle),Z.aEndAngle=Ne(Z.aEndAngle),L(M)&&(Z.aClockwise=!Z.aClockwise)}}function te(Z){const me=x(M),F=w(M);Z.xRadius*=me,Z.yRadius*=F;const Q=me>Number.EPSILON?Math.atan2(M.elements[1],M.elements[0]):Math.atan2(-M.elements[3],M.elements[4]);Z.aRotation+=Q,L(M)&&(Z.aStartAngle*=-1,Z.aEndAngle*=-1,Z.aClockwise=!Z.aClockwise)}const ie=R.subPaths;for(let Z=0,me=ie.length;Z<me;Z++){const Q=ie[Z].curves;for(let E=0;E<Q.length;E++){const j=Q[E];j.isLineCurve?(B(j.v1),B(j.v2)):j.isCubicBezierCurve?(B(j.v0),B(j.v1),B(j.v2),B(j.v3)):j.isQuadraticBezierCurve?(B(j.v0),B(j.v1),B(j.v2)):j.isEllipseCurve&&(fe.set(j.aX,j.aY),B(fe),j.aX=fe.x,j.aY=fe.y,I(M)?D(j):te(j))}}}function L(R){const M=R.elements;return M[0]*M[4]-M[1]*M[3]<0}function I(R){const M=R.elements,B=M[0]*M[3]+M[1]*M[4];if(B===0)return!1;const D=x(R),te=w(R);return Math.abs(B/(D*te))>Number.EPSILON}function x(R){const M=R.elements;return Math.sqrt(M[0]*M[0]+M[1]*M[1])}function w(R){const M=R.elements;return Math.sqrt(M[3]*M[3]+M[4]*M[4])}function P(R,M,B){let D,te,ie,Z,me;const F=R+B,Q=R-B,E=Math.sqrt(Q*Q+4*M*M);return F>0?(D=.5*(F+E),me=1/D,te=R*me*B-M*me*M):F<0?te=.5*(F-E):(D=.5*E,te=-.5*E),Q>0?ie=Q+E:ie=Q-E,Math.abs(ie)>2*Math.abs(M)?(me=-2*M/ie,Z=1/Math.sqrt(1+me*me),ie=me*Z):Math.abs(M)===0?(ie=1,Z=0):(me=-.5*ie/M,ie=1/Math.sqrt(1+me*me),Z=me*ie),Q>0&&(me=ie,ie=-Z,Z=me),{rt1:D,rt2:te,cs:ie,sn:Z}}const z=[],H={},K=[],le=new wt,J=new wt,W=new wt,O=new wt,fe=new Me,ue=new he,ee=new wt,de=new DOMParser().parseFromString(e,"image/svg+xml");return n(de.documentElement,{fill:"#000",fillOpacity:1,strokeOpacity:1,strokeWidth:1,strokeLineJoin:"miter",strokeLineCap:"butt",strokeMiterLimit:4}),{paths:z,xml:de.documentElement}}static createShapes(e){const n={ORIGIN:0,DESTINATION:1,BETWEEN:2,LEFT:3,RIGHT:4,BEHIND:5,BEYOND:6},s={loc:n.ORIGIN,t:0};function r(A,m,g,y){const _=A.x,v=m.x,b=g.x,T=y.x,L=A.y,I=m.y,x=g.y,w=y.y,P=(T-b)*(L-x)-(w-x)*(_-b),z=(v-_)*(L-x)-(I-L)*(_-b),H=(w-x)*(v-_)-(T-b)*(I-L),K=P/H,le=z/H;if(H===0&&P!==0||K<=0||K>=1||le<0||le>1)return null;if(P===0&&H===0){for(let J=0;J<2;J++)if(o(J===0?g:y,A,m),s.loc==n.ORIGIN){const W=J===0?g:y;return{x:W.x,y:W.y,t:s.t}}else if(s.loc==n.BETWEEN){const W=+(_+s.t*(v-_)).toPrecision(10),O=+(L+s.t*(I-L)).toPrecision(10);return{x:W,y:O,t:s.t}}return null}else{for(let O=0;O<2;O++)if(o(O===0?g:y,A,m),s.loc==n.ORIGIN){const fe=O===0?g:y;return{x:fe.x,y:fe.y,t:s.t}}const J=+(_+K*(v-_)).toPrecision(10),W=+(L+K*(I-L)).toPrecision(10);return{x:J,y:W,t:K}}}function o(A,m,g){const y=g.x-m.x,_=g.y-m.y,v=A.x-m.x,b=A.y-m.y,T=y*b-v*_;if(A.x===m.x&&A.y===m.y){s.loc=n.ORIGIN,s.t=0;return}if(A.x===g.x&&A.y===g.y){s.loc=n.DESTINATION,s.t=1;return}if(T<-Number.EPSILON){s.loc=n.LEFT;return}if(T>Number.EPSILON){s.loc=n.RIGHT;return}if(y*v<0||_*b<0){s.loc=n.BEHIND;return}if(Math.sqrt(y*y+_*_)<Math.sqrt(v*v+b*b)){s.loc=n.BEYOND;return}let L;y!==0?L=v/y:L=b/_,s.loc=n.BETWEEN,s.t=L}function a(A,m){const g=[],y=[];for(let _=1;_<A.length;_++){const v=A[_-1],b=A[_];for(let T=1;T<m.length;T++){const L=m[T-1],I=m[T],x=r(v,b,L,I);x!==null&&g.find(w=>w.t<=x.t+Number.EPSILON&&w.t>=x.t-Number.EPSILON)===void 0&&(g.push(x),y.push(new Me(x.x,x.y)))}}return y}function l(A,m,g){const y=new Me;m.getCenter(y);const _=[];return g.forEach(v=>{v.boundingBox.containsPoint(y)&&a(A,v.points).forEach(T=>{_.push({identifier:v.identifier,isCW:v.isCW,point:T})})}),_.sort((v,b)=>v.point.x-b.point.x),_}function c(A,m,g,y,_){(_==null||_==="")&&(_="nonzero");const v=new Me;A.boundingBox.getCenter(v);const b=[new Me(g,v.y),new Me(y,v.y)],T=l(b,A.boundingBox,m);T.sort((z,H)=>z.point.x-H.point.x);const L=[],I=[];T.forEach(z=>{z.identifier===A.identifier?L.push(z):I.push(z)});const x=L[0].point.x,w=[];let P=0;for(;P<I.length&&I[P].point.x<x;)w.length>0&&w[w.length-1]===I[P].identifier?w.pop():w.push(I[P].identifier),P++;if(w.push(A.identifier),_==="evenodd"){const z=w.length%2===0,H=w[w.length-2];return{identifier:A.identifier,isHole:z,for:H}}else if(_==="nonzero"){let z=!0,H=null,K=null;for(let le=0;le<w.length;le++){const J=w[le];z?(K=m[J].isCW,z=!1,H=J):K!==m[J].isCW&&(K=m[J].isCW,z=!0)}return{identifier:A.identifier,isHole:z,for:H}}else console.warn('fill-rule: "'+_+'" is currently not implemented.')}let h=999999999,u=-999999999,d=e.subPaths.map(A=>{const m=A.getPoints();let g=-999999999,y=999999999,_=-999999999,v=999999999;for(let b=0;b<m.length;b++){const T=m[b];T.y>g&&(g=T.y),T.y<y&&(y=T.y),T.x>_&&(_=T.x),T.x<v&&(v=T.x)}return u<=_&&(u=_+1),h>=v&&(h=v-1),{curves:A.curves,points:m,isCW:io.isClockWise(m),identifier:-1,boundingBox:new GB(new Me(v,y),new Me(_,g))}});d=d.filter(A=>A.points.length>1);for(let A=0;A<d.length;A++)d[A].identifier=A;const f=d.map(A=>c(A,d,h,u,e.userData?e.userData.style.fillRule:void 0)),p=[];return d.forEach(A=>{if(!f[A.identifier].isHole){const g=new Tc;g.curves=A.curves,f.filter(_=>_.isHole&&_.for===A.identifier).forEach(_=>{const v=d[_.identifier],b=new ol;b.curves=v.curves,g.holes.push(b)}),p.push(g)}}),p}static getStrokeStyle(e,t,n,s,r){return e=e!==void 0?e:1,t=t!==void 0?t:"#000",n=n!==void 0?n:"miter",s=s!==void 0?s:"butt",r=r!==void 0?r:4,{strokeColor:t,strokeWidth:e,strokeLineJoin:n,strokeLineCap:s,strokeMiterLimit:r}}static pointsToStroke(e,t,n,s){const r=[],o=[],a=[];if(ev.pointsToStrokeWithBuffers(e,t,n,s,r,o,a)===0)return null;const l=new Nn;return l.setAttribute("position",new jt(r,3)),l.setAttribute("normal",new jt(o,3)),l.setAttribute("uv",new jt(a,2)),l}static pointsToStrokeWithBuffers(e,t,n,s,r,o,a,l){const c=new Me,h=new Me,u=new Me,d=new Me,f=new Me,p=new Me,A=new Me,m=new Me,g=new Me,y=new Me,_=new Me,v=new Me,b=new Me,T=new Me,L=new Me,I=new Me,x=new Me;n=n!==void 0?n:12,s=s!==void 0?s:.001,l=l!==void 0?l:0,e=Q(e);const w=e.length;if(w<2)return 0;const P=e[0].equals(e[w-1]);let z,H=e[0],K;const le=t.strokeWidth/2,J=1/(w-1);let W=0,O,fe,ue,ee,de=!1,ae=0,R=l*3,M=l*2;B(e[0],e[1],c).multiplyScalar(le),m.copy(e[0]).sub(c),g.copy(e[0]).add(c),y.copy(m),_.copy(g);for(let E=1;E<w;E++){z=e[E],E===w-1?P?K=e[1]:K=void 0:K=e[E+1];const j=c;if(B(H,z,j),u.copy(j).multiplyScalar(le),v.copy(z).sub(u),b.copy(z).add(u),O=W+J,fe=!1,K!==void 0){B(z,K,h),u.copy(h).multiplyScalar(le),T.copy(z).sub(u),L.copy(z).add(u),ue=!0,u.subVectors(K,H),j.dot(u)<0&&(ue=!1),E===1&&(de=ue),u.subVectors(K,z),u.normalize();const q=Math.abs(j.dot(u));if(q>Number.EPSILON){const ce=le/q;u.multiplyScalar(-ce),d.subVectors(z,H),f.copy(d).setLength(ce).add(u),I.copy(f).negate();const G=f.length(),V=d.length();d.divideScalar(V),p.subVectors(K,z);const re=p.length();switch(p.divideScalar(re),d.dot(I)<V&&p.dot(I)<re&&(fe=!0),x.copy(f).add(z),I.add(z),ee=!1,fe?ue?(L.copy(I),b.copy(I)):(T.copy(I),v.copy(I)):ie(),t.strokeLineJoin){case"bevel":Z(ue,fe,O);break;case"round":me(ue,fe),ue?te(z,v,T,O,0):te(z,L,b,O,1);break;case"miter":case"miter-clip":default:const k=le*t.strokeMiterLimit/G;if(k<1)if(t.strokeLineJoin!=="miter-clip"){Z(ue,fe,O);break}else me(ue,fe),ue?(p.subVectors(x,v).multiplyScalar(k).add(v),A.subVectors(x,T).multiplyScalar(k).add(T),D(v,O,0),D(p,O,0),D(z,O,.5),D(z,O,.5),D(p,O,0),D(A,O,0),D(z,O,.5),D(A,O,0),D(T,O,0)):(p.subVectors(x,b).multiplyScalar(k).add(b),A.subVectors(x,L).multiplyScalar(k).add(L),D(b,O,1),D(p,O,1),D(z,O,.5),D(z,O,.5),D(p,O,1),D(A,O,1),D(z,O,.5),D(A,O,1),D(L,O,1));else fe?(ue?(D(g,W,1),D(m,W,0),D(x,O,0),D(g,W,1),D(x,O,0),D(I,O,1)):(D(g,W,1),D(m,W,0),D(x,O,1),D(m,W,0),D(I,O,0),D(x,O,1)),ue?T.copy(x):L.copy(x)):ue?(D(v,O,0),D(x,O,0),D(z,O,.5),D(z,O,.5),D(x,O,0),D(T,O,0)):(D(b,O,1),D(x,O,1),D(z,O,.5),D(z,O,.5),D(x,O,1),D(L,O,1)),ee=!0;break}}else ie()}else ie();!P&&E===w-1&&F(e[0],y,_,ue,!0,W),W=O,H=z,m.copy(T),g.copy(L)}if(!P)F(z,v,b,ue,!1,O);else if(fe&&r){let E=x,j=I;de!==ue&&(E=I,j=x),ue?(ee||de)&&(j.toArray(r,0*3),j.toArray(r,3*3),ee&&E.toArray(r,1*3)):(ee||!de)&&(j.toArray(r,1*3),j.toArray(r,3*3),ee&&E.toArray(r,0*3))}return ae;function B(E,j,q){return q.subVectors(j,E),q.set(-q.y,q.x).normalize()}function D(E,j,q){r&&(r[R]=E.x,r[R+1]=E.y,r[R+2]=0,o&&(o[R]=0,o[R+1]=0,o[R+2]=1),R+=3,a&&(a[M]=j,a[M+1]=q,M+=2)),ae+=3}function te(E,j,q,ce,G){c.copy(j).sub(E).normalize(),h.copy(q).sub(E).normalize();let V=Math.PI;const re=c.dot(h);Math.abs(re)<1&&(V=Math.abs(Math.acos(re))),V/=n,u.copy(j);for(let k=0,N=n-1;k<N;k++)d.copy(u).rotateAround(E,V),D(u,ce,G),D(d,ce,G),D(E,ce,.5),u.copy(d);D(d,ce,G),D(q,ce,G),D(E,ce,.5)}function ie(){D(g,W,1),D(m,W,0),D(v,O,0),D(g,W,1),D(v,O,0),D(b,O,1)}function Z(E,j,q){j?E?(D(g,W,1),D(m,W,0),D(v,O,0),D(g,W,1),D(v,O,0),D(I,O,1),D(v,q,0),D(T,q,0),D(I,q,.5)):(D(g,W,1),D(m,W,0),D(b,O,1),D(m,W,0),D(I,O,0),D(b,O,1),D(b,q,1),D(I,q,0),D(L,q,1)):E?(D(v,q,0),D(T,q,0),D(z,q,.5)):(D(b,q,1),D(L,q,0),D(z,q,.5))}function me(E,j){j&&(E?(D(g,W,1),D(m,W,0),D(v,O,0),D(g,W,1),D(v,O,0),D(I,O,1),D(v,W,0),D(z,O,.5),D(I,O,1),D(z,O,.5),D(T,W,0),D(I,O,1)):(D(g,W,1),D(m,W,0),D(b,O,1),D(m,W,0),D(I,O,0),D(b,O,1),D(b,W,1),D(I,O,0),D(z,O,.5),D(z,O,.5),D(I,O,0),D(L,W,1)))}function F(E,j,q,ce,G,V){switch(t.strokeLineCap){case"round":G?te(E,q,j,V,.5):te(E,j,q,V,.5);break;case"square":if(G)c.subVectors(j,E),h.set(c.y,-c.x),u.addVectors(c,h).add(E),d.subVectors(h,c).add(E),ce?(u.toArray(r,1*3),d.toArray(r,0*3),d.toArray(r,3*3)):(u.toArray(r,1*3),a[3*2+1]===1?d.toArray(r,3*3):u.toArray(r,3*3),d.toArray(r,0*3));else{c.subVectors(q,E),h.set(c.y,-c.x),u.addVectors(c,h).add(E),d.subVectors(h,c).add(E);const re=r.length;ce?(u.toArray(r,re-1*3),d.toArray(r,re-2*3),d.toArray(r,re-4*3)):(d.toArray(r,re-2*3),u.toArray(r,re-1*3),d.toArray(r,re-4*3))}break}}function Q(E){let j=!1;for(let ce=1,G=E.length-1;ce<G;ce++)if(E[ce].distanceTo(E[ce+1])<s){j=!0;break}if(!j)return E;const q=[];q.push(E[0]);for(let ce=1,G=E.length-1;ce<G;ce++)E[ce].distanceTo(E[ce+1])>=s&&q.push(E[ce]);return q.push(E[E.length-1]),q}}}class UQ extends nf{constructor(e,t={}){super(),this.experience=new ti,this.renderer=this.experience.renderer,this.sources=e,this.items={},this.toLoad=this.sources.length,this.loaded=0,this.loadingScreen=document.getElementById("loading-screen"),this.loadingBar=document.getElementById("loading-bar"),this.loadingPercentage=document.getElementById("loading-percentage"),this.options={dracoDecoderPath:"https://www.gstatic.com/draco/v1/decoders/",ktx2TranscoderPath:"https://unpkg.com/three/examples/jsm/libs/basis/",...t},this.setLoaders(),this.startLoading()}setLoaders(){this.loaders={},this.loaders.gltfLoader=new N3,this.loaders.textureLoader=new vg,this.loaders.cubeTextureLoader=new CB,this.loaders.fontLoader=new P3,this.loaders.fbxLoader=new y3,this.loaders.audioLoader=new RB,this.loaders.objLoader=new NQ,this.loaders.hdrTextureLoader=new kQ,this.loaders.svgLoader=new ev,this.loaders.exrLoader=new u3,this.loaders.ktx2Loader=new rs;const e=new XU;e.setDecoderPath(this.options.dracoDecoderPath),this.loaders.gltfLoader.setDRACOLoader(e),this.loaders.ktx2Loader.setTranscoderPath(this.options.ktx2TranscoderPath).detectSupport(this.renderer.instance),this.loaders.gltfLoader.setKTX2Loader(this.loaders.ktx2Loader)}startLoading(){for(const e of this.sources)switch(e.type){case"gltfModel":{this.loaders.gltfLoader.load(e.path,t=>{this.sourceLoaded(e,t)});break}case"texture":{this.loaders.textureLoader.load(e.path,t=>{this.sourceLoaded(e,t)});break}case"cubeTexture":{this.loaders.cubeTextureLoader.load(e.path,t=>{this.sourceLoaded(e,t)});break}case"font":{this.loaders.fontLoader.load(e.path,t=>{this.sourceLoaded(e,t)});break}case"fbxModel":{this.loaders.fbxLoader.load(e.path,t=>{this.sourceLoaded(e,t)});break}case"audio":{this.loaders.audioLoader.load(e.path,t=>{this.sourceLoaded(e,t)});break}case"objModel":{this.loaders.objLoader.load(e.path,t=>{this.sourceLoaded(e,t)});break}case"hdrTexture":{this.loaders.hdrTextureLoader.load(e.path,t=>{this.sourceLoaded(e,t)});break}case"svg":{this.loaders.svgLoader.load(e.path,t=>{this.sourceLoaded(e,t)});break}case"exrTexture":{this.loaders.exrLoader.load(e.path,t=>{this.sourceLoaded(e,t)});break}case"video":{this.loadVideoTexture(e.path).then(t=>{this.sourceLoaded(e,t)});break}case"ktx2Texture":{this.loaders.ktx2Loader.load(e.path,t=>{this.sourceLoaded(e,t)});break}}}sourceLoaded(e,t){this.items[e.name]=t,this.loaded++;const n=this.loadProgress,s=Math.round(n*100);this.loadingBar&&(this.loadingBar.style.width="".concat(s,"%")),this.loadingPercentage&&(this.loadingPercentage.textContent="".concat(s,"%")),this.loaded===this.toLoad&&(this.loadingScreen&&(this.loadingScreen.style.transition="opacity 0.5s ease-out",this.loadingScreen.style.opacity="0",setTimeout(()=>{this.loadingScreen.style.display="none"},500)),this.trigger("ready"))}loadVideoTexture(e){return new Promise(t=>{const n=document.createElement("video");n.src=e,n.loop=!0,n.muted=!0,n.playsInline=!0,n.addEventListener("loadeddata",()=>{const s=new T1(n);s.minFilter=Zt,s.magFilter=Zt,s.format=sg,t(s)}),n.load()})}get loadProgress(){return this.loaded/this.toLoad}get isLoaded(){return this.loaded===this.toLoad}}class QQ extends nf{constructor(){super(),this.width=window.innerWidth,this.height=window.innerHeight,this.aspect=this.width/this.height,this.pixelRatio=Math.min(window.devicePixelRatio,2),window.addEventListener("resize",()=>{this.width=window.innerWidth,this.height=window.innerHeight,this.pixelRatio=Math.min(window.devicePixelRatio,2),this.trigger("resize")})}}var Pc=function(){var i=0,e=document.createElement("div");e.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",e.addEventListener("click",function(h){h.preventDefault(),n(++i%e.children.length)},!1);function t(h){return e.appendChild(h.dom),h}function n(h){for(var u=0;u<e.children.length;u++)e.children[u].style.display=u===h?"block":"none";i=h}var s=(performance||Date).now(),r=s,o=0,a=t(new Pc.Panel("FPS","#0ff","#002")),l=t(new Pc.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var c=t(new Pc.Panel("MB","#f08","#201"));return n(0),{REVISION:16,dom:e,addPanel:t,showPanel:n,begin:function(){s=(performance||Date).now()},end:function(){o++;var h=(performance||Date).now();if(l.update(h-s,200),h>=r+1e3&&(a.update(o*1e3/(h-r),100),r=h,o=0,c)){var u=performance.memory;c.update(u.usedJSHeapSize/1048576,u.jsHeapSizeLimit/1048576)}return h},update:function(){s=this.end()},domElement:e,setMode:n}};Pc.Panel=function(i,e,t){var n=1/0,s=0,r=Math.round,o=r(window.devicePixelRatio||1),a=80*o,l=48*o,c=3*o,h=2*o,u=3*o,d=15*o,f=74*o,p=30*o,A=document.createElement("canvas");A.width=a,A.height=l,A.style.cssText="width:80px;height:48px";var m=A.getContext("2d");return m.font="bold "+9*o+"px Helvetica,Arial,sans-serif",m.textBaseline="top",m.fillStyle=t,m.fillRect(0,0,a,l),m.fillStyle=e,m.fillText(i,c,h),m.fillRect(u,d,f,p),m.fillStyle=t,m.globalAlpha=.9,m.fillRect(u,d,f,p),{dom:A,update:function(g,y){n=Math.min(n,g),s=Math.max(s,g),m.fillStyle=t,m.globalAlpha=1,m.fillRect(0,0,a,d),m.fillStyle=e,m.fillText(r(g)+" "+i+" ("+r(n)+"-"+r(s)+")",c,h),m.drawImage(A,u+o,d,f-o,p,u,d,f-o,p),m.fillRect(u+f-o,d,o,p),m.fillStyle=t,m.globalAlpha=.9,m.fillRect(u+f-o,d,o,r((1-g/y)*p))}}};class VQ{constructor(){this.active=window.location.hash==="#debug",this.active&&(this.stats=new Pc,this.stats.showPanel(0),document.body.append(this.stats.dom),this.stats.dom.style.width="200px",this.stats.dom.style.height="100px",this.stats.dom.style.fontSize="16px")}update(){this.active&&this.stats.update()}}class zQ extends nf{constructor(){super(),this.start=Date.now(),this.current=this.start,this.elapsed=0,this.delta=16,window.requestAnimationFrame(()=>{this.tick()})}tick(){const e=Date.now();this.delta=e-this.current,this.delta=Math.min(this.delta,50),this.current=e,this.elapsed=this.current-this.start,this.trigger("tick"),window.requestAnimationFrame(()=>{this.tick()})}}var ms=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function GQ(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}function HQ(i){if(i.__esModule)return i;var e=i.default;if(typeof e=="function"){var t=function n(){return this instanceof n?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(i).forEach(function(n){var s=Object.getOwnPropertyDescriptor(i,n);Object.defineProperty(t,n,s.get?s:{enumerable:!0,get:function(){return i[n]}})}),t}function Cu(i){throw new Error('Could not dynamically require "'+i+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var UE={exports:{}};(function(i,e){(function(t){i.exports=t()})(function(){return function t(n,s,r){function o(c,h){if(!s[c]){if(!n[c]){var u=typeof Cu=="function"&&Cu;if(!h&&u)return u(c,!0);if(a)return a(c,!0);throw new Error("Cannot find module '"+c+"'")}var d=s[c]={exports:{}};n[c][0].call(d.exports,function(f){var p=n[c][1][f];return o(p||f)},d,d.exports,t,n,s,r)}return s[c].exports}for(var a=typeof Cu=="function"&&Cu,l=0;l<r.length;l++)o(r[l]);return o}({1:[function(t,n,s){n.exports={name:"cannon",version:"0.6.2",description:"A lightweight 3D physics engine written in JavaScript.",homepage:"https://github.com/schteppe/cannon.js",author:"Stefan Hedman <schteppe@gmail.com> (http://steffe.se)",keywords:["cannon.js","cannon","physics","engine","3d"],main:"./build/cannon.js",engines:{node:"*"},repository:{type:"git",url:"https://github.com/schteppe/cannon.js.git"},bugs:{url:"https://github.com/schteppe/cannon.js/issues"},licenses:[{type:"MIT"}],devDependencies:{jshint:"latest","uglify-js":"latest",nodeunit:"^0.9.0",grunt:"~0.4.0","grunt-contrib-jshint":"~0.1.1","grunt-contrib-nodeunit":"^0.4.1","grunt-contrib-concat":"~0.1.3","grunt-contrib-uglify":"^0.5.1","grunt-browserify":"^2.1.4","grunt-contrib-yuidoc":"^0.5.2",browserify:"*"},dependencies:{}}},{}],2:[function(t,n,s){n.exports={version:t("../package.json").version,AABB:t("./collision/AABB"),ArrayCollisionMatrix:t("./collision/ArrayCollisionMatrix"),Body:t("./objects/Body"),Box:t("./shapes/Box"),Broadphase:t("./collision/Broadphase"),Constraint:t("./constraints/Constraint"),ContactEquation:t("./equations/ContactEquation"),Narrowphase:t("./world/Narrowphase"),ConeTwistConstraint:t("./constraints/ConeTwistConstraint"),ContactMaterial:t("./material/ContactMaterial"),ConvexPolyhedron:t("./shapes/ConvexPolyhedron"),Cylinder:t("./shapes/Cylinder"),DistanceConstraint:t("./constraints/DistanceConstraint"),Equation:t("./equations/Equation"),EventTarget:t("./utils/EventTarget"),FrictionEquation:t("./equations/FrictionEquation"),GSSolver:t("./solver/GSSolver"),GridBroadphase:t("./collision/GridBroadphase"),Heightfield:t("./shapes/Heightfield"),HingeConstraint:t("./constraints/HingeConstraint"),LockConstraint:t("./constraints/LockConstraint"),Mat3:t("./math/Mat3"),Material:t("./material/Material"),NaiveBroadphase:t("./collision/NaiveBroadphase"),ObjectCollisionMatrix:t("./collision/ObjectCollisionMatrix"),Pool:t("./utils/Pool"),Particle:t("./shapes/Particle"),Plane:t("./shapes/Plane"),PointToPointConstraint:t("./constraints/PointToPointConstraint"),Quaternion:t("./math/Quaternion"),Ray:t("./collision/Ray"),RaycastVehicle:t("./objects/RaycastVehicle"),RaycastResult:t("./collision/RaycastResult"),RigidVehicle:t("./objects/RigidVehicle"),RotationalEquation:t("./equations/RotationalEquation"),RotationalMotorEquation:t("./equations/RotationalMotorEquation"),SAPBroadphase:t("./collision/SAPBroadphase"),SPHSystem:t("./objects/SPHSystem"),Shape:t("./shapes/Shape"),Solver:t("./solver/Solver"),Sphere:t("./shapes/Sphere"),SplitSolver:t("./solver/SplitSolver"),Spring:t("./objects/Spring"),Trimesh:t("./shapes/Trimesh"),Vec3:t("./math/Vec3"),Vec3Pool:t("./utils/Vec3Pool"),World:t("./world/World")}},{"../package.json":1,"./collision/AABB":3,"./collision/ArrayCollisionMatrix":4,"./collision/Broadphase":5,"./collision/GridBroadphase":6,"./collision/NaiveBroadphase":7,"./collision/ObjectCollisionMatrix":8,"./collision/Ray":9,"./collision/RaycastResult":10,"./collision/SAPBroadphase":11,"./constraints/ConeTwistConstraint":12,"./constraints/Constraint":13,"./constraints/DistanceConstraint":14,"./constraints/HingeConstraint":15,"./constraints/LockConstraint":16,"./constraints/PointToPointConstraint":17,"./equations/ContactEquation":19,"./equations/Equation":20,"./equations/FrictionEquation":21,"./equations/RotationalEquation":22,"./equations/RotationalMotorEquation":23,"./material/ContactMaterial":24,"./material/Material":25,"./math/Mat3":27,"./math/Quaternion":28,"./math/Vec3":30,"./objects/Body":31,"./objects/RaycastVehicle":32,"./objects/RigidVehicle":33,"./objects/SPHSystem":34,"./objects/Spring":35,"./shapes/Box":37,"./shapes/ConvexPolyhedron":38,"./shapes/Cylinder":39,"./shapes/Heightfield":40,"./shapes/Particle":41,"./shapes/Plane":42,"./shapes/Shape":43,"./shapes/Sphere":44,"./shapes/Trimesh":45,"./solver/GSSolver":46,"./solver/Solver":47,"./solver/SplitSolver":48,"./utils/EventTarget":49,"./utils/Pool":51,"./utils/Vec3Pool":54,"./world/Narrowphase":55,"./world/World":56}],3:[function(t,n,s){var r=t("../math/Vec3");t("../utils/Utils"),n.exports=o;function o(c){c=c||{},this.lowerBound=new r,c.lowerBound&&this.lowerBound.copy(c.lowerBound),this.upperBound=new r,c.upperBound&&this.upperBound.copy(c.upperBound)}var a=new r;o.prototype.setFromPoints=function(c,h,u,d){var f=this.lowerBound,p=this.upperBound,A=u;f.copy(c[0]),A&&A.vmult(f,f),p.copy(f);for(var m=1;m<c.length;m++){var g=c[m];A&&(A.vmult(g,a),g=a),g.x>p.x&&(p.x=g.x),g.x<f.x&&(f.x=g.x),g.y>p.y&&(p.y=g.y),g.y<f.y&&(f.y=g.y),g.z>p.z&&(p.z=g.z),g.z<f.z&&(f.z=g.z)}return h&&(h.vadd(f,f),h.vadd(p,p)),d&&(f.x-=d,f.y-=d,f.z-=d,p.x+=d,p.y+=d,p.z+=d),this},o.prototype.copy=function(c){return this.lowerBound.copy(c.lowerBound),this.upperBound.copy(c.upperBound),this},o.prototype.clone=function(){return new o().copy(this)},o.prototype.extend=function(c){var h=c.lowerBound.x;this.lowerBound.x>h&&(this.lowerBound.x=h);var u=c.upperBound.x;this.upperBound.x<u&&(this.upperBound.x=u);var h=c.lowerBound.y;this.lowerBound.y>h&&(this.lowerBound.y=h);var u=c.upperBound.y;this.upperBound.y<u&&(this.upperBound.y=u);var h=c.lowerBound.z;this.lowerBound.z>h&&(this.lowerBound.z=h);var u=c.upperBound.z;this.upperBound.z<u&&(this.upperBound.z=u)},o.prototype.overlaps=function(c){var h=this.lowerBound,u=this.upperBound,d=c.lowerBound,f=c.upperBound;return(d.x<=u.x&&u.x<=f.x||h.x<=f.x&&f.x<=u.x)&&(d.y<=u.y&&u.y<=f.y||h.y<=f.y&&f.y<=u.y)&&(d.z<=u.z&&u.z<=f.z||h.z<=f.z&&f.z<=u.z)},o.prototype.contains=function(c){var h=this.lowerBound,u=this.upperBound,d=c.lowerBound,f=c.upperBound;return h.x<=d.x&&u.x>=f.x&&h.y<=d.y&&u.y>=f.y&&h.z<=d.z&&u.z>=f.z},o.prototype.getCorners=function(c,h,u,d,f,p,A,m){var g=this.lowerBound,y=this.upperBound;c.copy(g),h.set(y.x,g.y,g.z),u.set(y.x,y.y,g.z),d.set(g.x,y.y,y.z),f.set(y.x,g.y,g.z),p.set(g.x,y.y,g.z),A.set(g.x,g.y,y.z),m.copy(y)};var l=[new r,new r,new r,new r,new r,new r,new r,new r];o.prototype.toLocalFrame=function(c,h){var u=l,d=u[0],f=u[1],p=u[2],A=u[3],m=u[4],g=u[5],y=u[6],_=u[7];this.getCorners(d,f,p,A,m,g,y,_);for(var v=0;v!==8;v++){var b=u[v];c.pointToLocal(b,b)}return h.setFromPoints(u)},o.prototype.toWorldFrame=function(c,h){var u=l,d=u[0],f=u[1],p=u[2],A=u[3],m=u[4],g=u[5],y=u[6],_=u[7];this.getCorners(d,f,p,A,m,g,y,_);for(var v=0;v!==8;v++){var b=u[v];c.pointToWorld(b,b)}return h.setFromPoints(u)}},{"../math/Vec3":30,"../utils/Utils":53}],4:[function(t,n,s){n.exports=r;function r(){this.matrix=[]}r.prototype.get=function(o,a){if(o=o.index,a=a.index,a>o){var l=a;a=o,o=l}return this.matrix[(o*(o+1)>>1)+a-1]},r.prototype.set=function(o,a,l){if(o=o.index,a=a.index,a>o){var c=a;a=o,o=c}this.matrix[(o*(o+1)>>1)+a-1]=l?1:0},r.prototype.reset=function(){for(var o=0,a=this.matrix.length;o!==a;o++)this.matrix[o]=0},r.prototype.setNumObjects=function(o){this.matrix.length=o*(o-1)>>1}},{}],5:[function(t,n,s){var r=t("../objects/Body"),o=t("../math/Vec3"),a=t("../math/Quaternion");t("../shapes/Shape"),t("../shapes/Plane"),n.exports=l;function l(){this.world=null,this.useBoundingBoxes=!1,this.dirty=!0}l.prototype.collisionPairs=function(A,m,g){throw new Error("collisionPairs not implemented for this BroadPhase class!")};var c=r.STATIC|r.KINEMATIC;l.prototype.needBroadphaseCollision=function(A,m){return!(!(A.collisionFilterGroup&m.collisionFilterMask)||!(m.collisionFilterGroup&A.collisionFilterMask)||(A.type&c||A.sleepState===r.SLEEPING)&&(m.type&c||m.sleepState===r.SLEEPING))},l.prototype.intersectionTest=function(A,m,g,y){this.useBoundingBoxes?this.doBoundingBoxBroadphase(A,m,g,y):this.doBoundingSphereBroadphase(A,m,g,y)};var h=new o;new o,new a,new o,l.prototype.doBoundingSphereBroadphase=function(A,m,g,y){var _=h;m.position.vsub(A.position,_);var v=Math.pow(A.boundingRadius+m.boundingRadius,2),b=_.norm2();b<v&&(g.push(A),y.push(m))},l.prototype.doBoundingBoxBroadphase=function(A,m,g,y){A.aabbNeedsUpdate&&A.computeAABB(),m.aabbNeedsUpdate&&m.computeAABB(),A.aabb.overlaps(m.aabb)&&(g.push(A),y.push(m))};var u={keys:[]},d=[],f=[];l.prototype.makePairsUnique=function(A,m){for(var g=u,y=d,_=f,v=A.length,b=0;b!==v;b++)y[b]=A[b],_[b]=m[b];A.length=0,m.length=0;for(var b=0;b!==v;b++){var T=y[b].id,L=_[b].id,I=T<L?T+","+L:L+","+T;g[I]=b,g.keys.push(I)}for(var b=0;b!==g.keys.length;b++){var I=g.keys.pop(),x=g[I];A.push(y[x]),m.push(_[x]),delete g[I]}},l.prototype.setWorld=function(A){};var p=new o;l.boundingSphereCheck=function(A,m){var g=p;return A.position.vsub(m.position,g),Math.pow(A.shape.boundingSphereRadius+m.shape.boundingSphereRadius,2)>g.norm2()},l.prototype.aabbQuery=function(A,m,g){return console.warn(".aabbQuery is not implemented in this Broadphase subclass."),[]}},{"../math/Quaternion":28,"../math/Vec3":30,"../objects/Body":31,"../shapes/Plane":42,"../shapes/Shape":43}],6:[function(t,n,s){n.exports=l;var r=t("./Broadphase"),o=t("../math/Vec3"),a=t("../shapes/Shape");function l(h,u,d,f,p){r.apply(this),this.nx=d||10,this.ny=f||10,this.nz=p||10,this.aabbMin=h||new o(100,100,100),this.aabbMax=u||new o(-100,-100,-100);var A=this.nx*this.ny*this.nz;if(A<=0)throw"GridBroadphase: Each dimension's n must be >0";this.bins=[],this.binLengths=[],this.bins.length=A,this.binLengths.length=A;for(var m=0;m<A;m++)this.bins[m]=[],this.binLengths[m]=0}l.prototype=new r,l.prototype.constructor=l;var c=new o;new o,l.prototype.collisionPairs=function(h,u,d){var f=h.numObjects(),p=h.bodies,D=this.aabbMax,B=this.aabbMin,A=this.nx,m=this.ny,g=this.nz,y=m*g,_=g,v=1,b=D.x,T=D.y,L=D.z,I=B.x,x=B.y,w=B.z,P=A/(b-I),z=m/(T-x),H=g/(L-w),K=(b-I)/A,le=(T-x)/m,J=(L-w)/g,W=Math.sqrt(K*K+le*le+J*J)*.5,O=a.types,fe=O.SPHERE,ue=O.PLANE;O.BOX,O.COMPOUND,O.CONVEXPOLYHEDRON;for(var ee=this.bins,de=this.binLengths,ae=this.bins.length,R=0;R!==ae;R++)de[R]=0;var M=Math.ceil,B=Math.min,D=Math.max;function te(lt,Ne,qe,Ke,it,je,dt){var ct=(lt-I)*P|0,At=(Ne-x)*z|0,ge=(qe-w)*H|0,be=M((Ke-I)*P),Ce=M((it-x)*z),Le=M((je-w)*H);ct<0?ct=0:ct>=A&&(ct=A-1),At<0?At=0:At>=m&&(At=m-1),ge<0?ge=0:ge>=g&&(ge=g-1),be<0?be=0:be>=A&&(be=A-1),Ce<0?Ce=0:Ce>=m&&(Ce=m-1),Le<0?Le=0:Le>=g&&(Le=g-1),ct*=y,At*=_,ge*=v,be*=y,Ce*=_,Le*=v;for(var et=ct;et<=be;et+=y)for(var Ze=At;Ze<=Ce;Ze+=_)for(var _t=ge;_t<=Le;_t+=v){var Ht=et+Ze+_t;ee[Ht][de[Ht]++]=dt}}for(var R=0;R!==f;R++){var ie=p[R],Z=ie.shape;switch(Z.type){case fe:var me=ie.position.x,F=ie.position.y,Q=ie.position.z,E=Z.radius;te(me-E,F-E,Q-E,me+E,F+E,Q+E,ie);break;case ue:Z.worldNormalNeedsUpdate&&Z.computeWorldNormal(ie.quaternion);var j=Z.worldNormal,q=I+K*.5-ie.position.x,ce=x+le*.5-ie.position.y,G=w+J*.5-ie.position.z,V=c;V.set(q,ce,G);for(var re=0,k=0;re!==A;re++,k+=y,V.y=ce,V.x+=K)for(var N=0,oe=0;N!==m;N++,oe+=_,V.z=G,V.y+=le)for(var pe=0,ve=0;pe!==g;pe++,ve+=v,V.z+=J)if(V.dot(j)<W){var xe=k+oe+ve;ee[xe][de[xe]++]=ie}break;default:ie.aabbNeedsUpdate&&ie.computeAABB(),te(ie.aabb.lowerBound.x,ie.aabb.lowerBound.y,ie.aabb.lowerBound.z,ie.aabb.upperBound.x,ie.aabb.upperBound.y,ie.aabb.upperBound.z,ie);break}}for(var R=0;R!==ae;R++){var Pe=de[R];if(Pe>1)for(var Te=ee[R],re=0;re!==Pe;re++)for(var ie=Te[re],N=0;N!==re;N++){var Qe=Te[N];this.needBroadphaseCollision(ie,Qe)&&this.intersectionTest(ie,Qe,u,d)}}this.makePairsUnique(u,d)}},{"../math/Vec3":30,"../shapes/Shape":43,"./Broadphase":5}],7:[function(t,n,s){n.exports=a;var r=t("./Broadphase"),o=t("./AABB");function a(){r.apply(this)}a.prototype=new r,a.prototype.constructor=a,a.prototype.collisionPairs=function(l,c,h){var u=l.bodies,d=u.length,f,p,A,m;for(f=0;f!==d;f++)for(p=0;p!==f;p++)A=u[f],m=u[p],this.needBroadphaseCollision(A,m)&&this.intersectionTest(A,m,c,h)},new o,a.prototype.aabbQuery=function(l,c,h){h=h||[];for(var u=0;u<l.bodies.length;u++){var d=l.bodies[u];d.aabbNeedsUpdate&&d.computeAABB(),d.aabb.overlaps(c)&&h.push(d)}return h}},{"./AABB":3,"./Broadphase":5}],8:[function(t,n,s){n.exports=r;function r(){this.matrix={}}r.prototype.get=function(o,a){if(o=o.id,a=a.id,a>o){var l=a;a=o,o=l}return o+"-"+a in this.matrix},r.prototype.set=function(o,a,l){if(o=o.id,a=a.id,a>o){var c=a;a=o,o=c}l?this.matrix[o+"-"+a]=!0:delete this.matrix[o+"-"+a]},r.prototype.reset=function(){this.matrix={}},r.prototype.setNumObjects=function(o){}},{}],9:[function(t,n,s){n.exports=u;var r=t("../math/Vec3"),o=t("../math/Quaternion"),a=t("../math/Transform");t("../shapes/ConvexPolyhedron"),t("../shapes/Box");var l=t("../collision/RaycastResult"),c=t("../shapes/Shape"),h=t("../collision/AABB");function u(ae,R){this.from=ae?ae.clone():new r,this.to=R?R.clone():new r,this._direction=new r,this.precision=1e-4,this.checkCollisionResponse=!0,this.skipBackfaces=!1,this.collisionFilterMask=-1,this.collisionFilterGroup=-1,this.mode=u.ANY,this.result=new l,this.hasHit=!1,this.callback=function(M){}}u.prototype.constructor=u,u.CLOSEST=1,u.ANY=2,u.ALL=4;var d=new h,f=[];u.prototype.intersectWorld=function(ae,R){return this.mode=R.mode||u.ANY,this.result=R.result||new l,this.skipBackfaces=!!R.skipBackfaces,this.collisionFilterMask=typeof R.collisionFilterMask<"u"?R.collisionFilterMask:-1,this.collisionFilterGroup=typeof R.collisionFilterGroup<"u"?R.collisionFilterGroup:-1,R.from&&this.from.copy(R.from),R.to&&this.to.copy(R.to),this.callback=R.callback||function(){},this.hasHit=!1,this.result.reset(),this._updateDirection(),this.getAABB(d),f.length=0,ae.broadphase.aabbQuery(ae,d,f),this.intersectBodies(f),this.hasHit};var p=new r,A=new r;u.pointInTriangle=m;function m(ae,R,M,B){B.vsub(R,ue),M.vsub(R,p),ae.vsub(R,A);var D=ue.dot(ue),te=ue.dot(p),ie=ue.dot(A),Z=p.dot(p),me=p.dot(A),F,Q;return(F=Z*ie-te*me)>=0&&(Q=D*me-te*ie)>=0&&F+Q<D*Z-te*te}var g=new r,y=new o;u.prototype.intersectBody=function(ae,R){R&&(this.result=R,this._updateDirection());var M=this.checkCollisionResponse;if(!(M&&!ae.collisionResponse)&&!(!(this.collisionFilterGroup&ae.collisionFilterMask)||!(ae.collisionFilterGroup&this.collisionFilterMask)))for(var B=g,D=y,te=0,ie=ae.shapes.length;te<ie;te++){var Z=ae.shapes[te];if(!(M&&!Z.collisionResponse)&&(ae.quaternion.mult(ae.shapeOrientations[te],D),ae.quaternion.vmult(ae.shapeOffsets[te],B),B.vadd(ae.position,B),this.intersectShape(Z,D,B,ae),this.result._shouldStop))break}},u.prototype.intersectBodies=function(ae,R){R&&(this.result=R,this._updateDirection());for(var M=0,B=ae.length;!this.result._shouldStop&&M<B;M++)this.intersectBody(ae[M])},u.prototype._updateDirection=function(){this.to.vsub(this.from,this._direction),this._direction.normalize()},u.prototype.intersectShape=function(ae,R,M,B){var D=this.from,te=de(D,this._direction,M);if(!(te>ae.boundingSphereRadius)){var ie=this[ae.type];ie&&ie.call(this,ae,R,M,B)}},new r,new r;var _=new r,v=new r,b=new r,T=new r;new r,new l,u.prototype.intersectBox=function(ae,R,M,B){return this.intersectConvex(ae.convexPolyhedronRepresentation,R,M,B)},u.prototype[c.types.BOX]=u.prototype.intersectBox,u.prototype.intersectPlane=function(ae,R,M,B){var D=this.from,te=this.to,ie=this._direction,Z=new r(0,0,1);R.vmult(Z,Z);var me=new r;D.vsub(M,me);var F=me.dot(Z);te.vsub(M,me);var Q=me.dot(Z);if(!(F*Q>0)&&!(D.distanceTo(te)<F)){var E=Z.dot(ie);if(!(Math.abs(E)<this.precision)){var j=new r,q=new r,ce=new r;D.vsub(M,j);var G=-Z.dot(j)/E;ie.scale(G,q),D.vadd(q,ce),this.reportIntersection(Z,ce,ae,B,-1)}}},u.prototype[c.types.PLANE]=u.prototype.intersectPlane,u.prototype.getAABB=function(ae){var R=this.to,M=this.from;ae.lowerBound.x=Math.min(R.x,M.x),ae.lowerBound.y=Math.min(R.y,M.y),ae.lowerBound.z=Math.min(R.z,M.z),ae.upperBound.x=Math.max(R.x,M.x),ae.upperBound.y=Math.max(R.y,M.y),ae.upperBound.z=Math.max(R.z,M.z)};var L={faceList:[0]};u.prototype.intersectHeightfield=function(ae,R,M,B){ae.data,ae.elementSize;var D=new r,te=new u(this.from,this.to);a.pointToLocalFrame(M,R,te.from,te.from),a.pointToLocalFrame(M,R,te.to,te.to);var ie=[],Z=null,me=null,F=null,Q=null,E=ae.getIndexOfPosition(te.from.x,te.from.y,ie,!1);if(E&&(Z=ie[0],me=ie[1],F=ie[0],Q=ie[1]),E=ae.getIndexOfPosition(te.to.x,te.to.y,ie,!1),E&&((Z===null||ie[0]<Z)&&(Z=ie[0]),(F===null||ie[0]>F)&&(F=ie[0]),(me===null||ie[1]<me)&&(me=ie[1]),(Q===null||ie[1]>Q)&&(Q=ie[1])),Z!==null){var j=[];ae.getRectMinMax(Z,me,F,Q,j),j[0],j[1];for(var q=Z;q<=F;q++)for(var ce=me;ce<=Q;ce++){if(this.result._shouldStop||(ae.getConvexTrianglePillar(q,ce,!1),a.pointToWorldFrame(M,R,ae.pillarOffset,D),this.intersectConvex(ae.pillarConvex,R,D,B,L),this.result._shouldStop))return;ae.getConvexTrianglePillar(q,ce,!0),a.pointToWorldFrame(M,R,ae.pillarOffset,D),this.intersectConvex(ae.pillarConvex,R,D,B,L)}}},u.prototype[c.types.HEIGHTFIELD]=u.prototype.intersectHeightfield;var I=new r,x=new r;u.prototype.intersectSphere=function(ae,R,M,B){var D=this.from,te=this.to,ie=ae.radius,Z=Math.pow(te.x-D.x,2)+Math.pow(te.y-D.y,2)+Math.pow(te.z-D.z,2),me=2*((te.x-D.x)*(D.x-M.x)+(te.y-D.y)*(D.y-M.y)+(te.z-D.z)*(D.z-M.z)),F=Math.pow(D.x-M.x,2)+Math.pow(D.y-M.y,2)+Math.pow(D.z-M.z,2)-Math.pow(ie,2),Q=Math.pow(me,2)-4*Z*F,E=I,j=x;if(!(Q<0))if(Q===0)D.lerp(te,Q,E),E.vsub(M,j),j.normalize(),this.reportIntersection(j,E,ae,B,-1);else{var q=(-me-Math.sqrt(Q))/(2*Z),ce=(-me+Math.sqrt(Q))/(2*Z);if(q>=0&&q<=1&&(D.lerp(te,q,E),E.vsub(M,j),j.normalize(),this.reportIntersection(j,E,ae,B,-1)),this.result._shouldStop)return;ce>=0&&ce<=1&&(D.lerp(te,ce,E),E.vsub(M,j),j.normalize(),this.reportIntersection(j,E,ae,B,-1))}},u.prototype[c.types.SPHERE]=u.prototype.intersectSphere;var w=new r;new r,new r;var P=new r;u.prototype.intersectConvex=function(R,M,B,D,te){for(var ie=w,Z=P,me=te&&te.faceList||null,F=R.faces,Q=R.vertices,E=R.faceNormals,j=this._direction,q=this.from,ce=this.to,G=q.distanceTo(ce),V=me?me.length:F.length,re=this.result,k=0;!re._shouldStop&&k<V;k++){var N=me?me[k]:k,oe=F[N],pe=E[N],ve=M,xe=B;Z.copy(Q[oe[0]]),ve.vmult(Z,Z),Z.vadd(xe,Z),Z.vsub(q,Z),ve.vmult(pe,ie);var Pe=j.dot(ie);if(!(Math.abs(Pe)<this.precision)){var Te=ie.dot(Z)/Pe;if(!(Te<0)){j.mult(Te,_),_.vadd(q,_),v.copy(Q[oe[0]]),ve.vmult(v,v),xe.vadd(v,v);for(var Qe=1;!re._shouldStop&&Qe<oe.length-1;Qe++){b.copy(Q[oe[Qe]]),T.copy(Q[oe[Qe+1]]),ve.vmult(b,b),ve.vmult(T,T),xe.vadd(b,b),xe.vadd(T,T);var lt=_.distanceTo(q);!(m(_,v,b,T)||m(_,b,v,T))||lt>G||this.reportIntersection(ie,_,R,D,N)}}}}},u.prototype[c.types.CONVEXPOLYHEDRON]=u.prototype.intersectConvex;var z=new r,H=new r,K=new r,le=new r,J=new r,W=new r;new h;var O=[],fe=new a;u.prototype.intersectTrimesh=function(R,M,B,D,te){var ie=z,Z=O,me=fe,F=P,Q=H,E=K,j=le,q=W,ce=J;te&&te.faceList;var G=R.indices;R.vertices,R.faceNormals;var V=this.from,re=this.to,k=this._direction;me.position.copy(B),me.quaternion.copy(M),a.vectorToLocalFrame(B,M,k,Q),a.pointToLocalFrame(B,M,V,E),a.pointToLocalFrame(B,M,re,j);var N=E.distanceSquared(j);R.tree.rayQuery(this,me,Z);for(var oe=0,pe=Z.length;!this.result._shouldStop&&oe!==pe;oe++){var ve=Z[oe];R.getNormal(ve,ie),R.getVertex(G[ve*3],v),v.vsub(E,F);var xe=Q.dot(ie),Pe=ie.dot(F)/xe;if(!(Pe<0)){Q.scale(Pe,_),_.vadd(E,_),R.getVertex(G[ve*3+1],b),R.getVertex(G[ve*3+2],T);var Te=_.distanceSquared(E);!(m(_,b,v,T)||m(_,v,b,T))||Te>N||(a.vectorToWorldFrame(M,ie,ce),a.pointToWorldFrame(B,M,_,q),this.reportIntersection(ce,q,R,D,ve))}}Z.length=0},u.prototype[c.types.TRIMESH]=u.prototype.intersectTrimesh,u.prototype.reportIntersection=function(ae,R,M,B,D){var te=this.from,ie=this.to,Z=te.distanceTo(R),me=this.result;if(!(this.skipBackfaces&&ae.dot(this._direction)>0))switch(me.hitFaceIndex=typeof D<"u"?D:-1,this.mode){case u.ALL:this.hasHit=!0,me.set(te,ie,ae,R,M,B,Z),me.hasHit=!0,this.callback(me);break;case u.CLOSEST:(Z<me.distance||!me.hasHit)&&(this.hasHit=!0,me.hasHit=!0,me.set(te,ie,ae,R,M,B,Z));break;case u.ANY:this.hasHit=!0,me.hasHit=!0,me.set(te,ie,ae,R,M,B,Z),me._shouldStop=!0;break}};var ue=new r,ee=new r;function de(ae,R,M){M.vsub(ae,ue);var B=ue.dot(R);R.mult(B,ee),ee.vadd(ae,ee);var D=M.distanceTo(ee);return D}},{"../collision/AABB":3,"../collision/RaycastResult":10,"../math/Quaternion":28,"../math/Transform":29,"../math/Vec3":30,"../shapes/Box":37,"../shapes/ConvexPolyhedron":38,"../shapes/Shape":43}],10:[function(t,n,s){var r=t("../math/Vec3");n.exports=o;function o(){this.rayFromWorld=new r,this.rayToWorld=new r,this.hitNormalWorld=new r,this.hitPointWorld=new r,this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this._shouldStop=!1}o.prototype.reset=function(){this.rayFromWorld.setZero(),this.rayToWorld.setZero(),this.hitNormalWorld.setZero(),this.hitPointWorld.setZero(),this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this._shouldStop=!1},o.prototype.abort=function(){this._shouldStop=!0},o.prototype.set=function(a,l,c,h,u,d,f){this.rayFromWorld.copy(a),this.rayToWorld.copy(l),this.hitNormalWorld.copy(c),this.hitPointWorld.copy(h),this.shape=u,this.body=d,this.distance=f}},{"../math/Vec3":30}],11:[function(t,n,s){t("../shapes/Shape");var r=t("../collision/Broadphase");n.exports=o;function o(a){r.apply(this),this.axisList=[],this.world=null,this.axisIndex=0;var l=this.axisList;this._addBodyHandler=function(c){l.push(c.body)},this._removeBodyHandler=function(c){var h=l.indexOf(c.body);h!==-1&&l.splice(h,1)},a&&this.setWorld(a)}o.prototype=new r,o.prototype.setWorld=function(a){this.axisList.length=0;for(var l=0;l<a.bodies.length;l++)this.axisList.push(a.bodies[l]);a.removeEventListener("addBody",this._addBodyHandler),a.removeEventListener("removeBody",this._removeBodyHandler),a.addEventListener("addBody",this._addBodyHandler),a.addEventListener("removeBody",this._removeBodyHandler),this.world=a,this.dirty=!0},o.insertionSortX=function(a){for(var l=1,c=a.length;l<c;l++){for(var h=a[l],u=l-1;u>=0&&!(a[u].aabb.lowerBound.x<=h.aabb.lowerBound.x);u--)a[u+1]=a[u];a[u+1]=h}return a},o.insertionSortY=function(a){for(var l=1,c=a.length;l<c;l++){for(var h=a[l],u=l-1;u>=0&&!(a[u].aabb.lowerBound.y<=h.aabb.lowerBound.y);u--)a[u+1]=a[u];a[u+1]=h}return a},o.insertionSortZ=function(a){for(var l=1,c=a.length;l<c;l++){for(var h=a[l],u=l-1;u>=0&&!(a[u].aabb.lowerBound.z<=h.aabb.lowerBound.z);u--)a[u+1]=a[u];a[u+1]=h}return a},o.prototype.collisionPairs=function(a,l,c){var h=this.axisList,u=h.length,d=this.axisIndex,f,p;for(this.dirty&&(this.sortList(),this.dirty=!1),f=0;f!==u;f++){var A=h[f];for(p=f+1;p<u;p++){var m=h[p];if(this.needBroadphaseCollision(A,m)){if(!o.checkBounds(A,m,d))break;this.intersectionTest(A,m,l,c)}}}},o.prototype.sortList=function(){for(var a=this.axisList,l=this.axisIndex,c=a.length,h=0;h!==c;h++){var u=a[h];u.aabbNeedsUpdate&&u.computeAABB()}l===0?o.insertionSortX(a):l===1?o.insertionSortY(a):l===2&&o.insertionSortZ(a)},o.checkBounds=function(a,l,c){var h,u;c===0?(h=a.position.x,u=l.position.x):c===1?(h=a.position.y,u=l.position.y):c===2&&(h=a.position.z,u=l.position.z);var d=a.boundingRadius,f=l.boundingRadius,p=h+d,A=u-f;return A<p},o.prototype.autoDetectAxis=function(){for(var a=0,l=0,c=0,h=0,u=0,d=0,f=this.axisList,p=f.length,A=1/p,m=0;m!==p;m++){var g=f[m],y=g.position.x;a+=y,l+=y*y;var _=g.position.y;c+=_,h+=_*_;var v=g.position.z;u+=v,d+=v*v}var b=l-a*a*A,T=h-c*c*A,L=d-u*u*A;b>T?b>L?this.axisIndex=0:this.axisIndex=2:T>L?this.axisIndex=1:this.axisIndex=2},o.prototype.aabbQuery=function(a,l,c){c=c||[],this.dirty&&(this.sortList(),this.dirty=!1);var h=this.axisIndex,u="x";h===1&&(u="y"),h===2&&(u="z");var d=this.axisList;l.lowerBound[u],l.upperBound[u];for(var f=0;f<d.length;f++){var p=d[f];p.aabbNeedsUpdate&&p.computeAABB(),p.aabb.overlaps(l)&&c.push(p)}return c}},{"../collision/Broadphase":5,"../shapes/Shape":43}],12:[function(t,n,s){n.exports=c,t("./Constraint");var r=t("./PointToPointConstraint"),o=t("../equations/ConeEquation"),a=t("../equations/RotationalEquation");t("../equations/ContactEquation");var l=t("../math/Vec3");function c(h,u,d){d=d||{};var f=typeof d.maxForce<"u"?d.maxForce:1e6,p=d.pivotA?d.pivotA.clone():new l,A=d.pivotB?d.pivotB.clone():new l;this.axisA=d.axisA?d.axisA.clone():new l,this.axisB=d.axisB?d.axisB.clone():new l,r.call(this,h,p,u,A,f),this.collideConnected=!!d.collideConnected,this.angle=typeof d.angle<"u"?d.angle:0;var m=this.coneEquation=new o(h,u,d),g=this.twistEquation=new a(h,u,d);this.twistAngle=typeof d.twistAngle<"u"?d.twistAngle:0,m.maxForce=0,m.minForce=-f,g.maxForce=0,g.minForce=-f,this.equations.push(m,g)}c.prototype=new r,c.constructor=c,new l,new l,c.prototype.update=function(){var h=this.bodyA,u=this.bodyB,d=this.coneEquation,f=this.twistEquation;r.prototype.update.call(this),h.vectorToWorldFrame(this.axisA,d.axisA),u.vectorToWorldFrame(this.axisB,d.axisB),this.axisA.tangents(f.axisA,f.axisA),h.vectorToWorldFrame(f.axisA,f.axisA),this.axisB.tangents(f.axisB,f.axisB),u.vectorToWorldFrame(f.axisB,f.axisB),d.angle=this.angle,f.maxAngle=this.twistAngle}},{"../equations/ConeEquation":18,"../equations/ContactEquation":19,"../equations/RotationalEquation":22,"../math/Vec3":30,"./Constraint":13,"./PointToPointConstraint":17}],13:[function(t,n,s){n.exports=o;var r=t("../utils/Utils");function o(a,l,c){c=r.defaults(c,{collideConnected:!0,wakeUpBodies:!0}),this.equations=[],this.bodyA=a,this.bodyB=l,this.id=o.idCounter++,this.collideConnected=c.collideConnected,c.wakeUpBodies&&(a&&a.wakeUp(),l&&l.wakeUp())}o.prototype.update=function(){throw new Error("method update() not implmemented in this Constraint subclass!")},o.prototype.enable=function(){for(var a=this.equations,l=0;l<a.length;l++)a[l].enabled=!0},o.prototype.disable=function(){for(var a=this.equations,l=0;l<a.length;l++)a[l].enabled=!1},o.idCounter=0},{"../utils/Utils":53}],14:[function(t,n,s){n.exports=a;var r=t("./Constraint"),o=t("../equations/ContactEquation");function a(l,c,h,u){r.call(this,l,c),typeof h>"u"&&(h=l.position.distanceTo(c.position)),typeof u>"u"&&(u=1e6),this.distance=h;var d=this.distanceEquation=new o(l,c);this.equations.push(d),d.minForce=-u,d.maxForce=u}a.prototype=new r,a.prototype.update=function(){var l=this.bodyA,c=this.bodyB,h=this.distanceEquation,u=this.distance*.5,d=h.ni;c.position.vsub(l.position,d),d.normalize(),d.mult(u,h.ri),d.mult(-u,h.rj)}},{"../equations/ContactEquation":19,"./Constraint":13}],15:[function(t,n,s){n.exports=c,t("./Constraint");var r=t("./PointToPointConstraint"),o=t("../equations/RotationalEquation"),a=t("../equations/RotationalMotorEquation");t("../equations/ContactEquation");var l=t("../math/Vec3");function c(d,f,p){p=p||{};var A=typeof p.maxForce<"u"?p.maxForce:1e6,m=p.pivotA?p.pivotA.clone():new l,g=p.pivotB?p.pivotB.clone():new l;r.call(this,d,m,f,g,A);var y=this.axisA=p.axisA?p.axisA.clone():new l(1,0,0);y.normalize();var _=this.axisB=p.axisB?p.axisB.clone():new l(1,0,0);_.normalize();var v=this.rotationalEquation1=new o(d,f,p),b=this.rotationalEquation2=new o(d,f,p),T=this.motorEquation=new a(d,f,A);T.enabled=!1,this.equations.push(v,b,T)}c.prototype=new r,c.constructor=c,c.prototype.enableMotor=function(){this.motorEquation.enabled=!0},c.prototype.disableMotor=function(){this.motorEquation.enabled=!1},c.prototype.setMotorSpeed=function(d){this.motorEquation.targetVelocity=d},c.prototype.setMotorMaxForce=function(d){this.motorEquation.maxForce=d,this.motorEquation.minForce=-d};var h=new l,u=new l;c.prototype.update=function(){var d=this.bodyA,f=this.bodyB,p=this.motorEquation,A=this.rotationalEquation1,m=this.rotationalEquation2,g=h,y=u,_=this.axisA,v=this.axisB;r.prototype.update.call(this),d.quaternion.vmult(_,g),f.quaternion.vmult(v,y),g.tangents(A.axisA,m.axisA),A.axisB.copy(y),m.axisB.copy(y),this.motorEquation.enabled&&(d.quaternion.vmult(this.axisA,p.axisA),f.quaternion.vmult(this.axisB,p.axisB))}},{"../equations/ContactEquation":19,"../equations/RotationalEquation":22,"../equations/RotationalMotorEquation":23,"../math/Vec3":30,"./Constraint":13,"./PointToPointConstraint":17}],16:[function(t,n,s){n.exports=l,t("./Constraint");var r=t("./PointToPointConstraint"),o=t("../equations/RotationalEquation");t("../equations/RotationalMotorEquation"),t("../equations/ContactEquation");var a=t("../math/Vec3");function l(c,h,u){u=u||{};var d=typeof u.maxForce<"u"?u.maxForce:1e6,f=new a,p=new a,A=new a;c.position.vadd(h.position,A),A.scale(.5,A),h.pointToLocalFrame(A,p),c.pointToLocalFrame(A,f),r.call(this,c,f,h,p,d);var m=this.rotationalEquation1=new o(c,h,u),g=this.rotationalEquation2=new o(c,h,u),y=this.rotationalEquation3=new o(c,h,u);this.equations.push(m,g,y)}l.prototype=new r,l.constructor=l,new a,new a,l.prototype.update=function(){var c=this.bodyA,h=this.bodyB;this.motorEquation;var u=this.rotationalEquation1,d=this.rotationalEquation2,f=this.rotationalEquation3;r.prototype.update.call(this),c.vectorToWorldFrame(a.UNIT_X,u.axisA),h.vectorToWorldFrame(a.UNIT_Y,u.axisB),c.vectorToWorldFrame(a.UNIT_Y,d.axisA),h.vectorToWorldFrame(a.UNIT_Z,d.axisB),c.vectorToWorldFrame(a.UNIT_Z,f.axisA),h.vectorToWorldFrame(a.UNIT_X,f.axisB)}},{"../equations/ContactEquation":19,"../equations/RotationalEquation":22,"../equations/RotationalMotorEquation":23,"../math/Vec3":30,"./Constraint":13,"./PointToPointConstraint":17}],17:[function(t,n,s){n.exports=l;var r=t("./Constraint"),o=t("../equations/ContactEquation"),a=t("../math/Vec3");function l(c,h,u,d,f){r.call(this,c,u),f=typeof f<"u"?f:1e6,this.pivotA=h?h.clone():new a,this.pivotB=d?d.clone():new a;var p=this.equationX=new o(c,u),A=this.equationY=new o(c,u),m=this.equationZ=new o(c,u);this.equations.push(p,A,m),p.minForce=A.minForce=m.minForce=-f,p.maxForce=A.maxForce=m.maxForce=f,p.ni.set(1,0,0),A.ni.set(0,1,0),m.ni.set(0,0,1)}l.prototype=new r,l.prototype.update=function(){var c=this.bodyA,h=this.bodyB,u=this.equationX,d=this.equationY,f=this.equationZ;c.quaternion.vmult(this.pivotA,u.ri),h.quaternion.vmult(this.pivotB,u.rj),d.ri.copy(u.ri),d.rj.copy(u.rj),f.ri.copy(u.ri),f.rj.copy(u.rj)}},{"../equations/ContactEquation":19,"../math/Vec3":30,"./Constraint":13}],18:[function(t,n,s){n.exports=a;var r=t("../math/Vec3");t("../math/Mat3");var o=t("./Equation");function a(h,u,d){d=d||{};var f=typeof d.maxForce<"u"?d.maxForce:1e6;o.call(this,h,u,-f,f),this.axisA=d.axisA?d.axisA.clone():new r(1,0,0),this.axisB=d.axisB?d.axisB.clone():new r(0,1,0),this.angle=typeof d.angle<"u"?d.angle:0}a.prototype=new o,a.prototype.constructor=a;var l=new r,c=new r;a.prototype.computeB=function(h){var u=this.a,d=this.b,f=this.axisA,p=this.axisB,A=l,m=c,g=this.jacobianElementA,y=this.jacobianElementB;f.cross(p,A),p.cross(f,m),g.rotational.copy(m),y.rotational.copy(A);var _=Math.cos(this.angle)-f.dot(p),v=this.computeGW(),b=this.computeGiMf(),T=-_*u-v*d-h*b;return T}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],19:[function(t,n,s){n.exports=a;var r=t("./Equation"),o=t("../math/Vec3");t("../math/Mat3");function a(m,g,y){y=typeof y<"u"?y:1e6,r.call(this,m,g,0,y),this.restitution=0,this.ri=new o,this.rj=new o,this.ni=new o}a.prototype=new r,a.prototype.constructor=a;var l=new o,c=new o,h=new o;a.prototype.computeB=function(m){var g=this.a,y=this.b,_=this.bi,v=this.bj,b=this.ri,T=this.rj,L=l,I=c,x=_.velocity,w=_.angularVelocity;_.force,_.torque;var P=v.velocity,z=v.angularVelocity;v.force,v.torque;var H=h,K=this.jacobianElementA,le=this.jacobianElementB,J=this.ni;b.cross(J,L),T.cross(J,I),J.negate(K.spatial),L.negate(K.rotational),le.spatial.copy(J),le.rotational.copy(I),H.copy(v.position),H.vadd(T,H),H.vsub(_.position,H),H.vsub(b,H);var W=J.dot(H),O=this.restitution+1,fe=O*P.dot(J)-O*x.dot(J)+z.dot(I)-w.dot(L),ue=this.computeGiMf(),ee=-W*g-fe*y-m*ue;return ee};var u=new o,d=new o,f=new o,p=new o,A=new o;a.prototype.getImpactVelocityAlongNormal=function(){var m=u,g=d,y=f,_=p,v=A;return this.bi.position.vadd(this.ri,y),this.bj.position.vadd(this.rj,_),this.bi.getVelocityAtWorldPoint(y,m),this.bj.getVelocityAtWorldPoint(_,g),m.vsub(g,v),this.ni.dot(v)}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],20:[function(t,n,s){n.exports=a;var r=t("../math/JacobianElement"),o=t("../math/Vec3");function a(A,m,g,y){this.id=a.id++,this.minForce=typeof g>"u"?-1e6:g,this.maxForce=typeof y>"u"?1e6:y,this.bi=A,this.bj=m,this.a=0,this.b=0,this.eps=0,this.jacobianElementA=new r,this.jacobianElementB=new r,this.enabled=!0,this.setSpookParams(1e7,4,1/60)}a.prototype.constructor=a,a.id=0,a.prototype.setSpookParams=function(A,m,g){var y=m,_=A,v=g;this.a=4/(v*(1+4*y)),this.b=4*y/(1+4*y),this.eps=4/(v*v*_*(1+4*y))},a.prototype.computeB=function(A,m,g){var y=this.computeGW(),_=this.computeGq(),v=this.computeGiMf();return-_*A-y*m-v*g},a.prototype.computeGq=function(){var A=this.jacobianElementA,m=this.jacobianElementB,g=this.bi,y=this.bj,_=g.position,v=y.position;return A.spatial.dot(_)+m.spatial.dot(v)};var l=new o;a.prototype.computeGW=function(){var A=this.jacobianElementA,m=this.jacobianElementB,g=this.bi,y=this.bj,_=g.velocity,v=y.velocity,b=g.angularVelocity||l,T=y.angularVelocity||l;return A.multiplyVectors(_,b)+m.multiplyVectors(v,T)},a.prototype.computeGWlambda=function(){var A=this.jacobianElementA,m=this.jacobianElementB,g=this.bi,y=this.bj,_=g.vlambda,v=y.vlambda,b=g.wlambda||l,T=y.wlambda||l;return A.multiplyVectors(_,b)+m.multiplyVectors(v,T)};var c=new o,h=new o,u=new o,d=new o;a.prototype.computeGiMf=function(){var A=this.jacobianElementA,m=this.jacobianElementB,g=this.bi,y=this.bj,_=g.force,v=g.torque,b=y.force,T=y.torque,L=g.invMassSolve,I=y.invMassSolve;return g.invInertiaWorldSolve?g.invInertiaWorldSolve.vmult(v,u):u.set(0,0,0),y.invInertiaWorldSolve?y.invInertiaWorldSolve.vmult(T,d):d.set(0,0,0),_.mult(L,c),b.mult(I,h),A.multiplyVectors(c,u)+m.multiplyVectors(h,d)};var f=new o;a.prototype.computeGiMGt=function(){var A=this.jacobianElementA,m=this.jacobianElementB,g=this.bi,y=this.bj,_=g.invMassSolve,v=y.invMassSolve,b=g.invInertiaWorldSolve,T=y.invInertiaWorldSolve,L=_+v;return b&&(b.vmult(A.rotational,f),L+=f.dot(A.rotational)),T&&(T.vmult(m.rotational,f),L+=f.dot(m.rotational)),L};var p=new o;new o,new o,new o,new o,new o,a.prototype.addToWlambda=function(A){var m=this.jacobianElementA,g=this.jacobianElementB,y=this.bi,_=this.bj,v=p;m.spatial.mult(y.invMassSolve*A,v),y.vlambda.vadd(v,y.vlambda),g.spatial.mult(_.invMassSolve*A,v),_.vlambda.vadd(v,_.vlambda),y.invInertiaWorldSolve&&(y.invInertiaWorldSolve.vmult(m.rotational,v),v.mult(A,v),y.wlambda.vadd(v,y.wlambda)),_.invInertiaWorldSolve&&(_.invInertiaWorldSolve.vmult(g.rotational,v),v.mult(A,v),_.wlambda.vadd(v,_.wlambda))},a.prototype.computeC=function(){return this.computeGiMGt()+this.eps}},{"../math/JacobianElement":26,"../math/Vec3":30}],21:[function(t,n,s){n.exports=a;var r=t("./Equation"),o=t("../math/Vec3");t("../math/Mat3");function a(h,u,d){r.call(this,h,u,-d,d),this.ri=new o,this.rj=new o,this.t=new o}a.prototype=new r,a.prototype.constructor=a;var l=new o,c=new o;a.prototype.computeB=function(h){this.a;var u=this.b;this.bi,this.bj;var d=this.ri,f=this.rj,p=l,A=c,m=this.t;d.cross(m,p),f.cross(m,A);var g=this.jacobianElementA,y=this.jacobianElementB;m.negate(g.spatial),p.negate(g.rotational),y.spatial.copy(m),y.rotational.copy(A);var _=this.computeGW(),v=this.computeGiMf(),b=-_*u-h*v;return b}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],22:[function(t,n,s){n.exports=a;var r=t("../math/Vec3");t("../math/Mat3");var o=t("./Equation");function a(h,u,d){d=d||{};var f=typeof d.maxForce<"u"?d.maxForce:1e6;o.call(this,h,u,-f,f),this.axisA=d.axisA?d.axisA.clone():new r(1,0,0),this.axisB=d.axisB?d.axisB.clone():new r(0,1,0),this.maxAngle=Math.PI/2}a.prototype=new o,a.prototype.constructor=a;var l=new r,c=new r;a.prototype.computeB=function(h){var u=this.a,d=this.b,f=this.axisA,p=this.axisB,A=l,m=c,g=this.jacobianElementA,y=this.jacobianElementB;f.cross(p,A),p.cross(f,m),g.rotational.copy(m),y.rotational.copy(A);var _=Math.cos(this.maxAngle)-f.dot(p),v=this.computeGW(),b=this.computeGiMf(),T=-_*u-v*d-h*b;return T}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],23:[function(t,n,s){n.exports=a;var r=t("../math/Vec3");t("../math/Mat3");var o=t("./Equation");function a(l,c,h){h=typeof h<"u"?h:1e6,o.call(this,l,c,-h,h),this.axisA=new r,this.axisB=new r,this.targetVelocity=0}a.prototype=new o,a.prototype.constructor=a,a.prototype.computeB=function(l){this.a;var c=this.b;this.bi,this.bj;var h=this.axisA,u=this.axisB,d=this.jacobianElementA,f=this.jacobianElementB;d.rotational.copy(h),u.negate(f.rotational);var p=this.computeGW()-this.targetVelocity,A=this.computeGiMf(),m=-p*c-l*A;return m}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],24:[function(t,n,s){var r=t("../utils/Utils");n.exports=o;function o(a,l,c){c=r.defaults(c,{friction:.3,restitution:.3,contactEquationStiffness:1e7,contactEquationRelaxation:3,frictionEquationStiffness:1e7,frictionEquationRelaxation:3}),this.id=o.idCounter++,this.materials=[a,l],this.friction=c.friction,this.restitution=c.restitution,this.contactEquationStiffness=c.contactEquationStiffness,this.contactEquationRelaxation=c.contactEquationRelaxation,this.frictionEquationStiffness=c.frictionEquationStiffness,this.frictionEquationRelaxation=c.frictionEquationRelaxation}o.idCounter=0},{"../utils/Utils":53}],25:[function(t,n,s){n.exports=r;function r(o){var a="";o=o||{},typeof o=="string"?(a=o,o={}):typeof o=="object"&&(a=""),this.name=a,this.id=r.idCounter++,this.friction=typeof o.friction<"u"?o.friction:-1,this.restitution=typeof o.restitution<"u"?o.restitution:-1}r.idCounter=0},{}],26:[function(t,n,s){n.exports=o;var r=t("./Vec3");function o(){this.spatial=new r,this.rotational=new r}o.prototype.multiplyElement=function(a){return a.spatial.dot(this.spatial)+a.rotational.dot(this.rotational)},o.prototype.multiplyVectors=function(a,l){return a.dot(this.spatial)+l.dot(this.rotational)}},{"./Vec3":30}],27:[function(t,n,s){n.exports=o;var r=t("./Vec3");function o(a){a?this.elements=a:this.elements=[0,0,0,0,0,0,0,0,0]}o.prototype.identity=function(){var a=this.elements;a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=1,a[5]=0,a[6]=0,a[7]=0,a[8]=1},o.prototype.setZero=function(){var a=this.elements;a[0]=0,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=0,a[6]=0,a[7]=0,a[8]=0},o.prototype.setTrace=function(a){var l=this.elements;l[0]=a.x,l[4]=a.y,l[8]=a.z},o.prototype.getTrace=function(l){var l=l||new r,c=this.elements;l.x=c[0],l.y=c[4],l.z=c[8]},o.prototype.vmult=function(a,l){l=l||new r;var c=this.elements,h=a.x,u=a.y,d=a.z;return l.x=c[0]*h+c[1]*u+c[2]*d,l.y=c[3]*h+c[4]*u+c[5]*d,l.z=c[6]*h+c[7]*u+c[8]*d,l},o.prototype.smult=function(a){for(var l=0;l<this.elements.length;l++)this.elements[l]*=a},o.prototype.mmult=function(a,l){for(var c=l||new o,h=0;h<3;h++)for(var u=0;u<3;u++){for(var d=0,f=0;f<3;f++)d+=a.elements[h+f*3]*this.elements[f+u*3];c.elements[h+u*3]=d}return c},o.prototype.scale=function(a,l){l=l||new o;for(var c=this.elements,h=l.elements,u=0;u!==3;u++)h[3*u+0]=a.x*c[3*u+0],h[3*u+1]=a.y*c[3*u+1],h[3*u+2]=a.z*c[3*u+2];return l},o.prototype.solve=function(a,l){l=l||new r;for(var c=3,h=4,u=[],d=0;d<c*h;d++)u.push(0);var d,f;for(d=0;d<3;d++)for(f=0;f<3;f++)u[d+h*f]=this.elements[d+3*f];u[3+4*0]=a.x,u[3+4*1]=a.y,u[3+4*2]=a.z;var p=3,A=p,m,g=4,y;do{if(d=A-p,u[d+h*d]===0){for(f=d+1;f<A;f++)if(u[d+h*f]!==0){m=g;do y=g-m,u[y+h*d]+=u[y+h*f];while(--m);break}}if(u[d+h*d]!==0)for(f=d+1;f<A;f++){var _=u[d+h*f]/u[d+h*d];m=g;do y=g-m,u[y+h*f]=y<=d?0:u[y+h*f]-u[y+h*d]*_;while(--m)}}while(--p);if(l.z=u[2*h+3]/u[2*h+2],l.y=(u[1*h+3]-u[1*h+2]*l.z)/u[1*h+1],l.x=(u[0*h+3]-u[0*h+2]*l.z-u[0*h+1]*l.y)/u[0*h+0],isNaN(l.x)||isNaN(l.y)||isNaN(l.z)||l.x===1/0||l.y===1/0||l.z===1/0)throw"Could not solve equation! Got x=["+l.toString()+"], b=["+a.toString()+"], A=["+this.toString()+"]";return l},o.prototype.e=function(a,l,c){if(c===void 0)return this.elements[l+3*a];this.elements[l+3*a]=c},o.prototype.copy=function(a){for(var l=0;l<a.elements.length;l++)this.elements[l]=a.elements[l];return this},o.prototype.toString=function(){for(var a="",l=",",c=0;c<9;c++)a+=this.elements[c]+l;return a},o.prototype.reverse=function(a){a=a||new o;for(var l=3,c=6,h=[],u=0;u<l*c;u++)h.push(0);var u,d;for(u=0;u<3;u++)for(d=0;d<3;d++)h[u+c*d]=this.elements[u+3*d];h[3+6*0]=1,h[3+6*1]=0,h[3+6*2]=0,h[4+6*0]=0,h[4+6*1]=1,h[4+6*2]=0,h[5+6*0]=0,h[5+6*1]=0,h[5+6*2]=1;var f=3,p=f,A,m=c,g;do{if(u=p-f,h[u+c*u]===0){for(d=u+1;d<p;d++)if(h[u+c*d]!==0){A=m;do g=m-A,h[g+c*u]+=h[g+c*d];while(--A);break}}if(h[u+c*u]!==0)for(d=u+1;d<p;d++){var y=h[u+c*d]/h[u+c*u];A=m;do g=m-A,h[g+c*d]=g<=u?0:h[g+c*d]-h[g+c*u]*y;while(--A)}}while(--f);u=2;do{d=u-1;do{var y=h[u+c*d]/h[u+c*u];A=c;do g=c-A,h[g+c*d]=h[g+c*d]-h[g+c*u]*y;while(--A)}while(d--)}while(--u);u=2;do{var y=1/h[u+c*u];A=c;do g=c-A,h[g+c*u]=h[g+c*u]*y;while(--A)}while(u--);u=2;do{d=2;do{if(g=h[l+d+c*u],isNaN(g)||g===1/0)throw"Could not reverse! A=["+this.toString()+"]";a.e(u,d,g)}while(d--)}while(u--);return a},o.prototype.setRotationFromQuaternion=function(a){var l=a.x,c=a.y,h=a.z,u=a.w,d=l+l,f=c+c,p=h+h,A=l*d,m=l*f,g=l*p,y=c*f,_=c*p,v=h*p,b=u*d,T=u*f,L=u*p,I=this.elements;return I[3*0+0]=1-(y+v),I[3*0+1]=m-L,I[3*0+2]=g+T,I[3*1+0]=m+L,I[3*1+1]=1-(A+v),I[3*1+2]=_-b,I[3*2+0]=g-T,I[3*2+1]=_+b,I[3*2+2]=1-(A+y),this},o.prototype.transpose=function(a){a=a||new o;for(var l=a.elements,c=this.elements,h=0;h!==3;h++)for(var u=0;u!==3;u++)l[3*h+u]=c[3*u+h];return a}},{"./Vec3":30}],28:[function(t,n,s){n.exports=o;var r=t("./Vec3");function o(d,f,p,A){this.x=d!==void 0?d:0,this.y=f!==void 0?f:0,this.z=p!==void 0?p:0,this.w=A!==void 0?A:1}o.prototype.set=function(d,f,p,A){this.x=d,this.y=f,this.z=p,this.w=A},o.prototype.toString=function(){return this.x+","+this.y+","+this.z+","+this.w},o.prototype.toArray=function(){return[this.x,this.y,this.z,this.w]},o.prototype.setFromAxisAngle=function(d,f){var p=Math.sin(f*.5);this.x=d.x*p,this.y=d.y*p,this.z=d.z*p,this.w=Math.cos(f*.5)},o.prototype.toAxisAngle=function(d){d=d||new r,this.normalize();var f=2*Math.acos(this.w),p=Math.sqrt(1-this.w*this.w);return p<.001?(d.x=this.x,d.y=this.y,d.z=this.z):(d.x=this.x/p,d.y=this.y/p,d.z=this.z/p),[d,f]};var a=new r,l=new r;o.prototype.setFromVectors=function(d,f){if(d.isAntiparallelTo(f)){var p=a,A=l;d.tangents(p,A),this.setFromAxisAngle(p,Math.PI)}else{var m=d.cross(f);this.x=m.x,this.y=m.y,this.z=m.z,this.w=Math.sqrt(Math.pow(d.norm(),2)*Math.pow(f.norm(),2))+d.dot(f),this.normalize()}};var c=new r,h=new r,u=new r;o.prototype.mult=function(d,f){f=f||new o;var p=this.w,A=c,m=h,g=u;return A.set(this.x,this.y,this.z),m.set(d.x,d.y,d.z),f.w=p*d.w-A.dot(m),A.cross(m,g),f.x=p*m.x+d.w*A.x+g.x,f.y=p*m.y+d.w*A.y+g.y,f.z=p*m.z+d.w*A.z+g.z,f},o.prototype.inverse=function(d){var f=this.x,p=this.y,A=this.z,m=this.w;d=d||new o,this.conjugate(d);var g=1/(f*f+p*p+A*A+m*m);return d.x*=g,d.y*=g,d.z*=g,d.w*=g,d},o.prototype.conjugate=function(d){return d=d||new o,d.x=-this.x,d.y=-this.y,d.z=-this.z,d.w=this.w,d},o.prototype.normalize=function(){var d=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);d===0?(this.x=0,this.y=0,this.z=0,this.w=0):(d=1/d,this.x*=d,this.y*=d,this.z*=d,this.w*=d)},o.prototype.normalizeFast=function(){var d=(3-(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w))/2;d===0?(this.x=0,this.y=0,this.z=0,this.w=0):(this.x*=d,this.y*=d,this.z*=d,this.w*=d)},o.prototype.vmult=function(d,f){f=f||new r;var p=d.x,A=d.y,m=d.z,g=this.x,y=this.y,_=this.z,v=this.w,b=v*p+y*m-_*A,T=v*A+_*p-g*m,L=v*m+g*A-y*p,I=-g*p-y*A-_*m;return f.x=b*v+I*-g+T*-_-L*-y,f.y=T*v+I*-y+L*-g-b*-_,f.z=L*v+I*-_+b*-y-T*-g,f},o.prototype.copy=function(d){return this.x=d.x,this.y=d.y,this.z=d.z,this.w=d.w,this},o.prototype.toEuler=function(d,f){f=f||"YZX";var p,A,m,g=this.x,y=this.y,_=this.z,v=this.w;switch(f){case"YZX":var b=g*y+_*v;if(b>.499&&(p=2*Math.atan2(g,v),A=Math.PI/2,m=0),b<-.499&&(p=-2*Math.atan2(g,v),A=-Math.PI/2,m=0),isNaN(p)){var T=g*g,L=y*y,I=_*_;p=Math.atan2(2*y*v-2*g*_,1-2*L-2*I),A=Math.asin(2*b),m=Math.atan2(2*g*v-2*y*_,1-2*T-2*I)}break;default:throw new Error("Euler order "+f+" not supported yet.")}d.y=p,d.z=A,d.x=m},o.prototype.setFromEuler=function(d,f,p,A){A=A||"XYZ";var m=Math.cos(d/2),g=Math.cos(f/2),y=Math.cos(p/2),_=Math.sin(d/2),v=Math.sin(f/2),b=Math.sin(p/2);return A==="XYZ"?(this.x=_*g*y+m*v*b,this.y=m*v*y-_*g*b,this.z=m*g*b+_*v*y,this.w=m*g*y-_*v*b):A==="YXZ"?(this.x=_*g*y+m*v*b,this.y=m*v*y-_*g*b,this.z=m*g*b-_*v*y,this.w=m*g*y+_*v*b):A==="ZXY"?(this.x=_*g*y-m*v*b,this.y=m*v*y+_*g*b,this.z=m*g*b+_*v*y,this.w=m*g*y-_*v*b):A==="ZYX"?(this.x=_*g*y-m*v*b,this.y=m*v*y+_*g*b,this.z=m*g*b-_*v*y,this.w=m*g*y+_*v*b):A==="YZX"?(this.x=_*g*y+m*v*b,this.y=m*v*y+_*g*b,this.z=m*g*b-_*v*y,this.w=m*g*y-_*v*b):A==="XZY"&&(this.x=_*g*y-m*v*b,this.y=m*v*y-_*g*b,this.z=m*g*b+_*v*y,this.w=m*g*y+_*v*b),this},o.prototype.clone=function(){return new o(this.x,this.y,this.z,this.w)}},{"./Vec3":30}],29:[function(t,n,s){var r=t("./Vec3"),o=t("./Quaternion");n.exports=a;function a(c){c=c||{},this.position=new r,c.position&&this.position.copy(c.position),this.quaternion=new o,c.quaternion&&this.quaternion.copy(c.quaternion)}var l=new o;a.pointToLocalFrame=function(c,h,u,f){var f=f||new r;return u.vsub(c,f),h.conjugate(l),l.vmult(f,f),f},a.prototype.pointToLocal=function(c,h){return a.pointToLocalFrame(this.position,this.quaternion,c,h)},a.pointToWorldFrame=function(c,h,u,f){var f=f||new r;return h.vmult(u,f),f.vadd(c,f),f},a.prototype.pointToWorld=function(c,h){return a.pointToWorldFrame(this.position,this.quaternion,c,h)},a.prototype.vectorToWorldFrame=function(c,u){var u=u||new r;return this.quaternion.vmult(c,u),u},a.vectorToWorldFrame=function(c,h,u){return c.vmult(h,u),u},a.vectorToLocalFrame=function(c,h,u,f){var f=f||new r;return h.w*=-1,h.vmult(u,f),h.w*=-1,f}},{"./Quaternion":28,"./Vec3":30}],30:[function(t,n,s){n.exports=o;var r=t("./Mat3");function o(h,u,d){this.x=h||0,this.y=u||0,this.z=d||0}o.ZERO=new o(0,0,0),o.UNIT_X=new o(1,0,0),o.UNIT_Y=new o(0,1,0),o.UNIT_Z=new o(0,0,1),o.prototype.cross=function(h,u){var d=h.x,f=h.y,p=h.z,A=this.x,m=this.y,g=this.z;return u=u||new o,u.x=m*p-g*f,u.y=g*d-A*p,u.z=A*f-m*d,u},o.prototype.set=function(h,u,d){return this.x=h,this.y=u,this.z=d,this},o.prototype.setZero=function(){this.x=this.y=this.z=0},o.prototype.vadd=function(h,u){if(u)u.x=h.x+this.x,u.y=h.y+this.y,u.z=h.z+this.z;else return new o(this.x+h.x,this.y+h.y,this.z+h.z)},o.prototype.vsub=function(h,u){if(u)u.x=this.x-h.x,u.y=this.y-h.y,u.z=this.z-h.z;else return new o(this.x-h.x,this.y-h.y,this.z-h.z)},o.prototype.crossmat=function(){return new r([0,-this.z,this.y,this.z,0,-this.x,-this.y,this.x,0])},o.prototype.normalize=function(){var h=this.x,u=this.y,d=this.z,f=Math.sqrt(h*h+u*u+d*d);if(f>0){var p=1/f;this.x*=p,this.y*=p,this.z*=p}else this.x=0,this.y=0,this.z=0;return f},o.prototype.unit=function(h){h=h||new o;var u=this.x,d=this.y,f=this.z,p=Math.sqrt(u*u+d*d+f*f);return p>0?(p=1/p,h.x=u*p,h.y=d*p,h.z=f*p):(h.x=1,h.y=0,h.z=0),h},o.prototype.norm=function(){var h=this.x,u=this.y,d=this.z;return Math.sqrt(h*h+u*u+d*d)},o.prototype.length=o.prototype.norm,o.prototype.norm2=function(){return this.dot(this)},o.prototype.lengthSquared=o.prototype.norm2,o.prototype.distanceTo=function(h){var u=this.x,d=this.y,f=this.z,p=h.x,A=h.y,m=h.z;return Math.sqrt((p-u)*(p-u)+(A-d)*(A-d)+(m-f)*(m-f))},o.prototype.distanceSquared=function(h){var u=this.x,d=this.y,f=this.z,p=h.x,A=h.y,m=h.z;return(p-u)*(p-u)+(A-d)*(A-d)+(m-f)*(m-f)},o.prototype.mult=function(h,u){u=u||new o;var d=this.x,f=this.y,p=this.z;return u.x=h*d,u.y=h*f,u.z=h*p,u},o.prototype.scale=o.prototype.mult,o.prototype.dot=function(h){return this.x*h.x+this.y*h.y+this.z*h.z},o.prototype.isZero=function(){return this.x===0&&this.y===0&&this.z===0},o.prototype.negate=function(h){return h=h||new o,h.x=-this.x,h.y=-this.y,h.z=-this.z,h};var a=new o,l=new o;o.prototype.tangents=function(h,u){var d=this.norm();if(d>0){var f=a,p=1/d;f.set(this.x*p,this.y*p,this.z*p);var A=l;Math.abs(f.x)<.9?(A.set(1,0,0),f.cross(A,h)):(A.set(0,1,0),f.cross(A,h)),f.cross(h,u)}else h.set(1,0,0),u.set(0,1,0)},o.prototype.toString=function(){return this.x+","+this.y+","+this.z},o.prototype.toArray=function(){return[this.x,this.y,this.z]},o.prototype.copy=function(h){return this.x=h.x,this.y=h.y,this.z=h.z,this},o.prototype.lerp=function(h,u,d){var f=this.x,p=this.y,A=this.z;d.x=f+(h.x-f)*u,d.y=p+(h.y-p)*u,d.z=A+(h.z-A)*u},o.prototype.almostEquals=function(h,u){return u===void 0&&(u=1e-6),!(Math.abs(this.x-h.x)>u||Math.abs(this.y-h.y)>u||Math.abs(this.z-h.z)>u)},o.prototype.almostZero=function(h){return h===void 0&&(h=1e-6),!(Math.abs(this.x)>h||Math.abs(this.y)>h||Math.abs(this.z)>h)};var c=new o;o.prototype.isAntiparallelTo=function(h,u){return this.negate(c),c.almostEquals(h,u)},o.prototype.clone=function(){return new o(this.x,this.y,this.z)}},{"./Mat3":27}],31:[function(t,n,s){n.exports=u;var r=t("../utils/EventTarget");t("../shapes/Shape");var o=t("../math/Vec3"),a=t("../math/Mat3"),l=t("../math/Quaternion");t("../material/Material");var c=t("../collision/AABB"),h=t("../shapes/Box");function u(P){P=P||{},r.apply(this),this.id=u.idCounter++,this.world=null,this.preStep=null,this.postStep=null,this.vlambda=new o,this.collisionFilterGroup=typeof P.collisionFilterGroup=="number"?P.collisionFilterGroup:1,this.collisionFilterMask=typeof P.collisionFilterMask=="number"?P.collisionFilterMask:1,this.collisionResponse=!0,this.position=new o,P.position&&this.position.copy(P.position),this.previousPosition=new o,this.initPosition=new o,this.velocity=new o,P.velocity&&this.velocity.copy(P.velocity),this.initVelocity=new o,this.force=new o;var z=typeof P.mass=="number"?P.mass:0;this.mass=z,this.invMass=z>0?1/z:0,this.material=P.material||null,this.linearDamping=typeof P.linearDamping=="number"?P.linearDamping:.01,this.type=z<=0?u.STATIC:u.DYNAMIC,typeof P.type==typeof u.STATIC&&(this.type=P.type),this.allowSleep=typeof P.allowSleep<"u"?P.allowSleep:!0,this.sleepState=0,this.sleepSpeedLimit=typeof P.sleepSpeedLimit<"u"?P.sleepSpeedLimit:.1,this.sleepTimeLimit=typeof P.sleepTimeLimit<"u"?P.sleepTimeLimit:1,this.timeLastSleepy=0,this._wakeUpAfterNarrowphase=!1,this.torque=new o,this.quaternion=new l,P.quaternion&&this.quaternion.copy(P.quaternion),this.initQuaternion=new l,this.angularVelocity=new o,P.angularVelocity&&this.angularVelocity.copy(P.angularVelocity),this.initAngularVelocity=new o,this.interpolatedPosition=new o,this.interpolatedQuaternion=new l,this.shapes=[],this.shapeOffsets=[],this.shapeOrientations=[],this.inertia=new o,this.invInertia=new o,this.invInertiaWorld=new a,this.invMassSolve=0,this.invInertiaSolve=new o,this.invInertiaWorldSolve=new a,this.fixedRotation=typeof P.fixedRotation<"u"?P.fixedRotation:!1,this.angularDamping=typeof P.angularDamping<"u"?P.angularDamping:.01,this.aabb=new c,this.aabbNeedsUpdate=!0,this.wlambda=new o,P.shape&&this.addShape(P.shape),this.updateMassProperties()}u.prototype=new r,u.prototype.constructor=u,u.DYNAMIC=1,u.STATIC=2,u.KINEMATIC=4,u.AWAKE=0,u.SLEEPY=1,u.SLEEPING=2,u.idCounter=0,u.prototype.wakeUp=function(){var P=this.sleepState;this.sleepState=0,P===u.SLEEPING&&this.dispatchEvent({type:"wakeup"})},u.prototype.sleep=function(){this.sleepState=u.SLEEPING,this.velocity.set(0,0,0),this.angularVelocity.set(0,0,0)},u.sleepyEvent={type:"sleepy"},u.sleepEvent={type:"sleep"},u.prototype.sleepTick=function(P){if(this.allowSleep){var z=this.sleepState,H=this.velocity.norm2()+this.angularVelocity.norm2(),K=Math.pow(this.sleepSpeedLimit,2);z===u.AWAKE&&H<K?(this.sleepState=u.SLEEPY,this.timeLastSleepy=P,this.dispatchEvent(u.sleepyEvent)):z===u.SLEEPY&&H>K?this.wakeUp():z===u.SLEEPY&&P-this.timeLastSleepy>this.sleepTimeLimit&&(this.sleep(),this.dispatchEvent(u.sleepEvent))}},u.prototype.updateSolveMassProperties=function(){this.sleepState===u.SLEEPING||this.type===u.KINEMATIC?(this.invMassSolve=0,this.invInertiaSolve.setZero(),this.invInertiaWorldSolve.setZero()):(this.invMassSolve=this.invMass,this.invInertiaSolve.copy(this.invInertia),this.invInertiaWorldSolve.copy(this.invInertiaWorld))},u.prototype.pointToLocalFrame=function(P,H){var H=H||new o;return P.vsub(this.position,H),this.quaternion.conjugate().vmult(H,H),H},u.prototype.vectorToLocalFrame=function(P,H){var H=H||new o;return this.quaternion.conjugate().vmult(P,H),H},u.prototype.pointToWorldFrame=function(P,H){var H=H||new o;return this.quaternion.vmult(P,H),H.vadd(this.position,H),H},u.prototype.vectorToWorldFrame=function(P,H){var H=H||new o;return this.quaternion.vmult(P,H),H};var d=new o,f=new l;u.prototype.addShape=function(P,z,H){var K=new o,le=new l;return z&&K.copy(z),H&&le.copy(H),this.shapes.push(P),this.shapeOffsets.push(K),this.shapeOrientations.push(le),this.updateMassProperties(),this.updateBoundingRadius(),this.aabbNeedsUpdate=!0,this},u.prototype.updateBoundingRadius=function(){for(var P=this.shapes,z=this.shapeOffsets,H=P.length,K=0,le=0;le!==H;le++){var J=P[le];J.updateBoundingSphereRadius();var W=z[le].norm(),O=J.boundingSphereRadius;W+O>K&&(K=W+O)}this.boundingRadius=K};var p=new c;u.prototype.computeAABB=function(){for(var P=this.shapes,z=this.shapeOffsets,H=this.shapeOrientations,K=P.length,le=d,J=f,W=this.quaternion,O=this.aabb,fe=p,ue=0;ue!==K;ue++){var ee=P[ue];H[ue].mult(W,J),J.vmult(z[ue],le),le.vadd(this.position,le),ee.calculateWorldAABB(le,J,fe.lowerBound,fe.upperBound),ue===0?O.copy(fe):O.extend(fe)}this.aabbNeedsUpdate=!1};var A=new a,m=new a;new a,u.prototype.updateInertiaWorld=function(P){var z=this.invInertia;if(!(z.x===z.y&&z.y===z.z&&!P)){var H=A,K=m;H.setRotationFromQuaternion(this.quaternion),H.transpose(K),H.scale(z,H),H.mmult(K,this.invInertiaWorld)}};var g=new o,y=new o;u.prototype.applyForce=function(P,z){if(this.type===u.DYNAMIC){var H=g;z.vsub(this.position,H);var K=y;H.cross(P,K),this.force.vadd(P,this.force),this.torque.vadd(K,this.torque)}};var _=new o,v=new o;u.prototype.applyLocalForce=function(P,z){if(this.type===u.DYNAMIC){var H=_,K=v;this.vectorToWorldFrame(P,H),this.pointToWorldFrame(z,K),this.applyForce(H,K)}};var b=new o,T=new o,L=new o;u.prototype.applyImpulse=function(P,z){if(this.type===u.DYNAMIC){var H=b;z.vsub(this.position,H);var K=T;K.copy(P),K.mult(this.invMass,K),this.velocity.vadd(K,this.velocity);var le=L;H.cross(P,le),this.invInertiaWorld.vmult(le,le),this.angularVelocity.vadd(le,this.angularVelocity)}};var I=new o,x=new o;u.prototype.applyLocalImpulse=function(P,z){if(this.type===u.DYNAMIC){var H=I,K=x;this.vectorToWorldFrame(P,H),this.pointToWorldFrame(z,K),this.applyImpulse(H,K)}};var w=new o;u.prototype.updateMassProperties=function(){var P=w;this.invMass=this.mass>0?1/this.mass:0;var z=this.inertia,H=this.fixedRotation;this.computeAABB(),P.set((this.aabb.upperBound.x-this.aabb.lowerBound.x)/2,(this.aabb.upperBound.y-this.aabb.lowerBound.y)/2,(this.aabb.upperBound.z-this.aabb.lowerBound.z)/2),h.calculateInertia(P,this.mass,z),this.invInertia.set(z.x>0&&!H?1/z.x:0,z.y>0&&!H?1/z.y:0,z.z>0&&!H?1/z.z:0),this.updateInertiaWorld(!0)},u.prototype.getVelocityAtWorldPoint=function(P,z){var H=new o;return P.vsub(this.position,H),this.angularVelocity.cross(H,z),this.velocity.vadd(z,z),z}},{"../collision/AABB":3,"../material/Material":25,"../math/Mat3":27,"../math/Quaternion":28,"../math/Vec3":30,"../shapes/Box":37,"../shapes/Shape":43,"../utils/EventTarget":49}],32:[function(t,n,s){t("./Body");var r=t("../math/Vec3"),o=t("../math/Quaternion");t("../collision/RaycastResult");var a=t("../collision/Ray"),l=t("../objects/WheelInfo");n.exports=c;function c(W){this.chassisBody=W.chassisBody,this.wheelInfos=[],this.sliding=!1,this.world=null,this.indexRightAxis=typeof W.indexRightAxis<"u"?W.indexRightAxis:1,this.indexForwardAxis=typeof W.indexForwardAxis<"u"?W.indexForwardAxis:0,this.indexUpAxis=typeof W.indexUpAxis<"u"?W.indexUpAxis:2}new r,new r,new r;var h=new r,u=new r,d=new r;new a,c.prototype.addWheel=function(W){W=W||{};var O=new l(W),fe=this.wheelInfos.length;return this.wheelInfos.push(O),fe},c.prototype.setSteeringValue=function(W,O){var fe=this.wheelInfos[O];fe.steering=W},new r,c.prototype.applyEngineForce=function(W,O){this.wheelInfos[O].engineForce=W},c.prototype.setBrake=function(W,O){this.wheelInfos[O].brake=W},c.prototype.addToWorld=function(W){this.constraints,W.add(this.chassisBody);var O=this;this.preStepCallback=function(){O.updateVehicle(W.dt)},W.addEventListener("preStep",this.preStepCallback),this.world=W},c.prototype.getVehicleAxisWorld=function(W,O){O.set(W===0?1:0,W===1?1:0,W===2?1:0),this.chassisBody.vectorToWorldFrame(O,O)},c.prototype.updateVehicle=function(W){for(var O=this.wheelInfos,fe=O.length,ue=this.chassisBody,ee=0;ee<fe;ee++)this.updateWheelTransform(ee);this.currentVehicleSpeedKmHour=3.6*ue.velocity.norm();var de=new r;this.getVehicleAxisWorld(this.indexForwardAxis,de),de.dot(ue.velocity)<0&&(this.currentVehicleSpeedKmHour*=-1);for(var ee=0;ee<fe;ee++)this.castRay(O[ee]);this.updateSuspension(W);for(var ae=new r,R=new r,ee=0;ee<fe;ee++){var M=O[ee],B=M.suspensionForce;B>M.maxSuspensionForce&&(B=M.maxSuspensionForce),M.raycastResult.hitNormalWorld.scale(B*W,ae),M.raycastResult.hitPointWorld.vsub(ue.position,R),ue.applyImpulse(ae,M.raycastResult.hitPointWorld)}this.updateFriction(W);var D=new r,te=new r,ie=new r;for(ee=0;ee<fe;ee++){var M=O[ee];ue.getVelocityAtWorldPoint(M.chassisConnectionPointWorld,ie);var Z=1;switch(this.indexUpAxis){case 1:Z=-1;break}if(M.isInContact){this.getVehicleAxisWorld(this.indexForwardAxis,te);var me=te.dot(M.raycastResult.hitNormalWorld);M.raycastResult.hitNormalWorld.scale(me,D),te.vsub(D,te);var F=te.dot(ie);M.deltaRotation=Z*F*W/M.radius}(M.sliding||!M.isInContact)&&M.engineForce!==0&&M.useCustomSlidingRotationalSpeed&&(M.deltaRotation=(M.engineForce>0?1:-1)*M.customSlidingRotationalSpeed*W),Math.abs(M.brake)>Math.abs(M.engineForce)&&(M.deltaRotation=0),M.rotation+=M.deltaRotation,M.deltaRotation*=.99}},c.prototype.updateSuspension=function(W){for(var O=this.chassisBody,fe=O.mass,ue=this.wheelInfos,ee=ue.length,de=0;de<ee;de++){var ae=ue[de];if(ae.isInContact){var R,M=ae.suspensionRestLength,B=ae.suspensionLength,D=M-B;R=ae.suspensionStiffness*D*ae.clippedInvContactDotSuspension;var te=ae.suspensionRelativeVelocity,ie;te<0?ie=ae.dampingCompression:ie=ae.dampingRelaxation,R-=ie*te,ae.suspensionForce=R*fe,ae.suspensionForce<0&&(ae.suspensionForce=0)}else ae.suspensionForce=0}},c.prototype.removeFromWorld=function(W){this.constraints,W.remove(this.chassisBody),W.removeEventListener("preStep",this.preStepCallback),this.world=null};var f=new r,p=new r;c.prototype.castRay=function(W){var O=f,fe=p;this.updateWheelTransformWorld(W);var ue=this.chassisBody,ee=-1,de=W.suspensionRestLength+W.radius;W.directionWorld.scale(de,O);var ae=W.chassisConnectionPointWorld;ae.vadd(O,fe);var R=W.raycastResult;R.reset();var M=ue.collisionResponse;ue.collisionResponse=!1,this.world.rayTest(ae,fe,R),ue.collisionResponse=M;var B=R.body;if(W.raycastResult.groundObject=0,B){ee=R.distance,W.raycastResult.hitNormalWorld=R.hitNormalWorld,W.isInContact=!0;var D=R.distance;W.suspensionLength=D-W.radius;var te=W.suspensionRestLength-W.maxSuspensionTravel,ie=W.suspensionRestLength+W.maxSuspensionTravel;W.suspensionLength<te&&(W.suspensionLength=te),W.suspensionLength>ie&&(W.suspensionLength=ie,W.raycastResult.reset());var Z=W.raycastResult.hitNormalWorld.dot(W.directionWorld),me=new r;ue.getVelocityAtWorldPoint(W.raycastResult.hitPointWorld,me);var F=W.raycastResult.hitNormalWorld.dot(me);if(Z>=-.1)W.suspensionRelativeVelocity=0,W.clippedInvContactDotSuspension=1/.1;else{var Q=-1/Z;W.suspensionRelativeVelocity=F*Q,W.clippedInvContactDotSuspension=Q}}else W.suspensionLength=W.suspensionRestLength+0*W.maxSuspensionTravel,W.suspensionRelativeVelocity=0,W.directionWorld.scale(-1,W.raycastResult.hitNormalWorld),W.clippedInvContactDotSuspension=1;return ee},c.prototype.updateWheelTransformWorld=function(W){W.isInContact=!1;var O=this.chassisBody;O.pointToWorldFrame(W.chassisConnectionPointLocal,W.chassisConnectionPointWorld),O.vectorToWorldFrame(W.directionLocal,W.directionWorld),O.vectorToWorldFrame(W.axleLocal,W.axleWorld)},c.prototype.updateWheelTransform=function(W){var O=h,fe=u,ue=d,ee=this.wheelInfos[W];this.updateWheelTransformWorld(ee),ee.directionLocal.scale(-1,O),fe.copy(ee.axleLocal),O.cross(fe,ue),ue.normalize(),fe.normalize();var de=ee.steering,ae=new o;ae.setFromAxisAngle(O,de);var R=new o;R.setFromAxisAngle(fe,ee.rotation);var M=ee.worldTransform.quaternion;this.chassisBody.quaternion.mult(ae,M),M.mult(R,M),M.normalize();var B=ee.worldTransform.position;B.copy(ee.directionWorld),B.scale(ee.suspensionLength,B),B.vadd(ee.chassisConnectionPointWorld,B)};var A=[new r(1,0,0),new r(0,1,0),new r(0,0,1)];c.prototype.getWheelTransformWorld=function(W){return this.wheelInfos[W].worldTransform};var m=new r,g=[],y=[],_=1;c.prototype.updateFriction=function(W){for(var O=m,fe=this.wheelInfos,ue=fe.length,ee=this.chassisBody,de=y,ae=g,R=0;R<ue;R++){var M=fe[R],B=M.raycastResult.body;M.sideImpulse=0,M.forwardImpulse=0,de[R]||(de[R]=new r),ae[R]||(ae[R]=new r)}for(var R=0;R<ue;R++){var M=fe[R],B=M.raycastResult.body;if(B){var D=ae[R],te=this.getWheelTransformWorld(R);te.vectorToWorldFrame(A[this.indexRightAxis],D);var ie=M.raycastResult.hitNormalWorld,Z=D.dot(ie);ie.scale(Z,O),D.vsub(O,D),D.normalize(),ie.cross(D,de[R]),de[R].normalize(),M.sideImpulse=J(ee,M.raycastResult.hitPointWorld,B,M.raycastResult.hitPointWorld,D),M.sideImpulse*=_}}var me=1,F=.5;this.sliding=!1;for(var R=0;R<ue;R++){var M=fe[R],B=M.raycastResult.body,Q=0;if(M.slipInfo=1,B){var E=0,j=M.brake?M.brake:E;Q=L(ee,B,M.raycastResult.hitPointWorld,de[R],j),Q+=M.engineForce*W;var q=j/Q;M.slipInfo*=q}if(M.forwardImpulse=0,M.skidInfo=1,B){M.skidInfo=1;var ce=M.suspensionForce*W*M.frictionSlip,G=ce,V=ce*G;M.forwardImpulse=Q;var re=M.forwardImpulse*F,k=M.sideImpulse*me,N=re*re+k*k;if(M.sliding=!1,N>V){this.sliding=!0,M.sliding=!0;var q=ce/Math.sqrt(N);M.skidInfo*=q}}}if(this.sliding)for(var R=0;R<ue;R++){var M=fe[R];M.sideImpulse!==0&&M.skidInfo<1&&(M.forwardImpulse*=M.skidInfo,M.sideImpulse*=M.skidInfo)}for(var R=0;R<ue;R++){var M=fe[R],oe=new r;if(oe.copy(M.raycastResult.hitPointWorld),M.forwardImpulse!==0){var pe=new r;de[R].scale(M.forwardImpulse,pe),ee.applyImpulse(pe,oe)}if(M.sideImpulse!==0){var B=M.raycastResult.body,ve=new r;ve.copy(M.raycastResult.hitPointWorld);var xe=new r;ae[R].scale(M.sideImpulse,xe),ee.pointToLocalFrame(oe,oe),oe["xyz"[this.indexUpAxis]]*=M.rollInfluence,ee.pointToWorldFrame(oe,oe),ee.applyImpulse(xe,oe),xe.scale(-1,xe),B.applyImpulse(xe,ve)}}};var v=new r,b=new r,T=new r;function L(W,O,fe,ue,ee){var de=0,ae=fe,R=v,M=b,B=T;W.getVelocityAtWorldPoint(ae,R),O.getVelocityAtWorldPoint(ae,M),R.vsub(M,B);var D=ue.dot(B),te=z(W,fe,ue),ie=z(O,fe,ue),Z=1,me=Z/(te+ie);return de=-D*me,ee<de&&(de=ee),de<-ee&&(de=-ee),de}var I=new r,x=new r,w=new r,P=new r;function z(W,O,fe){var ue=I,ee=x,de=w,ae=P;return O.vsub(W.position,ue),ue.cross(fe,ee),W.invInertiaWorld.vmult(ee,ae),ae.cross(ue,de),W.invMass+fe.dot(de)}var H=new r,K=new r,le=new r;function J(W,O,fe,ue,ee,ie){var ae=ee.norm2();if(ae>1.1)return 0;var R=H,M=K,B=le;W.getVelocityAtWorldPoint(O,R),fe.getVelocityAtWorldPoint(ue,M),R.vsub(M,B);var D=ee.dot(B),te=1/(W.invMass+fe.invMass),ie=-.2*D*te;return ie}},{"../collision/Ray":9,"../collision/RaycastResult":10,"../math/Quaternion":28,"../math/Vec3":30,"../objects/WheelInfo":36,"./Body":31}],33:[function(t,n,s){var r=t("./Body"),o=t("../shapes/Sphere"),a=t("../shapes/Box"),l=t("../math/Vec3"),c=t("../constraints/HingeConstraint");n.exports=h;function h(f){if(this.wheelBodies=[],this.coordinateSystem=typeof f.coordinateSystem>"u"?new l(1,2,3):f.coordinateSystem.clone(),this.chassisBody=f.chassisBody,!this.chassisBody){var p=new a(new l(5,2,.5));this.chassisBody=new r(1,p)}this.constraints=[],this.wheelAxes=[],this.wheelForces=[]}h.prototype.addWheel=function(f){f=f||{};var p=f.body;p||(p=new r(1,new o(1.2))),this.wheelBodies.push(p),this.wheelForces.push(0),new l;var A=typeof f.position<"u"?f.position.clone():new l,m=new l;this.chassisBody.pointToWorldFrame(A,m),p.position.set(m.x,m.y,m.z);var g=typeof f.axis<"u"?f.axis.clone():new l(0,1,0);this.wheelAxes.push(g);var y=new c(this.chassisBody,p,{pivotA:A,axisA:g,pivotB:l.ZERO,axisB:g,collideConnected:!1});return this.constraints.push(y),this.wheelBodies.length-1},h.prototype.setSteeringValue=function(f,p){var A=this.wheelAxes[p],m=Math.cos(f),g=Math.sin(f),y=A.x,_=A.y;this.constraints[p].axisA.set(m*y-g*_,g*y+m*_,0)},h.prototype.setMotorSpeed=function(f,p){var A=this.constraints[p];A.enableMotor(),A.motorTargetVelocity=f},h.prototype.disableMotor=function(f){var p=this.constraints[f];p.disableMotor()};var u=new l;h.prototype.setWheelForce=function(f,p){this.wheelForces[p]=f},h.prototype.applyWheelForce=function(f,p){var A=this.wheelAxes[p],m=this.wheelBodies[p],g=m.torque;A.scale(f,u),m.vectorToWorldFrame(u,u),g.vadd(u,g)},h.prototype.addToWorld=function(f){for(var p=this.constraints,A=this.wheelBodies.concat([this.chassisBody]),m=0;m<A.length;m++)f.add(A[m]);for(var m=0;m<p.length;m++)f.addConstraint(p[m]);f.addEventListener("preStep",this._update.bind(this))},h.prototype._update=function(){for(var f=this.wheelForces,p=0;p<f.length;p++)this.applyWheelForce(f[p],p)},h.prototype.removeFromWorld=function(f){for(var p=this.constraints,A=this.wheelBodies.concat([this.chassisBody]),m=0;m<A.length;m++)f.remove(A[m]);for(var m=0;m<p.length;m++)f.removeConstraint(p[m])};var d=new l;h.prototype.getWheelSpeed=function(f){var p=this.wheelAxes[f],A=this.wheelBodies[f],m=A.angularVelocity;return this.chassisBody.vectorToWorldFrame(p,d),m.dot(d)}},{"../constraints/HingeConstraint":15,"../math/Vec3":30,"../shapes/Box":37,"../shapes/Sphere":44,"./Body":31}],34:[function(t,n,s){n.exports=o,t("../shapes/Shape");var r=t("../math/Vec3");t("../math/Quaternion"),t("../shapes/Particle"),t("../objects/Body"),t("../material/Material");function o(){this.particles=[],this.density=1,this.smoothingRadius=1,this.speedOfSound=1,this.viscosity=.01,this.eps=1e-6,this.pressures=[],this.densities=[],this.neighbors=[]}o.prototype.add=function(p){this.particles.push(p),this.neighbors.length<this.particles.length&&this.neighbors.push([])},o.prototype.remove=function(p){var A=this.particles.indexOf(p);A!==-1&&(this.particles.splice(A,1),this.neighbors.length>this.particles.length&&this.neighbors.pop())};var a=new r;o.prototype.getNeighbors=function(p,A){for(var m=this.particles.length,g=p.id,y=this.smoothingRadius*this.smoothingRadius,_=a,v=0;v!==m;v++){var b=this.particles[v];b.position.vsub(p.position,_),g!==b.id&&_.norm2()<y&&A.push(b)}};var l=new r,c=new r,h=new r,u=new r,d=new r,f=new r;o.prototype.update=function(){for(var p=this.particles.length,A=l,m=this.speedOfSound,g=this.eps,y=0;y!==p;y++){var _=this.particles[y],v=this.neighbors[y];v.length=0,this.getNeighbors(_,v),v.push(this.particles[y]);for(var b=v.length,T=0,L=0;L!==b;L++){_.position.vsub(v[L].position,A);var I=A.norm(),x=this.w(I);T+=v[L].mass*x}this.densities[y]=T,this.pressures[y]=m*m*(this.densities[y]-this.density)}for(var w=c,P=h,z=u,H=d,K=f,y=0;y!==p;y++){var le=this.particles[y];w.set(0,0,0),P.set(0,0,0);for(var J,W,v=this.neighbors[y],b=v.length,L=0;L!==b;L++){var O=v[L];le.position.vsub(O.position,H);var fe=H.norm();J=-O.mass*(this.pressures[y]/(this.densities[y]*this.densities[y]+g)+this.pressures[L]/(this.densities[L]*this.densities[L]+g)),this.gradw(H,z),z.mult(J,z),w.vadd(z,w),O.velocity.vsub(le.velocity,K),K.mult(1/(1e-4+this.densities[y]*this.densities[L])*this.viscosity*O.mass,K),W=this.nablaw(fe),K.mult(W,K),P.vadd(K,P)}P.mult(le.mass,P),w.mult(le.mass,w),le.force.vadd(P,le.force),le.force.vadd(w,le.force)}},o.prototype.w=function(p){var A=this.smoothingRadius;return 315/(64*Math.PI*Math.pow(A,9))*Math.pow(A*A-p*p,3)},o.prototype.gradw=function(p,A){var m=p.norm(),g=this.smoothingRadius;p.mult(945/(32*Math.PI*Math.pow(g,9))*Math.pow(g*g-m*m,2),A)},o.prototype.nablaw=function(p){var A=this.smoothingRadius,m=945/(32*Math.PI*Math.pow(A,9))*(A*A-p*p)*(7*p*p-3*A*A);return m}},{"../material/Material":25,"../math/Quaternion":28,"../math/Vec3":30,"../objects/Body":31,"../shapes/Particle":41,"../shapes/Shape":43}],35:[function(t,n,s){var r=t("../math/Vec3");n.exports=o;function o(y,_,v){v=v||{},this.restLength=typeof v.restLength=="number"?v.restLength:1,this.stiffness=v.stiffness||100,this.damping=v.damping||1,this.bodyA=y,this.bodyB=_,this.localAnchorA=new r,this.localAnchorB=new r,v.localAnchorA&&this.localAnchorA.copy(v.localAnchorA),v.localAnchorB&&this.localAnchorB.copy(v.localAnchorB),v.worldAnchorA&&this.setWorldAnchorA(v.worldAnchorA),v.worldAnchorB&&this.setWorldAnchorB(v.worldAnchorB)}o.prototype.setWorldAnchorA=function(y){this.bodyA.pointToLocalFrame(y,this.localAnchorA)},o.prototype.setWorldAnchorB=function(y){this.bodyB.pointToLocalFrame(y,this.localAnchorB)},o.prototype.getWorldAnchorA=function(y){this.bodyA.pointToWorldFrame(this.localAnchorA,y)},o.prototype.getWorldAnchorB=function(y){this.bodyB.pointToWorldFrame(this.localAnchorB,y)};var a=new r,l=new r,c=new r,h=new r,u=new r,d=new r,f=new r,p=new r,A=new r,m=new r,g=new r;o.prototype.applyForce=function(){var y=this.stiffness,_=this.damping,v=this.restLength,b=this.bodyA,T=this.bodyB,L=a,I=l,x=c,w=h,P=g,z=u,H=d,K=f,le=p,J=A,W=m;this.getWorldAnchorA(z),this.getWorldAnchorB(H),z.vsub(b.position,K),H.vsub(T.position,le),H.vsub(z,L);var O=L.norm();I.copy(L),I.normalize(),T.velocity.vsub(b.velocity,x),T.angularVelocity.cross(le,P),x.vadd(P,x),b.angularVelocity.cross(K,P),x.vsub(P,x),I.mult(-y*(O-v)-_*x.dot(I),w),b.force.vsub(w,b.force),T.force.vadd(w,T.force),K.cross(w,J),le.cross(w,W),b.torque.vsub(J,b.torque),T.torque.vadd(W,T.torque)}},{"../math/Vec3":30}],36:[function(t,n,s){var r=t("../math/Vec3"),o=t("../math/Transform"),a=t("../collision/RaycastResult"),l=t("../utils/Utils");n.exports=c;function c(d){d=l.defaults(d,{chassisConnectionPointLocal:new r,chassisConnectionPointWorld:new r,directionLocal:new r,directionWorld:new r,axleLocal:new r,axleWorld:new r,suspensionRestLength:1,suspensionMaxLength:2,radius:1,suspensionStiffness:100,dampingCompression:10,dampingRelaxation:10,frictionSlip:1e4,steering:0,rotation:0,deltaRotation:0,rollInfluence:.01,maxSuspensionForce:Number.MAX_VALUE,isFrontWheel:!0,clippedInvContactDotSuspension:1,suspensionRelativeVelocity:0,suspensionForce:0,skidInfo:0,suspensionLength:0,maxSuspensionTravel:1,useCustomSlidingRotationalSpeed:!1,customSlidingRotationalSpeed:-.1}),this.maxSuspensionTravel=d.maxSuspensionTravel,this.customSlidingRotationalSpeed=d.customSlidingRotationalSpeed,this.useCustomSlidingRotationalSpeed=d.useCustomSlidingRotationalSpeed,this.sliding=!1,this.chassisConnectionPointLocal=d.chassisConnectionPointLocal.clone(),this.chassisConnectionPointWorld=d.chassisConnectionPointWorld.clone(),this.directionLocal=d.directionLocal.clone(),this.directionWorld=d.directionWorld.clone(),this.axleLocal=d.axleLocal.clone(),this.axleWorld=d.axleWorld.clone(),this.suspensionRestLength=d.suspensionRestLength,this.suspensionMaxLength=d.suspensionMaxLength,this.radius=d.radius,this.suspensionStiffness=d.suspensionStiffness,this.dampingCompression=d.dampingCompression,this.dampingRelaxation=d.dampingRelaxation,this.frictionSlip=d.frictionSlip,this.steering=0,this.rotation=0,this.deltaRotation=0,this.rollInfluence=d.rollInfluence,this.maxSuspensionForce=d.maxSuspensionForce,this.engineForce=0,this.brake=0,this.isFrontWheel=d.isFrontWheel,this.clippedInvContactDotSuspension=1,this.suspensionRelativeVelocity=0,this.suspensionForce=0,this.skidInfo=0,this.suspensionLength=0,this.sideImpulse=0,this.forwardImpulse=0,this.raycastResult=new a,this.worldTransform=new o,this.isInContact=!1}var u=new r,h=new r,u=new r;c.prototype.updateWheel=function(d){var f=this.raycastResult;if(this.isInContact){var p=f.hitNormalWorld.dot(f.directionWorld);f.hitPointWorld.vsub(d.position,h),d.getVelocityAtWorldPoint(h,u);var A=f.hitNormalWorld.dot(u);if(p>=-.1)this.suspensionRelativeVelocity=0,this.clippedInvContactDotSuspension=1/.1;else{var m=-1/p;this.suspensionRelativeVelocity=A*m,this.clippedInvContactDotSuspension=m}}else f.suspensionLength=this.suspensionRestLength,this.suspensionRelativeVelocity=0,f.directionWorld.scale(-1,f.hitNormalWorld),this.clippedInvContactDotSuspension=1}},{"../collision/RaycastResult":10,"../math/Transform":29,"../math/Vec3":30,"../utils/Utils":53}],37:[function(t,n,s){n.exports=l;var r=t("./Shape"),o=t("../math/Vec3"),a=t("./ConvexPolyhedron");function l(u){r.call(this),this.type=r.types.BOX,this.halfExtents=u,this.convexPolyhedronRepresentation=null,this.updateConvexPolyhedronRepresentation(),this.updateBoundingSphereRadius()}l.prototype=new r,l.prototype.constructor=l,l.prototype.updateConvexPolyhedronRepresentation=function(){var u=this.halfExtents.x,d=this.halfExtents.y,f=this.halfExtents.z,p=o,A=[new p(-u,-d,-f),new p(u,-d,-f),new p(u,d,-f),new p(-u,d,-f),new p(-u,-d,f),new p(u,-d,f),new p(u,d,f),new p(-u,d,f)],m=[[3,2,1,0],[4,5,6,7],[5,4,0,1],[2,3,7,6],[0,4,7,3],[1,2,6,5]];new p(0,0,1),new p(0,1,0),new p(1,0,0);var g=new a(A,m);this.convexPolyhedronRepresentation=g,g.material=this.material},l.prototype.calculateLocalInertia=function(u,d){return d=d||new o,l.calculateInertia(this.halfExtents,u,d),d},l.calculateInertia=function(u,d,f){var p=u;f.x=1/12*d*(2*p.y*2*p.y+2*p.z*2*p.z),f.y=1/12*d*(2*p.x*2*p.x+2*p.z*2*p.z),f.z=1/12*d*(2*p.y*2*p.y+2*p.x*2*p.x)},l.prototype.getSideNormals=function(u,d){var f=u,p=this.halfExtents;if(f[0].set(p.x,0,0),f[1].set(0,p.y,0),f[2].set(0,0,p.z),f[3].set(-p.x,0,0),f[4].set(0,-p.y,0),f[5].set(0,0,-p.z),d!==void 0)for(var A=0;A!==f.length;A++)d.vmult(f[A],f[A]);return f},l.prototype.volume=function(){return 8*this.halfExtents.x*this.halfExtents.y*this.halfExtents.z},l.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=this.halfExtents.norm()};var c=new o;new o,l.prototype.forEachWorldCorner=function(u,d,f){for(var p=this.halfExtents,A=[[p.x,p.y,p.z],[-p.x,p.y,p.z],[-p.x,-p.y,p.z],[-p.x,-p.y,-p.z],[p.x,-p.y,-p.z],[p.x,p.y,-p.z],[-p.x,p.y,-p.z],[p.x,-p.y,p.z]],m=0;m<A.length;m++)c.set(A[m][0],A[m][1],A[m][2]),d.vmult(c,c),u.vadd(c,c),f(c.x,c.y,c.z)};var h=[new o,new o,new o,new o,new o,new o,new o,new o];l.prototype.calculateWorldAABB=function(u,d,f,p){var A=this.halfExtents;h[0].set(A.x,A.y,A.z),h[1].set(-A.x,A.y,A.z),h[2].set(-A.x,-A.y,A.z),h[3].set(-A.x,-A.y,-A.z),h[4].set(A.x,-A.y,-A.z),h[5].set(A.x,A.y,-A.z),h[6].set(-A.x,A.y,-A.z),h[7].set(A.x,-A.y,A.z);var m=h[0];d.vmult(m,m),u.vadd(m,m),p.copy(m),f.copy(m);for(var g=1;g<8;g++){var m=h[g];d.vmult(m,m),u.vadd(m,m);var y=m.x,_=m.y,v=m.z;y>p.x&&(p.x=y),_>p.y&&(p.y=_),v>p.z&&(p.z=v),y<f.x&&(f.x=y),_<f.y&&(f.y=_),v<f.z&&(f.z=v)}}},{"../math/Vec3":30,"./ConvexPolyhedron":38,"./Shape":43}],38:[function(t,n,s){n.exports=l;var r=t("./Shape"),o=t("../math/Vec3");t("../math/Quaternion");var a=t("../math/Transform");function l(ee,de,ae){r.call(this),this.type=r.types.CONVEXPOLYHEDRON,this.vertices=ee||[],this.worldVertices=[],this.worldVerticesNeedsUpdate=!0,this.faces=de||[],this.faceNormals=[],this.computeNormals(),this.worldFaceNormalsNeedsUpdate=!0,this.worldFaceNormals=[],this.uniqueEdges=[],this.uniqueAxes=ae?ae.slice():null,this.computeEdges(),this.updateBoundingSphereRadius()}l.prototype=new r,l.prototype.constructor=l;var c=new o;l.prototype.computeEdges=function(){var ee=this.faces,de=this.vertices;de.length;var ae=this.uniqueEdges;ae.length=0;for(var R=c,M=0;M!==ee.length;M++)for(var B=ee[M],D=B.length,te=0;te!==D;te++){var ie=(te+1)%D;de[B[te]].vsub(de[B[ie]],R),R.normalize();for(var Z=!1,me=0;me!==ae.length;me++)if(ae[me].almostEquals(R)||ae[me].almostEquals(R)){Z=!0;break}Z||ae.push(R.clone())}},l.prototype.computeNormals=function(){this.faceNormals.length=this.faces.length;for(var ee=0;ee<this.faces.length;ee++){for(var de=0;de<this.faces[ee].length;de++)if(!this.vertices[this.faces[ee][de]])throw new Error("Vertex "+this.faces[ee][de]+" not found!");var ae=this.faceNormals[ee]||new o;this.getFaceNormal(ee,ae),ae.negate(ae),this.faceNormals[ee]=ae;var R=this.vertices[this.faces[ee][0]];if(ae.dot(R)<0){console.error(".faceNormals["+ee+"] = Vec3("+ae.toString()+") looks like it points into the shape? The vertices follow. Make sure they are ordered CCW around the normal, using the right hand rule.");for(var de=0;de<this.faces[ee].length;de++)console.warn(".vertices["+this.faces[ee][de]+"] = Vec3("+this.vertices[this.faces[ee][de]].toString()+")")}}};var h=new o,u=new o;l.computeNormal=function(ee,de,ae,R){de.vsub(ee,u),ae.vsub(de,h),h.cross(u,R),R.isZero()||R.normalize()},l.prototype.getFaceNormal=function(ee,de){var ae=this.faces[ee],R=this.vertices[ae[0]],M=this.vertices[ae[1]],B=this.vertices[ae[2]];return l.computeNormal(R,M,B,de)};var d=new o;l.prototype.clipAgainstHull=function(ee,de,ae,R,M,B,D,te,ie){for(var Z=d,me=-1,F=-Number.MAX_VALUE,Q=0;Q<ae.faces.length;Q++){Z.copy(ae.faceNormals[Q]),M.vmult(Z,Z);var E=Z.dot(B);E>F&&(F=E,me=Q)}for(var j=[],q=ae.faces[me],ce=q.length,G=0;G<ce;G++){var V=ae.vertices[q[G]],re=new o;re.copy(V),M.vmult(re,re),R.vadd(re,re),j.push(re)}me>=0&&this.clipFaceAgainstHull(B,ee,de,j,D,te,ie)};var f=new o,p=new o,A=new o,m=new o,g=new o,y=new o;l.prototype.findSeparatingAxis=function(ee,de,ae,R,M,B,D,te){var ie=f,Z=p,me=A,F=m,Q=g,E=y,j=Number.MAX_VALUE,q=this;if(q.uniqueAxes)for(var G=0;G!==q.uniqueAxes.length;G++){ae.vmult(q.uniqueAxes[G],ie);var re=q.testSepAxis(ie,ee,de,ae,R,M);if(re===!1)return!1;re<j&&(j=re,B.copy(ie))}else for(var ce=D?D.length:q.faces.length,G=0;G<ce;G++){var V=D?D[G]:G;ie.copy(q.faceNormals[V]),ae.vmult(ie,ie);var re=q.testSepAxis(ie,ee,de,ae,R,M);if(re===!1)return!1;re<j&&(j=re,B.copy(ie))}if(ee.uniqueAxes)for(var G=0;G!==ee.uniqueAxes.length;G++){M.vmult(ee.uniqueAxes[G],Z);var re=q.testSepAxis(Z,ee,de,ae,R,M);if(re===!1)return!1;re<j&&(j=re,B.copy(Z))}else for(var k=te?te.length:ee.faces.length,G=0;G<k;G++){var V=te?te[G]:G;Z.copy(ee.faceNormals[V]),M.vmult(Z,Z);var re=q.testSepAxis(Z,ee,de,ae,R,M);if(re===!1)return!1;re<j&&(j=re,B.copy(Z))}for(var N=0;N!==q.uniqueEdges.length;N++){ae.vmult(q.uniqueEdges[N],F);for(var oe=0;oe!==ee.uniqueEdges.length;oe++)if(M.vmult(ee.uniqueEdges[oe],Q),F.cross(Q,E),!E.almostZero()){E.normalize();var pe=q.testSepAxis(E,ee,de,ae,R,M);if(pe===!1)return!1;pe<j&&(j=pe,B.copy(E))}}return R.vsub(de,me),me.dot(B)>0&&B.negate(B),!0};var _=[],v=[];l.prototype.testSepAxis=function(ee,de,ae,R,M,B){var D=this;l.project(D,ee,ae,R,_),l.project(de,ee,M,B,v);var te=_[0],ie=_[1],Z=v[0],me=v[1];if(te<me||Z<ie)return!1;var F=te-me,Q=Z-ie,E=F<Q?F:Q;return E};var b=new o,T=new o;l.prototype.calculateLocalInertia=function(ee,de){this.computeLocalAABB(b,T);var ae=T.x-b.x,R=T.y-b.y,M=T.z-b.z;de.x=1/12*ee*(2*R*2*R+2*M*2*M),de.y=1/12*ee*(2*ae*2*ae+2*M*2*M),de.z=1/12*ee*(2*R*2*R+2*ae*2*ae)},l.prototype.getPlaneConstantOfFace=function(ee){var de=this.faces[ee],ae=this.faceNormals[ee],R=this.vertices[de[0]],M=-ae.dot(R);return M};var L=new o,I=new o,x=new o,w=new o,P=new o,z=new o,H=new o,K=new o;l.prototype.clipFaceAgainstHull=function(ee,de,ae,R,M,B,D){for(var te=L,ie=I,Z=x,me=w,F=P,Q=z,E=H,j=K,q=this,ce=[],G=R,V=ce,re=-1,k=Number.MAX_VALUE,N=0;N<q.faces.length;N++){te.copy(q.faceNormals[N]),ae.vmult(te,te);var oe=te.dot(ee);oe<k&&(k=oe,re=N)}if(!(re<0)){var pe=q.faces[re];pe.connectedFaces=[];for(var ve=0;ve<q.faces.length;ve++)for(var xe=0;xe<q.faces[ve].length;xe++)pe.indexOf(q.faces[ve][xe])!==-1&&ve!==re&&pe.connectedFaces.indexOf(ve)===-1&&pe.connectedFaces.push(ve);G.length;for(var Pe=pe.length,Te=0;Te<Pe;Te++){var Qe=q.vertices[pe[Te]],lt=q.vertices[pe[(Te+1)%Pe]];Qe.vsub(lt,ie),Z.copy(ie),ae.vmult(Z,Z),de.vadd(Z,Z),me.copy(this.faceNormals[re]),ae.vmult(me,me),de.vadd(me,me),Z.cross(me,F),F.negate(F),Q.copy(Qe),ae.vmult(Q,Q),de.vadd(Q,Q),-Q.dot(F);var Ke;{var Ne=pe.connectedFaces[Te];E.copy(this.faceNormals[Ne]);var qe=this.getPlaneConstantOfFace(Ne);j.copy(E),ae.vmult(j,j);var Ke=qe-j.dot(de)}for(this.clipFaceAgainstPlane(G,V,j,Ke);G.length;)G.shift();for(;V.length;)G.push(V.shift())}E.copy(this.faceNormals[re]);var qe=this.getPlaneConstantOfFace(re);j.copy(E),ae.vmult(j,j);for(var Ke=qe-j.dot(de),ve=0;ve<G.length;ve++){var it=j.dot(G[ve])+Ke;if(it<=M&&(console.log("clamped: depth="+it+" to minDist="+(M+"")),it=M),it<=B){var je=G[ve];if(it<=0){var dt={point:je,normal:j,depth:it};D.push(dt)}}}}},l.prototype.clipFaceAgainstPlane=function(ee,de,ae,R){var M,B,D=ee.length;if(D<2)return de;var te=ee[ee.length-1],ie=ee[0];M=ae.dot(te)+R;for(var Z=0;Z<D;Z++){if(ie=ee[Z],B=ae.dot(ie)+R,M<0)if(B<0){var me=new o;me.copy(ie),de.push(me)}else{var me=new o;te.lerp(ie,M/(M-B),me),de.push(me)}else if(B<0){var me=new o;te.lerp(ie,M/(M-B),me),de.push(me),de.push(ie)}te=ie,M=B}return de},l.prototype.computeWorldVertices=function(ee,de){for(var ae=this.vertices.length;this.worldVertices.length<ae;)this.worldVertices.push(new o);for(var R=this.vertices,M=this.worldVertices,B=0;B!==ae;B++)de.vmult(R[B],M[B]),ee.vadd(M[B],M[B]);this.worldVerticesNeedsUpdate=!1},new o,l.prototype.computeLocalAABB=function(ee,de){var ae=this.vertices.length,R=this.vertices;ee.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),de.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(var M=0;M<ae;M++){var B=R[M];B.x<ee.x?ee.x=B.x:B.x>de.x&&(de.x=B.x),B.y<ee.y?ee.y=B.y:B.y>de.y&&(de.y=B.y),B.z<ee.z?ee.z=B.z:B.z>de.z&&(de.z=B.z)}},l.prototype.computeWorldFaceNormals=function(ee){for(var de=this.faceNormals.length;this.worldFaceNormals.length<de;)this.worldFaceNormals.push(new o);for(var ae=this.faceNormals,R=this.worldFaceNormals,M=0;M!==de;M++)ee.vmult(ae[M],R[M]);this.worldFaceNormalsNeedsUpdate=!1},l.prototype.updateBoundingSphereRadius=function(){for(var ee=0,de=this.vertices,ae=0,R=de.length;ae!==R;ae++){var M=de[ae].norm2();M>ee&&(ee=M)}this.boundingSphereRadius=Math.sqrt(ee)};var le=new o;l.prototype.calculateWorldAABB=function(ee,de,ae,R){for(var M=this.vertices.length,B=this.vertices,D,te,ie,Z,me,F,Q=0;Q<M;Q++){le.copy(B[Q]),de.vmult(le,le),ee.vadd(le,le);var E=le;E.x<D||D===void 0?D=E.x:(E.x>Z||Z===void 0)&&(Z=E.x),E.y<te||te===void 0?te=E.y:(E.y>me||me===void 0)&&(me=E.y),E.z<ie||ie===void 0?ie=E.z:(E.z>F||F===void 0)&&(F=E.z)}ae.set(D,te,ie),R.set(Z,me,F)},l.prototype.volume=function(){return 4*Math.PI*this.boundingSphereRadius/3},l.prototype.getAveragePointLocal=function(ee){ee=ee||new o;for(var de=this.vertices.length,ae=this.vertices,R=0;R<de;R++)ee.vadd(ae[R],ee);return ee.mult(1/de,ee),ee},l.prototype.transformAllPoints=function(ee,de){var ae=this.vertices.length,R=this.vertices;if(de){for(var M=0;M<ae;M++){var B=R[M];de.vmult(B,B)}for(var M=0;M<this.faceNormals.length;M++){var B=this.faceNormals[M];de.vmult(B,B)}}if(ee)for(var M=0;M<ae;M++){var B=R[M];B.vadd(ee,B)}};var J=new o,W=new o,O=new o;l.prototype.pointIsInside=function(ee){var de=this.vertices.length,ae=this.vertices,R=this.faces,M=this.faceNormals,B=null,D=this.faces.length,te=J;this.getAveragePointLocal(te);for(var ie=0;ie<D;ie++){this.faces[ie].length;var de=M[ie],Z=ae[R[ie][0]],me=W;ee.vsub(Z,me);var F=de.dot(me),Q=O;te.vsub(Z,Q);var E=de.dot(Q);if(F<0&&E>0||F>0&&E<0)return!1}return B?1:-1},new o;var fe=new o,ue=new o;l.project=function(ee,de,ae,R,M){var B=ee.vertices.length,D=fe,te=0,ie=0,Z=ue,me=ee.vertices;Z.setZero(),a.vectorToLocalFrame(ae,R,de,D),a.pointToLocalFrame(ae,R,Z,Z);var F=Z.dot(D);ie=te=me[0].dot(D);for(var Q=1;Q<B;Q++){var E=me[Q].dot(D);E>te&&(te=E),E<ie&&(ie=E)}if(ie-=F,te-=F,ie>te){var j=ie;ie=te,te=j}M[0]=te,M[1]=ie}},{"../math/Quaternion":28,"../math/Transform":29,"../math/Vec3":30,"./Shape":43}],39:[function(t,n,s){n.exports=l;var r=t("./Shape"),o=t("../math/Vec3");t("../math/Quaternion");var a=t("./ConvexPolyhedron");function l(c,h,u,d){var f=d,p=[],A=[],m=[],g=[],y=[],_=Math.cos,v=Math.sin;p.push(new o(h*_(0),h*v(0),-u*.5)),g.push(0),p.push(new o(c*_(0),c*v(0),u*.5)),y.push(1);for(var b=0;b<f;b++){var T=2*Math.PI/f*(b+1),L=2*Math.PI/f*(b+.5);b<f-1?(p.push(new o(h*_(T),h*v(T),-u*.5)),g.push(2*b+2),p.push(new o(c*_(T),c*v(T),u*.5)),y.push(2*b+3),m.push([2*b+2,2*b+3,2*b+1,2*b])):m.push([0,1,2*b+1,2*b]),(f%2===1||b<f/2)&&A.push(new o(_(L),v(L),0))}m.push(y),A.push(new o(0,0,1));for(var I=[],b=0;b<g.length;b++)I.push(g[g.length-b-1]);m.push(I),this.type=r.types.CONVEXPOLYHEDRON,a.call(this,p,m,A)}l.prototype=new a},{"../math/Quaternion":28,"../math/Vec3":30,"./ConvexPolyhedron":38,"./Shape":43}],40:[function(t,n,s){var r=t("./Shape"),o=t("./ConvexPolyhedron"),a=t("../math/Vec3"),l=t("../utils/Utils");n.exports=c;function c(h,u){u=l.defaults(u,{maxValue:null,minValue:null,elementSize:1}),this.data=h,this.maxValue=u.maxValue,this.minValue=u.minValue,this.elementSize=u.elementSize,u.minValue===null&&this.updateMinValue(),u.maxValue===null&&this.updateMaxValue(),this.cacheEnabled=!0,r.call(this),this.pillarConvex=new o,this.pillarOffset=new a,this.type=r.types.HEIGHTFIELD,this.updateBoundingSphereRadius(),this._cachedPillars={}}c.prototype=new r,c.prototype.update=function(){this._cachedPillars={}},c.prototype.updateMinValue=function(){for(var h=this.data,u=h[0][0],d=0;d!==h.length;d++)for(var f=0;f!==h[d].length;f++){var p=h[d][f];p<u&&(u=p)}this.minValue=u},c.prototype.updateMaxValue=function(){for(var h=this.data,u=h[0][0],d=0;d!==h.length;d++)for(var f=0;f!==h[d].length;f++){var p=h[d][f];p>u&&(u=p)}this.maxValue=u},c.prototype.setHeightValueAtIndex=function(h,u,d){var f=this.data;f[h][u]=d,this.clearCachedConvexTrianglePillar(h,u,!1),h>0&&(this.clearCachedConvexTrianglePillar(h-1,u,!0),this.clearCachedConvexTrianglePillar(h-1,u,!1)),u>0&&(this.clearCachedConvexTrianglePillar(h,u-1,!0),this.clearCachedConvexTrianglePillar(h,u-1,!1)),u>0&&h>0&&this.clearCachedConvexTrianglePillar(h-1,u-1,!0)},c.prototype.getRectMinMax=function(h,u,d,f,p){p=p||[];for(var A=this.data,m=this.minValue,g=h;g<=d;g++)for(var y=u;y<=f;y++){var _=A[g][y];_>m&&(m=_)}p[0]=this.minValue,p[1]=m},c.prototype.getIndexOfPosition=function(h,u,d,f){var p=this.elementSize,A=this.data,m=Math.floor(h/p),g=Math.floor(u/p);return d[0]=m,d[1]=g,f&&(m<0&&(m=0),g<0&&(g=0),m>=A.length-1&&(m=A.length-1),g>=A[0].length-1&&(g=A[0].length-1)),!(m<0||g<0||m>=A.length-1||g>=A[0].length-1)},c.prototype.getHeightAt=function(h,u,d){var f=[];this.getIndexOfPosition(h,u,f,d);var p=[];return this.getRectMinMax(f[0],f[1]+1,f[0],f[1]+1,p),(p[0]+p[1])/2},c.prototype.getCacheConvexTrianglePillarKey=function(h,u,d){return h+"_"+u+"_"+(d?1:0)},c.prototype.getCachedConvexTrianglePillar=function(h,u,d){return this._cachedPillars[this.getCacheConvexTrianglePillarKey(h,u,d)]},c.prototype.setCachedConvexTrianglePillar=function(h,u,d,f,p){this._cachedPillars[this.getCacheConvexTrianglePillarKey(h,u,d)]={convex:f,offset:p}},c.prototype.clearCachedConvexTrianglePillar=function(h,u,d){delete this._cachedPillars[this.getCacheConvexTrianglePillarKey(h,u,d)]},c.prototype.getConvexTrianglePillar=function(h,u,d){var f=this.pillarConvex,p=this.pillarOffset;if(this.cacheEnabled){var A=this.getCachedConvexTrianglePillar(h,u,d);if(A){this.pillarConvex=A.convex,this.pillarOffset=A.offset;return}f=new o,p=new a,this.pillarConvex=f,this.pillarOffset=p}var A=this.data,m=this.elementSize,g=f.faces;f.vertices.length=6;for(var y=0;y<6;y++)f.vertices[y]||(f.vertices[y]=new a);g.length=5;for(var y=0;y<5;y++)g[y]||(g[y]=[]);var _=f.vertices,v=(Math.min(A[h][u],A[h+1][u],A[h][u+1],A[h+1][u+1])-this.minValue)/2+this.minValue;d?(p.set((h+.75)*m,(u+.75)*m,v),_[0].set(.25*m,.25*m,A[h+1][u+1]-v),_[1].set(-.75*m,.25*m,A[h][u+1]-v),_[2].set(.25*m,-.75*m,A[h+1][u]-v),_[3].set(.25*m,.25*m,-v-1),_[4].set(-.75*m,.25*m,-v-1),_[5].set(.25*m,-.75*m,-v-1),g[0][0]=0,g[0][1]=1,g[0][2]=2,g[1][0]=5,g[1][1]=4,g[1][2]=3,g[2][0]=2,g[2][1]=5,g[2][2]=3,g[2][3]=0,g[3][0]=3,g[3][1]=4,g[3][2]=1,g[3][3]=0,g[4][0]=1,g[4][1]=4,g[4][2]=5,g[4][3]=2):(p.set((h+.25)*m,(u+.25)*m,v),_[0].set(-.25*m,-.25*m,A[h][u]-v),_[1].set(.75*m,-.25*m,A[h+1][u]-v),_[2].set(-.25*m,.75*m,A[h][u+1]-v),_[3].set(-.25*m,-.25*m,-v-1),_[4].set(.75*m,-.25*m,-v-1),_[5].set(-.25*m,.75*m,-v-1),g[0][0]=0,g[0][1]=1,g[0][2]=2,g[1][0]=5,g[1][1]=4,g[1][2]=3,g[2][0]=0,g[2][1]=2,g[2][2]=5,g[2][3]=3,g[3][0]=1,g[3][1]=0,g[3][2]=3,g[3][3]=4,g[4][0]=4,g[4][1]=5,g[4][2]=2,g[4][3]=1),f.computeNormals(),f.computeEdges(),f.updateBoundingSphereRadius(),this.setCachedConvexTrianglePillar(h,u,d,f,p)},c.prototype.calculateLocalInertia=function(h,u){return u=u||new a,u.set(0,0,0),u},c.prototype.volume=function(){return Number.MAX_VALUE},c.prototype.calculateWorldAABB=function(h,u,d,f){d.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),f.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)},c.prototype.updateBoundingSphereRadius=function(){var h=this.data,u=this.elementSize;this.boundingSphereRadius=new a(h.length*u,h[0].length*u,Math.max(Math.abs(this.maxValue),Math.abs(this.minValue))).norm()}},{"../math/Vec3":30,"../utils/Utils":53,"./ConvexPolyhedron":38,"./Shape":43}],41:[function(t,n,s){n.exports=a;var r=t("./Shape"),o=t("../math/Vec3");function a(){r.call(this),this.type=r.types.PARTICLE}a.prototype=new r,a.prototype.constructor=a,a.prototype.calculateLocalInertia=function(l,c){return c=c||new o,c.set(0,0,0),c},a.prototype.volume=function(){return 0},a.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=0},a.prototype.calculateWorldAABB=function(l,c,h,u){h.copy(l),u.copy(l)}},{"../math/Vec3":30,"./Shape":43}],42:[function(t,n,s){n.exports=a;var r=t("./Shape"),o=t("../math/Vec3");function a(){r.call(this),this.type=r.types.PLANE,this.worldNormal=new o,this.worldNormalNeedsUpdate=!0,this.boundingSphereRadius=Number.MAX_VALUE}a.prototype=new r,a.prototype.constructor=a,a.prototype.computeWorldNormal=function(c){var h=this.worldNormal;h.set(0,0,1),c.vmult(h,h),this.worldNormalNeedsUpdate=!1},a.prototype.calculateLocalInertia=function(c,h){return h=h||new o,h},a.prototype.volume=function(){return Number.MAX_VALUE};var l=new o;a.prototype.calculateWorldAABB=function(c,h,u,d){l.set(0,0,1),h.vmult(l,l);var f=Number.MAX_VALUE;u.set(-f,-f,-f),d.set(f,f,f),l.x===1&&(d.x=c.x),l.y===1&&(d.y=c.y),l.z===1&&(d.z=c.z),l.x===-1&&(u.x=c.x),l.y===-1&&(u.y=c.y),l.z===-1&&(u.z=c.z)},a.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=Number.MAX_VALUE}},{"../math/Vec3":30,"./Shape":43}],43:[function(t,n,s){n.exports=r;var r=t("./Shape");t("../math/Vec3"),t("../math/Quaternion"),t("../material/Material");function r(){this.id=r.idCounter++,this.type=0,this.boundingSphereRadius=0,this.collisionResponse=!0,this.material=null}r.prototype.constructor=r,r.prototype.updateBoundingSphereRadius=function(){throw"computeBoundingSphereRadius() not implemented for shape type "+this.type},r.prototype.volume=function(){throw"volume() not implemented for shape type "+this.type},r.prototype.calculateLocalInertia=function(o,a){throw"calculateLocalInertia() not implemented for shape type "+this.type},r.idCounter=0,r.types={SPHERE:1,PLANE:2,BOX:4,COMPOUND:8,CONVEXPOLYHEDRON:16,HEIGHTFIELD:32,PARTICLE:64,CYLINDER:128,TRIMESH:256}},{"../material/Material":25,"../math/Quaternion":28,"../math/Vec3":30,"./Shape":43}],44:[function(t,n,s){n.exports=a;var r=t("./Shape"),o=t("../math/Vec3");function a(l){if(r.call(this),this.radius=l!==void 0?Number(l):1,this.type=r.types.SPHERE,this.radius<0)throw new Error("The sphere radius cannot be negative.");this.updateBoundingSphereRadius()}a.prototype=new r,a.prototype.constructor=a,a.prototype.calculateLocalInertia=function(l,c){c=c||new o;var h=2*l*this.radius*this.radius/5;return c.x=h,c.y=h,c.z=h,c},a.prototype.volume=function(){return 4*Math.PI*this.radius/3},a.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=this.radius},a.prototype.calculateWorldAABB=function(l,c,h,u){for(var d=this.radius,f=["x","y","z"],p=0;p<f.length;p++){var A=f[p];h[A]=l[A]-d,u[A]=l[A]+d}}},{"../math/Vec3":30,"./Shape":43}],45:[function(t,n,s){n.exports=h;var r=t("./Shape"),o=t("../math/Vec3");t("../math/Quaternion");var a=t("../math/Transform"),l=t("../collision/AABB"),c=t("../utils/Octree");function h(I,x){r.call(this),this.type=r.types.TRIMESH,this.vertices=new Float32Array(I),this.indices=new Int16Array(x),this.normals=new Float32Array(x.length),this.aabb=new l,this.edges=null,this.scale=new o(1,1,1),this.tree=new c,this.updateEdges(),this.updateNormals(),this.updateAABB(),this.updateBoundingSphereRadius(),this.updateTree()}h.prototype=new r,h.prototype.constructor=h;var u=new o;h.prototype.updateTree=function(){var I=this.tree;I.reset(),I.aabb.copy(this.aabb);var x=this.scale;I.aabb.lowerBound.x*=1/x.x,I.aabb.lowerBound.y*=1/x.y,I.aabb.lowerBound.z*=1/x.z,I.aabb.upperBound.x*=1/x.x,I.aabb.upperBound.y*=1/x.y,I.aabb.upperBound.z*=1/x.z;for(var w=new l,P=new o,z=new o,H=new o,K=[P,z,H],le=0;le<this.indices.length/3;le++){var J=le*3;this._getUnscaledVertex(this.indices[J],P),this._getUnscaledVertex(this.indices[J+1],z),this._getUnscaledVertex(this.indices[J+2],H),w.setFromPoints(K),I.insert(w,le)}I.removeEmptyNodes()};var d=new l;h.prototype.getTrianglesInAABB=function(I,x){d.copy(I);var w=this.scale,P=w.x,z=w.y,H=w.z,K=d.lowerBound,le=d.upperBound;return K.x/=P,K.y/=z,K.z/=H,le.x/=P,le.y/=z,le.z/=H,this.tree.aabbQuery(d,x)},h.prototype.setScale=function(I){var x=this.scale.x===this.scale.y===this.scale.z,w=I.x===I.y===I.z;x&&w||this.updateNormals(),this.scale.copy(I),this.updateAABB(),this.updateBoundingSphereRadius()},h.prototype.updateNormals=function(){for(var I=u,x=this.normals,w=0;w<this.indices.length/3;w++){var P=w*3,z=this.indices[P],H=this.indices[P+1],K=this.indices[P+2];this.getVertex(z,g),this.getVertex(H,y),this.getVertex(K,_),h.computeNormal(y,g,_,I),x[P]=I.x,x[P+1]=I.y,x[P+2]=I.z}},h.prototype.updateEdges=function(){for(var I={},x=function(J,W){var O=z<H?z+"_"+H:H+"_"+z;I[O]=!0},w=0;w<this.indices.length/3;w++){var P=w*3,z=this.indices[P],H=this.indices[P+1];this.indices[P+2],x(),x(),x()}var K=Object.keys(I);this.edges=new Int16Array(K.length*2);for(var w=0;w<K.length;w++){var le=K[w].split("_");this.edges[2*w]=parseInt(le[0],10),this.edges[2*w+1]=parseInt(le[1],10)}},h.prototype.getEdgeVertex=function(I,x,w){var P=this.edges[I*2+(x?1:0)];this.getVertex(P,w)};var f=new o,p=new o;h.prototype.getEdgeVector=function(I,x){var w=f,P=p;this.getEdgeVertex(I,0,w),this.getEdgeVertex(I,1,P),P.vsub(w,x)};var A=new o,m=new o;h.computeNormal=function(I,x,w,P){x.vsub(I,m),w.vsub(x,A),A.cross(m,P),P.isZero()||P.normalize()};var g=new o,y=new o,_=new o;h.prototype.getVertex=function(I,x){var w=this.scale;return this._getUnscaledVertex(I,x),x.x*=w.x,x.y*=w.y,x.z*=w.z,x},h.prototype._getUnscaledVertex=function(I,x){var w=I*3,P=this.vertices;return x.set(P[w],P[w+1],P[w+2])},h.prototype.getWorldVertex=function(I,x,w,P){return this.getVertex(I,P),a.pointToWorldFrame(x,w,P,P),P},h.prototype.getTriangleVertices=function(I,x,w,P){var z=I*3;this.getVertex(this.indices[z],x),this.getVertex(this.indices[z+1],w),this.getVertex(this.indices[z+2],P)},h.prototype.getNormal=function(I,x){var w=I*3;return x.set(this.normals[w],this.normals[w+1],this.normals[w+2])};var v=new l;h.prototype.calculateLocalInertia=function(I,x){this.computeLocalAABB(v);var w=v.upperBound.x-v.lowerBound.x,P=v.upperBound.y-v.lowerBound.y,z=v.upperBound.z-v.lowerBound.z;return x.set(1/12*I*(2*P*2*P+2*z*2*z),1/12*I*(2*w*2*w+2*z*2*z),1/12*I*(2*P*2*P+2*w*2*w))};var b=new o;h.prototype.computeLocalAABB=function(I){var x=I.lowerBound,w=I.upperBound,P=this.vertices.length;this.vertices;var z=b;this.getVertex(0,z),x.copy(z),w.copy(z);for(var H=0;H!==P;H++)this.getVertex(H,z),z.x<x.x?x.x=z.x:z.x>w.x&&(w.x=z.x),z.y<x.y?x.y=z.y:z.y>w.y&&(w.y=z.y),z.z<x.z?x.z=z.z:z.z>w.z&&(w.z=z.z)},h.prototype.updateAABB=function(){this.computeLocalAABB(this.aabb)},h.prototype.updateBoundingSphereRadius=function(){for(var I=0,x=this.vertices,w=new o,P=0,z=x.length/3;P!==z;P++){this.getVertex(P,w);var H=w.norm2();H>I&&(I=H)}this.boundingSphereRadius=Math.sqrt(I)},new o;var T=new a,L=new l;h.prototype.calculateWorldAABB=function(I,x,w,P){var z=T,H=L;z.position=I,z.quaternion=x,this.aabb.toWorldFrame(z,H),w.copy(H.lowerBound),P.copy(H.upperBound)},h.prototype.volume=function(){return 4*Math.PI*this.boundingSphereRadius/3},h.createTorus=function(I,x,w,P,z){I=I||1,x=x||.5,w=w||8,P=P||6,z=z||Math.PI*2;for(var H=[],K=[],le=0;le<=w;le++)for(var J=0;J<=P;J++){var W=J/P*z,O=le/w*Math.PI*2,fe=(I+x*Math.cos(O))*Math.cos(W),ue=(I+x*Math.cos(O))*Math.sin(W),ee=x*Math.sin(O);H.push(fe,ue,ee)}for(var le=1;le<=w;le++)for(var J=1;J<=P;J++){var de=(P+1)*le+J-1,ae=(P+1)*(le-1)+J-1,R=(P+1)*(le-1)+J,M=(P+1)*le+J;K.push(de,ae,M),K.push(ae,R,M)}return new h(H,K)}},{"../collision/AABB":3,"../math/Quaternion":28,"../math/Transform":29,"../math/Vec3":30,"../utils/Octree":50,"./Shape":43}],46:[function(t,n,s){n.exports=o,t("../math/Vec3"),t("../math/Quaternion");var r=t("./Solver");function o(){r.call(this),this.iterations=10,this.tolerance=1e-7}o.prototype=new r;var a=[],l=[],c=[];o.prototype.solve=function(h,u){var d=0,f=this.iterations,p=this.tolerance*this.tolerance,A=this.equations,m=A.length,g=u.bodies,y=g.length,_=h,v,b,T,L,I,x;if(m!==0)for(var w=0;w!==y;w++)g[w].updateSolveMassProperties();var P=l,z=c,H=a;P.length=m,z.length=m,H.length=m;for(var w=0;w!==m;w++){var K=A[w];H[w]=0,z[w]=K.computeB(_),P[w]=1/K.computeC()}if(m!==0){for(var w=0;w!==y;w++){var le=g[w],J=le.vlambda,W=le.wlambda;J.set(0,0,0),W&&W.set(0,0,0)}for(d=0;d!==f;d++){L=0;for(var O=0;O!==m;O++){var K=A[O];v=z[O],b=P[O],x=H[O],I=K.computeGWlambda(),T=b*(v-I-K.eps*x),x+T<K.minForce?T=K.minForce-x:x+T>K.maxForce&&(T=K.maxForce-x),H[O]+=T,L+=T>0?T:-T,K.addToWlambda(T)}if(L*L<p)break}for(var w=0;w!==y;w++){var le=g[w],fe=le.velocity,ue=le.angularVelocity;fe.vadd(le.vlambda,fe),ue&&ue.vadd(le.wlambda,ue)}}return d}},{"../math/Quaternion":28,"../math/Vec3":30,"./Solver":47}],47:[function(t,n,s){n.exports=r;function r(){this.equations=[]}r.prototype.solve=function(o,a){return 0},r.prototype.addEquation=function(o){o.enabled&&this.equations.push(o)},r.prototype.removeEquation=function(o){var a=this.equations,l=a.indexOf(o);l!==-1&&a.splice(l,1)},r.prototype.removeAllEquations=function(){this.equations.length=0}},{}],48:[function(t,n,s){n.exports=a,t("../math/Vec3"),t("../math/Quaternion");var r=t("./Solver"),o=t("../objects/Body");function a(g){for(r.call(this),this.iterations=10,this.tolerance=1e-7,this.subsolver=g,this.nodes=[],this.nodePool=[];this.nodePool.length<128;)this.nodePool.push(this.createNode())}a.prototype=new r;var l=[],c=[],h={bodies:[]},u=o.STATIC;function d(g){for(var y=g.length,_=0;_!==y;_++){var v=g[_];if(!v.visited&&!(v.body.type&u))return v}return!1}var f=[];function p(g,y,_,v){for(f.push(g),g.visited=!0,y(g,_,v);f.length;)for(var b=f.pop(),T;T=d(b.children);)T.visited=!0,y(T,_,v),f.push(T)}function A(g,y,_){y.push(g.body);for(var v=g.eqs.length,b=0;b!==v;b++){var T=g.eqs[b];_.indexOf(T)===-1&&_.push(T)}}a.prototype.createNode=function(){return{body:null,children:[],eqs:[],visited:!1}},a.prototype.solve=function(g,y){for(var _=l,v=this.nodePool,b=y.bodies,T=this.equations,L=T.length,I=b.length,x=this.subsolver;v.length<I;)v.push(this.createNode());_.length=I;for(var w=0;w<I;w++)_[w]=v[w];for(var w=0;w!==I;w++){var P=_[w];P.body=b[w],P.children.length=0,P.eqs.length=0,P.visited=!1}for(var z=0;z!==L;z++){var H=T[z],w=b.indexOf(H.bi),K=b.indexOf(H.bj),le=_[w],J=_[K];le.children.push(J),le.eqs.push(H),J.children.push(le),J.eqs.push(H)}var W,O=0,fe=c;x.tolerance=this.tolerance,x.iterations=this.iterations;for(var ue=h;W=d(_);){fe.length=0,ue.bodies.length=0,p(W,A,ue.bodies,fe);var ee=fe.length;fe=fe.sort(m);for(var w=0;w!==ee;w++)x.addEquation(fe[w]);x.solve(g,ue),x.removeAllEquations(),O++}return O};function m(g,y){return y.id-g.id}},{"../math/Quaternion":28,"../math/Vec3":30,"../objects/Body":31,"./Solver":47}],49:[function(t,n,s){var r=function(){};n.exports=r,r.prototype={constructor:r,addEventListener:function(o,a){this._listeners===void 0&&(this._listeners={});var l=this._listeners;return l[o]===void 0&&(l[o]=[]),l[o].indexOf(a)===-1&&l[o].push(a),this},hasEventListener:function(o,a){if(this._listeners===void 0)return!1;var l=this._listeners;return l[o]!==void 0&&l[o].indexOf(a)!==-1},removeEventListener:function(o,a){if(this._listeners===void 0)return this;var l=this._listeners;if(l[o]===void 0)return this;var c=l[o].indexOf(a);return c!==-1&&l[o].splice(c,1),this},dispatchEvent:function(o){if(this._listeners===void 0)return this;var a=this._listeners,l=a[o.type];if(l!==void 0){o.target=this;for(var c=0,h=l.length;c<h;c++)l[c].call(this,o)}return this}}},{}],50:[function(t,n,s){var r=t("../collision/AABB"),o=t("../math/Vec3");n.exports=l;function a(u){u=u||{},this.root=u.root||null,this.aabb=u.aabb?u.aabb.clone():new r,this.data=[],this.children=[]}function l(u,d){d=d||{},d.root=null,d.aabb=u,a.call(this,d),this.maxDepth=typeof d.maxDepth<"u"?d.maxDepth:8}l.prototype=new a,a.prototype.reset=function(u,d){this.children.length=this.data.length=0},a.prototype.insert=function(u,d,f){var p=this.data;if(f=f||0,!this.aabb.contains(u))return!1;var A=this.children;if(f<(this.maxDepth||this.root.maxDepth)){var m=!1;A.length||(this.subdivide(),m=!0);for(var g=0;g!==8;g++)if(A[g].insert(u,d,f+1))return!0;m&&(A.length=0)}return p.push(d),!0};var c=new o;a.prototype.subdivide=function(){var u=this.aabb,d=u.lowerBound,f=u.upperBound,p=this.children;p.push(new a({aabb:new r({lowerBound:new o(0,0,0)})}),new a({aabb:new r({lowerBound:new o(1,0,0)})}),new a({aabb:new r({lowerBound:new o(1,1,0)})}),new a({aabb:new r({lowerBound:new o(1,1,1)})}),new a({aabb:new r({lowerBound:new o(0,1,1)})}),new a({aabb:new r({lowerBound:new o(0,0,1)})}),new a({aabb:new r({lowerBound:new o(1,0,1)})}),new a({aabb:new r({lowerBound:new o(0,1,0)})})),f.vsub(d,c),c.scale(.5,c);for(var A=this.root||this,m=0;m!==8;m++){var g=p[m];g.root=A;var y=g.aabb.lowerBound;y.x*=c.x,y.y*=c.y,y.z*=c.z,y.vadd(d,y),y.vadd(c,g.aabb.upperBound)}},a.prototype.aabbQuery=function(u,d){this.data,this.children;for(var f=[this];f.length;){var p=f.pop();p.aabb.overlaps(u)&&Array.prototype.push.apply(d,p.data),Array.prototype.push.apply(f,p.children)}return d};var h=new r;a.prototype.rayQuery=function(u,d,f){return u.getAABB(h),h.toLocalFrame(d,h),this.aabbQuery(h,f),f},a.prototype.removeEmptyNodes=function(){for(var u=[this];u.length;){for(var d=u.pop(),f=d.children.length-1;f>=0;f--)d.children[f].data.length||d.children.splice(f,1);Array.prototype.push.apply(u,d.children)}}},{"../collision/AABB":3,"../math/Vec3":30}],51:[function(t,n,s){n.exports=r;function r(){this.objects=[],this.type=Object}r.prototype.release=function(){for(var o=arguments.length,a=0;a!==o;a++)this.objects.push(arguments[a])},r.prototype.get=function(){return this.objects.length===0?this.constructObject():this.objects.pop()},r.prototype.constructObject=function(){throw new Error("constructObject() not implemented in this Pool subclass yet!")}},{}],52:[function(t,n,s){n.exports=r;function r(){this.data={keys:[]}}r.prototype.get=function(o,a){if(o>a){var l=a;a=o,o=l}return this.data[o+"-"+a]},r.prototype.set=function(o,a,l){if(o>a){var c=a;a=o,o=c}var h=o+"-"+a;this.get(o,a)||this.data.keys.push(h),this.data[h]=l},r.prototype.reset=function(){for(var o=this.data,a=o.keys;a.length>0;){var l=a.pop();delete o[l]}}},{}],53:[function(t,n,s){function r(){}n.exports=r,r.defaults=function(o,a){o=o||{};for(var l in a)l in o||(o[l]=a[l]);return o}},{}],54:[function(t,n,s){n.exports=a;var r=t("../math/Vec3"),o=t("./Pool");function a(){o.call(this),this.type=r}a.prototype=new o,a.prototype.constructObject=function(){return new r}},{"../math/Vec3":30,"./Pool":51}],55:[function(t,n,s){n.exports=p;var r=t("../collision/AABB"),o=t("../shapes/Shape"),a=t("../collision/Ray"),l=t("../math/Vec3"),c=t("../math/Transform");t("../shapes/ConvexPolyhedron");var h=t("../math/Quaternion");t("../solver/Solver");var u=t("../utils/Vec3Pool"),d=t("../equations/ContactEquation"),f=t("../equations/FrictionEquation");function p(Se){this.contactPointPool=[],this.frictionEquationPool=[],this.result=[],this.frictionResult=[],this.v3pool=new u,this.world=Se,this.currentContactMaterial=null,this.enableFrictionReduction=!1}p.prototype.createContactEquation=function(Se,Be,Oe,Ue,mt,Je){var Ge;this.contactPointPool.length?(Ge=this.contactPointPool.pop(),Ge.bi=Se,Ge.bj=Be):Ge=new d(Se,Be),Ge.enabled=Se.collisionResponse&&Be.collisionResponse&&Oe.collisionResponse&&Ue.collisionResponse;var $e=this.currentContactMaterial;Ge.restitution=$e.restitution,Ge.setSpookParams($e.contactEquationStiffness,$e.contactEquationRelaxation,this.world.dt);var we=Oe.material||Se.material,He=Ue.material||Be.material;return we&&He&&we.restitution>=0&&He.restitution>=0&&(Ge.restitution=we.restitution*He.restitution),Ge.si=mt||Oe,Ge.sj=Je||Ue,Ge},p.prototype.createFrictionEquationsFromContact=function(Se,Be){var Oe=Se.bi,Ue=Se.bj,mt=Se.si,Je=Se.sj,Ge=this.world,$e=this.currentContactMaterial,we=$e.friction,He=mt.material||Oe.material,Ye=Je.material||Ue.material;if(He&&Ye&&He.friction>=0&&Ye.friction>=0&&(we=He.friction*Ye.friction),we>0){var ot=we*Ge.gravity.length(),Xe=Oe.invMass+Ue.invMass;Xe>0&&(Xe=1/Xe);var ze=this.frictionEquationPool,We=ze.length?ze.pop():new f(Oe,Ue,ot*Xe),ut=ze.length?ze.pop():new f(Oe,Ue,ot*Xe);return We.bi=ut.bi=Oe,We.bj=ut.bj=Ue,We.minForce=ut.minForce=-ot*Xe,We.maxForce=ut.maxForce=ot*Xe,We.ri.copy(Se.ri),We.rj.copy(Se.rj),ut.ri.copy(Se.ri),ut.rj.copy(Se.rj),Se.ni.tangents(We.t,ut.t),We.setSpookParams($e.frictionEquationStiffness,$e.frictionEquationRelaxation,Ge.dt),ut.setSpookParams($e.frictionEquationStiffness,$e.frictionEquationRelaxation,Ge.dt),We.enabled=ut.enabled=Se.enabled,Be.push(We,ut),!0}return!1};var A=new l,m=new l,g=new l;p.prototype.createFrictionFromAverage=function(Se){var Be=this.result[this.result.length-1];if(!(!this.createFrictionEquationsFromContact(Be,this.frictionResult)||Se===1)){var Oe=this.frictionResult[this.frictionResult.length-2],Ue=this.frictionResult[this.frictionResult.length-1];A.setZero(),m.setZero(),g.setZero();var mt=Be.bi;Be.bj;for(var Je=0;Je!==Se;Je++)Be=this.result[this.result.length-1-Je],Be.bodyA!==mt?(A.vadd(Be.ni,A),m.vadd(Be.ri,m),g.vadd(Be.rj,g)):(A.vsub(Be.ni,A),m.vadd(Be.rj,m),g.vadd(Be.ri,g));var Ge=1/Se;m.scale(Ge,Oe.ri),g.scale(Ge,Oe.rj),Ue.ri.copy(Oe.ri),Ue.rj.copy(Oe.rj),A.normalize(),A.tangents(Oe.t,Ue.t)}};var y=new l,_=new l,v=new h,b=new h;p.prototype.getContacts=function(Se,Be,Oe,Ue,mt,Je,Ge){this.contactPointPool=mt,this.frictionEquationPool=Ge,this.result=Ue,this.frictionResult=Je;for(var $e=v,we=b,He=y,Ye=_,ot=0,Xe=Se.length;ot!==Xe;ot++){var ze=Se[ot],We=Be[ot],ut=null;ze.material&&We.material&&(ut=Oe.getContactMaterial(ze.material,We.material)||null);for(var C=0;C<ze.shapes.length;C++){ze.quaternion.mult(ze.shapeOrientations[C],$e),ze.quaternion.vmult(ze.shapeOffsets[C],He),He.vadd(ze.position,He);for(var U=ze.shapes[C],ne=0;ne<We.shapes.length;ne++){We.quaternion.mult(We.shapeOrientations[ne],we),We.quaternion.vmult(We.shapeOffsets[ne],Ye),Ye.vadd(We.position,Ye);var S=We.shapes[ne];if(!(He.distanceTo(Ye)>U.boundingSphereRadius+S.boundingSphereRadius)){var Y=null;U.material&&S.material&&(Y=Oe.getContactMaterial(U.material,S.material)||null),this.currentContactMaterial=Y||ut||Oe.defaultContactMaterial;var X=this[U.type|S.type];X&&(U.type<S.type?X.call(this,U,S,He,Ye,$e,we,ze,We,U,S):X.call(this,S,U,Ye,He,we,$e,We,ze,U,S))}}}}},p.prototype[o.types.BOX|o.types.BOX]=p.prototype.boxBox=function(Se,Be,Oe,Ue,mt,Je,Ge,$e){Se.convexPolyhedronRepresentation.material=Se.material,Be.convexPolyhedronRepresentation.material=Be.material,Se.convexPolyhedronRepresentation.collisionResponse=Se.collisionResponse,Be.convexPolyhedronRepresentation.collisionResponse=Be.collisionResponse,this.convexConvex(Se.convexPolyhedronRepresentation,Be.convexPolyhedronRepresentation,Oe,Ue,mt,Je,Ge,$e,Se,Be)},p.prototype[o.types.BOX|o.types.CONVEXPOLYHEDRON]=p.prototype.boxConvex=function(Se,Be,Oe,Ue,mt,Je,Ge,$e){Se.convexPolyhedronRepresentation.material=Se.material,Se.convexPolyhedronRepresentation.collisionResponse=Se.collisionResponse,this.convexConvex(Se.convexPolyhedronRepresentation,Be,Oe,Ue,mt,Je,Ge,$e,Se,Be)},p.prototype[o.types.BOX|o.types.PARTICLE]=p.prototype.boxParticle=function(Se,Be,Oe,Ue,mt,Je,Ge,$e){Se.convexPolyhedronRepresentation.material=Se.material,Se.convexPolyhedronRepresentation.collisionResponse=Se.collisionResponse,this.convexParticle(Se.convexPolyhedronRepresentation,Be,Oe,Ue,mt,Je,Ge,$e,Se,Be)},p.prototype[o.types.SPHERE]=p.prototype.sphereSphere=function(Se,Be,Oe,Ue,mt,Je,Ge,$e){var we=this.createContactEquation(Ge,$e,Se,Be);Ue.vsub(Oe,we.ni),we.ni.normalize(),we.ri.copy(we.ni),we.rj.copy(we.ni),we.ri.mult(Se.radius,we.ri),we.rj.mult(-Be.radius,we.rj),we.ri.vadd(Oe,we.ri),we.ri.vsub(Ge.position,we.ri),we.rj.vadd(Ue,we.rj),we.rj.vsub($e.position,we.rj),this.result.push(we),this.createFrictionEquationsFromContact(we,this.frictionResult)};var T=new l,L=new l,I=new l;p.prototype[o.types.PLANE|o.types.TRIMESH]=p.prototype.planeTrimesh=function(Se,Be,Oe,Ue,mt,Je,Ge,$e){var we=new l,He=T;He.set(0,0,1),mt.vmult(He,He);for(var Ye=0;Ye<Be.vertices.length/3;Ye++){Be.getVertex(Ye,we);var ot=new l;ot.copy(we),c.pointToWorldFrame(Ue,Je,ot,we);var Xe=L;we.vsub(Oe,Xe);var ze=He.dot(Xe);if(ze<=0){var We=this.createContactEquation(Ge,$e,Se,Be);We.ni.copy(He);var ut=I;He.scale(Xe.dot(He),ut),we.vsub(ut,ut),We.ri.copy(ut),We.ri.vsub(Ge.position,We.ri),We.rj.copy(we),We.rj.vsub($e.position,We.rj),this.result.push(We),this.createFrictionEquationsFromContact(We,this.frictionResult)}}};var x=new l,w=new l;new l;var P=new l,z=new l,H=new l,K=new l,le=new l,J=new l,W=new l,O=new l,fe=new l,ue=new l,ee=new l,de=new r,ae=[];p.prototype[o.types.SPHERE|o.types.TRIMESH]=p.prototype.sphereTrimesh=function(Se,Be,Oe,Ue,mt,Je,Ge,$e){var we=H,He=K,Ye=le,ot=J,Xe=W,ze=O,We=de,ut=z,C=w,U=ae;c.pointToLocalFrame(Ue,Je,Oe,Xe);var ne=Se.radius;We.lowerBound.set(Xe.x-ne,Xe.y-ne,Xe.z-ne),We.upperBound.set(Xe.x+ne,Xe.y+ne,Xe.z+ne),Be.getTrianglesInAABB(We,U);for(var S=P,Y=Se.radius*Se.radius,X=0;X<U.length;X++)for(var se=0;se<3;se++)if(Be.getVertex(Be.indices[U[X]*3+se],S),S.vsub(Xe,C),C.norm2()<=Y){ut.copy(S),c.pointToWorldFrame(Ue,Je,ut,S),S.vsub(Oe,C);var $=this.createContactEquation(Ge,$e,Se,Be);$.ni.copy(C),$.ni.normalize(),$.ri.copy($.ni),$.ri.scale(Se.radius,$.ri),$.ri.vadd(Oe,$.ri),$.ri.vsub(Ge.position,$.ri),$.rj.copy(S),$.rj.vsub($e.position,$.rj),this.result.push($),this.createFrictionEquationsFromContact($,this.frictionResult)}for(var X=0;X<U.length;X++)for(var se=0;se<3;se++){Be.getVertex(Be.indices[U[X]*3+se],we),Be.getVertex(Be.indices[U[X]*3+(se+1)%3],He),He.vsub(we,Ye),Xe.vsub(He,ze);var Ae=ze.dot(Ye);Xe.vsub(we,ze);var _e=ze.dot(Ye);if(_e>0&&Ae<0){Xe.vsub(we,ze),ot.copy(Ye),ot.normalize(),_e=ze.dot(ot),ot.scale(_e,ze),ze.vadd(we,ze);var ye=ze.distanceTo(Xe);if(ye<Se.radius){var $=this.createContactEquation(Ge,$e,Se,Be);ze.vsub(Xe,$.ni),$.ni.normalize(),$.ni.scale(Se.radius,$.ri),c.pointToWorldFrame(Ue,Je,ze,ze),ze.vsub($e.position,$.rj),c.vectorToWorldFrame(Je,$.ni,$.ni),c.vectorToWorldFrame(Je,$.ri,$.ri),this.result.push($),this.createFrictionEquationsFromContact($,this.frictionResult)}}}for(var Ee=fe,Re=ue,Ie=ee,Fe=x,X=0,De=U.length;X!==De;X++){Be.getTriangleVertices(U[X],Ee,Re,Ie),Be.getNormal(U[X],Fe),Xe.vsub(Ee,ze);var ye=ze.dot(Fe);if(Fe.scale(ye,ze),Xe.vsub(ze,ze),ye=ze.distanceTo(Xe),a.pointInTriangle(ze,Ee,Re,Ie)&&ye<Se.radius){var $=this.createContactEquation(Ge,$e,Se,Be);ze.vsub(Xe,$.ni),$.ni.normalize(),$.ni.scale(Se.radius,$.ri),c.pointToWorldFrame(Ue,Je,ze,ze),ze.vsub($e.position,$.rj),c.vectorToWorldFrame(Je,$.ni,$.ni),c.vectorToWorldFrame(Je,$.ri,$.ri),this.result.push($),this.createFrictionEquationsFromContact($,this.frictionResult)}}U.length=0};var R=new l,M=new l;p.prototype[o.types.SPHERE|o.types.PLANE]=p.prototype.spherePlane=function(Se,Be,Oe,Ue,mt,Je,Ge,$e){var we=this.createContactEquation(Ge,$e,Se,Be);if(we.ni.set(0,0,1),Je.vmult(we.ni,we.ni),we.ni.negate(we.ni),we.ni.normalize(),we.ni.mult(Se.radius,we.ri),Oe.vsub(Ue,R),we.ni.mult(we.ni.dot(R),M),R.vsub(M,we.rj),-R.dot(we.ni)<=Se.radius){var He=we.ri,Ye=we.rj;He.vadd(Oe,He),He.vsub(Ge.position,He),Ye.vadd(Ue,Ye),Ye.vsub($e.position,Ye),this.result.push(we),this.createFrictionEquationsFromContact(we,this.frictionResult)}};var B=new l,D=new l,te=new l;function ie(Se,Be,Oe){for(var Ue=null,mt=Se.length,Je=0;Je!==mt;Je++){var Ge=Se[Je],$e=B;Se[(Je+1)%mt].vsub(Ge,$e);var we=D;$e.cross(Be,we);var He=te;Oe.vsub(Ge,He);var Ye=we.dot(He);if(Ue===null||Ye>0&&Ue===!0||Ye<=0&&Ue===!1){Ue===null&&(Ue=Ye>0);continue}else return!1}return!0}var Z=new l,me=new l,F=new l,Q=new l,E=[new l,new l,new l,new l,new l,new l],j=new l,q=new l,ce=new l,G=new l;p.prototype[o.types.SPHERE|o.types.BOX]=p.prototype.sphereBox=function(Se,Be,Oe,Ue,mt,Je,Ge,$e){var we=this.v3pool,He=E;Oe.vsub(Ue,Z),Be.getSideNormals(He,Je);for(var Ye=Se.radius,ot=!1,Xe=q,ze=ce,We=G,ut=null,C=0,U=0,ne=0,S=null,Y=0,X=He.length;Y!==X&&ot===!1;Y++){var se=me;se.copy(He[Y]);var $=se.norm();se.normalize();var Ae=Z.dot(se);if(Ae<$+Ye&&Ae>0){var _e=F,ye=Q;_e.copy(He[(Y+1)%3]),ye.copy(He[(Y+2)%3]);var Ee=_e.norm(),Re=ye.norm();_e.normalize(),ye.normalize();var Ie=Z.dot(_e),Fe=Z.dot(ye);if(Ie<Ee&&Ie>-Ee&&Fe<Re&&Fe>-Re){var Lt=Math.abs(Ae-$-Ye);(S===null||Lt<S)&&(S=Lt,U=Ie,ne=Fe,ut=$,Xe.copy(se),ze.copy(_e),We.copy(ye),C++)}}}if(C){ot=!0;var ke=this.createContactEquation(Ge,$e,Se,Be);Xe.mult(-Ye,ke.ri),ke.ni.copy(Xe),ke.ni.negate(ke.ni),Xe.mult(ut,Xe),ze.mult(U,ze),Xe.vadd(ze,Xe),We.mult(ne,We),Xe.vadd(We,ke.rj),ke.ri.vadd(Oe,ke.ri),ke.ri.vsub(Ge.position,ke.ri),ke.rj.vadd(Ue,ke.rj),ke.rj.vsub($e.position,ke.rj),this.result.push(ke),this.createFrictionEquationsFromContact(ke,this.frictionResult)}for(var De=we.get(),Ve=j,tt=0;tt!==2&&!ot;tt++)for(var ht=0;ht!==2&&!ot;ht++)for(var rt=0;rt!==2&&!ot;rt++)if(De.set(0,0,0),tt?De.vadd(He[0],De):De.vsub(He[0],De),ht?De.vadd(He[1],De):De.vsub(He[1],De),rt?De.vadd(He[2],De):De.vsub(He[2],De),Ue.vadd(De,Ve),Ve.vsub(Oe,Ve),Ve.norm2()<Ye*Ye){ot=!0;var ke=this.createContactEquation(Ge,$e,Se,Be);ke.ri.copy(Ve),ke.ri.normalize(),ke.ni.copy(ke.ri),ke.ri.mult(Ye,ke.ri),ke.rj.copy(De),ke.ri.vadd(Oe,ke.ri),ke.ri.vsub(Ge.position,ke.ri),ke.rj.vadd(Ue,ke.rj),ke.rj.vsub($e.position,ke.rj),this.result.push(ke),this.createFrictionEquationsFromContact(ke,this.frictionResult)}we.release(De),De=null;for(var nt=we.get(),gt=we.get(),ke=we.get(),bt=we.get(),Lt=we.get(),Bt=He.length,tt=0;tt!==Bt&&!ot;tt++)for(var ht=0;ht!==Bt&&!ot;ht++)if(tt%3!==ht%3){He[ht].cross(He[tt],nt),nt.normalize(),He[tt].vadd(He[ht],gt),ke.copy(Oe),ke.vsub(gt,ke),ke.vsub(Ue,ke);var Et=ke.dot(nt);nt.mult(Et,bt);for(var rt=0;rt===tt%3||rt===ht%3;)rt++;Lt.copy(Oe),Lt.vsub(bt,Lt),Lt.vsub(gt,Lt),Lt.vsub(Ue,Lt);var vt=Math.abs(Et),pn=Lt.norm();if(vt<He[rt].norm()&&pn<Ye){ot=!0;var Ct=this.createContactEquation(Ge,$e,Se,Be);gt.vadd(bt,Ct.rj),Ct.rj.copy(Ct.rj),Lt.negate(Ct.ni),Ct.ni.normalize(),Ct.ri.copy(Ct.rj),Ct.ri.vadd(Ue,Ct.ri),Ct.ri.vsub(Oe,Ct.ri),Ct.ri.normalize(),Ct.ri.mult(Ye,Ct.ri),Ct.ri.vadd(Oe,Ct.ri),Ct.ri.vsub(Ge.position,Ct.ri),Ct.rj.vadd(Ue,Ct.rj),Ct.rj.vsub($e.position,Ct.rj),this.result.push(Ct),this.createFrictionEquationsFromContact(Ct,this.frictionResult)}}we.release(nt,gt,ke,bt,Lt)};var V=new l,re=new l,k=new l,N=new l,oe=new l,pe=new l,ve=new l,xe=new l,Pe=new l,Te=new l;p.prototype[o.types.SPHERE|o.types.CONVEXPOLYHEDRON]=p.prototype.sphereConvex=function(Se,Be,Oe,Ue,mt,Je,Ge,$e){var we=this.v3pool;Oe.vsub(Ue,V);for(var He=Be.faceNormals,Ye=Be.faces,ot=Be.vertices,Xe=Se.radius,ze=0;ze!==ot.length;ze++){var We=ot[ze],ut=oe;Je.vmult(We,ut),Ue.vadd(ut,ut);var C=N;if(ut.vsub(Oe,C),C.norm2()<Xe*Xe){ne=!0;var U=this.createContactEquation(Ge,$e,Se,Be);U.ri.copy(C),U.ri.normalize(),U.ni.copy(U.ri),U.ri.mult(Xe,U.ri),ut.vsub(Ue,U.rj),U.ri.vadd(Oe,U.ri),U.ri.vsub(Ge.position,U.ri),U.rj.vadd(Ue,U.rj),U.rj.vsub($e.position,U.rj),this.result.push(U),this.createFrictionEquationsFromContact(U,this.frictionResult);return}}for(var ne=!1,ze=0,S=Ye.length;ze!==S&&ne===!1;ze++){var Y=He[ze],X=Ye[ze],se=pe;Je.vmult(Y,se);var $=ve;Je.vmult(ot[X[0]],$),$.vadd(Ue,$);var Ae=xe;se.mult(-Xe,Ae),Oe.vadd(Ae,Ae);var _e=Pe;Ae.vsub($,_e);var ye=_e.dot(se),Ee=Te;if(Oe.vsub($,Ee),ye<0&&Ee.dot(se)>0){for(var Re=[],Ie=0,Fe=X.length;Ie!==Fe;Ie++){var De=we.get();Je.vmult(ot[X[Ie]],De),Ue.vadd(De,De),Re.push(De)}if(ie(Re,se,Oe)){ne=!0;var U=this.createContactEquation(Ge,$e,Se,Be);se.mult(-Xe,U.ri),se.negate(U.ni);var Ve=we.get();se.mult(-ye,Ve);var tt=we.get();se.mult(-Xe,tt),Oe.vsub(Ue,U.rj),U.rj.vadd(tt,U.rj),U.rj.vadd(Ve,U.rj),U.rj.vadd(Ue,U.rj),U.rj.vsub($e.position,U.rj),U.ri.vadd(Oe,U.ri),U.ri.vsub(Ge.position,U.ri),we.release(Ve),we.release(tt),this.result.push(U),this.createFrictionEquationsFromContact(U,this.frictionResult);for(var Ie=0,ht=Re.length;Ie!==ht;Ie++)we.release(Re[Ie]);return}else for(var Ie=0;Ie!==X.length;Ie++){var rt=we.get(),nt=we.get();Je.vmult(ot[X[(Ie+1)%X.length]],rt),Je.vmult(ot[X[(Ie+2)%X.length]],nt),Ue.vadd(rt,rt),Ue.vadd(nt,nt);var gt=re;nt.vsub(rt,gt);var ke=k;gt.unit(ke);var bt=we.get(),Lt=we.get();Oe.vsub(rt,Lt);var Bt=Lt.dot(ke);ke.mult(Bt,bt),bt.vadd(rt,bt);var Et=we.get();if(bt.vsub(Oe,Et),Bt>0&&Bt*Bt<gt.norm2()&&Et.norm2()<Xe*Xe){var U=this.createContactEquation(Ge,$e,Se,Be);bt.vsub(Ue,U.rj),bt.vsub(Oe,U.ni),U.ni.normalize(),U.ni.mult(Xe,U.ri),U.rj.vadd(Ue,U.rj),U.rj.vsub($e.position,U.rj),U.ri.vadd(Oe,U.ri),U.ri.vsub(Ge.position,U.ri),this.result.push(U),this.createFrictionEquationsFromContact(U,this.frictionResult);for(var Ie=0,ht=Re.length;Ie!==ht;Ie++)we.release(Re[Ie]);we.release(rt),we.release(nt),we.release(bt),we.release(Et),we.release(Lt);return}we.release(rt),we.release(nt),we.release(bt),we.release(Et),we.release(Lt)}for(var Ie=0,ht=Re.length;Ie!==ht;Ie++)we.release(Re[Ie])}}},new l,new l,p.prototype[o.types.PLANE|o.types.BOX]=p.prototype.planeBox=function(Se,Be,Oe,Ue,mt,Je,Ge,$e){Be.convexPolyhedronRepresentation.material=Be.material,Be.convexPolyhedronRepresentation.collisionResponse=Be.collisionResponse,this.planeConvex(Se,Be.convexPolyhedronRepresentation,Oe,Ue,mt,Je,Ge,$e)};var Qe=new l,lt=new l,Ne=new l,qe=new l;p.prototype[o.types.PLANE|o.types.CONVEXPOLYHEDRON]=p.prototype.planeConvex=function(Se,Be,Oe,Ue,mt,Je,Ge,$e){var we=Qe,He=lt;He.set(0,0,1),mt.vmult(He,He);for(var Ye=0,ot=Ne,Xe=0;Xe!==Be.vertices.length;Xe++){we.copy(Be.vertices[Xe]),Je.vmult(we,we),Ue.vadd(we,we),we.vsub(Oe,ot);var ze=He.dot(ot);if(ze<=0){var We=this.createContactEquation(Ge,$e,Se,Be),ut=qe;He.mult(He.dot(ot),ut),we.vsub(ut,ut),ut.vsub(Oe,We.ri),We.ni.copy(He),we.vsub(Ue,We.rj),We.ri.vadd(Oe,We.ri),We.ri.vsub(Ge.position,We.ri),We.rj.vadd(Ue,We.rj),We.rj.vsub($e.position,We.rj),this.result.push(We),Ye++,this.enableFrictionReduction||this.createFrictionEquationsFromContact(We,this.frictionResult)}}this.enableFrictionReduction&&Ye&&this.createFrictionFromAverage(Ye)};var Ke=new l,it=new l;p.prototype[o.types.CONVEXPOLYHEDRON]=p.prototype.convexConvex=function(Se,Be,Oe,Ue,mt,Je,Ge,$e,we,He,Ye,ot){var Xe=Ke;if(!(Oe.distanceTo(Ue)>Se.boundingSphereRadius+Be.boundingSphereRadius)&&Se.findSeparatingAxis(Be,Oe,mt,Ue,Je,Xe,Ye,ot)){var ze=[],We=it;Se.clipAgainstHull(Oe,mt,Be,Ue,Je,Xe,-100,100,ze);for(var ut=0,C=0;C!==ze.length;C++){var U=this.createContactEquation(Ge,$e,Se,Be,we,He),ne=U.ri,S=U.rj;Xe.negate(U.ni),ze[C].normal.negate(We),We.mult(ze[C].depth,We),ze[C].point.vadd(We,ne),S.copy(ze[C].point),ne.vsub(Oe,ne),S.vsub(Ue,S),ne.vadd(Oe,ne),ne.vsub(Ge.position,ne),S.vadd(Ue,S),S.vsub($e.position,S),this.result.push(U),ut++,this.enableFrictionReduction||this.createFrictionEquationsFromContact(U,this.frictionResult)}this.enableFrictionReduction&&ut&&this.createFrictionFromAverage(ut)}};var je=new l,dt=new l,ct=new l;p.prototype[o.types.PLANE|o.types.PARTICLE]=p.prototype.planeParticle=function(Se,Be,Oe,Ue,mt,Je,Ge,$e){var we=je;we.set(0,0,1),Ge.quaternion.vmult(we,we);var He=dt;Ue.vsub(Ge.position,He);var Ye=we.dot(He);if(Ye<=0){var ot=this.createContactEquation($e,Ge,Be,Se);ot.ni.copy(we),ot.ni.negate(ot.ni),ot.ri.set(0,0,0);var Xe=ct;we.mult(we.dot(Ue),Xe),Ue.vsub(Xe,Xe),ot.rj.copy(Xe),this.result.push(ot),this.createFrictionEquationsFromContact(ot,this.frictionResult)}};var At=new l;p.prototype[o.types.PARTICLE|o.types.SPHERE]=p.prototype.sphereParticle=function(Se,Be,Oe,Ue,mt,Je,Ge,$e){var we=At;we.set(0,0,1),Ue.vsub(Oe,we);var He=we.norm2();if(He<=Se.radius*Se.radius){var Ye=this.createContactEquation($e,Ge,Be,Se);we.normalize(),Ye.rj.copy(we),Ye.rj.mult(Se.radius,Ye.rj),Ye.ni.copy(we),Ye.ni.negate(Ye.ni),Ye.ri.set(0,0,0),this.result.push(Ye),this.createFrictionEquationsFromContact(Ye,this.frictionResult)}};var ge=new h,be=new l;new l;var Ce=new l,Le=new l,et=new l;p.prototype[o.types.PARTICLE|o.types.CONVEXPOLYHEDRON]=p.prototype.convexParticle=function(Se,Be,Oe,Ue,mt,Je,Ge,$e){var we=-1,He=Ce,Ye=et,ot=null,Xe=be;if(Xe.copy(Ue),Xe.vsub(Oe,Xe),mt.conjugate(ge),ge.vmult(Xe,Xe),Se.pointIsInside(Xe)){Se.worldVerticesNeedsUpdate&&Se.computeWorldVertices(Oe,mt),Se.worldFaceNormalsNeedsUpdate&&Se.computeWorldFaceNormals(mt);for(var ze=0,We=Se.faces.length;ze!==We;ze++){var ut=[Se.worldVertices[Se.faces[ze][0]]],C=Se.worldFaceNormals[ze];Ue.vsub(ut[0],Le);var U=-C.dot(Le);(ot===null||Math.abs(U)<Math.abs(ot))&&(ot=U,we=ze,He.copy(C))}if(we!==-1){var ne=this.createContactEquation($e,Ge,Be,Se);He.mult(ot,Ye),Ye.vadd(Ue,Ye),Ye.vsub(Oe,Ye),ne.rj.copy(Ye),He.negate(ne.ni),ne.ri.set(0,0,0);var S=ne.ri,Y=ne.rj;S.vadd(Ue,S),S.vsub($e.position,S),Y.vadd(Oe,Y),Y.vsub(Ge.position,Y),this.result.push(ne),this.createFrictionEquationsFromContact(ne,this.frictionResult)}else console.warn("Point found inside convex, but did not find penetrating face!")}},p.prototype[o.types.BOX|o.types.HEIGHTFIELD]=p.prototype.boxHeightfield=function(Se,Be,Oe,Ue,mt,Je,Ge,$e){Se.convexPolyhedronRepresentation.material=Se.material,Se.convexPolyhedronRepresentation.collisionResponse=Se.collisionResponse,this.convexHeightfield(Se.convexPolyhedronRepresentation,Be,Oe,Ue,mt,Je,Ge,$e)};var Ze=new l,_t=new l,Ht=[0];p.prototype[o.types.CONVEXPOLYHEDRON|o.types.HEIGHTFIELD]=p.prototype.convexHeightfield=function(Se,Be,Oe,Ue,mt,Je,Ge,$e){var we=Be.data,He=Be.elementSize,Ye=Se.boundingSphereRadius,ot=_t,Xe=Ht,ze=Ze;c.pointToLocalFrame(Ue,Je,Oe,ze);var We=Math.floor((ze.x-Ye)/He)-1,ut=Math.ceil((ze.x+Ye)/He)+1,C=Math.floor((ze.y-Ye)/He)-1,U=Math.ceil((ze.y+Ye)/He)+1;if(!(ut<0||U<0||We>we.length||C>we[0].length)){We<0&&(We=0),ut<0&&(ut=0),C<0&&(C=0),U<0&&(U=0),We>=we.length&&(We=we.length-1),ut>=we.length&&(ut=we.length-1),U>=we[0].length&&(U=we[0].length-1),C>=we[0].length&&(C=we[0].length-1);var ne=[];Be.getRectMinMax(We,C,ut,U,ne);var S=ne[0],Y=ne[1];if(!(ze.z-Ye>Y||ze.z+Ye<S))for(var X=We;X<ut;X++)for(var se=C;se<U;se++)Be.getConvexTrianglePillar(X,se,!1),c.pointToWorldFrame(Ue,Je,Be.pillarOffset,ot),Oe.distanceTo(ot)<Be.pillarConvex.boundingSphereRadius+Se.boundingSphereRadius&&this.convexConvex(Se,Be.pillarConvex,Oe,ot,mt,Je,Ge,$e,null,null,Xe,null),Be.getConvexTrianglePillar(X,se,!0),c.pointToWorldFrame(Ue,Je,Be.pillarOffset,ot),Oe.distanceTo(ot)<Be.pillarConvex.boundingSphereRadius+Se.boundingSphereRadius&&this.convexConvex(Se,Be.pillarConvex,Oe,ot,mt,Je,Ge,$e,null,null,Xe,null)}};var dn=new l,yt=new l;p.prototype[o.types.SPHERE|o.types.HEIGHTFIELD]=p.prototype.sphereHeightfield=function(Se,Be,Oe,Ue,mt,Je,Ge,$e){var we=Be.data,He=Se.radius,Ye=Be.elementSize,ot=yt,Xe=dn;c.pointToLocalFrame(Ue,Je,Oe,Xe);var ze=Math.floor((Xe.x-He)/Ye)-1,We=Math.ceil((Xe.x+He)/Ye)+1,ut=Math.floor((Xe.y-He)/Ye)-1,C=Math.ceil((Xe.y+He)/Ye)+1;if(!(We<0||C<0||ze>we.length||C>we[0].length)){ze<0&&(ze=0),We<0&&(We=0),ut<0&&(ut=0),C<0&&(C=0),ze>=we.length&&(ze=we.length-1),We>=we.length&&(We=we.length-1),C>=we[0].length&&(C=we[0].length-1),ut>=we[0].length&&(ut=we[0].length-1);var U=[];Be.getRectMinMax(ze,ut,We,C,U);var ne=U[0],S=U[1];if(!(Xe.z-He>S||Xe.z+He<ne))for(var Y=this.result,X=ze;X<We;X++)for(var se=ut;se<C;se++){var $=Y.length;Be.getConvexTrianglePillar(X,se,!1),c.pointToWorldFrame(Ue,Je,Be.pillarOffset,ot),Oe.distanceTo(ot)<Be.pillarConvex.boundingSphereRadius+Se.boundingSphereRadius&&this.sphereConvex(Se,Be.pillarConvex,Oe,ot,mt,Je,Ge,$e),Be.getConvexTrianglePillar(X,se,!0),c.pointToWorldFrame(Ue,Je,Be.pillarOffset,ot),Oe.distanceTo(ot)<Be.pillarConvex.boundingSphereRadius+Se.boundingSphereRadius&&this.sphereConvex(Se,Be.pillarConvex,Oe,ot,mt,Je,Ge,$e);var Ae=Y.length-$;if(Ae>2)return}}}},{"../collision/AABB":3,"../collision/Ray":9,"../equations/ContactEquation":19,"../equations/FrictionEquation":21,"../math/Quaternion":28,"../math/Transform":29,"../math/Vec3":30,"../shapes/ConvexPolyhedron":38,"../shapes/Shape":43,"../solver/Solver":47,"../utils/Vec3Pool":54}],56:[function(t,n,s){n.exports=v;var r=t("../shapes/Shape"),o=t("../math/Vec3"),a=t("../math/Quaternion"),l=t("../solver/GSSolver");t("../utils/Vec3Pool"),t("../equations/ContactEquation"),t("../equations/FrictionEquation");var c=t("./Narrowphase"),h=t("../utils/EventTarget"),u=t("../collision/ArrayCollisionMatrix"),d=t("../material/Material"),f=t("../material/ContactMaterial"),p=t("../objects/Body"),A=t("../utils/TupleDictionary"),m=t("../collision/RaycastResult"),g=t("../collision/AABB"),y=t("../collision/Ray"),_=t("../collision/NaiveBroadphase");function v(){h.apply(this),this.dt=-1,this.allowSleep=!1,this.contacts=[],this.frictionEquations=[],this.quatNormalizeSkip=0,this.quatNormalizeFast=!1,this.time=0,this.stepnumber=0,this.default_dt=1/60,this.nextId=0,this.gravity=new o,this.broadphase=new _,this.bodies=[],this.solver=new l,this.constraints=[],this.narrowphase=new c(this),this.collisionMatrix=new u,this.collisionMatrixPrevious=new u,this.materials=[],this.contactmaterials=[],this.contactMaterialTable=new A,this.defaultMaterial=new d("default"),this.defaultContactMaterial=new f(this.defaultMaterial,this.defaultMaterial,{friction:.3,restitution:0}),this.doProfiling=!1,this.profile={solve:0,makeContactConstraints:0,broadphase:0,integrate:0,narrowphase:0},this.subsystems=[],this.addBodyEvent={type:"addBody",body:null},this.removeBodyEvent={type:"removeBody",body:null}}v.prototype=new h,new g;var b=new y;if(v.prototype.getContactMaterial=function(O,fe){return this.contactMaterialTable.get(O.id,fe.id)},v.prototype.numObjects=function(){return this.bodies.length},v.prototype.collisionMatrixTick=function(){var O=this.collisionMatrixPrevious;this.collisionMatrixPrevious=this.collisionMatrix,this.collisionMatrix=O,this.collisionMatrix.reset()},v.prototype.add=v.prototype.addBody=function(O){this.bodies.indexOf(O)===-1&&(O.index=this.bodies.length,this.bodies.push(O),O.world=this,O.initPosition.copy(O.position),O.initVelocity.copy(O.velocity),O.timeLastSleepy=this.time,O instanceof p&&(O.initAngularVelocity.copy(O.angularVelocity),O.initQuaternion.copy(O.quaternion)),this.collisionMatrix.setNumObjects(this.bodies.length),this.addBodyEvent.body=O,this.dispatchEvent(this.addBodyEvent))},v.prototype.addConstraint=function(O){this.constraints.push(O)},v.prototype.removeConstraint=function(O){var fe=this.constraints.indexOf(O);fe!==-1&&this.constraints.splice(fe,1)},v.prototype.rayTest=function(O,fe,ue){ue instanceof m?this.raycastClosest(O,fe,{skipBackfaces:!0},ue):this.raycastAll(O,fe,{skipBackfaces:!0},ue)},v.prototype.raycastAll=function(O,fe,ue,ee){return ue.mode=y.ALL,ue.from=O,ue.to=fe,ue.callback=ee,b.intersectWorld(this,ue)},v.prototype.raycastAny=function(O,fe,ue,ee){return ue.mode=y.ANY,ue.from=O,ue.to=fe,ue.result=ee,b.intersectWorld(this,ue)},v.prototype.raycastClosest=function(O,fe,ue,ee){return ue.mode=y.CLOSEST,ue.from=O,ue.to=fe,ue.result=ee,b.intersectWorld(this,ue)},v.prototype.remove=function(O){O.world=null;var fe=this.bodies.length-1,ue=this.bodies,ee=ue.indexOf(O);if(ee!==-1){ue.splice(ee,1);for(var de=0;de!==ue.length;de++)ue[de].index=de;this.collisionMatrix.setNumObjects(fe),this.removeBodyEvent.body=O,this.dispatchEvent(this.removeBodyEvent)}},v.prototype.removeBody=v.prototype.remove,v.prototype.addMaterial=function(O){this.materials.push(O)},v.prototype.addContactMaterial=function(O){this.contactmaterials.push(O),this.contactMaterialTable.set(O.materials[0].id,O.materials[1].id,O)},typeof performance>"u"&&(performance={}),!performance.now){var T=Date.now();performance.timing&&performance.timing.navigationStart&&(T=performance.timing.navigationStart),performance.now=function(){return Date.now()-T}}var L=new o;v.prototype.step=function(O,fe,ue){if(ue=ue||10,fe=fe||0,fe===0)this.internalStep(O),this.time+=O;else{var ee=Math.floor((this.time+fe)/O)-Math.floor(this.time/O);ee=Math.min(ee,ue);for(var de=performance.now(),ae=0;ae!==ee&&(this.internalStep(O),!(performance.now()-de>O*1e3));ae++);this.time+=fe;for(var R=this.time%O,M=R/O,B=L,D=this.bodies,te=0;te!==D.length;te++){var ie=D[te];ie.type!==p.STATIC&&ie.sleepState!==p.SLEEPING?(ie.position.vsub(ie.previousPosition,B),B.scale(M,B),ie.position.vadd(B,ie.interpolatedPosition)):(ie.interpolatedPosition.copy(ie.position),ie.interpolatedQuaternion.copy(ie.quaternion))}}};var I={type:"postStep"},x={type:"preStep"},w={type:"collide",body:null,contact:null},P=[],z=[],H=[],K=[];new o,new o,new o,new o,new o,new o,new o,new o,new o,new a;var le=new a,J=new a,W=new o;v.prototype.internalStep=function(O){this.dt=O;var fe=this.contacts,ue=H,ee=K,de=this.numObjects(),ae=this.bodies,R=this.solver,M=this.gravity,B=this.doProfiling,D=this.profile,te=p.DYNAMIC,ie,Z=this.constraints,me=z;M.norm();var F=M.x,Q=M.y,E=M.z,j=0;for(B&&(ie=performance.now()),j=0;j!==de;j++){var q=ae[j];if(q.type&te){var ce=q.force,G=q.mass;ce.x+=G*F,ce.y+=G*Q,ce.z+=G*E}}for(var j=0,V=this.subsystems.length;j!==V;j++)this.subsystems[j].update();B&&(ie=performance.now()),ue.length=0,ee.length=0,this.broadphase.collisionPairs(this,ue,ee),B&&(D.broadphase=performance.now()-ie);var Ke=Z.length;for(j=0;j!==Ke;j++){var re=Z[j];if(!re.collideConnected)for(var k=ue.length-1;k>=0;k-=1)(re.bodyA===ue[k]&&re.bodyB===ee[k]||re.bodyB===ue[k]&&re.bodyA===ee[k])&&(ue.splice(k,1),ee.splice(k,1))}this.collisionMatrixTick(),B&&(ie=performance.now());var N=P,oe=fe.length;for(j=0;j!==oe;j++)N.push(fe[j]);fe.length=0;var pe=this.frictionEquations.length;for(j=0;j!==pe;j++)me.push(this.frictionEquations[j]);this.frictionEquations.length=0,this.narrowphase.getContacts(ue,ee,this,fe,N,this.frictionEquations,me),B&&(D.narrowphase=performance.now()-ie),B&&(ie=performance.now());for(var j=0;j<this.frictionEquations.length;j++)R.addEquation(this.frictionEquations[j]);for(var ve=fe.length,xe=0;xe!==ve;xe++){var re=fe[xe],q=re.bi,Pe=re.bj;re.si,re.sj;var Te;if(q.material&&Pe.material?Te=this.getContactMaterial(q.material,Pe.material)||this.defaultContactMaterial:Te=this.defaultContactMaterial,Te.friction,q.material&&Pe.material&&(q.material.friction>=0&&Pe.material.friction>=0&&q.material.friction*Pe.material.friction,q.material.restitution>=0&&Pe.material.restitution>=0&&(re.restitution=q.material.restitution*Pe.material.restitution)),R.addEquation(re),q.allowSleep&&q.type===p.DYNAMIC&&q.sleepState===p.SLEEPING&&Pe.sleepState===p.AWAKE&&Pe.type!==p.STATIC){var Qe=Pe.velocity.norm2()+Pe.angularVelocity.norm2(),lt=Math.pow(Pe.sleepSpeedLimit,2);Qe>=lt*2&&(q._wakeUpAfterNarrowphase=!0)}if(Pe.allowSleep&&Pe.type===p.DYNAMIC&&Pe.sleepState===p.SLEEPING&&q.sleepState===p.AWAKE&&q.type!==p.STATIC){var Ne=q.velocity.norm2()+q.angularVelocity.norm2(),qe=Math.pow(q.sleepSpeedLimit,2);Ne>=qe*2&&(Pe._wakeUpAfterNarrowphase=!0)}this.collisionMatrix.set(q,Pe,!0),this.collisionMatrixPrevious.get(q,Pe)||(w.body=Pe,w.contact=re,q.dispatchEvent(w),w.body=q,Pe.dispatchEvent(w))}for(B&&(D.makeContactConstraints=performance.now()-ie,ie=performance.now()),j=0;j!==de;j++){var q=ae[j];q._wakeUpAfterNarrowphase&&(q.wakeUp(),q._wakeUpAfterNarrowphase=!1)}var Ke=Z.length;for(j=0;j!==Ke;j++){var re=Z[j];re.update();for(var k=0,it=re.equations.length;k!==it;k++){var je=re.equations[k];R.addEquation(je)}}R.solve(O,this),B&&(D.solve=performance.now()-ie),R.removeAllEquations();var dt=Math.pow;for(j=0;j!==de;j++){var q=ae[j];if(q.type&te){var ct=dt(1-q.linearDamping,O),At=q.velocity;At.mult(ct,At);var ge=q.angularVelocity;if(ge){var be=dt(1-q.angularDamping,O);ge.mult(be,ge)}}}for(this.dispatchEvent(x),j=0;j!==de;j++){var q=ae[j];q.preStep&&q.preStep.call(q)}B&&(ie=performance.now());var Ce=le,Le=J,et=this.stepnumber,Ze=p.DYNAMIC|p.KINEMATIC,_t=et%(this.quatNormalizeSkip+1)===0,Ht=this.quatNormalizeFast,dn=O*.5;for(r.types.PLANE,r.types.CONVEXPOLYHEDRON,j=0;j!==de;j++){var yt=ae[j],Se=yt.force,Be=yt.torque;if(yt.type&Ze&&yt.sleepState!==p.SLEEPING){var Oe=yt.velocity,Ue=yt.angularVelocity,mt=yt.position,Je=yt.quaternion,Ge=yt.invMass,$e=yt.invInertiaWorld;Oe.x+=Se.x*Ge*O,Oe.y+=Se.y*Ge*O,Oe.z+=Se.z*Ge*O,yt.angularVelocity&&($e.vmult(Be,W),W.mult(O,W),W.vadd(Ue,Ue)),mt.x+=Oe.x*O,mt.y+=Oe.y*O,mt.z+=Oe.z*O,yt.angularVelocity&&(Ce.set(Ue.x,Ue.y,Ue.z,0),Ce.mult(Je,Le),Je.x+=dn*Le.x,Je.y+=dn*Le.y,Je.z+=dn*Le.z,Je.w+=dn*Le.w,_t&&(Ht?Je.normalizeFast():Je.normalize())),yt.aabb&&(yt.aabbNeedsUpdate=!0),yt.updateInertiaWorld&&yt.updateInertiaWorld()}}for(this.clearForces(),this.broadphase.dirty=!0,B&&(D.integrate=performance.now()-ie),this.time+=O,this.stepnumber+=1,this.dispatchEvent(I),j=0;j!==de;j++){var q=ae[j],we=q.postStep;we&&we.call(q)}if(this.allowSleep)for(j=0;j!==de;j++)ae[j].sleepTick(this.time)},v.prototype.clearForces=function(){for(var O=this.bodies,fe=O.length,ue=0;ue!==fe;ue++){var ee=O[ue];ee.force,ee.torque,ee.force.set(0,0,0),ee.torque.set(0,0,0)}}},{"../collision/AABB":3,"../collision/ArrayCollisionMatrix":4,"../collision/NaiveBroadphase":7,"../collision/Ray":9,"../collision/RaycastResult":10,"../equations/ContactEquation":19,"../equations/FrictionEquation":21,"../material/ContactMaterial":24,"../material/Material":25,"../math/Quaternion":28,"../math/Vec3":30,"../objects/Body":31,"../shapes/Shape":43,"../solver/GSSolver":46,"../utils/EventTarget":49,"../utils/TupleDictionary":52,"../utils/Vec3Pool":54,"./Narrowphase":55}]},{},[2])(2)})})(UE);var WQ=UE.exports;const qQ=GQ(WQ);class jQ{constructor(e=9.81){this.experience=new ti,this.scene=this.experience.scene,this.world=new qQ.World,this.deltaTime=this.experience.time.delta,this.world.gravity.set(0,-e,0)}update(){this.world.step(1/60,this.deltaTime,3)}}class XQ extends Ag{constructor(e,t={}){const n=t.font;if(n===void 0)super();else{const s=n.generateShapes(e,t.size);t.depth===void 0&&t.height!==void 0&&console.warn("THREE.TextGeometry: .height is now depreciated. Please use .depth instead"),t.depth=t.depth!==void 0?t.depth:t.height!==void 0?t.height:50,t.bevelThickness===void 0&&(t.bevelThickness=10),t.bevelSize===void 0&&(t.bevelSize=8),t.bevelEnabled===void 0&&(t.bevelEnabled=!1),super(s,t)}this.type="TextGeometry"}}class YQ{constructor(e={}){this.experience=new ti,this.scene=this.experience.scene,this.resources=this.experience.resources,this.camera=this.experience.camera.instance;const t={texts:["three"],font:"fontSource",position:new he(0,0,-5),rotation:new Rn(0,0,0),fontOptions:{size:1,depth:.1,curveSegments:24,bevelEnabled:!0,bevelThickness:.15,bevelSize:.05,bevelOffset:0,bevelSegments:20}},{texts:n,font:s,position:r,rotation:o,fontOptions:a}={...t,...e};this.texts=n,this.font=s,this.position=r,this.rotation=o,this.fontOptions=a,this.colors=[{from:new at("#56b868"),to:new at("#afc97b")}],this.float=new hb({speed:.5,floatIntensity:.21,rotationIntensity:.21}),this.resources.on("ready",()=>{const l=this.resources.items[this.font],c=this.resources.items.matcapGreen;l&&c?this.setupTextMeshes(l,c):console.error("Font source  matcap ")})}setupTextMeshes(e,t){const n={...this.fontOptions,font:e};this.textGroups=[];const s=1;for(const[r,o]of this.texts.entries()){const a=new Wi;a.letterOff=0;for(const[l,c]of[...o].entries()){const h=new fB({matcap:t,color:"#daf799"});if(c===" ")a.letterOff+=s;else{const u=new XQ(c,n);u.computeBoundingBox(),u.computeBoundingSphere();const d=new $n(u,h);d.size=d.geometry.boundingBox.getSize(new he),d.userData.name=c,a.letterOff+=d.size.x,d.position.x=a.letterOff,a.add(d)}}for(const l of a.children)l.position.x-=a.letterOff*.5;this.textGroups.push(a),this.float.add(a)}this.centerTextBlock();for(const r of this.textGroups)r.position.add(this.position),r.rotation.copy(this.rotation);this.scene.add(this.float.group)}centerTextBlock(){const e=new ps;for(const n of this.textGroups)e.expandByObject(n);const t=e.getCenter(new he);for(const n of this.textGroups)n.position.sub(t)}update(){this.float&&this.float.update()}}const vy={SHOE:"radial-gradient(ellipse at center, transparent 70%, rgba(255,0,0,0.7) 100%)",CLOCK:"radial-gradient(ellipse at center, transparent 70%, rgba(0,120,255,0.7) 100%)",SHEID:"radial-gradient(ellipse at center, transparent 70%, rgba(255,255,0,0.7) 100%)",ZONGZI:"radial-gradient(ellipse at center, transparent 70%, rgba(0,255,0,0.7) 100%)"},KQ={shoe:"/image/shoe.png",clock:"/image/clock.png",sheid:"/image/sheid.png",zongzi:"/image/zongzi.png"},$Q=800;function JQ(i,e){const t=document.getElementById("item-effect-mask");t&&(t.style.background=vy[i.toUpperCase()]||vy.SHOE,t.style.display="block",t.classList.remove("opacity-0"),t.classList.add("opacity-100"),t.classList.remove("animate-pulse","flash"),clearTimeout(t._hideTimer),clearTimeout(t._flashTimer),t._flashTimer=setTimeout(()=>{t.classList.add("animate-pulse"),t.classList.add("flash")},e-$Q),t._hideTimer=setTimeout(()=>{t.classList.remove("animate-pulse","flash"),t.classList.remove("opacity-100"),t.classList.add("opacity-0"),setTimeout(()=>{t.style.display="none"},300)},e))}const Bs={};function ZQ(){let i=document.getElementById("item-effect-indicator");return i||(i=document.createElement("div"),i.id="item-effect-indicator",document.body.appendChild(i)),i.className="\n    fixed right-6 top-1/2 -translate-y-1/2\n    flex flex-col gap-4 z-[9999] transform\n    select-none\n    sm:right-6 sm:top-1/2 sm:-translate-y-1/2\n    right-2 top-[60%] -translate-y-[60%]\n  ".replace(/\s+/g," "),i}function Vp(){const i=ZQ();i.innerHTML="",Object.entries(Bs).forEach(([e,t])=>{const n=document.createElement("div");n.className="\n      flex items-center justify-center bg-black/70 rounded-xl px-4 py-3 shadow-2xl pixel\n      select-none\n      pointer-events-none\n      sm:px-4 sm:py-3\n      px-2 py-2\n    ".replace(/\s+/g," "),n.innerHTML='\n      <div class="w-16 h-16 mx-auto sm:w-16 sm:h-16 w-12 h-12 ">\n        <img src="'.concat(t.icon,'" alt="').concat(e,'" class="w-full h-full object-contain" draggable="false" />\n      </div>\n      <span class="flex items-center justify-center text-white font-extrabold sm:text-4xl text-2xl drop-shadow mx-auto">').concat(t.remain,"s</span>\n    "),i.appendChild(n)})}function eV(i,e){const t=KQ[i];t&&(Bs[i]?(clearInterval(Bs[i].timer),Bs[i].remain=Math.ceil(e/1e3)):Bs[i]={remain:Math.ceil(e/1e3),icon:t,timer:null},Bs[i].timer=setInterval(()=>{Bs[i].remain--,Bs[i].remain<=0&&(clearInterval(Bs[i].timer),delete Bs[i]),Vp()},1e3),Vp())}function tV(i,e){eV(i,e)}const nV="modulepreload",iV=function(i){return"/"+i},_y={},bl=function(e,t,n){let s=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),a=(o==null?void 0:o.nonce)||(o==null?void 0:o.getAttribute("nonce"));s=Promise.allSettled(t.map(l=>{if(l=iV(l),l in _y)return;_y[l]=!0;const c=l.endsWith(".css"),h=c?'[rel="stylesheet"]':"";if(document.querySelector('link[href="'.concat(l,'"]').concat(h)))return;const u=document.createElement("link");if(u.rel=c?"stylesheet":nV,c||(u.as="script"),u.crossOrigin="",u.href=l,a&&u.setAttribute("nonce",a),document.head.appendChild(u),c)return new Promise((d,f)=>{u.addEventListener("load",d),u.addEventListener("error",()=>f(new Error("Unable to preload CSS for ".concat(l))))})}))}function r(o){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=o,window.dispatchEvent(a),!a.defaultPrevented)throw o}return s.then(o=>{for(const a of o||[])a.status==="rejected"&&r(a.reason);return e().catch(r)})},sV=i=>{let e;return i?e=i:typeof fetch>"u"?e=(...t)=>bl(async()=>{const{default:n}=await Promise.resolve().then(()=>Ul);return{default:n}},[]).then(({default:n})=>n(...t)):e=fetch,(...t)=>e(...t)};class tv extends Error{constructor(e,t="FunctionsError",n){super(e),this.name=t,this.context=n}}class rV extends tv{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class oV extends tv{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class aV extends tv{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var dA;(function(i){i.Any="any",i.ApNortheast1="ap-northeast-1",i.ApNortheast2="ap-northeast-2",i.ApSouth1="ap-south-1",i.ApSoutheast1="ap-southeast-1",i.ApSoutheast2="ap-southeast-2",i.CaCentral1="ca-central-1",i.EuCentral1="eu-central-1",i.EuWest1="eu-west-1",i.EuWest2="eu-west-2",i.EuWest3="eu-west-3",i.SaEast1="sa-east-1",i.UsEast1="us-east-1",i.UsWest1="us-west-1",i.UsWest2="us-west-2"})(dA||(dA={}));var lV=function(i,e,t,n){function s(r){return r instanceof t?r:new t(function(o){o(r)})}return new(t||(t=Promise))(function(r,o){function a(h){try{c(n.next(h))}catch(u){o(u)}}function l(h){try{c(n.throw(h))}catch(u){o(u)}}function c(h){h.done?r(h.value):s(h.value).then(a,l)}c((n=n.apply(i,e||[])).next())})};class cV{constructor(e,{headers:t={},customFetch:n,region:s=dA.Any}={}){this.url=e,this.headers=t,this.region=s,this.fetch=sV(n)}setAuth(e){this.headers.Authorization="Bearer ".concat(e)}invoke(e,t={}){var n;return lV(this,void 0,void 0,function*(){try{const{headers:s,method:r,body:o}=t;let a={},{region:l}=t;l||(l=this.region),l&&l!=="any"&&(a["x-region"]=l);let c;o&&(s&&!Object.prototype.hasOwnProperty.call(s,"Content-Type")||!s)&&(typeof Blob<"u"&&o instanceof Blob||o instanceof ArrayBuffer?(a["Content-Type"]="application/octet-stream",c=o):typeof o=="string"?(a["Content-Type"]="text/plain",c=o):typeof FormData<"u"&&o instanceof FormData?c=o:(a["Content-Type"]="application/json",c=JSON.stringify(o)));const h=yield this.fetch("".concat(this.url,"/").concat(e),{method:r||"POST",headers:Object.assign(Object.assign(Object.assign({},a),this.headers),s),body:c}).catch(p=>{throw new rV(p)}),u=h.headers.get("x-relay-error");if(u&&u==="true")throw new oV(h);if(!h.ok)throw new aV(h);let d=((n=h.headers.get("Content-Type"))!==null&&n!==void 0?n:"text/plain").split(";")[0].trim(),f;return d==="application/json"?f=yield h.json():d==="application/octet-stream"?f=yield h.blob():d==="text/event-stream"?f=h:d==="multipart/form-data"?f=yield h.formData():f=yield h.text(),{data:f,error:null}}catch(s){return{data:null,error:s}}})}}var Ii={},nv={},sf={},Dh={},rf={},of={},hV=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},El=hV();const uV=El.fetch,QE=El.fetch.bind(El),VE=El.Headers,dV=El.Request,fV=El.Response,Ul=Object.freeze(Object.defineProperty({__proto__:null,Headers:VE,Request:dV,Response:fV,default:QE,fetch:uV},Symbol.toStringTag,{value:"Module"})),pV=HQ(Ul);var af={};Object.defineProperty(af,"__esModule",{value:!0});let mV=class extends Error{constructor(e){super(e.message),this.name="PostgrestError",this.details=e.details,this.hint=e.hint,this.code=e.code}};af.default=mV;var zE=ms&&ms.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(of,"__esModule",{value:!0});const AV=zE(pV),gV=zE(af);let vV=class{constructor(e){this.shouldThrowOnError=!1,this.method=e.method,this.url=e.url,this.headers=e.headers,this.schema=e.schema,this.body=e.body,this.shouldThrowOnError=e.shouldThrowOnError,this.signal=e.signal,this.isMaybeSingle=e.isMaybeSingle,e.fetch?this.fetch=e.fetch:typeof fetch>"u"?this.fetch=AV.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(e,t){return this.headers=Object.assign({},this.headers),this.headers[e]=t,this}then(e,t){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),this.method!=="GET"&&this.method!=="HEAD"&&(this.headers["Content-Type"]="application/json");const n=this.fetch;let s=n(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async r=>{var o,a,l;let c=null,h=null,u=null,d=r.status,f=r.statusText;if(r.ok){if(this.method!=="HEAD"){const g=await r.text();g===""||(this.headers.Accept==="text/csv"||this.headers.Accept&&this.headers.Accept.includes("application/vnd.pgrst.plan+text")?h=g:h=JSON.parse(g))}const A=(o=this.headers.Prefer)===null||o===void 0?void 0:o.match(/count=(exact|planned|estimated)/),m=(a=r.headers.get("content-range"))===null||a===void 0?void 0:a.split("/");A&&m&&m.length>1&&(u=parseInt(m[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(h)&&(h.length>1?(c={code:"PGRST116",details:"Results contain ".concat(h.length," rows, application/vnd.pgrst.object+json requires 1 row"),hint:null,message:"JSON object requested, multiple (or no) rows returned"},h=null,u=null,d=406,f="Not Acceptable"):h.length===1?h=h[0]:h=null)}else{const A=await r.text();try{c=JSON.parse(A),Array.isArray(c)&&r.status===404&&(h=[],c=null,d=200,f="OK")}catch(m){r.status===404&&A===""?(d=204,f="No Content"):c={message:A}}if(c&&this.isMaybeSingle&&(!((l=c==null?void 0:c.details)===null||l===void 0)&&l.includes("0 rows"))&&(c=null,d=200,f="OK"),c&&this.shouldThrowOnError)throw new gV.default(c)}return{error:c,data:h,count:u,status:d,statusText:f}});return this.shouldThrowOnError||(s=s.catch(r=>{var o,a,l;return{error:{message:"".concat((o=r==null?void 0:r.name)!==null&&o!==void 0?o:"FetchError",": ").concat(r==null?void 0:r.message),details:"".concat((a=r==null?void 0:r.stack)!==null&&a!==void 0?a:""),hint:"",code:"".concat((l=r==null?void 0:r.code)!==null&&l!==void 0?l:"")},data:null,count:null,status:0,statusText:""}})),s.then(e,t)}returns(){return this}overrideTypes(){return this}};of.default=vV;var _V=ms&&ms.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(rf,"__esModule",{value:!0});const yV=_V(of);let xV=class extends yV.default{select(e){let t=!1;const n=(e!=null?e:"*").split("").map(s=>/\s/.test(s)&&!t?"":(s==='"'&&(t=!t),s)).join("");return this.url.searchParams.set("select",n),this.headers.Prefer&&(this.headers.Prefer+=","),this.headers.Prefer+="return=representation",this}order(e,{ascending:t=!0,nullsFirst:n,foreignTable:s,referencedTable:r=s}={}){const o=r?"".concat(r,".order"):"order",a=this.url.searchParams.get(o);return this.url.searchParams.set(o,"".concat(a?"".concat(a,","):"").concat(e,".").concat(t?"asc":"desc").concat(n===void 0?"":n?".nullsfirst":".nullslast")),this}limit(e,{foreignTable:t,referencedTable:n=t}={}){const s=typeof n>"u"?"limit":"".concat(n,".limit");return this.url.searchParams.set(s,"".concat(e)),this}range(e,t,{foreignTable:n,referencedTable:s=n}={}){const r=typeof s>"u"?"offset":"".concat(s,".offset"),o=typeof s>"u"?"limit":"".concat(s,".limit");return this.url.searchParams.set(r,"".concat(e)),this.url.searchParams.set(o,"".concat(t-e+1)),this}abortSignal(e){return this.signal=e,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return this.method==="GET"?this.headers.Accept="application/json":this.headers.Accept="application/vnd.pgrst.object+json",this.isMaybeSingle=!0,this}csv(){return this.headers.Accept="text/csv",this}geojson(){return this.headers.Accept="application/geo+json",this}explain({analyze:e=!1,verbose:t=!1,settings:n=!1,buffers:s=!1,wal:r=!1,format:o="text"}={}){var a;const l=[e?"analyze":null,t?"verbose":null,n?"settings":null,s?"buffers":null,r?"wal":null].filter(Boolean).join("|"),c=(a=this.headers.Accept)!==null&&a!==void 0?a:"application/json";return this.headers.Accept="application/vnd.pgrst.plan+".concat(o,'; for="').concat(c,'"; options=').concat(l,";"),o==="json"?this:this}rollback(){var e;return((e=this.headers.Prefer)!==null&&e!==void 0?e:"").trim().length>0?this.headers.Prefer+=",tx=rollback":this.headers.Prefer="tx=rollback",this}returns(){return this}};rf.default=xV;var wV=ms&&ms.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(Dh,"__esModule",{value:!0});const bV=wV(rf);let EV=class extends bV.default{eq(e,t){return this.url.searchParams.append(e,"eq.".concat(t)),this}neq(e,t){return this.url.searchParams.append(e,"neq.".concat(t)),this}gt(e,t){return this.url.searchParams.append(e,"gt.".concat(t)),this}gte(e,t){return this.url.searchParams.append(e,"gte.".concat(t)),this}lt(e,t){return this.url.searchParams.append(e,"lt.".concat(t)),this}lte(e,t){return this.url.searchParams.append(e,"lte.".concat(t)),this}like(e,t){return this.url.searchParams.append(e,"like.".concat(t)),this}likeAllOf(e,t){return this.url.searchParams.append(e,"like(all).{".concat(t.join(","),"}")),this}likeAnyOf(e,t){return this.url.searchParams.append(e,"like(any).{".concat(t.join(","),"}")),this}ilike(e,t){return this.url.searchParams.append(e,"ilike.".concat(t)),this}ilikeAllOf(e,t){return this.url.searchParams.append(e,"ilike(all).{".concat(t.join(","),"}")),this}ilikeAnyOf(e,t){return this.url.searchParams.append(e,"ilike(any).{".concat(t.join(","),"}")),this}is(e,t){return this.url.searchParams.append(e,"is.".concat(t)),this}in(e,t){const n=Array.from(new Set(t)).map(s=>typeof s=="string"&&new RegExp("[,()]").test(s)?'"'.concat(s,'"'):"".concat(s)).join(",");return this.url.searchParams.append(e,"in.(".concat(n,")")),this}contains(e,t){return typeof t=="string"?this.url.searchParams.append(e,"cs.".concat(t)):Array.isArray(t)?this.url.searchParams.append(e,"cs.{".concat(t.join(","),"}")):this.url.searchParams.append(e,"cs.".concat(JSON.stringify(t))),this}containedBy(e,t){return typeof t=="string"?this.url.searchParams.append(e,"cd.".concat(t)):Array.isArray(t)?this.url.searchParams.append(e,"cd.{".concat(t.join(","),"}")):this.url.searchParams.append(e,"cd.".concat(JSON.stringify(t))),this}rangeGt(e,t){return this.url.searchParams.append(e,"sr.".concat(t)),this}rangeGte(e,t){return this.url.searchParams.append(e,"nxl.".concat(t)),this}rangeLt(e,t){return this.url.searchParams.append(e,"sl.".concat(t)),this}rangeLte(e,t){return this.url.searchParams.append(e,"nxr.".concat(t)),this}rangeAdjacent(e,t){return this.url.searchParams.append(e,"adj.".concat(t)),this}overlaps(e,t){return typeof t=="string"?this.url.searchParams.append(e,"ov.".concat(t)):this.url.searchParams.append(e,"ov.{".concat(t.join(","),"}")),this}textSearch(e,t,{config:n,type:s}={}){let r="";s==="plain"?r="pl":s==="phrase"?r="ph":s==="websearch"&&(r="w");const o=n===void 0?"":"(".concat(n,")");return this.url.searchParams.append(e,"".concat(r,"fts").concat(o,".").concat(t)),this}match(e){return Object.entries(e).forEach(([t,n])=>{this.url.searchParams.append(t,"eq.".concat(n))}),this}not(e,t,n){return this.url.searchParams.append(e,"not.".concat(t,".").concat(n)),this}or(e,{foreignTable:t,referencedTable:n=t}={}){const s=n?"".concat(n,".or"):"or";return this.url.searchParams.append(s,"(".concat(e,")")),this}filter(e,t,n){return this.url.searchParams.append(e,"".concat(t,".").concat(n)),this}};Dh.default=EV;var CV=ms&&ms.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(sf,"__esModule",{value:!0});const ic=CV(Dh);let SV=class{constructor(e,{headers:t={},schema:n,fetch:s}){this.url=e,this.headers=t,this.schema=n,this.fetch=s}select(e,{head:t=!1,count:n}={}){const s=t?"HEAD":"GET";let r=!1;const o=(e!=null?e:"*").split("").map(a=>/\s/.test(a)&&!r?"":(a==='"'&&(r=!r),a)).join("");return this.url.searchParams.set("select",o),n&&(this.headers.Prefer="count=".concat(n)),new ic.default({method:s,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}insert(e,{count:t,defaultToNull:n=!0}={}){const s="POST",r=[];if(this.headers.Prefer&&r.push(this.headers.Prefer),t&&r.push("count=".concat(t)),n||r.push("missing=default"),this.headers.Prefer=r.join(","),Array.isArray(e)){const o=e.reduce((a,l)=>a.concat(Object.keys(l)),[]);if(o.length>0){const a=[...new Set(o)].map(l=>'"'.concat(l,'"'));this.url.searchParams.set("columns",a.join(","))}}return new ic.default({method:s,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}upsert(e,{onConflict:t,ignoreDuplicates:n=!1,count:s,defaultToNull:r=!0}={}){const o="POST",a=["resolution=".concat(n?"ignore":"merge","-duplicates")];if(t!==void 0&&this.url.searchParams.set("on_conflict",t),this.headers.Prefer&&a.push(this.headers.Prefer),s&&a.push("count=".concat(s)),r||a.push("missing=default"),this.headers.Prefer=a.join(","),Array.isArray(e)){const l=e.reduce((c,h)=>c.concat(Object.keys(h)),[]);if(l.length>0){const c=[...new Set(l)].map(h=>'"'.concat(h,'"'));this.url.searchParams.set("columns",c.join(","))}}return new ic.default({method:o,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}update(e,{count:t}={}){const n="PATCH",s=[];return this.headers.Prefer&&s.push(this.headers.Prefer),t&&s.push("count=".concat(t)),this.headers.Prefer=s.join(","),new ic.default({method:n,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}delete({count:e}={}){const t="DELETE",n=[];return e&&n.push("count=".concat(e)),this.headers.Prefer&&n.unshift(this.headers.Prefer),this.headers.Prefer=n.join(","),new ic.default({method:t,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}};sf.default=SV;var lf={},cf={};Object.defineProperty(cf,"__esModule",{value:!0});cf.version=void 0;cf.version="0.0.0-automated";Object.defineProperty(lf,"__esModule",{value:!0});lf.DEFAULT_HEADERS=void 0;const IV=cf;lf.DEFAULT_HEADERS={"X-Client-Info":"postgrest-js/".concat(IV.version)};var GE=ms&&ms.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(nv,"__esModule",{value:!0});const MV=GE(sf),TV=GE(Dh),BV=lf;let RV=class HE{constructor(e,{headers:t={},schema:n,fetch:s}={}){this.url=e,this.headers=Object.assign(Object.assign({},BV.DEFAULT_HEADERS),t),this.schemaName=n,this.fetch=s}from(e){const t=new URL("".concat(this.url,"/").concat(e));return new MV.default(t,{headers:Object.assign({},this.headers),schema:this.schemaName,fetch:this.fetch})}schema(e){return new HE(this.url,{headers:this.headers,schema:e,fetch:this.fetch})}rpc(e,t={},{head:n=!1,get:s=!1,count:r}={}){let o;const a=new URL("".concat(this.url,"/rpc/").concat(e));let l;n||s?(o=n?"HEAD":"GET",Object.entries(t).filter(([h,u])=>u!==void 0).map(([h,u])=>[h,Array.isArray(u)?"{".concat(u.join(","),"}"):"".concat(u)]).forEach(([h,u])=>{a.searchParams.append(h,u)})):(o="POST",l=t);const c=Object.assign({},this.headers);return r&&(c.Prefer="count=".concat(r)),new TV.default({method:o,url:a,headers:c,schema:this.schemaName,body:l,fetch:this.fetch,allowEmpty:!1})}};nv.default=RV;var Ql=ms&&ms.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(Ii,"__esModule",{value:!0});Ii.PostgrestError=Ii.PostgrestBuilder=Ii.PostgrestTransformBuilder=Ii.PostgrestFilterBuilder=Ii.PostgrestQueryBuilder=Ii.PostgrestClient=void 0;const WE=Ql(nv);Ii.PostgrestClient=WE.default;const qE=Ql(sf);Ii.PostgrestQueryBuilder=qE.default;const jE=Ql(Dh);Ii.PostgrestFilterBuilder=jE.default;const XE=Ql(rf);Ii.PostgrestTransformBuilder=XE.default;const YE=Ql(of);Ii.PostgrestBuilder=YE.default;const KE=Ql(af);Ii.PostgrestError=KE.default;var PV=Ii.default={PostgrestClient:WE.default,PostgrestQueryBuilder:qE.default,PostgrestFilterBuilder:jE.default,PostgrestTransformBuilder:XE.default,PostgrestBuilder:YE.default,PostgrestError:KE.default};const{PostgrestClient:DV,PostgrestQueryBuilder:_5,PostgrestFilterBuilder:y5,PostgrestTransformBuilder:x5,PostgrestBuilder:w5,PostgrestError:b5}=PV,LV="2.11.2",FV={"X-Client-Info":"realtime-js/".concat(LV)},NV="1.0.0",$E=1e4,kV=1e3;var ul;(function(i){i[i.connecting=0]="connecting",i[i.open=1]="open",i[i.closing=2]="closing",i[i.closed=3]="closed"})(ul||(ul={}));var Ui;(function(i){i.closed="closed",i.errored="errored",i.joined="joined",i.joining="joining",i.leaving="leaving"})(Ui||(Ui={}));var xs;(function(i){i.close="phx_close",i.error="phx_error",i.join="phx_join",i.reply="phx_reply",i.leave="phx_leave",i.access_token="access_token"})(xs||(xs={}));var fA;(function(i){i.websocket="websocket"})(fA||(fA={}));var Qo;(function(i){i.Connecting="connecting",i.Open="open",i.Closing="closing",i.Closed="closed"})(Qo||(Qo={}));class OV{constructor(){this.HEADER_LENGTH=1}decode(e,t){return e.constructor===ArrayBuffer?t(this._binaryDecode(e)):t(typeof e=="string"?JSON.parse(e):{})}_binaryDecode(e){const t=new DataView(e),n=new TextDecoder;return this._decodeBroadcast(e,t,n)}_decodeBroadcast(e,t,n){const s=t.getUint8(1),r=t.getUint8(2);let o=this.HEADER_LENGTH+2;const a=n.decode(e.slice(o,o+s));o=o+s;const l=n.decode(e.slice(o,o+r));o=o+r;const c=JSON.parse(n.decode(e.slice(o,e.byteLength)));return{ref:null,topic:a,event:l,payload:c}}}class JE{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var on;(function(i){i.abstime="abstime",i.bool="bool",i.date="date",i.daterange="daterange",i.float4="float4",i.float8="float8",i.int2="int2",i.int4="int4",i.int4range="int4range",i.int8="int8",i.int8range="int8range",i.json="json",i.jsonb="jsonb",i.money="money",i.numeric="numeric",i.oid="oid",i.reltime="reltime",i.text="text",i.time="time",i.timestamp="timestamp",i.timestamptz="timestamptz",i.timetz="timetz",i.tsrange="tsrange",i.tstzrange="tstzrange"})(on||(on={}));const yy=(i,e,t={})=>{var n;const s=(n=t.skipTypes)!==null&&n!==void 0?n:[];return Object.keys(e).reduce((r,o)=>(r[o]=UV(o,i,e,s),r),{})},UV=(i,e,t,n)=>{const s=e.find(a=>a.name===i),r=s==null?void 0:s.type,o=t[i];return r&&!n.includes(r)?ZE(r,o):pA(o)},ZE=(i,e)=>{if(i.charAt(0)==="_"){const t=i.slice(1,i.length);return GV(e,t)}switch(i){case on.bool:return QV(e);case on.float4:case on.float8:case on.int2:case on.int4:case on.int8:case on.numeric:case on.oid:return VV(e);case on.json:case on.jsonb:return zV(e);case on.timestamp:return HV(e);case on.abstime:case on.date:case on.daterange:case on.int4range:case on.int8range:case on.money:case on.reltime:case on.text:case on.time:case on.timestamptz:case on.timetz:case on.tsrange:case on.tstzrange:return pA(e);default:return pA(e)}},pA=i=>i,QV=i=>{switch(i){case"t":return!0;case"f":return!1;default:return i}},VV=i=>{if(typeof i=="string"){const e=parseFloat(i);if(!Number.isNaN(e))return e}return i},zV=i=>{if(typeof i=="string")try{return JSON.parse(i)}catch(e){return console.log("JSON parse error: ".concat(e)),i}return i},GV=(i,e)=>{if(typeof i!="string")return i;const t=i.length-1,n=i[t];if(i[0]==="{"&&n==="}"){let r;const o=i.slice(1,t);try{r=JSON.parse("["+o+"]")}catch(a){r=o?o.split(","):[]}return r.map(a=>ZE(e,a))}return i},HV=i=>typeof i=="string"?i.replace(" ","T"):i,eC=i=>{let e=i;return e=e.replace(/^ws/i,"http"),e=e.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),e.replace(/\/+$/,"")};class zp{constructor(e,t,n={},s=$E){this.channel=e,this.event=t,this.payload=n,this.timeout=s,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var n;return this._hasReceived(e)&&t((n=this.receivedResp)===null||n===void 0?void 0:n.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=t=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=t,this._matchReceive(t)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(n=>n.status===e).forEach(n=>n.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var xy;(function(i){i.SYNC="sync",i.JOIN="join",i.LEAVE="leave"})(xy||(xy={}));class Dc{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const n=(t==null?void 0:t.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(n.state,{},s=>{const{onJoin:r,onLeave:o,onSync:a}=this.caller;this.joinRef=this.channel._joinRef(),this.state=Dc.syncState(this.state,s,r,o),this.pendingDiffs.forEach(l=>{this.state=Dc.syncDiff(this.state,l,r,o)}),this.pendingDiffs=[],a()}),this.channel._on(n.diff,{},s=>{const{onJoin:r,onLeave:o,onSync:a}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(s):(this.state=Dc.syncDiff(this.state,s,r,o),a())}),this.onJoin((s,r,o)=>{this.channel._trigger("presence",{event:"join",key:s,currentPresences:r,newPresences:o})}),this.onLeave((s,r,o)=>{this.channel._trigger("presence",{event:"leave",key:s,currentPresences:r,leftPresences:o})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,n,s){const r=this.cloneDeep(e),o=this.transformState(t),a={},l={};return this.map(r,(c,h)=>{o[c]||(l[c]=h)}),this.map(o,(c,h)=>{const u=r[c];if(u){const d=h.map(m=>m.presence_ref),f=u.map(m=>m.presence_ref),p=h.filter(m=>f.indexOf(m.presence_ref)<0),A=u.filter(m=>d.indexOf(m.presence_ref)<0);p.length>0&&(a[c]=p),A.length>0&&(l[c]=A)}else a[c]=h}),this.syncDiff(r,{joins:a,leaves:l},n,s)}static syncDiff(e,t,n,s){const{joins:r,leaves:o}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return n||(n=()=>{}),s||(s=()=>{}),this.map(r,(a,l)=>{var c;const h=(c=e[a])!==null&&c!==void 0?c:[];if(e[a]=this.cloneDeep(l),h.length>0){const u=e[a].map(f=>f.presence_ref),d=h.filter(f=>u.indexOf(f.presence_ref)<0);e[a].unshift(...d)}n(a,h,l)}),this.map(o,(a,l)=>{let c=e[a];if(!c)return;const h=l.map(u=>u.presence_ref);c=c.filter(u=>h.indexOf(u.presence_ref)<0),e[a]=c,s(a,c,l),c.length===0&&delete e[a]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(n=>t(n,e[n]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,n)=>{const s=e[n];return"metas"in s?t[n]=s.metas.map(r=>(r.presence_ref=r.phx_ref,delete r.phx_ref,delete r.phx_ref_prev,r)):t[n]=s,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var wy;(function(i){i.ALL="*",i.INSERT="INSERT",i.UPDATE="UPDATE",i.DELETE="DELETE"})(wy||(wy={}));var by;(function(i){i.BROADCAST="broadcast",i.PRESENCE="presence",i.POSTGRES_CHANGES="postgres_changes",i.SYSTEM="system"})(by||(by={}));var cr;(function(i){i.SUBSCRIBED="SUBSCRIBED",i.TIMED_OUT="TIMED_OUT",i.CLOSED="CLOSED",i.CHANNEL_ERROR="CHANNEL_ERROR"})(cr||(cr={}));class iv{constructor(e,t={config:{}},n){this.topic=e,this.params=t,this.socket=n,this.bindings={},this.state=Ui.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:""},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new zp(this,xs.join,this.params,this.timeout),this.rejoinTimer=new JE(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=Ui.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(s=>s.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel","close ".concat(this.topic," ").concat(this._joinRef())),this.state=Ui.closed,this.socket._remove(this)}),this._onError(s=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel","error ".concat(this.topic),s),this.state=Ui.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel","timeout ".concat(this.topic),this.joinPush.timeout),this.state=Ui.errored,this.rejoinTimer.scheduleTimeout())}),this._on(xs.reply,{},(s,r)=>{this._trigger(this._replyEventName(r),s)}),this.presence=new Dc(this),this.broadcastEndpointURL=eC(this.socket.endPoint)+"/api/broadcast",this.private=this.params.config.private||!1}subscribe(e,t=this.timeout){var n,s;if(this.socket.isConnected()||this.socket.connect(),this.joinedOnce)throw"tried to subscribe multiple times. 'subscribe' can only be called a single time per channel instance";{const{config:{broadcast:r,presence:o,private:a}}=this.params;this._onError(h=>e==null?void 0:e(cr.CHANNEL_ERROR,h)),this._onClose(()=>e==null?void 0:e(cr.CLOSED));const l={},c={broadcast:r,presence:o,postgres_changes:(s=(n=this.bindings.postgres_changes)===null||n===void 0?void 0:n.map(h=>h.filter))!==null&&s!==void 0?s:[],private:a};this.socket.accessTokenValue&&(l.access_token=this.socket.accessTokenValue),this.updateJoinPayload(Object.assign({config:c},l)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",async({postgres_changes:h})=>{var u;if(this.socket.setAuth(),h===void 0){e==null||e(cr.SUBSCRIBED);return}else{const d=this.bindings.postgres_changes,f=(u=d==null?void 0:d.length)!==null&&u!==void 0?u:0,p=[];for(let A=0;A<f;A++){const m=d[A],{filter:{event:g,schema:y,table:_,filter:v}}=m,b=h&&h[A];if(b&&b.event===g&&b.schema===y&&b.table===_&&b.filter===v)p.push(Object.assign(Object.assign({},m),{id:b.id}));else{this.unsubscribe(),e==null||e(cr.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=p,e&&e(cr.SUBSCRIBED);return}}).receive("error",h=>{e==null||e(cr.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(h).join(", ")||"error")))}).receive("timeout",()=>{e==null||e(cr.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,t={}){return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,t,n){return this._on(e,t,n)}async send(e,t={}){var n,s;if(!this._canPush()&&e.type==="broadcast"){const{event:r,payload:o}=e,l={method:"POST",headers:{Authorization:this.socket.accessTokenValue?"Bearer ".concat(this.socket.accessTokenValue):"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:r,payload:o,private:this.private}]})};try{const c=await this._fetchWithTimeout(this.broadcastEndpointURL,l,(n=t.timeout)!==null&&n!==void 0?n:this.timeout);return await((s=c.body)===null||s===void 0?void 0:s.cancel()),c.ok?"ok":"error"}catch(c){return c.name==="AbortError"?"timed out":"error"}}else return new Promise(r=>{var o,a,l;const c=this._push(e.type,e,t.timeout||this.timeout);e.type==="broadcast"&&!(!((l=(a=(o=this.params)===null||o===void 0?void 0:o.config)===null||a===void 0?void 0:a.broadcast)===null||l===void 0)&&l.ack)&&r("ok"),c.receive("ok",()=>r("ok")),c.receive("error",()=>r("error")),c.receive("timeout",()=>r("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=Ui.leaving;const t=()=>{this.socket.log("channel","leave ".concat(this.topic)),this._trigger(xs.close,"leave",this._joinRef())};return this.rejoinTimer.reset(),this.joinPush.destroy(),new Promise(n=>{const s=new zp(this,xs.leave,{},e);s.receive("ok",()=>{t(),n("ok")}).receive("timeout",()=>{t(),n("timed out")}).receive("error",()=>{n("error")}),s.send(),this._canPush()||s.trigger("ok",{})})}async _fetchWithTimeout(e,t,n){const s=new AbortController,r=setTimeout(()=>s.abort(),n),o=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:s.signal}));return clearTimeout(r),o}_push(e,t,n=this.timeout){if(!this.joinedOnce)throw"tried to push '".concat(e,"' to '").concat(this.topic,"' before joining. Use channel.subscribe() before pushing events");let s=new zp(this,e,t,n);return this._canPush()?s.send():(s.startTimeout(),this.pushBuffer.push(s)),s}_onMessage(e,t,n){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,n){var s,r;const o=e.toLocaleLowerCase(),{close:a,error:l,leave:c,join:h}=xs;if(n&&[a,l,c,h].indexOf(o)>=0&&n!==this._joinRef())return;let d=this._onMessage(o,t,n);if(t&&!d)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(o)?(s=this.bindings.postgres_changes)===null||s===void 0||s.filter(f=>{var p,A,m;return((p=f.filter)===null||p===void 0?void 0:p.event)==="*"||((m=(A=f.filter)===null||A===void 0?void 0:A.event)===null||m===void 0?void 0:m.toLocaleLowerCase())===o}).map(f=>f.callback(d,n)):(r=this.bindings[o])===null||r===void 0||r.filter(f=>{var p,A,m,g,y,_;if(["broadcast","presence","postgres_changes"].includes(o))if("id"in f){const v=f.id,b=(p=f.filter)===null||p===void 0?void 0:p.event;return v&&((A=t.ids)===null||A===void 0?void 0:A.includes(v))&&(b==="*"||(b==null?void 0:b.toLocaleLowerCase())===((m=t.data)===null||m===void 0?void 0:m.type.toLocaleLowerCase()))}else{const v=(y=(g=f==null?void 0:f.filter)===null||g===void 0?void 0:g.event)===null||y===void 0?void 0:y.toLocaleLowerCase();return v==="*"||v===((_=t==null?void 0:t.event)===null||_===void 0?void 0:_.toLocaleLowerCase())}else return f.type.toLocaleLowerCase()===o}).map(f=>{if(typeof d=="object"&&"ids"in d){const p=d.data,{schema:A,table:m,commit_timestamp:g,type:y,errors:_}=p;d=Object.assign(Object.assign({},{schema:A,table:m,commit_timestamp:g,eventType:y,new:{},old:{},errors:_}),this._getPayloadRecords(p))}f.callback(d,n)})}_isClosed(){return this.state===Ui.closed}_isJoined(){return this.state===Ui.joined}_isJoining(){return this.state===Ui.joining}_isLeaving(){return this.state===Ui.leaving}_replyEventName(e){return"chan_reply_".concat(e)}_on(e,t,n){const s=e.toLocaleLowerCase(),r={type:s,filter:t,callback:n};return this.bindings[s]?this.bindings[s].push(r):this.bindings[s]=[r],this}_off(e,t){const n=e.toLocaleLowerCase();return this.bindings[n]=this.bindings[n].filter(s=>{var r;return!(((r=s.type)===null||r===void 0?void 0:r.toLocaleLowerCase())===n&&iv.isEqual(s.filter,t))}),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const n in e)if(e[n]!==t[n])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(xs.close,{},e)}_onError(e){this._on(xs.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=Ui.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(t.new=yy(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(t.old=yy(e.columns,e.old_record)),t}}const WV=()=>{},qV=typeof WebSocket<"u",jV='\n  addEventListener("message", (e) => {\n    if (e.data.event === "start") {\n      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);\n    }\n  });';class XV{constructor(e,t){var n;this.accessTokenValue=null,this.apiKey=null,this.channels=[],this.endPoint="",this.httpEndpoint="",this.headers=FV,this.params={},this.timeout=$E,this.heartbeatIntervalMs=3e4,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.ref=0,this.logger=WV,this.conn=null,this.sendBuffer=[],this.serializer=new OV,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._resolveFetch=r=>{let o;return r?o=r:typeof fetch>"u"?o=(...a)=>bl(async()=>{const{default:l}=await Promise.resolve().then(()=>Ul);return{default:l}},void 0).then(({default:l})=>l(...a)):o=fetch,(...a)=>o(...a)},this.endPoint="".concat(e,"/").concat(fA.websocket),this.httpEndpoint=eC(e),t!=null&&t.transport?this.transport=t.transport:this.transport=null,t!=null&&t.params&&(this.params=t.params),t!=null&&t.headers&&(this.headers=Object.assign(Object.assign({},this.headers),t.headers)),t!=null&&t.timeout&&(this.timeout=t.timeout),t!=null&&t.logger&&(this.logger=t.logger),t!=null&&t.heartbeatIntervalMs&&(this.heartbeatIntervalMs=t.heartbeatIntervalMs);const s=(n=t==null?void 0:t.params)===null||n===void 0?void 0:n.apikey;if(s&&(this.accessTokenValue=s,this.apiKey=s),this.reconnectAfterMs=t!=null&&t.reconnectAfterMs?t.reconnectAfterMs:r=>[1e3,2e3,5e3,1e4][r-1]||1e4,this.encode=t!=null&&t.encode?t.encode:(r,o)=>o(JSON.stringify(r)),this.decode=t!=null&&t.decode?t.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new JE(async()=>{this.disconnect(),this.connect()},this.reconnectAfterMs),this.fetch=this._resolveFetch(t==null?void 0:t.fetch),t!=null&&t.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.worker=(t==null?void 0:t.worker)||!1,this.workerUrl=t==null?void 0:t.workerUrl}this.accessToken=(t==null?void 0:t.accessToken)||null}connect(){if(!this.conn){if(this.transport){this.conn=new this.transport(this.endpointURL(),void 0,{headers:this.headers});return}if(qV){this.conn=new WebSocket(this.endpointURL()),this.setupConnection();return}this.conn=new YV(this.endpointURL(),void 0,{close:()=>{this.conn=null}}),bl(async()=>{const{default:e}=await import("./browser-B6UkBFhs.js").then(t=>t.b);return{default:e}},[]).then(({default:e})=>{this.conn=new e(this.endpointURL(),void 0,{headers:this.headers}),this.setupConnection()})}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:NV}))}disconnect(e,t){this.conn&&(this.conn.onclose=function(){},e?this.conn.close(e,t!=null?t:""):this.conn.close(),this.conn=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.reset())}getChannels(){return this.channels}async removeChannel(e){const t=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),t}async removeAllChannels(){const e=await Promise.all(this.channels.map(t=>t.unsubscribe()));return this.disconnect(),e}log(e,t,n){this.logger(e,t,n)}connectionState(){switch(this.conn&&this.conn.readyState){case ul.connecting:return Qo.Connecting;case ul.open:return Qo.Open;case ul.closing:return Qo.Closing;default:return Qo.Closed}}isConnected(){return this.connectionState()===Qo.Open}channel(e,t={config:{}}){const n=new iv("realtime:".concat(e),t,this);return this.channels.push(n),n}push(e){const{topic:t,event:n,payload:s,ref:r}=e,o=()=>{this.encode(e,a=>{var l;(l=this.conn)===null||l===void 0||l.send(a)})};this.log("push","".concat(t," ").concat(n," (").concat(r,")"),s),this.isConnected()?o():this.sendBuffer.push(o)}async setAuth(e=null){let t=e||this.accessToken&&await this.accessToken()||this.accessTokenValue;if(t){let n=null;try{n=JSON.parse(atob(t.split(".")[1]))}catch(s){}if(n&&n.exp&&!(Math.floor(Date.now()/1e3)-n.exp<0))return this.log("auth",'InvalidJWTToken: Invalid value for JWT claim "exp" with value '.concat(n.exp)),Promise.reject('InvalidJWTToken: Invalid value for JWT claim "exp" with value '.concat(n.exp));this.accessTokenValue=t,this.channels.forEach(s=>{t&&s.updateJoinPayload({access_token:t}),s.joinedOnce&&s._isJoined()&&s._push(xs.access_token,{access_token:t})})}}async sendHeartbeat(){var e;if(this.isConnected()){if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),(e=this.conn)===null||e===void 0||e.close(kV,"hearbeat timeout");return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.setAuth()}}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(n=>n.topic===e&&(n._isJoined()||n._isJoining()));t&&(this.log("transport",'leaving duplicate topic "'.concat(e,'"')),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t._joinRef()!==e._joinRef())}setupConnection(){this.conn&&(this.conn.binaryType="arraybuffer",this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_onConnMessage(e){this.decode(e.data,t=>{let{topic:n,event:s,payload:r,ref:o}=t;o&&o===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null),this.log("receive","".concat(r.status||""," ").concat(n," ").concat(s," ").concat(o&&"("+o+")"||""),r),this.channels.filter(a=>a._isMember(n)).forEach(a=>a._trigger(s,r,o)),this.stateChangeCallbacks.message.forEach(a=>a(t))})}async _onConnOpen(){if(this.log("transport","connected to ".concat(this.endpointURL())),this.flushSendBuffer(),this.reconnectTimer.reset(),!this.worker)this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs);else{this.workerUrl?this.log("worker","starting worker for from ".concat(this.workerUrl)):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=t=>{this.log("worker","worker error",t.message),this.workerRef.terminate()},this.workerRef.onmessage=t=>{t.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}this.stateChangeCallbacks.open.forEach(e=>e())}_onConnClose(e){this.log("transport","close",e),this._triggerChanError(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach(t=>t(e))}_onConnError(e){this.log("transport",e.message),this._triggerChanError(),this.stateChangeCallbacks.error.forEach(t=>t(e))}_triggerChanError(){this.channels.forEach(e=>e._trigger(xs.error))}_appendParams(e,t){if(Object.keys(t).length===0)return e;const n=e.match(/\?/)?"&":"?",s=new URLSearchParams(t);return"".concat(e).concat(n).concat(s)}_workerObjectUrl(e){let t;if(e)t=e;else{const n=new Blob([jV],{type:"application/javascript"});t=URL.createObjectURL(n)}return t}}class YV{constructor(e,t,n){this.binaryType="arraybuffer",this.onclose=()=>{},this.onerror=()=>{},this.onmessage=()=>{},this.onopen=()=>{},this.readyState=ul.connecting,this.send=()=>{},this.url=null,this.url=e,this.close=n.close}}class sv extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function Yn(i){return typeof i=="object"&&i!==null&&"__isStorageError"in i}class KV extends sv{constructor(e,t){super(e),this.name="StorageApiError",this.status=t}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class mA extends sv{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}}var $V=function(i,e,t,n){function s(r){return r instanceof t?r:new t(function(o){o(r)})}return new(t||(t=Promise))(function(r,o){function a(h){try{c(n.next(h))}catch(u){o(u)}}function l(h){try{c(n.throw(h))}catch(u){o(u)}}function c(h){h.done?r(h.value):s(h.value).then(a,l)}c((n=n.apply(i,e||[])).next())})};const tC=i=>{let e;return i?e=i:typeof fetch>"u"?e=(...t)=>bl(async()=>{const{default:n}=await Promise.resolve().then(()=>Ul);return{default:n}},void 0).then(({default:n})=>n(...t)):e=fetch,(...t)=>e(...t)},JV=()=>$V(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield bl(()=>Promise.resolve().then(()=>Ul),void 0)).Response:Response}),AA=i=>{if(Array.isArray(i))return i.map(t=>AA(t));if(typeof i=="function"||i!==Object(i))return i;const e={};return Object.entries(i).forEach(([t,n])=>{const s=t.replace(/([-_][a-z])/gi,r=>r.toUpperCase().replace(/[-_]/g,""));e[s]=AA(n)}),e};var pa=function(i,e,t,n){function s(r){return r instanceof t?r:new t(function(o){o(r)})}return new(t||(t=Promise))(function(r,o){function a(h){try{c(n.next(h))}catch(u){o(u)}}function l(h){try{c(n.throw(h))}catch(u){o(u)}}function c(h){h.done?r(h.value):s(h.value).then(a,l)}c((n=n.apply(i,e||[])).next())})};const Gp=i=>i.msg||i.message||i.error_description||i.error||JSON.stringify(i),ZV=(i,e,t)=>pa(void 0,void 0,void 0,function*(){const n=yield JV();i instanceof n&&!(t!=null&&t.noResolveJson)?i.json().then(s=>{e(new KV(Gp(s),i.status||500))}).catch(s=>{e(new mA(Gp(s),s))}):e(new mA(Gp(i),i))}),ez=(i,e,t,n)=>{const s={method:i,headers:(e==null?void 0:e.headers)||{}};return i==="GET"?s:(s.headers=Object.assign({"Content-Type":"application/json"},e==null?void 0:e.headers),n&&(s.body=JSON.stringify(n)),Object.assign(Object.assign({},s),t))};function Lh(i,e,t,n,s,r){return pa(this,void 0,void 0,function*(){return new Promise((o,a)=>{i(t,ez(e,n,s,r)).then(l=>{if(!l.ok)throw l;return n!=null&&n.noResolveJson?l:l.json()}).then(l=>o(l)).catch(l=>ZV(l,a,n))})})}function _d(i,e,t,n){return pa(this,void 0,void 0,function*(){return Lh(i,"GET",e,t,n)})}function qr(i,e,t,n,s){return pa(this,void 0,void 0,function*(){return Lh(i,"POST",e,n,s,t)})}function tz(i,e,t,n,s){return pa(this,void 0,void 0,function*(){return Lh(i,"PUT",e,n,s,t)})}function nz(i,e,t,n){return pa(this,void 0,void 0,function*(){return Lh(i,"HEAD",e,Object.assign(Object.assign({},t),{noResolveJson:!0}),n)})}function nC(i,e,t,n,s){return pa(this,void 0,void 0,function*(){return Lh(i,"DELETE",e,n,s,t)})}var Si=function(i,e,t,n){function s(r){return r instanceof t?r:new t(function(o){o(r)})}return new(t||(t=Promise))(function(r,o){function a(h){try{c(n.next(h))}catch(u){o(u)}}function l(h){try{c(n.throw(h))}catch(u){o(u)}}function c(h){h.done?r(h.value):s(h.value).then(a,l)}c((n=n.apply(i,e||[])).next())})};const iz={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},Ey={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class sz{constructor(e,t={},n,s){this.url=e,this.headers=t,this.bucketId=n,this.fetch=tC(s)}uploadOrUpdate(e,t,n,s){return Si(this,void 0,void 0,function*(){try{let r;const o=Object.assign(Object.assign({},Ey),s);let a=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(o.upsert)});const l=o.metadata;typeof Blob<"u"&&n instanceof Blob?(r=new FormData,r.append("cacheControl",o.cacheControl),l&&r.append("metadata",this.encodeMetadata(l)),r.append("",n)):typeof FormData<"u"&&n instanceof FormData?(r=n,r.append("cacheControl",o.cacheControl),l&&r.append("metadata",this.encodeMetadata(l))):(r=n,a["cache-control"]="max-age=".concat(o.cacheControl),a["content-type"]=o.contentType,l&&(a["x-metadata"]=this.toBase64(this.encodeMetadata(l)))),s!=null&&s.headers&&(a=Object.assign(Object.assign({},a),s.headers));const c=this._removeEmptyFolders(t),h=this._getFinalPath(c),u=yield this.fetch("".concat(this.url,"/object/").concat(h),Object.assign({method:e,body:r,headers:a},o!=null&&o.duplex?{duplex:o.duplex}:{})),d=yield u.json();return u.ok?{data:{path:c,id:d.Id,fullPath:d.Key},error:null}:{data:null,error:d}}catch(r){if(Yn(r))return{data:null,error:r};throw r}})}upload(e,t,n){return Si(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,t,n)})}uploadToSignedUrl(e,t,n,s){return Si(this,void 0,void 0,function*(){const r=this._removeEmptyFolders(e),o=this._getFinalPath(r),a=new URL(this.url+"/object/upload/sign/".concat(o));a.searchParams.set("token",t);try{let l;const c=Object.assign({upsert:Ey.upsert},s),h=Object.assign(Object.assign({},this.headers),{"x-upsert":String(c.upsert)});typeof Blob<"u"&&n instanceof Blob?(l=new FormData,l.append("cacheControl",c.cacheControl),l.append("",n)):typeof FormData<"u"&&n instanceof FormData?(l=n,l.append("cacheControl",c.cacheControl)):(l=n,h["cache-control"]="max-age=".concat(c.cacheControl),h["content-type"]=c.contentType);const u=yield this.fetch(a.toString(),{method:"PUT",body:l,headers:h}),d=yield u.json();return u.ok?{data:{path:r,fullPath:d.Key},error:null}:{data:null,error:d}}catch(l){if(Yn(l))return{data:null,error:l};throw l}})}createSignedUploadUrl(e,t){return Si(this,void 0,void 0,function*(){try{let n=this._getFinalPath(e);const s=Object.assign({},this.headers);t!=null&&t.upsert&&(s["x-upsert"]="true");const r=yield qr(this.fetch,"".concat(this.url,"/object/upload/sign/").concat(n),{},{headers:s}),o=new URL(this.url+r.url),a=o.searchParams.get("token");if(!a)throw new sv("No token returned by API");return{data:{signedUrl:o.toString(),path:e,token:a},error:null}}catch(n){if(Yn(n))return{data:null,error:n};throw n}})}update(e,t,n){return Si(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,t,n)})}move(e,t,n){return Si(this,void 0,void 0,function*(){try{return{data:yield qr(this.fetch,"".concat(this.url,"/object/move"),{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:n==null?void 0:n.destinationBucket},{headers:this.headers}),error:null}}catch(s){if(Yn(s))return{data:null,error:s};throw s}})}copy(e,t,n){return Si(this,void 0,void 0,function*(){try{return{data:{path:(yield qr(this.fetch,"".concat(this.url,"/object/copy"),{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:n==null?void 0:n.destinationBucket},{headers:this.headers})).Key},error:null}}catch(s){if(Yn(s))return{data:null,error:s};throw s}})}createSignedUrl(e,t,n){return Si(this,void 0,void 0,function*(){try{let s=this._getFinalPath(e),r=yield qr(this.fetch,"".concat(this.url,"/object/sign/").concat(s),Object.assign({expiresIn:t},n!=null&&n.transform?{transform:n.transform}:{}),{headers:this.headers});const o=n!=null&&n.download?"&download=".concat(n.download===!0?"":n.download):"";return r={signedUrl:encodeURI("".concat(this.url).concat(r.signedURL).concat(o))},{data:r,error:null}}catch(s){if(Yn(s))return{data:null,error:s};throw s}})}createSignedUrls(e,t,n){return Si(this,void 0,void 0,function*(){try{const s=yield qr(this.fetch,"".concat(this.url,"/object/sign/").concat(this.bucketId),{expiresIn:t,paths:e},{headers:this.headers}),r=n!=null&&n.download?"&download=".concat(n.download===!0?"":n.download):"";return{data:s.map(o=>Object.assign(Object.assign({},o),{signedUrl:o.signedURL?encodeURI("".concat(this.url).concat(o.signedURL).concat(r)):null})),error:null}}catch(s){if(Yn(s))return{data:null,error:s};throw s}})}download(e,t){return Si(this,void 0,void 0,function*(){const s=typeof(t==null?void 0:t.transform)<"u"?"render/image/authenticated":"object",r=this.transformOptsToQueryString((t==null?void 0:t.transform)||{}),o=r?"?".concat(r):"";try{const a=this._getFinalPath(e);return{data:yield(yield _d(this.fetch,"".concat(this.url,"/").concat(s,"/").concat(a).concat(o),{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(a){if(Yn(a))return{data:null,error:a};throw a}})}info(e){return Si(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{const n=yield _d(this.fetch,"".concat(this.url,"/object/info/").concat(t),{headers:this.headers});return{data:AA(n),error:null}}catch(n){if(Yn(n))return{data:null,error:n};throw n}})}exists(e){return Si(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{return yield nz(this.fetch,"".concat(this.url,"/object/").concat(t),{headers:this.headers}),{data:!0,error:null}}catch(n){if(Yn(n)&&n instanceof mA){const s=n.originalError;if([400,404].includes(s==null?void 0:s.status))return{data:!1,error:n}}throw n}})}getPublicUrl(e,t){const n=this._getFinalPath(e),s=[],r=t!=null&&t.download?"download=".concat(t.download===!0?"":t.download):"";r!==""&&s.push(r);const a=typeof(t==null?void 0:t.transform)<"u"?"render/image":"object",l=this.transformOptsToQueryString((t==null?void 0:t.transform)||{});l!==""&&s.push(l);let c=s.join("&");return c!==""&&(c="?".concat(c)),{data:{publicUrl:encodeURI("".concat(this.url,"/").concat(a,"/public/").concat(n).concat(c))}}}remove(e){return Si(this,void 0,void 0,function*(){try{return{data:yield nC(this.fetch,"".concat(this.url,"/object/").concat(this.bucketId),{prefixes:e},{headers:this.headers}),error:null}}catch(t){if(Yn(t))return{data:null,error:t};throw t}})}list(e,t,n){return Si(this,void 0,void 0,function*(){try{const s=Object.assign(Object.assign(Object.assign({},iz),t),{prefix:e||""});return{data:yield qr(this.fetch,"".concat(this.url,"/object/list/").concat(this.bucketId),s,{headers:this.headers},n),error:null}}catch(s){if(Yn(s))return{data:null,error:s};throw s}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return typeof Buffer<"u"?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return"".concat(this.bucketId,"/").concat(e)}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push("width=".concat(e.width)),e.height&&t.push("height=".concat(e.height)),e.resize&&t.push("resize=".concat(e.resize)),e.format&&t.push("format=".concat(e.format)),e.quality&&t.push("quality=".concat(e.quality)),t.join("&")}}const rz="2.7.1",oz={"X-Client-Info":"storage-js/".concat(rz)};var ka=function(i,e,t,n){function s(r){return r instanceof t?r:new t(function(o){o(r)})}return new(t||(t=Promise))(function(r,o){function a(h){try{c(n.next(h))}catch(u){o(u)}}function l(h){try{c(n.throw(h))}catch(u){o(u)}}function c(h){h.done?r(h.value):s(h.value).then(a,l)}c((n=n.apply(i,e||[])).next())})};class az{constructor(e,t={},n){this.url=e,this.headers=Object.assign(Object.assign({},oz),t),this.fetch=tC(n)}listBuckets(){return ka(this,void 0,void 0,function*(){try{return{data:yield _d(this.fetch,"".concat(this.url,"/bucket"),{headers:this.headers}),error:null}}catch(e){if(Yn(e))return{data:null,error:e};throw e}})}getBucket(e){return ka(this,void 0,void 0,function*(){try{return{data:yield _d(this.fetch,"".concat(this.url,"/bucket/").concat(e),{headers:this.headers}),error:null}}catch(t){if(Yn(t))return{data:null,error:t};throw t}})}createBucket(e,t={public:!1}){return ka(this,void 0,void 0,function*(){try{return{data:yield qr(this.fetch,"".concat(this.url,"/bucket"),{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(n){if(Yn(n))return{data:null,error:n};throw n}})}updateBucket(e,t){return ka(this,void 0,void 0,function*(){try{return{data:yield tz(this.fetch,"".concat(this.url,"/bucket/").concat(e),{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(n){if(Yn(n))return{data:null,error:n};throw n}})}emptyBucket(e){return ka(this,void 0,void 0,function*(){try{return{data:yield qr(this.fetch,"".concat(this.url,"/bucket/").concat(e,"/empty"),{},{headers:this.headers}),error:null}}catch(t){if(Yn(t))return{data:null,error:t};throw t}})}deleteBucket(e){return ka(this,void 0,void 0,function*(){try{return{data:yield nC(this.fetch,"".concat(this.url,"/bucket/").concat(e),{},{headers:this.headers}),error:null}}catch(t){if(Yn(t))return{data:null,error:t};throw t}})}}class lz extends az{constructor(e,t={},n){super(e,t,n)}from(e){return new sz(this.url,this.headers,e,this.fetch)}}const cz="2.49.4";let cc="";typeof Deno<"u"?cc="deno":typeof document<"u"?cc="web":typeof navigator<"u"&&navigator.product==="ReactNative"?cc="react-native":cc="node";const hz={"X-Client-Info":"supabase-js-".concat(cc,"/").concat(cz)},uz={headers:hz},dz={schema:"public"},fz={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},pz={};var mz=function(i,e,t,n){function s(r){return r instanceof t?r:new t(function(o){o(r)})}return new(t||(t=Promise))(function(r,o){function a(h){try{c(n.next(h))}catch(u){o(u)}}function l(h){try{c(n.throw(h))}catch(u){o(u)}}function c(h){h.done?r(h.value):s(h.value).then(a,l)}c((n=n.apply(i,e||[])).next())})};const Az=i=>{let e;return i?e=i:typeof fetch>"u"?e=QE:e=fetch,(...t)=>e(...t)},gz=()=>typeof Headers>"u"?VE:Headers,vz=(i,e,t)=>{const n=Az(t),s=gz();return(r,o)=>mz(void 0,void 0,void 0,function*(){var a;const l=(a=yield e())!==null&&a!==void 0?a:i;let c=new s(o==null?void 0:o.headers);return c.has("apikey")||c.set("apikey",i),c.has("Authorization")||c.set("Authorization","Bearer ".concat(l)),n(r,Object.assign(Object.assign({},o),{headers:c}))})};var _z=function(i,e,t,n){function s(r){return r instanceof t?r:new t(function(o){o(r)})}return new(t||(t=Promise))(function(r,o){function a(h){try{c(n.next(h))}catch(u){o(u)}}function l(h){try{c(n.throw(h))}catch(u){o(u)}}function c(h){h.done?r(h.value):s(h.value).then(a,l)}c((n=n.apply(i,e||[])).next())})};function yz(i){return i.replace(/\/$/,"")}function xz(i,e){const{db:t,auth:n,realtime:s,global:r}=i,{db:o,auth:a,realtime:l,global:c}=e,h={db:Object.assign(Object.assign({},o),t),auth:Object.assign(Object.assign({},a),n),realtime:Object.assign(Object.assign({},l),s),global:Object.assign(Object.assign({},c),r),accessToken:()=>_z(this,void 0,void 0,function*(){return""})};return i.accessToken?h.accessToken=i.accessToken:delete h.accessToken,h}const iC="2.69.1",Ga=30*1e3,gA=3,Hp=gA*Ga,wz="http://localhost:9999",bz="supabase.auth.token",Ez={"X-Client-Info":"gotrue-js/".concat(iC)},vA="X-Supabase-Api-Version",sC={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},Cz=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,Sz=6e5;class rv extends Error{constructor(e,t,n){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=n}}function Tt(i){return typeof i=="object"&&i!==null&&"__isAuthError"in i}class Iz extends rv{constructor(e,t,n){super(e,t,n),this.name="AuthApiError",this.status=t,this.code=n}}function Mz(i){return Tt(i)&&i.name==="AuthApiError"}class rC extends rv{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class go extends rv{constructor(e,t,n,s){super(e,n,s),this.name=t,this.status=n}}class Vr extends go{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function Tz(i){return Tt(i)&&i.name==="AuthSessionMissingError"}class Wp extends go{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class Su extends go{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class Iu extends go{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function Bz(i){return Tt(i)&&i.name==="AuthImplicitGrantRedirectError"}class Cy extends go{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class _A extends go{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}}function qp(i){return Tt(i)&&i.name==="AuthRetryableFetchError"}class Sy extends go{constructor(e,t,n){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=n}}class Lc extends go{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const Iy="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),My=" 	\n\r=".split(""),Rz=(()=>{const i=new Array(128);for(let e=0;e<i.length;e+=1)i[e]=-1;for(let e=0;e<My.length;e+=1)i[My[e].charCodeAt(0)]=-2;for(let e=0;e<Iy.length;e+=1)i[Iy[e].charCodeAt(0)]=e;return i})();function oC(i,e,t){const n=Rz[i];if(n>-1)for(e.queue=e.queue<<6|n,e.queuedBits+=6;e.queuedBits>=8;)t(e.queue>>e.queuedBits-8&255),e.queuedBits-=8;else{if(n===-2)return;throw new Error('Invalid Base64-URL character "'.concat(String.fromCharCode(i),'"'))}}function Ty(i){const e=[],t=o=>{e.push(String.fromCodePoint(o))},n={utf8seq:0,codepoint:0},s={queue:0,queuedBits:0},r=o=>{Lz(o,n,t)};for(let o=0;o<i.length;o+=1)oC(i.charCodeAt(o),s,r);return e.join("")}function Pz(i,e){if(i<=127){e(i);return}else if(i<=2047){e(192|i>>6),e(128|i&63);return}else if(i<=65535){e(224|i>>12),e(128|i>>6&63),e(128|i&63);return}else if(i<=1114111){e(240|i>>18),e(128|i>>12&63),e(128|i>>6&63),e(128|i&63);return}throw new Error("Unrecognized Unicode codepoint: ".concat(i.toString(16)))}function Dz(i,e){for(let t=0;t<i.length;t+=1){let n=i.charCodeAt(t);if(n>55295&&n<=56319){const s=(n-55296)*1024&65535;n=(i.charCodeAt(t+1)-56320&65535|s)+65536,t+=1}Pz(n,e)}}function Lz(i,e,t){if(e.utf8seq===0){if(i<=127){t(i);return}for(let n=1;n<6;n+=1)if(!(i>>7-n&1)){e.utf8seq=n;break}if(e.utf8seq===2)e.codepoint=i&31;else if(e.utf8seq===3)e.codepoint=i&15;else if(e.utf8seq===4)e.codepoint=i&7;else throw new Error("Invalid UTF-8 sequence");e.utf8seq-=1}else if(e.utf8seq>0){if(i<=127)throw new Error("Invalid UTF-8 sequence");e.codepoint=e.codepoint<<6|i&63,e.utf8seq-=1,e.utf8seq===0&&t(e.codepoint)}}function Fz(i){const e=[],t={queue:0,queuedBits:0},n=s=>{e.push(s)};for(let s=0;s<i.length;s+=1)oC(i.charCodeAt(s),t,n);return new Uint8Array(e)}function Nz(i){const e=[];return Dz(i,t=>e.push(t)),new Uint8Array(e)}function kz(i){return Math.round(Date.now()/1e3)+i}function Oz(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(i){const e=Math.random()*16|0;return(i=="x"?e:e&3|8).toString(16)})}const Rs=()=>typeof window<"u"&&typeof document<"u",Bo={tested:!1,writable:!1},Fc=()=>{if(!Rs())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch(e){return!1}if(Bo.tested)return Bo.writable;const i="lswt-".concat(Math.random()).concat(Math.random());try{globalThis.localStorage.setItem(i,i),globalThis.localStorage.removeItem(i),Bo.tested=!0,Bo.writable=!0}catch(e){Bo.tested=!0,Bo.writable=!1}return Bo.writable};function Uz(i){const e={},t=new URL(i);if(t.hash&&t.hash[0]==="#")try{new URLSearchParams(t.hash.substring(1)).forEach((s,r)=>{e[r]=s})}catch(n){}return t.searchParams.forEach((n,s)=>{e[s]=n}),e}const aC=i=>{let e;return i?e=i:typeof fetch>"u"?e=(...t)=>bl(async()=>{const{default:n}=await Promise.resolve().then(()=>Ul);return{default:n}},void 0).then(({default:n})=>n(...t)):e=fetch,(...t)=>e(...t)},Qz=i=>typeof i=="object"&&i!==null&&"status"in i&&"ok"in i&&"json"in i&&typeof i.json=="function",lC=async(i,e,t)=>{await i.setItem(e,JSON.stringify(t))},Mu=async(i,e)=>{const t=await i.getItem(e);if(!t)return null;try{return JSON.parse(t)}catch(n){return t}},Tu=async(i,e)=>{await i.removeItem(e)};class hf{constructor(){this.promise=new hf.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}hf.promiseConstructor=Promise;function jp(i){const e=i.split(".");if(e.length!==3)throw new Lc("Invalid JWT structure");for(let n=0;n<e.length;n++)if(!Cz.test(e[n]))throw new Lc("JWT not in base64url format");return{header:JSON.parse(Ty(e[0])),payload:JSON.parse(Ty(e[1])),signature:Fz(e[2]),raw:{header:e[0],payload:e[1]}}}async function Vz(i){return await new Promise(e=>{setTimeout(()=>e(null),i)})}function zz(i,e){return new Promise((n,s)=>{(async()=>{for(let r=0;r<1/0;r++)try{const o=await i(r);if(!e(r,null,o)){n(o);return}}catch(o){if(!e(r,o)){s(o);return}}})()})}function Gz(i){return("0"+i.toString(16)).substr(-2)}function Hz(){const e=new Uint32Array(56);if(typeof crypto>"u"){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",n=t.length;let s="";for(let r=0;r<56;r++)s+=t.charAt(Math.floor(Math.random()*n));return s}return crypto.getRandomValues(e),Array.from(e,Gz).join("")}async function Wz(i){const t=new TextEncoder().encode(i),n=await crypto.subtle.digest("SHA-256",t),s=new Uint8Array(n);return Array.from(s).map(r=>String.fromCharCode(r)).join("")}async function qz(i){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),i;const t=await Wz(i);return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function Oa(i,e,t=!1){const n=Hz();let s=n;t&&(s+="/PASSWORD_RECOVERY"),await lC(i,"".concat(e,"-code-verifier"),s);const r=await qz(n);return[r,n===r?"plain":"s256"]}const jz=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function Xz(i){const e=i.headers.get(vA);if(!e||!e.match(jz))return null;try{return new Date("".concat(e,"T00:00:00.0Z"))}catch(t){return null}}function Yz(i){if(!i)throw new Error("Missing exp claim");const e=Math.floor(Date.now()/1e3);if(i<=e)throw new Error("JWT has expired")}function Kz(i){switch(i){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}var $z=function(i,e){var t={};for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&e.indexOf(n)<0&&(t[n]=i[n]);if(i!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,n=Object.getOwnPropertySymbols(i);s<n.length;s++)e.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(i,n[s])&&(t[n[s]]=i[n[s]]);return t};const Fo=i=>i.msg||i.message||i.error_description||i.error||JSON.stringify(i),Jz=[502,503,504];async function By(i){var e;if(!Qz(i))throw new _A(Fo(i),0);if(Jz.includes(i.status))throw new _A(Fo(i),i.status);let t;try{t=await i.json()}catch(r){throw new rC(Fo(r),r)}let n;const s=Xz(i);if(s&&s.getTime()>=sC["2024-01-01"].timestamp&&typeof t=="object"&&t&&typeof t.code=="string"?n=t.code:typeof t=="object"&&t&&typeof t.error_code=="string"&&(n=t.error_code),n){if(n==="weak_password")throw new Sy(Fo(t),i.status,((e=t.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(n==="session_not_found")throw new Vr}else if(typeof t=="object"&&t&&typeof t.weak_password=="object"&&t.weak_password&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.reasons.reduce((r,o)=>r&&typeof o=="string",!0))throw new Sy(Fo(t),i.status,t.weak_password.reasons);throw new Iz(Fo(t),i.status||500,n)}const Zz=(i,e,t,n)=>{const s={method:i,headers:(e==null?void 0:e.headers)||{}};return i==="GET"?s:(s.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e==null?void 0:e.headers),s.body=JSON.stringify(n),Object.assign(Object.assign({},s),t))};async function kt(i,e,t,n){var s;const r=Object.assign({},n==null?void 0:n.headers);r[vA]||(r[vA]=sC["2024-01-01"].name),n!=null&&n.jwt&&(r.Authorization="Bearer ".concat(n.jwt));const o=(s=n==null?void 0:n.query)!==null&&s!==void 0?s:{};n!=null&&n.redirectTo&&(o.redirect_to=n.redirectTo);const a=Object.keys(o).length?"?"+new URLSearchParams(o).toString():"",l=await eG(i,e,t+a,{headers:r,noResolveJson:n==null?void 0:n.noResolveJson},{},n==null?void 0:n.body);return n!=null&&n.xform?n==null?void 0:n.xform(l):{data:Object.assign({},l),error:null}}async function eG(i,e,t,n,s,r){const o=Zz(e,n,s,r);let a;try{a=await i(t,Object.assign({},o))}catch(l){throw console.error(l),new _A(Fo(l),0)}if(a.ok||await By(a),n!=null&&n.noResolveJson)return a;try{return await a.json()}catch(l){await By(l)}}function zr(i){var e;let t=null;sG(i)&&(t=Object.assign({},i),i.expires_at||(t.expires_at=kz(i.expires_in)));const n=(e=i.user)!==null&&e!==void 0?e:i;return{data:{session:t,user:n},error:null}}function Ry(i){const e=zr(i);return!e.error&&i.weak_password&&typeof i.weak_password=="object"&&Array.isArray(i.weak_password.reasons)&&i.weak_password.reasons.length&&i.weak_password.message&&typeof i.weak_password.message=="string"&&i.weak_password.reasons.reduce((t,n)=>t&&typeof n=="string",!0)&&(e.data.weak_password=i.weak_password),e}function jr(i){var e;return{data:{user:(e=i.user)!==null&&e!==void 0?e:i},error:null}}function tG(i){return{data:i,error:null}}function nG(i){const{action_link:e,email_otp:t,hashed_token:n,redirect_to:s,verification_type:r}=i,o=$z(i,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),a={action_link:e,email_otp:t,hashed_token:n,redirect_to:s,verification_type:r},l=Object.assign({},o);return{data:{properties:a,user:l},error:null}}function iG(i){return i}function sG(i){return i.access_token&&i.refresh_token&&i.expires_in}var rG=function(i,e){var t={};for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&e.indexOf(n)<0&&(t[n]=i[n]);if(i!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,n=Object.getOwnPropertySymbols(i);s<n.length;s++)e.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(i,n[s])&&(t[n[s]]=i[n[s]]);return t};class oG{constructor({url:e="",headers:t={},fetch:n}){this.url=e,this.headers=t,this.fetch=aC(n),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(e,t="global"){try{return await kt(this.fetch,"POST","".concat(this.url,"/logout?scope=").concat(t),{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(n){if(Tt(n))return{data:null,error:n};throw n}}async inviteUserByEmail(e,t={}){try{return await kt(this.fetch,"POST","".concat(this.url,"/invite"),{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:jr})}catch(n){if(Tt(n))return{data:{user:null},error:n};throw n}}async generateLink(e){try{const{options:t}=e,n=rG(e,["options"]),s=Object.assign(Object.assign({},n),t);return"newEmail"in n&&(s.new_email=n==null?void 0:n.newEmail,delete s.newEmail),await kt(this.fetch,"POST","".concat(this.url,"/admin/generate_link"),{body:s,headers:this.headers,xform:nG,redirectTo:t==null?void 0:t.redirectTo})}catch(t){if(Tt(t))return{data:{properties:null,user:null},error:t};throw t}}async createUser(e){try{return await kt(this.fetch,"POST","".concat(this.url,"/admin/users"),{body:e,headers:this.headers,xform:jr})}catch(t){if(Tt(t))return{data:{user:null},error:t};throw t}}async listUsers(e){var t,n,s,r,o,a,l;try{const c={nextPage:null,lastPage:0,total:0},h=await kt(this.fetch,"GET","".concat(this.url,"/admin/users"),{headers:this.headers,noResolveJson:!0,query:{page:(n=(t=e==null?void 0:e.page)===null||t===void 0?void 0:t.toString())!==null&&n!==void 0?n:"",per_page:(r=(s=e==null?void 0:e.perPage)===null||s===void 0?void 0:s.toString())!==null&&r!==void 0?r:""},xform:iG});if(h.error)throw h.error;const u=await h.json(),d=(o=h.headers.get("x-total-count"))!==null&&o!==void 0?o:0,f=(l=(a=h.headers.get("link"))===null||a===void 0?void 0:a.split(","))!==null&&l!==void 0?l:[];return f.length>0&&(f.forEach(p=>{const A=parseInt(p.split(";")[0].split("=")[1].substring(0,1)),m=JSON.parse(p.split(";")[1].split("=")[1]);c["".concat(m,"Page")]=A}),c.total=parseInt(d)),{data:Object.assign(Object.assign({},u),c),error:null}}catch(c){if(Tt(c))return{data:{users:[]},error:c};throw c}}async getUserById(e){try{return await kt(this.fetch,"GET","".concat(this.url,"/admin/users/").concat(e),{headers:this.headers,xform:jr})}catch(t){if(Tt(t))return{data:{user:null},error:t};throw t}}async updateUserById(e,t){try{return await kt(this.fetch,"PUT","".concat(this.url,"/admin/users/").concat(e),{body:t,headers:this.headers,xform:jr})}catch(n){if(Tt(n))return{data:{user:null},error:n};throw n}}async deleteUser(e,t=!1){try{return await kt(this.fetch,"DELETE","".concat(this.url,"/admin/users/").concat(e),{headers:this.headers,body:{should_soft_delete:t},xform:jr})}catch(n){if(Tt(n))return{data:{user:null},error:n};throw n}}async _listFactors(e){try{const{data:t,error:n}=await kt(this.fetch,"GET","".concat(this.url,"/admin/users/").concat(e.userId,"/factors"),{headers:this.headers,xform:s=>({data:{factors:s},error:null})});return{data:t,error:n}}catch(t){if(Tt(t))return{data:null,error:t};throw t}}async _deleteFactor(e){try{return{data:await kt(this.fetch,"DELETE","".concat(this.url,"/admin/users/").concat(e.userId,"/factors/").concat(e.id),{headers:this.headers}),error:null}}catch(t){if(Tt(t))return{data:null,error:t};throw t}}}const aG={getItem:i=>Fc()?globalThis.localStorage.getItem(i):null,setItem:(i,e)=>{Fc()&&globalThis.localStorage.setItem(i,e)},removeItem:i=>{Fc()&&globalThis.localStorage.removeItem(i)}};function Py(i={}){return{getItem:e=>i[e]||null,setItem:(e,t)=>{i[e]=t},removeItem:e=>{delete i[e]}}}function lG(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch(i){typeof self<"u"&&(self.globalThis=self)}}const Ua={debug:!!(globalThis&&Fc()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class cC extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class cG extends cC{}async function hG(i,e,t){Ua.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",i,e);const n=new globalThis.AbortController;return e>0&&setTimeout(()=>{n.abort(),Ua.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",i)},e),await Promise.resolve().then(()=>globalThis.navigator.locks.request(i,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:n.signal},async s=>{if(s){Ua.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",i,s.name);try{return await t()}finally{Ua.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",i,s.name)}}else{if(e===0)throw Ua.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",i),new cG('Acquiring an exclusive Navigator LockManager lock "'.concat(i,'" immediately failed'));if(Ua.debug)try{const r=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(r,null,"  "))}catch(r){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",r)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await t()}}))}lG();const uG={url:wz,storageKey:bz,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:Ez,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};async function Dy(i,e,t){return await t()}class ah{constructor(e){var t,n;this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=ah.nextInstanceID,ah.nextInstanceID+=1,this.instanceID>0&&Rs()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const s=Object.assign(Object.assign({},uG),e);if(this.logDebugMessages=!!s.debug,typeof s.debug=="function"&&(this.logger=s.debug),this.persistSession=s.persistSession,this.storageKey=s.storageKey,this.autoRefreshToken=s.autoRefreshToken,this.admin=new oG({url:s.url,headers:s.headers,fetch:s.fetch}),this.url=s.url,this.headers=s.headers,this.fetch=aC(s.fetch),this.lock=s.lock||Dy,this.detectSessionInUrl=s.detectSessionInUrl,this.flowType=s.flowType,this.hasCustomAuthorizationHeader=s.hasCustomAuthorizationHeader,s.lock?this.lock=s.lock:Rs()&&(!((t=globalThis==null?void 0:globalThis.navigator)===null||t===void 0)&&t.locks)?this.lock=hG:this.lock=Dy,this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER,this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?s.storage?this.storage=s.storage:Fc()?this.storage=aG:(this.memoryStorage={},this.storage=Py(this.memoryStorage)):(this.memoryStorage={},this.storage=Py(this.memoryStorage)),Rs()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(r){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",r)}(n=this.broadcastChannel)===null||n===void 0||n.addEventListener("message",async r=>{this._debug("received broadcast notification from other tab or client",r),await this._notifyAllSubscribers(r.data.event,r.data.session,!1)})}this.initialize()}_debug(...e){return this.logDebugMessages&&this.logger("GoTrueClient@".concat(this.instanceID," (").concat(iC,") ").concat(new Date().toISOString()),...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{const t=Uz(window.location.href);let n="none";if(this._isImplicitGrantCallback(t)?n="implicit":await this._isPKCECallback(t)&&(n="pkce"),Rs()&&this.detectSessionInUrl&&n!=="none"){const{data:s,error:r}=await this._getSessionFromURL(t,n);if(r){if(this._debug("#_initialize()","error detecting session from URL",r),Bz(r)){const l=(e=r.details)===null||e===void 0?void 0:e.code;if(l==="identity_already_exists"||l==="identity_not_found"||l==="single_identity_not_deletable")return{error:r}}return await this._removeSession(),{error:r}}const{session:o,redirectType:a}=s;return this._debug("#_initialize()","detected session in URL",o,"redirect type",a),await this._saveSession(o),setTimeout(async()=>{a==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",o):await this._notifyAllSubscribers("SIGNED_IN",o)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(t){return Tt(t)?{error:t}:{error:new rC("Unexpected error during initialization",t)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var t,n,s;try{const r=await kt(this.fetch,"POST","".concat(this.url,"/signup"),{headers:this.headers,body:{data:(n=(t=e==null?void 0:e.options)===null||t===void 0?void 0:t.data)!==null&&n!==void 0?n:{},gotrue_meta_security:{captcha_token:(s=e==null?void 0:e.options)===null||s===void 0?void 0:s.captchaToken}},xform:zr}),{data:o,error:a}=r;if(a||!o)return{data:{user:null,session:null},error:a};const l=o.session,c=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",l)),{data:{user:c,session:l},error:null}}catch(r){if(Tt(r))return{data:{user:null,session:null},error:r};throw r}}async signUp(e){var t,n,s;try{let r;if("email"in e){const{email:h,password:u,options:d}=e;let f=null,p=null;this.flowType==="pkce"&&([f,p]=await Oa(this.storage,this.storageKey)),r=await kt(this.fetch,"POST","".concat(this.url,"/signup"),{headers:this.headers,redirectTo:d==null?void 0:d.emailRedirectTo,body:{email:h,password:u,data:(t=d==null?void 0:d.data)!==null&&t!==void 0?t:{},gotrue_meta_security:{captcha_token:d==null?void 0:d.captchaToken},code_challenge:f,code_challenge_method:p},xform:zr})}else if("phone"in e){const{phone:h,password:u,options:d}=e;r=await kt(this.fetch,"POST","".concat(this.url,"/signup"),{headers:this.headers,body:{phone:h,password:u,data:(n=d==null?void 0:d.data)!==null&&n!==void 0?n:{},channel:(s=d==null?void 0:d.channel)!==null&&s!==void 0?s:"sms",gotrue_meta_security:{captcha_token:d==null?void 0:d.captchaToken}},xform:zr})}else throw new Su("You must provide either an email or phone number and a password");const{data:o,error:a}=r;if(a||!o)return{data:{user:null,session:null},error:a};const l=o.session,c=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",l)),{data:{user:c,session:l},error:null}}catch(r){if(Tt(r))return{data:{user:null,session:null},error:r};throw r}}async signInWithPassword(e){try{let t;if("email"in e){const{email:r,password:o,options:a}=e;t=await kt(this.fetch,"POST","".concat(this.url,"/token?grant_type=password"),{headers:this.headers,body:{email:r,password:o,gotrue_meta_security:{captcha_token:a==null?void 0:a.captchaToken}},xform:Ry})}else if("phone"in e){const{phone:r,password:o,options:a}=e;t=await kt(this.fetch,"POST","".concat(this.url,"/token?grant_type=password"),{headers:this.headers,body:{phone:r,password:o,gotrue_meta_security:{captcha_token:a==null?void 0:a.captchaToken}},xform:Ry})}else throw new Su("You must provide either an email or phone number and a password");const{data:n,error:s}=t;return s?{data:{user:null,session:null},error:s}:!n||!n.session||!n.user?{data:{user:null,session:null},error:new Wp}:(n.session&&(await this._saveSession(n.session),await this._notifyAllSubscribers("SIGNED_IN",n.session)),{data:Object.assign({user:n.user,session:n.session},n.weak_password?{weakPassword:n.weak_password}:null),error:s})}catch(t){if(Tt(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOAuth(e){var t,n,s,r;return await this._handleProviderSignIn(e.provider,{redirectTo:(t=e.options)===null||t===void 0?void 0:t.redirectTo,scopes:(n=e.options)===null||n===void 0?void 0:n.scopes,queryParams:(s=e.options)===null||s===void 0?void 0:s.queryParams,skipBrowserRedirect:(r=e.options)===null||r===void 0?void 0:r.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async _exchangeCodeForSession(e){const t=await Mu(this.storage,"".concat(this.storageKey,"-code-verifier")),[n,s]=(t!=null?t:"").split("/");try{const{data:r,error:o}=await kt(this.fetch,"POST","".concat(this.url,"/token?grant_type=pkce"),{headers:this.headers,body:{auth_code:e,code_verifier:n},xform:zr});if(await Tu(this.storage,"".concat(this.storageKey,"-code-verifier")),o)throw o;return!r||!r.session||!r.user?{data:{user:null,session:null,redirectType:null},error:new Wp}:(r.session&&(await this._saveSession(r.session),await this._notifyAllSubscribers("SIGNED_IN",r.session)),{data:Object.assign(Object.assign({},r),{redirectType:s!=null?s:null}),error:o})}catch(r){if(Tt(r))return{data:{user:null,session:null,redirectType:null},error:r};throw r}}async signInWithIdToken(e){try{const{options:t,provider:n,token:s,access_token:r,nonce:o}=e,a=await kt(this.fetch,"POST","".concat(this.url,"/token?grant_type=id_token"),{headers:this.headers,body:{provider:n,id_token:s,access_token:r,nonce:o,gotrue_meta_security:{captcha_token:t==null?void 0:t.captchaToken}},xform:zr}),{data:l,error:c}=a;return c?{data:{user:null,session:null},error:c}:!l||!l.session||!l.user?{data:{user:null,session:null},error:new Wp}:(l.session&&(await this._saveSession(l.session),await this._notifyAllSubscribers("SIGNED_IN",l.session)),{data:l,error:c})}catch(t){if(Tt(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOtp(e){var t,n,s,r,o;try{if("email"in e){const{email:a,options:l}=e;let c=null,h=null;this.flowType==="pkce"&&([c,h]=await Oa(this.storage,this.storageKey));const{error:u}=await kt(this.fetch,"POST","".concat(this.url,"/otp"),{headers:this.headers,body:{email:a,data:(t=l==null?void 0:l.data)!==null&&t!==void 0?t:{},create_user:(n=l==null?void 0:l.shouldCreateUser)!==null&&n!==void 0?n:!0,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken},code_challenge:c,code_challenge_method:h},redirectTo:l==null?void 0:l.emailRedirectTo});return{data:{user:null,session:null},error:u}}if("phone"in e){const{phone:a,options:l}=e,{data:c,error:h}=await kt(this.fetch,"POST","".concat(this.url,"/otp"),{headers:this.headers,body:{phone:a,data:(s=l==null?void 0:l.data)!==null&&s!==void 0?s:{},create_user:(r=l==null?void 0:l.shouldCreateUser)!==null&&r!==void 0?r:!0,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken},channel:(o=l==null?void 0:l.channel)!==null&&o!==void 0?o:"sms"}});return{data:{user:null,session:null,messageId:c==null?void 0:c.message_id},error:h}}throw new Su("You must provide either an email or phone number.")}catch(a){if(Tt(a))return{data:{user:null,session:null},error:a};throw a}}async verifyOtp(e){var t,n;try{let s,r;"options"in e&&(s=(t=e.options)===null||t===void 0?void 0:t.redirectTo,r=(n=e.options)===null||n===void 0?void 0:n.captchaToken);const{data:o,error:a}=await kt(this.fetch,"POST","".concat(this.url,"/verify"),{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:r}}),redirectTo:s,xform:zr});if(a)throw a;if(!o)throw new Error("An error occurred on token verification.");const l=o.session,c=o.user;return l!=null&&l.access_token&&(await this._saveSession(l),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",l)),{data:{user:c,session:l},error:null}}catch(s){if(Tt(s))return{data:{user:null,session:null},error:s};throw s}}async signInWithSSO(e){var t,n,s;try{let r=null,o=null;return this.flowType==="pkce"&&([r,o]=await Oa(this.storage,this.storageKey)),await kt(this.fetch,"POST","".concat(this.url,"/sso"),{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(n=(t=e.options)===null||t===void 0?void 0:t.redirectTo)!==null&&n!==void 0?n:void 0}),!((s=e==null?void 0:e.options)===null||s===void 0)&&s.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:r,code_challenge_method:o}),headers:this.headers,xform:tG})}catch(r){if(Tt(r))return{data:null,error:r};throw r}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:t},error:n}=e;if(n)throw n;if(!t)throw new Vr;const{error:s}=await kt(this.fetch,"GET","".concat(this.url,"/reauthenticate"),{headers:this.headers,jwt:t.access_token});return{data:{user:null,session:null},error:s}})}catch(e){if(Tt(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{const t="".concat(this.url,"/resend");if("email"in e){const{email:n,type:s,options:r}=e,{error:o}=await kt(this.fetch,"POST",t,{headers:this.headers,body:{email:n,type:s,gotrue_meta_security:{captcha_token:r==null?void 0:r.captchaToken}},redirectTo:r==null?void 0:r.emailRedirectTo});return{data:{user:null,session:null},error:o}}else if("phone"in e){const{phone:n,type:s,options:r}=e,{data:o,error:a}=await kt(this.fetch,"POST",t,{headers:this.headers,body:{phone:n,type:s,gotrue_meta_security:{captcha_token:r==null?void 0:r.captchaToken}}});return{data:{user:null,session:null,messageId:o==null?void 0:o.message_id},error:a}}throw new Su("You must provide either an email or phone number and a type")}catch(t){if(Tt(t))return{data:{user:null,session:null},error:t};throw t}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async t=>t))}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const n=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),s=(async()=>(await n,await t()))();return this.pendingInLock.push((async()=>{try{await s}catch(r){}})()),s}return await this.lock("lock:".concat(this.storageKey),e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const n=t();for(this.pendingInLock.push((async()=>{try{await n}catch(s){}})()),await n;this.pendingInLock.length;){const s=[...this.pendingInLock];await Promise.all(s),this.pendingInLock.splice(0,s.length)}return await n}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const t=await this.__loadSession();return await e(t)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const t=await Mu(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),t!==null&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const n=e.expires_at?e.expires_at*1e3-Date.now()<Hp:!1;if(this._debug("#__loadSession()","session has".concat(n?"":" not"," expired"),"expires_at",e.expires_at),!n){if(this.storage.isServer){let o=this.suppressGetSessionWarning;e=new Proxy(e,{get:(l,c,h)=>(!o&&c==="user"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),o=!0,this.suppressGetSessionWarning=!0),Reflect.get(l,c,h))})}return{data:{session:e},error:null}}const{session:s,error:r}=await this._callRefreshToken(e.refresh_token);return r?{data:{session:null},error:r}:{data:{session:s},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(e){return e?await this._getUser(e):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(e){try{return e?await kt(this.fetch,"GET","".concat(this.url,"/user"),{headers:this.headers,jwt:e,xform:jr}):await this._useSession(async t=>{var n,s,r;const{data:o,error:a}=t;if(a)throw a;return!(!((n=o.session)===null||n===void 0)&&n.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new Vr}:await kt(this.fetch,"GET","".concat(this.url,"/user"),{headers:this.headers,jwt:(r=(s=o.session)===null||s===void 0?void 0:s.access_token)!==null&&r!==void 0?r:void 0,xform:jr})})}catch(t){if(Tt(t))return Tz(t)&&(await this._removeSession(),await Tu(this.storage,"".concat(this.storageKey,"-code-verifier"))),{data:{user:null},error:t};throw t}}async updateUser(e,t={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,t))}async _updateUser(e,t={}){try{return await this._useSession(async n=>{const{data:s,error:r}=n;if(r)throw r;if(!s.session)throw new Vr;const o=s.session;let a=null,l=null;this.flowType==="pkce"&&e.email!=null&&([a,l]=await Oa(this.storage,this.storageKey));const{data:c,error:h}=await kt(this.fetch,"PUT","".concat(this.url,"/user"),{headers:this.headers,redirectTo:t==null?void 0:t.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:a,code_challenge_method:l}),jwt:o.access_token,xform:jr});if(h)throw h;return o.user=c.user,await this._saveSession(o),await this._notifyAllSubscribers("USER_UPDATED",o),{data:{user:o.user},error:null}})}catch(n){if(Tt(n))return{data:{user:null},error:n};throw n}}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new Vr;const t=Date.now()/1e3;let n=t,s=!0,r=null;const{payload:o}=jp(e.access_token);if(o.exp&&(n=o.exp,s=n<=t),s){const{session:a,error:l}=await this._callRefreshToken(e.refresh_token);if(l)return{data:{user:null,session:null},error:l};if(!a)return{data:{user:null,session:null},error:null};r=a}else{const{data:a,error:l}=await this._getUser(e.access_token);if(l)throw l;r={access_token:e.access_token,refresh_token:e.refresh_token,user:a.user,token_type:"bearer",expires_in:n-t,expires_at:n},await this._saveSession(r),await this._notifyAllSubscribers("SIGNED_IN",r)}return{data:{user:r.user,session:r},error:null}}catch(t){if(Tt(t))return{data:{session:null,user:null},error:t};throw t}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async t=>{var n;if(!e){const{data:o,error:a}=t;if(a)throw a;e=(n=o.session)!==null&&n!==void 0?n:void 0}if(!(e!=null&&e.refresh_token))throw new Vr;const{session:s,error:r}=await this._callRefreshToken(e.refresh_token);return r?{data:{user:null,session:null},error:r}:s?{data:{user:s.user,session:s},error:null}:{data:{user:null,session:null},error:null}})}catch(t){if(Tt(t))return{data:{user:null,session:null},error:t};throw t}}async _getSessionFromURL(e,t){try{if(!Rs())throw new Iu("No browser detected.");if(e.error||e.error_description||e.error_code)throw new Iu(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(t){case"implicit":if(this.flowType==="pkce")throw new Cy("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new Iu("Not a valid implicit grant flow url.");break;default:}if(t==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new Cy("No code detected.");const{data:y,error:_}=await this._exchangeCodeForSession(e.code);if(_)throw _;const v=new URL(window.location.href);return v.searchParams.delete("code"),window.history.replaceState(window.history.state,"",v.toString()),{data:{session:y.session,redirectType:null},error:null}}const{provider_token:n,provider_refresh_token:s,access_token:r,refresh_token:o,expires_in:a,expires_at:l,token_type:c}=e;if(!r||!a||!o||!c)throw new Iu("No session defined in URL");const h=Math.round(Date.now()/1e3),u=parseInt(a);let d=h+u;l&&(d=parseInt(l));const f=d-h;f*1e3<=Ga&&console.warn("@supabase/gotrue-js: Session as retrieved from URL expires in ".concat(f,"s, should have been closer to ").concat(u,"s"));const p=d-u;h-p>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",p,d,h):h-p<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",p,d,h);const{data:A,error:m}=await this._getUser(r);if(m)throw m;const g={provider_token:n,provider_refresh_token:s,access_token:r,expires_in:u,expires_at:d,refresh_token:o,token_type:c,user:A.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:g,redirectType:e.type},error:null}}catch(n){if(Tt(n))return{data:{session:null,redirectType:null},error:n};throw n}}_isImplicitGrantCallback(e){return!!(e.access_token||e.error_description)}async _isPKCECallback(e){const t=await Mu(this.storage,"".concat(this.storageKey,"-code-verifier"));return!!(e.code&&t)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async t=>{var n;const{data:s,error:r}=t;if(r)return{error:r};const o=(n=s.session)===null||n===void 0?void 0:n.access_token;if(o){const{error:a}=await this.admin.signOut(o,e);if(a&&!(Mz(a)&&(a.status===404||a.status===401||a.status===403)))return{error:a}}return e!=="others"&&(await this._removeSession(),await Tu(this.storage,"".concat(this.storageKey,"-code-verifier"))),{error:null}})}onAuthStateChange(e){const t=Oz(),n={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,n),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(t)})))(),{data:{subscription:n}}}async _emitInitialSession(e){return await this._useSession(async t=>{var n,s;try{const{data:{session:r},error:o}=t;if(o)throw o;await((n=this.stateChangeEmitters.get(e))===null||n===void 0?void 0:n.callback("INITIAL_SESSION",r)),this._debug("INITIAL_SESSION","callback id",e,"session",r)}catch(r){await((s=this.stateChangeEmitters.get(e))===null||s===void 0?void 0:s.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",r),console.error(r)}})}async resetPasswordForEmail(e,t={}){let n=null,s=null;this.flowType==="pkce"&&([n,s]=await Oa(this.storage,this.storageKey,!0));try{return await kt(this.fetch,"POST","".concat(this.url,"/recover"),{body:{email:e,code_challenge:n,code_challenge_method:s,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(r){if(Tt(r))return{data:null,error:r};throw r}}async getUserIdentities(){var e;try{const{data:t,error:n}=await this.getUser();if(n)throw n;return{data:{identities:(e=t.user.identities)!==null&&e!==void 0?e:[]},error:null}}catch(t){if(Tt(t))return{data:null,error:t};throw t}}async linkIdentity(e){var t;try{const{data:n,error:s}=await this._useSession(async r=>{var o,a,l,c,h;const{data:u,error:d}=r;if(d)throw d;const f=await this._getUrlForProvider("".concat(this.url,"/user/identities/authorize"),e.provider,{redirectTo:(o=e.options)===null||o===void 0?void 0:o.redirectTo,scopes:(a=e.options)===null||a===void 0?void 0:a.scopes,queryParams:(l=e.options)===null||l===void 0?void 0:l.queryParams,skipBrowserRedirect:!0});return await kt(this.fetch,"GET",f,{headers:this.headers,jwt:(h=(c=u.session)===null||c===void 0?void 0:c.access_token)!==null&&h!==void 0?h:void 0})});if(s)throw s;return Rs()&&!(!((t=e.options)===null||t===void 0)&&t.skipBrowserRedirect)&&window.location.assign(n==null?void 0:n.url),{data:{provider:e.provider,url:n==null?void 0:n.url},error:null}}catch(n){if(Tt(n))return{data:{provider:e.provider,url:null},error:n};throw n}}async unlinkIdentity(e){try{return await this._useSession(async t=>{var n,s;const{data:r,error:o}=t;if(o)throw o;return await kt(this.fetch,"DELETE","".concat(this.url,"/user/identities/").concat(e.identity_id),{headers:this.headers,jwt:(s=(n=r.session)===null||n===void 0?void 0:n.access_token)!==null&&s!==void 0?s:void 0})})}catch(t){if(Tt(t))return{data:null,error:t};throw t}}async _refreshAccessToken(e){const t="#_refreshAccessToken(".concat(e.substring(0,5),"...)");this._debug(t,"begin");try{const n=Date.now();return await zz(async s=>(s>0&&await Vz(200*Math.pow(2,s-1)),this._debug(t,"refreshing attempt",s),await kt(this.fetch,"POST","".concat(this.url,"/token?grant_type=refresh_token"),{body:{refresh_token:e},headers:this.headers,xform:zr})),(s,r)=>{const o=200*Math.pow(2,s);return r&&qp(r)&&Date.now()+o-n<Ga})}catch(n){if(this._debug(t,"error",n),Tt(n))return{data:{session:null,user:null},error:n};throw n}finally{this._debug(t,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){const n=await this._getUrlForProvider("".concat(this.url,"/authorize"),e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",n),Rs()&&!t.skipBrowserRedirect&&window.location.assign(n),{data:{provider:e,url:n},error:null}}async _recoverAndRefresh(){var e;const t="#_recoverAndRefresh()";this._debug(t,"begin");try{const n=await Mu(this.storage,this.storageKey);if(this._debug(t,"session from storage",n),!this._isValidSession(n)){this._debug(t,"session is not valid"),n!==null&&await this._removeSession();return}const s=((e=n.expires_at)!==null&&e!==void 0?e:1/0)*1e3-Date.now()<Hp;if(this._debug(t,"session has".concat(s?"":" not"," expired with margin of ").concat(Hp,"s")),s){if(this.autoRefreshToken&&n.refresh_token){const{error:r}=await this._callRefreshToken(n.refresh_token);r&&(console.error(r),qp(r)||(this._debug(t,"refresh failed with a non-retryable error, removing the session",r),await this._removeSession()))}}else await this._notifyAllSubscribers("SIGNED_IN",n)}catch(n){this._debug(t,"error",n),console.error(n);return}finally{this._debug(t,"end")}}async _callRefreshToken(e){var t,n;if(!e)throw new Vr;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const s="#_callRefreshToken(".concat(e.substring(0,5),"...)");this._debug(s,"begin");try{this.refreshingDeferred=new hf;const{data:r,error:o}=await this._refreshAccessToken(e);if(o)throw o;if(!r.session)throw new Vr;await this._saveSession(r.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",r.session);const a={session:r.session,error:null};return this.refreshingDeferred.resolve(a),a}catch(r){if(this._debug(s,"error",r),Tt(r)){const o={session:null,error:r};return qp(r)||await this._removeSession(),(t=this.refreshingDeferred)===null||t===void 0||t.resolve(o),o}throw(n=this.refreshingDeferred)===null||n===void 0||n.reject(r),r}finally{this.refreshingDeferred=null,this._debug(s,"end")}}async _notifyAllSubscribers(e,t,n=!0){const s="#_notifyAllSubscribers(".concat(e,")");this._debug(s,"begin",t,"broadcast = ".concat(n));try{this.broadcastChannel&&n&&this.broadcastChannel.postMessage({event:e,session:t});const r=[],o=Array.from(this.stateChangeEmitters.values()).map(async a=>{try{await a.callback(e,t)}catch(l){r.push(l)}});if(await Promise.all(o),r.length>0){for(let a=0;a<r.length;a+=1)console.error(r[a]);throw r[0]}}finally{this._debug(s,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0,await lC(this.storage,this.storageKey,e)}async _removeSession(){this._debug("#_removeSession()"),await Tu(this.storage,this.storageKey),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&Rs()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(t){console.error("removing visibilitychange callback failed",t)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),Ga);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async t=>{const{data:{session:n}}=t;if(!n||!n.refresh_token||!n.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const s=Math.floor((n.expires_at*1e3-e)/Ga);this._debug("#_autoRefreshTokenTick()","access token expires in ".concat(s," ticks, a tick lasts ").concat(Ga,"ms, refresh threshold is ").concat(gA," ticks")),s<=gA&&await this._callRefreshToken(n.refresh_token)})}catch(t){console.error("Auto refresh tick failed with error. This is likely a transient error.",t)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof cC)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!Rs()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const t="#_onVisibilityChanged(".concat(e,")");this._debug(t,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t,n){const s=["provider=".concat(encodeURIComponent(t))];if(n!=null&&n.redirectTo&&s.push("redirect_to=".concat(encodeURIComponent(n.redirectTo))),n!=null&&n.scopes&&s.push("scopes=".concat(encodeURIComponent(n.scopes))),this.flowType==="pkce"){const[r,o]=await Oa(this.storage,this.storageKey),a=new URLSearchParams({code_challenge:"".concat(encodeURIComponent(r)),code_challenge_method:"".concat(encodeURIComponent(o))});s.push(a.toString())}if(n!=null&&n.queryParams){const r=new URLSearchParams(n.queryParams);s.push(r.toString())}return n!=null&&n.skipBrowserRedirect&&s.push("skip_http_redirect=".concat(n.skipBrowserRedirect)),"".concat(e,"?").concat(s.join("&"))}async _unenroll(e){try{return await this._useSession(async t=>{var n;const{data:s,error:r}=t;return r?{data:null,error:r}:await kt(this.fetch,"DELETE","".concat(this.url,"/factors/").concat(e.factorId),{headers:this.headers,jwt:(n=s==null?void 0:s.session)===null||n===void 0?void 0:n.access_token})})}catch(t){if(Tt(t))return{data:null,error:t};throw t}}async _enroll(e){try{return await this._useSession(async t=>{var n,s;const{data:r,error:o}=t;if(o)return{data:null,error:o};const a=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:{issuer:e.issuer}),{data:l,error:c}=await kt(this.fetch,"POST","".concat(this.url,"/factors"),{body:a,headers:this.headers,jwt:(n=r==null?void 0:r.session)===null||n===void 0?void 0:n.access_token});return c?{data:null,error:c}:(e.factorType==="totp"&&(!((s=l==null?void 0:l.totp)===null||s===void 0)&&s.qr_code)&&(l.totp.qr_code="data:image/svg+xml;utf-8,".concat(l.totp.qr_code)),{data:l,error:null})})}catch(t){if(Tt(t))return{data:null,error:t};throw t}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var n;const{data:s,error:r}=t;if(r)return{data:null,error:r};const{data:o,error:a}=await kt(this.fetch,"POST","".concat(this.url,"/factors/").concat(e.factorId,"/verify"),{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:(n=s==null?void 0:s.session)===null||n===void 0?void 0:n.access_token});return a?{data:null,error:a}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+o.expires_in},o)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",o),{data:o,error:a})})}catch(t){if(Tt(t))return{data:null,error:t};throw t}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var n;const{data:s,error:r}=t;return r?{data:null,error:r}:await kt(this.fetch,"POST","".concat(this.url,"/factors/").concat(e.factorId,"/challenge"),{body:{channel:e.channel},headers:this.headers,jwt:(n=s==null?void 0:s.session)===null||n===void 0?void 0:n.access_token})})}catch(t){if(Tt(t))return{data:null,error:t};throw t}})}async _challengeAndVerify(e){const{data:t,error:n}=await this._challenge({factorId:e.factorId});return n?{data:null,error:n}:await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){const{data:{user:e},error:t}=await this.getUser();if(t)return{data:null,error:t};const n=(e==null?void 0:e.factors)||[],s=n.filter(o=>o.factor_type==="totp"&&o.status==="verified"),r=n.filter(o=>o.factor_type==="phone"&&o.status==="verified");return{data:{all:n,totp:s,phone:r},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async e=>{var t,n;const{data:{session:s},error:r}=e;if(r)return{data:null,error:r};if(!s)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:o}=jp(s.access_token);let a=null;o.aal&&(a=o.aal);let l=a;((n=(t=s.user.factors)===null||t===void 0?void 0:t.filter(u=>u.status==="verified"))!==null&&n!==void 0?n:[]).length>0&&(l="aal2");const h=o.amr||[];return{data:{currentLevel:a,nextLevel:l,currentAuthenticationMethods:h},error:null}}))}async fetchJwk(e,t={keys:[]}){let n=t.keys.find(o=>o.kid===e);if(n||(n=this.jwks.keys.find(o=>o.kid===e),n&&this.jwks_cached_at+Sz>Date.now()))return n;const{data:s,error:r}=await kt(this.fetch,"GET","".concat(this.url,"/.well-known/jwks.json"),{headers:this.headers});if(r)throw r;if(!s.keys||s.keys.length===0)throw new Lc("JWKS is empty");if(this.jwks=s,this.jwks_cached_at=Date.now(),n=s.keys.find(o=>o.kid===e),!n)throw new Lc("No matching signing key found in JWKS");return n}async getClaims(e,t={keys:[]}){try{let n=e;if(!n){const{data:f,error:p}=await this.getSession();if(p||!f.session)return{data:null,error:p};n=f.session.access_token}const{header:s,payload:r,signature:o,raw:{header:a,payload:l}}=jp(n);if(Yz(r.exp),!s.kid||s.alg==="HS256"||!("crypto"in globalThis&&"subtle"in globalThis.crypto)){const{error:f}=await this.getUser(n);if(f)throw f;return{data:{claims:r,header:s,signature:o},error:null}}const c=Kz(s.alg),h=await this.fetchJwk(s.kid,t),u=await crypto.subtle.importKey("jwk",h,c,!0,["verify"]);if(!await crypto.subtle.verify(c,u,o,Nz("".concat(a,".").concat(l))))throw new Lc("Invalid JWT signature");return{data:{claims:r,header:s,signature:o},error:null}}catch(n){if(Tt(n))return{data:null,error:n};throw n}}}ah.nextInstanceID=0;const dG=ah;class fG extends dG{constructor(e){super(e)}}var pG=function(i,e,t,n){function s(r){return r instanceof t?r:new t(function(o){o(r)})}return new(t||(t=Promise))(function(r,o){function a(h){try{c(n.next(h))}catch(u){o(u)}}function l(h){try{c(n.throw(h))}catch(u){o(u)}}function c(h){h.done?r(h.value):s(h.value).then(a,l)}c((n=n.apply(i,e||[])).next())})};class mG{constructor(e,t,n){var s,r,o;if(this.supabaseUrl=e,this.supabaseKey=t,!e)throw new Error("supabaseUrl is required.");if(!t)throw new Error("supabaseKey is required.");const a=yz(e);this.realtimeUrl="".concat(a,"/realtime/v1").replace(/^http/i,"ws"),this.authUrl="".concat(a,"/auth/v1"),this.storageUrl="".concat(a,"/storage/v1"),this.functionsUrl="".concat(a,"/functions/v1");const l="sb-".concat(new URL(this.authUrl).hostname.split(".")[0],"-auth-token"),c={db:dz,realtime:pz,auth:Object.assign(Object.assign({},fz),{storageKey:l}),global:uz},h=xz(n!=null?n:{},c);this.storageKey=(s=h.auth.storageKey)!==null&&s!==void 0?s:"",this.headers=(r=h.global.headers)!==null&&r!==void 0?r:{},h.accessToken?(this.accessToken=h.accessToken,this.auth=new Proxy({},{get:(u,d)=>{throw new Error("@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.".concat(String(d)," is not possible"))}})):this.auth=this._initSupabaseAuthClient((o=h.auth)!==null&&o!==void 0?o:{},this.headers,h.global.fetch),this.fetch=vz(t,this._getAccessToken.bind(this),h.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},h.realtime)),this.rest=new DV("".concat(a,"/rest/v1"),{headers:this.headers,schema:h.db.schema,fetch:this.fetch}),h.accessToken||this._listenForAuthEvents()}get functions(){return new cV(this.functionsUrl,{headers:this.headers,customFetch:this.fetch})}get storage(){return new lz(this.storageUrl,this.headers,this.fetch)}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},n={}){return this.rest.rpc(e,t,n)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,t;return pG(this,void 0,void 0,function*(){if(this.accessToken)return yield this.accessToken();const{data:n}=yield this.auth.getSession();return(t=(e=n.session)===null||e===void 0?void 0:e.access_token)!==null&&t!==void 0?t:null})}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:n,storage:s,storageKey:r,flowType:o,lock:a,debug:l},c,h){const u={Authorization:"Bearer ".concat(this.supabaseKey),apikey:"".concat(this.supabaseKey)};return new fG({url:this.authUrl,headers:Object.assign(Object.assign({},u),c),storageKey:r,autoRefreshToken:e,persistSession:t,detectSessionInUrl:n,storage:s,flowType:o,lock:a,debug:l,fetch:h,hasCustomAuthorizationHeader:"Authorization"in this.headers})}_initRealtimeClient(e){return new XV(this.realtimeUrl,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e==null?void 0:e.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((t,n)=>{this._handleTokenChanged(t,"CLIENT",n==null?void 0:n.access_token)})}_handleTokenChanged(e,t,n){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==n?this.changedAccessToken=n:e==="SIGNED_OUT"&&(this.realtime.setAuth(),t=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const AG=(i,e,t)=>new mG(i,e,t),hC=AG(cF,hF);class gG{constructor(){this.experience=new ti,this.scene=this.experience.scene,this.resources=this.experience.resources,this.debug=this.experience.debug.ui,this.debugActive=this.experience.debug.active,this.axesHelper=new WB(5),this.axesHelper.visible=!1,this.scene.add(this.axesHelper),this.setSunLight(),this.setAmbientLight(),this.setEnvironmentMap(),this.debuggerInit()}setSunLight(){this.sunLightColor="#ffffff",this.sunLightIntensity=2.5,this.sunLight=new yg(this.sunLightColor,this.sunLightIntensity),this.sunLight.castShadow=!0,this.sunLight.shadow.camera.far=60,this.sunLight.shadow.camera.left=-10,this.sunLight.shadow.camera.right=10,this.sunLight.shadow.camera.top=10,this.sunLight.shadow.camera.bottom=-10,this.sunLight.shadow.mapSize.set(2048,2048),this.sunLight.shadow.normalBias=.05,this.sunLightPosition=new he(17,12,6.5),this.sunLight.position.copy(this.sunLightPosition),this.sunLight.target=new en,this.sunLightTarget=new he(0,0,0),this.sunLight.target.position.copy(this.sunLightTarget),this.scene.add(this.sunLight.target),this.helper=new HB(this.sunLight.shadow.camera),this.helper.visible=!1,this.scene.add(this.helper)}setAmbientLight(){this.ambientLight=new Zw(16777215,.5),this.scene.add(this.ambientLight)}setEnvironmentMap(){this.environmentMap={},this.environmentMap.intensity=.3,this.environmentMap.texture=this.resources.items.environmentMapTexture,this.environmentMap.texture.colorSpace=Ft,this.scene.environment=this.environmentMap.texture}updateSunLightPosition(){this.sunLight.position.copy(this.sunLightPosition),this.sunLight.target.position.copy(this.sunLightTarget),this.helper.update()}updateSunLightColor(){this.sunLight.color.set(this.sunLightColor)}updateSunLightIntensity(){this.sunLight.intensity=this.sunLightIntensity}debuggerInit(){if(this.debugActive){this.debug.addFolder({title:"Environment",expanded:!1}).addBinding(this.scene,"environmentIntensity",{min:0,max:2,step:.01,label:"Intensity"});const t=this.debug.addFolder({title:"Sun Light",expanded:!1});t.addBinding(this,"sunLightPosition",{label:"Light Position"}).on("change",this.updateSunLightPosition.bind(this)),t.addBinding(this,"sunLightTarget",{label:"Light Target"}).on("change",this.updateSunLightPosition.bind(this)),t.addBinding(this,"sunLightColor",{label:"Light Color",view:"color"}).on("change",this.updateSunLightColor.bind(this)),t.addBinding(this,"sunLightIntensity",{label:"Light Intensity",min:0,max:20,step:.1}).on("change",this.updateSunLightIntensity.bind(this));const n=this.sunLight.shadow.camera,s=t.addFolder({title:"Shadow Camera",expanded:!1});s.addBinding(n,"left",{label:"Shadow Left",min:-100,max:0,step:.1}).on("change",()=>{n.updateProjectionMatrix(),this.helper.update()}),s.addBinding(n,"right",{label:"Shadow Right",min:0,max:100,step:.1}).on("change",()=>{n.updateProjectionMatrix(),this.helper.update()}),s.addBinding(n,"top",{label:"Shadow Top",min:0,max:100,step:.1}).on("change",()=>{n.updateProjectionMatrix(),this.helper.update()}),s.addBinding(n,"bottom",{label:"Shadow Bottom",min:-100,max:0,step:.1}).on("change",()=>{n.updateProjectionMatrix(),this.helper.update()}),t.addBinding(this.helper,"visible",{label:"Helper"}),this.axesHelper&&this.debug.addBinding(this.axesHelper,"visible",{label:"Axes"})}}}class vG{constructor(e,t,n,s=0,r=!1,o=1){this.experience=new ti,this.scene=e,this.resources=t,this.time=this.experience.time,this.vehicles=n,this.rowIndex=s,this.direction=r,this.speed=o,this.timeMultiplier=1,this.carMeshes=[],this.carShakeParams=[],this.addCars(),this.experience.on("itemCollected",this.applyClockEffect.bind(this))}addCars(){this.vehicles.forEach((e,t)=>{const{initialTileIndex:n,type:s}=e,r=this.resources.items[s];if(!r){console.warn(": ".concat(s));return}const o=r.scene.clone();o.scale.set(.5,.5,.5),o.traverse(a=>{a.isMesh&&(a.castShadow=!0)}),o.position.set(n,.35,this.rowIndex),this.direction?o.rotation.y=0:o.rotation.y=Math.PI,this.scene.add(o),this.carMeshes.push(o),this.carShakeParams.push({baseY:o.position.y,phase:Math.random()*Math.PI*2})})}getCarMeshes(){return this.carMeshes}remove(){this.carMeshes.forEach(e=>{this.scene.remove(e)}),this.carMeshes=[]}update(){const e=this.time.elapsed*.03*this.timeMultiplier;this.carMeshes.forEach((t,n)=>{const s=this.direction?1:-1;s===1&&t.position.x>eA?t.position.x=Zm:s===-1&&t.position.x<Zm&&(t.position.x=eA),t.position.x+=s*this.speed*this.time.delta*1/60*.23*this.timeMultiplier;const r=this.carShakeParams[n],h=Math.sin(e*2.5+r.phase)*.02+Math.cos(e*4.3+r.phase*1.3)*.01;t.position.y=r.baseY+h})}applyClockEffect(e){e==="clock"&&(this.clockTimeout&&clearTimeout(this.clockTimeout),this.timeMultiplier=rF,this.clockTimeout=setTimeout(()=>{this.timeMultiplier=1,this.clockTimeout=null},lb))}}class _G{constructor(e,t,n=0){this.scene=e,this.object3d=t,this.rowIndex=n,this.tiles=[],this.createGrassRow()}createGrassRow(){const e=this.object3d;if(e.scene.updateMatrixWorld(),!e){console.warn(" grass ");return}for(let t=0;t<ab;t++){const n=qo+t,s=e.scene.clone();s.traverse(r=>{r.isMesh&&(r.receiveShadow=!0)}),s.position.set(n*4,0,this.rowIndex),this.scene.add(s),this.tiles.push(s)}}remove(){this.tiles.forEach(e=>{this.scene.remove(e)}),this.tiles=[]}}const Ly=[{type:"forest",trees:[{tileIndex:-7,type:"tree01"},{tileIndex:-3,type:"tree02"}]},{type:"forest",trees:[{tileIndex:-5,type:"tree01"},{tileIndex:5,type:"tree04"}]},{type:"forest",trees:[{tileIndex:-6,type:"tree03"}]},{type:"forest",trees:[{tileIndex:8,type:"tree03"}]},{type:"forest",trees:[{tileIndex:-3,type:"tree02"},{tileIndex:6,type:"tree04"}]}];class yG{constructor(e,t,n=0){this.scene=e,this.resources=t,this.rowIndex=n,this.tiles=[],this.createRoadRow()}createRoadRow(){const e=this.resources.items.road;if(!e){console.warn(" road ");return}for(let t=0;t<ab;t++){const n=qo+t,s=e.scene.clone();s.traverse(r=>{r.isMesh&&(r.receiveShadow=!0)}),s.position.set(n*4,0,this.rowIndex),s.scale.set(1,1,1),this.scene.add(s),this.tiles.push(s)}}remove(){this.tiles.forEach(e=>{this.scene.remove(e)}),this.tiles=[]}}class xG{constructor(e,t,n,s=0){this.scene=e,this.resources=t,this.trees=n,this.rowIndex=s,this.treeMeshes=[],this.addTrees()}addTrees(){this.trees.forEach(e=>{const{tileIndex:t,type:n}=e,s=this.resources.items[n];if(!s){console.warn(": ".concat(n));return}const r=s.scene.clone();r.traverse(o=>{o.isMesh&&(o.castShadow=!0)}),r.position.set(t,.2,this.rowIndex),this.scene.add(r),this.treeMeshes.push(r)})}remove(){this.treeMeshes.forEach(e=>{this.scene.remove(e)}),this.treeMeshes=[]}}let wG=class{constructor(){this.experience=new ti,this.scene=this.experience.scene,this.resources=this.experience.resources,this.debug=this.experience.debug,this.rowIndex=0,this.metadata=JSON.parse(JSON.stringify(Ly)),this.tiles=[],this.grassRows=[],this.treeRows=[],this.roadRows=[],this.carRows=[],this.carMeshDict={},this.itemManager=new uF,this.initializeMap(),this.debug.active&&this.debugInit()}initializeMap(){this.rowIndex=0,this.addGrassRow(-5),this.addGrassRow(-4),this.addGrassRow(-3),this.addGrassRow(-2),this.addGrassRow(-1),this.addGrassRow(0),this.metadata.forEach(e=>{this.rowIndex++,e&&e.type==="forest"&&(this.addGrassRow(this.rowIndex),this.addTreeRow(e.trees,this.rowIndex)),e&&e.type==="road"&&(this.addRoadRow(this.rowIndex),this.addCarRow(e.vehicles,this.rowIndex,e.direction,e.speed)),e.items&&e.items.length>0&&this.itemManager.addItems(e.items,this.rowIndex)})}addGrassRow(e=0){const t=new _G(this.scene,this.resources.items.grass,e);this.grassRows.push(t),this.tiles.push(...t.tiles)}addTreeRow(e,t){const n=new xG(this.scene,this.resources,e,t);this.treeRows.push(n)}addRoadRow(e=0){const t=new yG(this.scene,this.resources,e);this.roadRows.push(t)}addCarRow(e,t=0,n=!1,s=1){const r=new vG(this.scene,this.resources,e,t,n,s);this.carRows.push(r),this.carMeshDict[t]=r.getCarMeshes()}extendMap(e=10){const t=this.metadata.length,n=dF(t,e);this.metadata.push(...n),n.forEach(s=>{this.rowIndex++,s.type==="forest"&&(this.addGrassRow(this.rowIndex),this.addTreeRow(s.trees,this.rowIndex)),s.type==="road"&&(this.addRoadRow(this.rowIndex),this.addCarRow(s.vehicles,this.rowIndex,s.direction,s.speed)),s.items&&s.items.length>0&&this.itemManager.addItems(s.items,this.rowIndex)})}checkAndExtendMap(e){this.metadata.length-Math.abs(e)<pp&&this.extendMap(pp)}resetMap(){this.tiles.forEach(e=>{this.scene.remove(e)}),this.tiles=[],this.grassRows.forEach(e=>e.remove()),this.grassRows=[],this.treeRows.forEach(e=>e.remove()),this.treeRows=[],this.roadRows.forEach(e=>e.remove()),this.roadRows=[],this.carRows.forEach(e=>e.remove()),this.carRows=[],this.carMeshDict={},this.itemManager&&this.itemManager.clear(),this.metadata=JSON.parse(JSON.stringify(Ly)),this.initializeMap()}update(){this.carRows.forEach(e=>{e.update()}),this.itemManager&&this.itemManager.update()}debugInit(){this.debugFolder=this.debug.ui.addFolder({title:"",expanded:!0}),this.debugFolder.addButton({title:"",label:"",onClick:()=>this.resetMap()}),this.debugFolder.addButton({title:"",label:"",onClick:()=>this.extendMap(pp)})}getCarMeshesByRow(e){return this.carMeshDict[e]||[]}};function hr(i){if(i===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return i}function uC(i,e){i.prototype=Object.create(e.prototype),i.prototype.constructor=i,i.__proto__=e}/*!
 * GSAP 3.13.0
 * https://gsap.com
 *
 * @license Copyright 2008-2025, GreenSock. All rights reserved.
 * Subject to the terms at https://gsap.com/standard-license
 * @author: Jack Doyle, jack@greensock.com
*/var Xi={autoSleep:120,force3D:"auto",nullTargetWarn:1,units:{lineHeight:""}},Cl={duration:.5,overwrite:!1,delay:0},ov,ei,mn,zs=1e8,hi=1/zs,yA=Math.PI*2,bG=yA/4,EG=0,dC=Math.sqrt,CG=Math.cos,SG=Math.sin,Jn=function(e){return typeof e=="string"},In=function(e){return typeof e=="function"},br=function(e){return typeof e=="number"},av=function(e){return typeof e>"u"},js=function(e){return typeof e=="object"},Bi=function(e){return e!==!1},lv=function(){return typeof window<"u"},Bu=function(e){return In(e)||Jn(e)},fC=typeof ArrayBuffer=="function"&&ArrayBuffer.isView||function(){},ui=Array.isArray,xA=/(?:-?\.?\d|\.)+/gi,pC=/[-+=.]*\d+[.e\-+]*\d*[e\-+]*\d*/g,Ka=/[-+=.]*\d+[.e-]*\d*[a-z%]*/g,Xp=/[-+=.]*\d+\.?\d*(?:e-|e\+)?\d*/gi,mC=/[+-]=-?[.\d]+/,AC=/[^,'"\[\]\s]+/gi,IG=/^[+\-=e\s\d]*\d+[.\d]*([a-z]*|%)\s*$/i,gn,Ds,wA,cv,Yi={},yd={},gC,vC=function(e){return(yd=Sl(e,Yi))&&Fi},hv=function(e,t){return console.warn("Invalid property",e,"set to",t,"Missing plugin? gsap.registerPlugin()")},lh=function(e,t){return!t&&console.warn(e)},_C=function(e,t){return e&&(Yi[e]=t)&&yd&&(yd[e]=t)||Yi},ch=function(){return 0},MG={suppressEvents:!0,isStart:!0,kill:!1},zu={suppressEvents:!0,kill:!1},TG={suppressEvents:!0},uv={},ro=[],bA={},yC,Qi={},Yp={},Fy=30,Gu=[],dv="",fv=function(e){var t=e[0],n,s;if(js(t)||In(t)||(e=[e]),!(n=(t._gsap||{}).harness)){for(s=Gu.length;s--&&!Gu[s].targetTest(t););n=Gu[s]}for(s=e.length;s--;)e[s]&&(e[s]._gsap||(e[s]._gsap=new HC(e[s],n)))||e.splice(s,1);return e},Xo=function(e){return e._gsap||fv(ls(e))[0]._gsap},xC=function(e,t,n){return(n=e[t])&&In(n)?e[t]():av(n)&&e.getAttribute&&e.getAttribute(t)||n},Ri=function(e,t){return(e=e.split(",")).forEach(t)||e},Bn=function(e){return Math.round(e*1e5)/1e5||0},Fn=function(e){return Math.round(e*1e7)/1e7||0},dl=function(e,t){var n=t.charAt(0),s=parseFloat(t.substr(2));return e=parseFloat(e),n==="+"?e+s:n==="-"?e-s:n==="*"?e*s:e/s},BG=function(e,t){for(var n=t.length,s=0;e.indexOf(t[s])<0&&++s<n;);return s<n},xd=function(){var e=ro.length,t=ro.slice(0),n,s;for(bA={},ro.length=0,n=0;n<e;n++)s=t[n],s&&s._lazy&&(s.render(s._lazy[0],s._lazy[1],!0)._lazy=0)},pv=function(e){return!!(e._initted||e._startAt||e.add)},wC=function(e,t,n,s){ro.length&&!ei&&xd(),e.render(t,n,!!(ei&&t<0&&pv(e))),ro.length&&!ei&&xd()},bC=function(e){var t=parseFloat(e);return(t||t===0)&&(e+"").match(AC).length<2?t:Jn(e)?e.trim():e},EC=function(e){return e},Ki=function(e,t){for(var n in t)n in e||(e[n]=t[n]);return e},RG=function(e){return function(t,n){for(var s in n)s in t||s==="duration"&&e||s==="ease"||(t[s]=n[s])}},Sl=function(e,t){for(var n in t)e[n]=t[n];return e},Ny=function i(e,t){for(var n in t)n!=="__proto__"&&n!=="constructor"&&n!=="prototype"&&(e[n]=js(t[n])?i(e[n]||(e[n]={}),t[n]):t[n]);return e},wd=function(e,t){var n={},s;for(s in e)s in t||(n[s]=e[s]);return n},Nc=function(e){var t=e.parent||gn,n=e.keyframes?RG(ui(e.keyframes)):Ki;if(Bi(e.inherit))for(;t;)n(e,t.vars.defaults),t=t.parent||t._dp;return e},PG=function(e,t){for(var n=e.length,s=n===t.length;s&&n--&&e[n]===t[n];);return n<0},CC=function(e,t,n,s,r){var o=e[s],a;if(r)for(a=t[r];o&&o[r]>a;)o=o._prev;return o?(t._next=o._next,o._next=t):(t._next=e[n],e[n]=t),t._next?t._next._prev=t:e[s]=t,t._prev=o,t.parent=t._dp=e,t},uf=function(e,t,n,s){n===void 0&&(n="_first"),s===void 0&&(s="_last");var r=t._prev,o=t._next;r?r._next=o:e[n]===t&&(e[n]=o),o?o._prev=r:e[s]===t&&(e[s]=r),t._next=t._prev=t.parent=null},fo=function(e,t){e.parent&&(!t||e.parent.autoRemoveChildren)&&e.parent.remove&&e.parent.remove(e),e._act=0},Yo=function(e,t){if(e&&(!t||t._end>e._dur||t._start<0))for(var n=e;n;)n._dirty=1,n=n.parent;return e},DG=function(e){for(var t=e.parent;t&&t.parent;)t._dirty=1,t.totalDuration(),t=t.parent;return e},EA=function(e,t,n,s){return e._startAt&&(ei?e._startAt.revert(zu):e.vars.immediateRender&&!e.vars.autoRevert||e._startAt.render(t,!0,s))},LG=function i(e){return!e||e._ts&&i(e.parent)},ky=function(e){return e._repeat?Il(e._tTime,e=e.duration()+e._rDelay)*e:0},Il=function(e,t){var n=Math.floor(e=Fn(e/t));return e&&n===e?n-1:n},bd=function(e,t){return(e-t._start)*t._ts+(t._ts>=0?0:t._dirty?t.totalDuration():t._tDur)},df=function(e){return e._end=Fn(e._start+(e._tDur/Math.abs(e._ts||e._rts||hi)||0))},ff=function(e,t){var n=e._dp;return n&&n.smoothChildTiming&&e._ts&&(e._start=Fn(n._time-(e._ts>0?t/e._ts:((e._dirty?e.totalDuration():e._tDur)-t)/-e._ts)),df(e),n._dirty||Yo(n,e)),e},SC=function(e,t){var n;if((t._time||!t._dur&&t._initted||t._start<e._time&&(t._dur||!t.add))&&(n=bd(e.rawTime(),t),(!t._dur||Fh(0,t.totalDuration(),n)-t._tTime>hi)&&t.render(n,!0)),Yo(e,t)._dp&&e._initted&&e._time>=e._dur&&e._ts){if(e._dur<e.duration())for(n=e;n._dp;)n.rawTime()>=0&&n.totalTime(n._tTime),n=n._dp;e._zTime=-1e-8}},ks=function(e,t,n,s){return t.parent&&fo(t),t._start=Fn((br(n)?n:n||e!==gn?ns(e,n,t):e._time)+t._delay),t._end=Fn(t._start+(t.totalDuration()/Math.abs(t.timeScale())||0)),CC(e,t,"_first","_last",e._sort?"_start":0),CA(t)||(e._recent=t),s||SC(e,t),e._ts<0&&ff(e,e._tTime),e},IC=function(e,t){return(Yi.ScrollTrigger||hv("scrollTrigger",t))&&Yi.ScrollTrigger.create(t,e)},MC=function(e,t,n,s,r){if(Av(e,t,r),!e._initted)return 1;if(!n&&e._pt&&!ei&&(e._dur&&e.vars.lazy!==!1||!e._dur&&e.vars.lazy)&&yC!==Vi.frame)return ro.push(e),e._lazy=[r,s],1},FG=function i(e){var t=e.parent;return t&&t._ts&&t._initted&&!t._lock&&(t.rawTime()<0||i(t))},CA=function(e){var t=e.data;return t==="isFromStart"||t==="isStart"},NG=function(e,t,n,s){var r=e.ratio,o=t<0||!t&&(!e._start&&FG(e)&&!(!e._initted&&CA(e))||(e._ts<0||e._dp._ts<0)&&!CA(e))?0:1,a=e._rDelay,l=0,c,h,u;if(a&&e._repeat&&(l=Fh(0,e._tDur,t),h=Il(l,a),e._yoyo&&h&1&&(o=1-o),h!==Il(e._tTime,a)&&(r=1-o,e.vars.repeatRefresh&&e._initted&&e.invalidate())),o!==r||ei||s||e._zTime===hi||!t&&e._zTime){if(!e._initted&&MC(e,t,s,n,l))return;for(u=e._zTime,e._zTime=t||(n?hi:0),n||(n=t&&!u),e.ratio=o,e._from&&(o=1-o),e._time=0,e._tTime=l,c=e._pt;c;)c.r(o,c.d),c=c._next;t<0&&EA(e,t,n,!0),e._onUpdate&&!n&&qi(e,"onUpdate"),l&&e._repeat&&!n&&e.parent&&qi(e,"onRepeat"),(t>=e._tDur||t<0)&&e.ratio===o&&(o&&fo(e,1),!n&&!ei&&(qi(e,o?"onComplete":"onReverseComplete",!0),e._prom&&e._prom()))}else e._zTime||(e._zTime=t)},kG=function(e,t,n){var s;if(n>t)for(s=e._first;s&&s._start<=n;){if(s.data==="isPause"&&s._start>t)return s;s=s._next}else for(s=e._last;s&&s._start>=n;){if(s.data==="isPause"&&s._start<t)return s;s=s._prev}},Ml=function(e,t,n,s){var r=e._repeat,o=Fn(t)||0,a=e._tTime/e._tDur;return a&&!s&&(e._time*=o/e._dur),e._dur=o,e._tDur=r?r<0?1e10:Fn(o*(r+1)+e._rDelay*r):o,a>0&&!s&&ff(e,e._tTime=e._tDur*a),e.parent&&df(e),n||Yo(e.parent,e),e},Oy=function(e){return e instanceof _i?Yo(e):Ml(e,e._dur)},OG={_start:0,endTime:ch,totalDuration:ch},ns=function i(e,t,n){var s=e.labels,r=e._recent||OG,o=e.duration()>=zs?r.endTime(!1):e._dur,a,l,c;return Jn(t)&&(isNaN(t)||t in s)?(l=t.charAt(0),c=t.substr(-1)==="%",a=t.indexOf("="),l==="<"||l===">"?(a>=0&&(t=t.replace(/=/,"")),(l==="<"?r._start:r.endTime(r._repeat>=0))+(parseFloat(t.substr(1))||0)*(c?(a<0?r:n).totalDuration()/100:1)):a<0?(t in s||(s[t]=o),s[t]):(l=parseFloat(t.charAt(a-1)+t.substr(a+1)),c&&n&&(l=l/100*(ui(n)?n[0]:n).totalDuration()),a>1?i(e,t.substr(0,a-1),n)+l:o+l)):t==null?o:+t},kc=function(e,t,n){var s=br(t[1]),r=(s?2:1)+(e<2?0:1),o=t[r],a,l;if(s&&(o.duration=t[1]),o.parent=n,e){for(a=o,l=n;l&&!("immediateRender"in a);)a=l.vars.defaults||{},l=Bi(l.vars.inherit)&&l.parent;o.immediateRender=Bi(a.immediateRender),e<2?o.runBackwards=1:o.startAt=t[r-1]}return new Ln(t[0],o,t[r+1])},vo=function(e,t){return e||e===0?t(e):t},Fh=function(e,t,n){return n<e?e:n>t?t:n},ci=function(e,t){return!Jn(e)||!(t=IG.exec(e))?"":t[1]},UG=function(e,t,n){return vo(n,function(s){return Fh(e,t,s)})},SA=[].slice,TC=function(e,t){return e&&js(e)&&"length"in e&&(!t&&!e.length||e.length-1 in e&&js(e[0]))&&!e.nodeType&&e!==Ds},QG=function(e,t,n){return n===void 0&&(n=[]),e.forEach(function(s){var r;return Jn(s)&&!t||TC(s,1)?(r=n).push.apply(r,ls(s)):n.push(s)})||n},ls=function(e,t,n){return mn&&!t&&mn.selector?mn.selector(e):Jn(e)&&!n&&(wA||!Tl())?SA.call((t||cv).querySelectorAll(e),0):ui(e)?QG(e,n):TC(e)?SA.call(e,0):e?[e]:[]},IA=function(e){return e=ls(e)[0]||lh("Invalid scope")||{},function(t){var n=e.current||e.nativeElement||e;return ls(t,n.querySelectorAll?n:n===e?lh("Invalid scope")||cv.createElement("div"):e)}},BC=function(e){return e.sort(function(){return .5-Math.random()})},RC=function(e){if(In(e))return e;var t=js(e)?e:{each:e},n=Ko(t.ease),s=t.from||0,r=parseFloat(t.base)||0,o={},a=s>0&&s<1,l=isNaN(s)||a,c=t.axis,h=s,u=s;return Jn(s)?h=u={center:.5,edges:.5,end:1}[s]||0:!a&&l&&(h=s[0],u=s[1]),function(d,f,p){var A=(p||t).length,m=o[A],g,y,_,v,b,T,L,I,x;if(!m){if(x=t.grid==="auto"?0:(t.grid||[1,zs])[1],!x){for(L=-1e8;L<(L=p[x++].getBoundingClientRect().left)&&x<A;);x<A&&x--}for(m=o[A]=[],g=l?Math.min(x,A)*h-.5:s%x,y=x===zs?0:l?A*u/x-.5:s/x|0,L=0,I=zs,T=0;T<A;T++)_=T%x-g,v=y-(T/x|0),m[T]=b=c?Math.abs(c==="y"?v:_):dC(_*_+v*v),b>L&&(L=b),b<I&&(I=b);s==="random"&&BC(m),m.max=L-I,m.min=I,m.v=A=(parseFloat(t.amount)||parseFloat(t.each)*(x>A?A-1:c?c==="y"?A/x:x:Math.max(x,A/x))||0)*(s==="edges"?-1:1),m.b=A<0?r-A:r,m.u=ci(t.amount||t.each)||0,n=n&&A<0?VC(n):n}return A=(m[d]-m.min)/m.max||0,Fn(m.b+(n?n(A):A)*m.v)+m.u}},MA=function(e){var t=Math.pow(10,((e+"").split(".")[1]||"").length);return function(n){var s=Fn(Math.round(parseFloat(n)/e)*e*t);return(s-s%1)/t+(br(n)?0:ci(n))}},PC=function(e,t){var n=ui(e),s,r;return!n&&js(e)&&(s=n=e.radius||zs,e.values?(e=ls(e.values),(r=!br(e[0]))&&(s*=s)):e=MA(e.increment)),vo(t,n?In(e)?function(o){return r=e(o),Math.abs(r-o)<=s?r:o}:function(o){for(var a=parseFloat(r?o.x:o),l=parseFloat(r?o.y:0),c=zs,h=0,u=e.length,d,f;u--;)r?(d=e[u].x-a,f=e[u].y-l,d=d*d+f*f):d=Math.abs(e[u]-a),d<c&&(c=d,h=u);return h=!s||c<=s?e[h]:o,r||h===o||br(o)?h:h+ci(o)}:MA(e))},DC=function(e,t,n,s){return vo(ui(e)?!t:n===!0?!!(n=0):!s,function(){return ui(e)?e[~~(Math.random()*e.length)]:(n=n||1e-5)&&(s=n<1?Math.pow(10,(n+"").length-2):1)&&Math.floor(Math.round((e-n/2+Math.random()*(t-e+n*.99))/n)*n*s)/s})},VG=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(s){return t.reduce(function(r,o){return o(r)},s)}},zG=function(e,t){return function(n){return e(parseFloat(n))+(t||ci(n))}},GG=function(e,t,n){return FC(e,t,0,1,n)},LC=function(e,t,n){return vo(n,function(s){return e[~~t(s)]})},HG=function i(e,t,n){var s=t-e;return ui(e)?LC(e,i(0,e.length),t):vo(n,function(r){return(s+(r-e)%s)%s+e})},WG=function i(e,t,n){var s=t-e,r=s*2;return ui(e)?LC(e,i(0,e.length-1),t):vo(n,function(o){return o=(r+(o-e)%r)%r||0,e+(o>s?r-o:o)})},hh=function(e){for(var t=0,n="",s,r,o,a;~(s=e.indexOf("random(",t));)o=e.indexOf(")",s),a=e.charAt(s+7)==="[",r=e.substr(s+7,o-s-7).match(a?AC:xA),n+=e.substr(t,s-t)+DC(a?r:+r[0],a?0:+r[1],+r[2]||1e-5),t=o+1;return n+e.substr(t,e.length-t)},FC=function(e,t,n,s,r){var o=t-e,a=s-n;return vo(r,function(l){return n+((l-e)/o*a||0)})},qG=function i(e,t,n,s){var r=isNaN(e+t)?0:function(f){return(1-f)*e+f*t};if(!r){var o=Jn(e),a={},l,c,h,u,d;if(n===!0&&(s=1)&&(n=null),o)e={p:e},t={p:t};else if(ui(e)&&!ui(t)){for(h=[],u=e.length,d=u-2,c=1;c<u;c++)h.push(i(e[c-1],e[c]));u--,r=function(p){p*=u;var A=Math.min(d,~~p);return h[A](p-A)},n=t}else s||(e=Sl(ui(e)?[]:{},e));if(!h){for(l in t)mv.call(a,e,l,"get",t[l]);r=function(p){return _v(p,a)||(o?e.p:e)}}}return vo(n,r)},Uy=function(e,t,n){var s=e.labels,r=zs,o,a,l;for(o in s)a=s[o]-t,a<0==!!n&&a&&r>(a=Math.abs(a))&&(l=o,r=a);return l},qi=function(e,t,n){var s=e.vars,r=s[t],o=mn,a=e._ctx,l,c,h;if(r)return l=s[t+"Params"],c=s.callbackScope||e,n&&ro.length&&xd(),a&&(mn=a),h=l?r.apply(c,l):r.call(c),mn=o,h},hc=function(e){return fo(e),e.scrollTrigger&&e.scrollTrigger.kill(!!ei),e.progress()<1&&qi(e,"onInterrupt"),e},$a,NC=[],kC=function(e){if(e)if(e=!e.name&&e.default||e,lv()||e.headless){var t=e.name,n=In(e),s=t&&!n&&e.init?function(){this._props=[]}:e,r={init:ch,render:_v,add:mv,kill:lH,modifier:aH,rawVars:0},o={targetTest:0,get:0,getSetter:vv,aliases:{},register:0};if(Tl(),e!==s){if(Qi[t])return;Ki(s,Ki(wd(e,r),o)),Sl(s.prototype,Sl(r,wd(e,o))),Qi[s.prop=t]=s,e.targetTest&&(Gu.push(s),uv[t]=1),t=(t==="css"?"CSS":t.charAt(0).toUpperCase()+t.substr(1))+"Plugin"}_C(t,s),e.register&&e.register(Fi,s,Pi)}else NC.push(e)},tn=255,uc={aqua:[0,tn,tn],lime:[0,tn,0],silver:[192,192,192],black:[0,0,0],maroon:[128,0,0],teal:[0,128,128],blue:[0,0,tn],navy:[0,0,128],white:[tn,tn,tn],olive:[128,128,0],yellow:[tn,tn,0],orange:[tn,165,0],gray:[128,128,128],purple:[128,0,128],green:[0,128,0],red:[tn,0,0],pink:[tn,192,203],cyan:[0,tn,tn],transparent:[tn,tn,tn,0]},Kp=function(e,t,n){return e+=e<0?1:e>1?-1:0,(e*6<1?t+(n-t)*e*6:e<.5?n:e*3<2?t+(n-t)*(2/3-e)*6:t)*tn+.5|0},OC=function(e,t,n){var s=e?br(e)?[e>>16,e>>8&tn,e&tn]:0:uc.black,r,o,a,l,c,h,u,d,f,p;if(!s){if(e.substr(-1)===","&&(e=e.substr(0,e.length-1)),uc[e])s=uc[e];else if(e.charAt(0)==="#"){if(e.length<6&&(r=e.charAt(1),o=e.charAt(2),a=e.charAt(3),e="#"+r+r+o+o+a+a+(e.length===5?e.charAt(4)+e.charAt(4):"")),e.length===9)return s=parseInt(e.substr(1,6),16),[s>>16,s>>8&tn,s&tn,parseInt(e.substr(7),16)/255];e=parseInt(e.substr(1),16),s=[e>>16,e>>8&tn,e&tn]}else if(e.substr(0,3)==="hsl"){if(s=p=e.match(xA),!t)l=+s[0]%360/360,c=+s[1]/100,h=+s[2]/100,o=h<=.5?h*(c+1):h+c-h*c,r=h*2-o,s.length>3&&(s[3]*=1),s[0]=Kp(l+1/3,r,o),s[1]=Kp(l,r,o),s[2]=Kp(l-1/3,r,o);else if(~e.indexOf("="))return s=e.match(pC),n&&s.length<4&&(s[3]=1),s}else s=e.match(xA)||uc.transparent;s=s.map(Number)}return t&&!p&&(r=s[0]/tn,o=s[1]/tn,a=s[2]/tn,u=Math.max(r,o,a),d=Math.min(r,o,a),h=(u+d)/2,u===d?l=c=0:(f=u-d,c=h>.5?f/(2-u-d):f/(u+d),l=u===r?(o-a)/f+(o<a?6:0):u===o?(a-r)/f+2:(r-o)/f+4,l*=60),s[0]=~~(l+.5),s[1]=~~(c*100+.5),s[2]=~~(h*100+.5)),n&&s.length<4&&(s[3]=1),s},UC=function(e){var t=[],n=[],s=-1;return e.split(oo).forEach(function(r){var o=r.match(Ka)||[];t.push.apply(t,o),n.push(s+=o.length+1)}),t.c=n,t},Qy=function(e,t,n){var s="",r=(e+s).match(oo),o=t?"hsla(":"rgba(",a=0,l,c,h,u;if(!r)return e;if(r=r.map(function(d){return(d=OC(d,t,1))&&o+(t?d[0]+","+d[1]+"%,"+d[2]+"%,"+d[3]:d.join(","))+")"}),n&&(h=UC(e),l=n.c,l.join(s)!==h.c.join(s)))for(c=e.replace(oo,"1").split(Ka),u=c.length-1;a<u;a++)s+=c[a]+(~l.indexOf(a)?r.shift()||o+"0,0,0,0)":(h.length?h:r.length?r:n).shift());if(!c)for(c=e.split(oo),u=c.length-1;a<u;a++)s+=c[a]+r[a];return s+c[u]},oo=function(){var i="(?:\\b(?:(?:rgb|rgba|hsl|hsla)\\(.+?\\))|\\B#(?:[0-9a-f]{3,4}){1,2}\\b",e;for(e in uc)i+="|"+e+"\\b";return new RegExp(i+")","gi")}(),jG=/hsl[a]?\(/,QC=function(e){var t=e.join(" "),n;if(oo.lastIndex=0,oo.test(t))return n=jG.test(t),e[1]=Qy(e[1],n),e[0]=Qy(e[0],n,UC(e[1])),!0},uh,Vi=function(){var i=Date.now,e=500,t=33,n=i(),s=n,r=1e3/240,o=r,a=[],l,c,h,u,d,f,p=function A(m){var g=i()-s,y=m===!0,_,v,b,T;if((g>e||g<0)&&(n+=g-t),s+=g,b=s-n,_=b-o,(_>0||y)&&(T=++u.frame,d=b-u.time*1e3,u.time=b=b/1e3,o+=_+(_>=r?4:r-_),v=1),y||(l=c(A)),v)for(f=0;f<a.length;f++)a[f](b,d,T,m)};return u={time:0,frame:0,tick:function(){p(!0)},deltaRatio:function(m){return d/(1e3/(m||60))},wake:function(){gC&&(!wA&&lv()&&(Ds=wA=window,cv=Ds.document||{},Yi.gsap=Fi,(Ds.gsapVersions||(Ds.gsapVersions=[])).push(Fi.version),vC(yd||Ds.GreenSockGlobals||!Ds.gsap&&Ds||{}),NC.forEach(kC)),h=typeof requestAnimationFrame<"u"&&requestAnimationFrame,l&&u.sleep(),c=h||function(m){return setTimeout(m,o-u.time*1e3+1|0)},uh=1,p(2))},sleep:function(){(h?cancelAnimationFrame:clearTimeout)(l),uh=0,c=ch},lagSmoothing:function(m,g){e=m||1/0,t=Math.min(g||33,e)},fps:function(m){r=1e3/(m||240),o=u.time*1e3+r},add:function(m,g,y){var _=g?function(v,b,T,L){m(v,b,T,L),u.remove(_)}:m;return u.remove(m),a[y?"unshift":"push"](_),Tl(),_},remove:function(m,g){~(g=a.indexOf(m))&&a.splice(g,1)&&f>=g&&f--},_listeners:a},u}(),Tl=function(){return!uh&&Vi.wake()},Ut={},XG=/^[\d.\-M][\d.\-,\s]/,YG=/["']/g,KG=function(e){for(var t={},n=e.substr(1,e.length-3).split(":"),s=n[0],r=1,o=n.length,a,l,c;r<o;r++)l=n[r],a=r!==o-1?l.lastIndexOf(","):l.length,c=l.substr(0,a),t[s]=isNaN(c)?c.replace(YG,"").trim():+c,s=l.substr(a+1).trim();return t},$G=function(e){var t=e.indexOf("(")+1,n=e.indexOf(")"),s=e.indexOf("(",t);return e.substring(t,~s&&s<n?e.indexOf(")",n+1):n)},JG=function(e){var t=(e+"").split("("),n=Ut[t[0]];return n&&t.length>1&&n.config?n.config.apply(null,~e.indexOf("{")?[KG(t[1])]:$G(e).split(",").map(bC)):Ut._CE&&XG.test(e)?Ut._CE("",e):n},VC=function(e){return function(t){return 1-e(1-t)}},zC=function i(e,t){for(var n=e._first,s;n;)n instanceof _i?i(n,t):n.vars.yoyoEase&&(!n._yoyo||!n._repeat)&&n._yoyo!==t&&(n.timeline?i(n.timeline,t):(s=n._ease,n._ease=n._yEase,n._yEase=s,n._yoyo=t)),n=n._next},Ko=function(e,t){return e&&(In(e)?e:Ut[e]||JG(e))||t},ma=function(e,t,n,s){n===void 0&&(n=function(l){return 1-t(1-l)}),s===void 0&&(s=function(l){return l<.5?t(l*2)/2:1-t((1-l)*2)/2});var r={easeIn:t,easeOut:n,easeInOut:s},o;return Ri(e,function(a){Ut[a]=Yi[a]=r,Ut[o=a.toLowerCase()]=n;for(var l in r)Ut[o+(l==="easeIn"?".in":l==="easeOut"?".out":".inOut")]=Ut[a+"."+l]=r[l]}),r},GC=function(e){return function(t){return t<.5?(1-e(1-t*2))/2:.5+e((t-.5)*2)/2}},$p=function i(e,t,n){var s=t>=1?t:1,r=(n||(e?.3:.45))/(t<1?t:1),o=r/yA*(Math.asin(1/s)||0),a=function(h){return h===1?1:s*Math.pow(2,-10*h)*SG((h-o)*r)+1},l=e==="out"?a:e==="in"?function(c){return 1-a(1-c)}:GC(a);return r=yA/r,l.config=function(c,h){return i(e,c,h)},l},Jp=function i(e,t){t===void 0&&(t=1.70158);var n=function(o){return o?--o*o*((t+1)*o+t)+1:0},s=e==="out"?n:e==="in"?function(r){return 1-n(1-r)}:GC(n);return s.config=function(r){return i(e,r)},s};Ri("Linear,Quad,Cubic,Quart,Quint,Strong",function(i,e){var t=e<5?e+1:e;ma(i+",Power"+(t-1),e?function(n){return Math.pow(n,t)}:function(n){return n},function(n){return 1-Math.pow(1-n,t)},function(n){return n<.5?Math.pow(n*2,t)/2:1-Math.pow((1-n)*2,t)/2})});Ut.Linear.easeNone=Ut.none=Ut.Linear.easeIn;ma("Elastic",$p("in"),$p("out"),$p());(function(i,e){var t=1/e,n=2*t,s=2.5*t,r=function(a){return a<t?i*a*a:a<n?i*Math.pow(a-1.5/e,2)+.75:a<s?i*(a-=2.25/e)*a+.9375:i*Math.pow(a-2.625/e,2)+.984375};ma("Bounce",function(o){return 1-r(1-o)},r)})(7.5625,2.75);ma("Expo",function(i){return Math.pow(2,10*(i-1))*i+i*i*i*i*i*i*(1-i)});ma("Circ",function(i){return-(dC(1-i*i)-1)});ma("Sine",function(i){return i===1?1:-CG(i*bG)+1});ma("Back",Jp("in"),Jp("out"),Jp());Ut.SteppedEase=Ut.steps=Yi.SteppedEase={config:function(e,t){e===void 0&&(e=1);var n=1/e,s=e+(t?0:1),r=t?1:0,o=1-hi;return function(a){return((s*Fh(0,o,a)|0)+r)*n}}};Cl.ease=Ut["quad.out"];Ri("onComplete,onUpdate,onStart,onRepeat,onReverseComplete,onInterrupt",function(i){return dv+=i+","+i+"Params,"});var HC=function(e,t){this.id=EG++,e._gsap=this,this.target=e,this.harness=t,this.get=t?t.get:xC,this.set=t?t.getSetter:vv},dh=function(){function i(t){this.vars=t,this._delay=+t.delay||0,(this._repeat=t.repeat===1/0?-2:t.repeat||0)&&(this._rDelay=t.repeatDelay||0,this._yoyo=!!t.yoyo||!!t.yoyoEase),this._ts=1,Ml(this,+t.duration,1,1),this.data=t.data,mn&&(this._ctx=mn,mn.data.push(this)),uh||Vi.wake()}var e=i.prototype;return e.delay=function(n){return n||n===0?(this.parent&&this.parent.smoothChildTiming&&this.startTime(this._start+n-this._delay),this._delay=n,this):this._delay},e.duration=function(n){return arguments.length?this.totalDuration(this._repeat>0?n+(n+this._rDelay)*this._repeat:n):this.totalDuration()&&this._dur},e.totalDuration=function(n){return arguments.length?(this._dirty=0,Ml(this,this._repeat<0?n:(n-this._repeat*this._rDelay)/(this._repeat+1))):this._tDur},e.totalTime=function(n,s){if(Tl(),!arguments.length)return this._tTime;var r=this._dp;if(r&&r.smoothChildTiming&&this._ts){for(ff(this,n),!r._dp||r.parent||SC(r,this);r&&r.parent;)r.parent._time!==r._start+(r._ts>=0?r._tTime/r._ts:(r.totalDuration()-r._tTime)/-r._ts)&&r.totalTime(r._tTime,!0),r=r.parent;!this.parent&&this._dp.autoRemoveChildren&&(this._ts>0&&n<this._tDur||this._ts<0&&n>0||!this._tDur&&!n)&&ks(this._dp,this,this._start-this._delay)}return(this._tTime!==n||!this._dur&&!s||this._initted&&Math.abs(this._zTime)===hi||!n&&!this._initted&&(this.add||this._ptLookup))&&(this._ts||(this._pTime=n),wC(this,n,s)),this},e.time=function(n,s){return arguments.length?this.totalTime(Math.min(this.totalDuration(),n+ky(this))%(this._dur+this._rDelay)||(n?this._dur:0),s):this._time},e.totalProgress=function(n,s){return arguments.length?this.totalTime(this.totalDuration()*n,s):this.totalDuration()?Math.min(1,this._tTime/this._tDur):this.rawTime()>=0&&this._initted?1:0},e.progress=function(n,s){return arguments.length?this.totalTime(this.duration()*(this._yoyo&&!(this.iteration()&1)?1-n:n)+ky(this),s):this.duration()?Math.min(1,this._time/this._dur):this.rawTime()>0?1:0},e.iteration=function(n,s){var r=this.duration()+this._rDelay;return arguments.length?this.totalTime(this._time+(n-1)*r,s):this._repeat?Il(this._tTime,r)+1:1},e.timeScale=function(n,s){if(!arguments.length)return this._rts===-1e-8?0:this._rts;if(this._rts===n)return this;var r=this.parent&&this._ts?bd(this.parent._time,this):this._tTime;return this._rts=+n||0,this._ts=this._ps||n===-1e-8?0:this._rts,this.totalTime(Fh(-Math.abs(this._delay),this.totalDuration(),r),s!==!1),df(this),DG(this)},e.paused=function(n){return arguments.length?(this._ps!==n&&(this._ps=n,n?(this._pTime=this._tTime||Math.max(-this._delay,this.rawTime()),this._ts=this._act=0):(Tl(),this._ts=this._rts,this.totalTime(this.parent&&!this.parent.smoothChildTiming?this.rawTime():this._tTime||this._pTime,this.progress()===1&&Math.abs(this._zTime)!==hi&&(this._tTime-=hi)))),this):this._ps},e.startTime=function(n){if(arguments.length){this._start=n;var s=this.parent||this._dp;return s&&(s._sort||!this.parent)&&ks(s,this,n-this._delay),this}return this._start},e.endTime=function(n){return this._start+(Bi(n)?this.totalDuration():this.duration())/Math.abs(this._ts||1)},e.rawTime=function(n){var s=this.parent||this._dp;return s?n&&(!this._ts||this._repeat&&this._time&&this.totalProgress()<1)?this._tTime%(this._dur+this._rDelay):this._ts?bd(s.rawTime(n),this):this._tTime:this._tTime},e.revert=function(n){n===void 0&&(n=TG);var s=ei;return ei=n,pv(this)&&(this.timeline&&this.timeline.revert(n),this.totalTime(-.01,n.suppressEvents)),this.data!=="nested"&&n.kill!==!1&&this.kill(),ei=s,this},e.globalTime=function(n){for(var s=this,r=arguments.length?n:s.rawTime();s;)r=s._start+r/(Math.abs(s._ts)||1),s=s._dp;return!this.parent&&this._sat?this._sat.globalTime(n):r},e.repeat=function(n){return arguments.length?(this._repeat=n===1/0?-2:n,Oy(this)):this._repeat===-2?1/0:this._repeat},e.repeatDelay=function(n){if(arguments.length){var s=this._time;return this._rDelay=n,Oy(this),s?this.time(s):this}return this._rDelay},e.yoyo=function(n){return arguments.length?(this._yoyo=n,this):this._yoyo},e.seek=function(n,s){return this.totalTime(ns(this,n),Bi(s))},e.restart=function(n,s){return this.play().totalTime(n?-this._delay:0,Bi(s)),this._dur||(this._zTime=-1e-8),this},e.play=function(n,s){return n!=null&&this.seek(n,s),this.reversed(!1).paused(!1)},e.reverse=function(n,s){return n!=null&&this.seek(n||this.totalDuration(),s),this.reversed(!0).paused(!1)},e.pause=function(n,s){return n!=null&&this.seek(n,s),this.paused(!0)},e.resume=function(){return this.paused(!1)},e.reversed=function(n){return arguments.length?(!!n!==this.reversed()&&this.timeScale(-this._rts||(n?-1e-8:0)),this):this._rts<0},e.invalidate=function(){return this._initted=this._act=0,this._zTime=-1e-8,this},e.isActive=function(){var n=this.parent||this._dp,s=this._start,r;return!!(!n||this._ts&&this._initted&&n.isActive()&&(r=n.rawTime(!0))>=s&&r<this.endTime(!0)-hi)},e.eventCallback=function(n,s,r){var o=this.vars;return arguments.length>1?(s?(o[n]=s,r&&(o[n+"Params"]=r),n==="onUpdate"&&(this._onUpdate=s)):delete o[n],this):o[n]},e.then=function(n){var s=this;return new Promise(function(r){var o=In(n)?n:EC,a=function(){var c=s.then;s.then=null,In(o)&&(o=o(s))&&(o.then||o===s)&&(s.then=c),r(o),s.then=c};s._initted&&s.totalProgress()===1&&s._ts>=0||!s._tTime&&s._ts<0?a():s._prom=a})},e.kill=function(){hc(this)},i}();Ki(dh.prototype,{_time:0,_start:0,_end:0,_tTime:0,_tDur:0,_dirty:0,_repeat:0,_yoyo:!1,parent:null,_initted:!1,_rDelay:0,_ts:1,_dp:0,ratio:0,_zTime:-1e-8,_prom:0,_ps:!1,_rts:1});var _i=function(i){uC(e,i);function e(n,s){var r;return n===void 0&&(n={}),r=i.call(this,n)||this,r.labels={},r.smoothChildTiming=!!n.smoothChildTiming,r.autoRemoveChildren=!!n.autoRemoveChildren,r._sort=Bi(n.sortChildren),gn&&ks(n.parent||gn,hr(r),s),n.reversed&&r.reverse(),n.paused&&r.paused(!0),n.scrollTrigger&&IC(hr(r),n.scrollTrigger),r}var t=e.prototype;return t.to=function(s,r,o){return kc(0,arguments,this),this},t.from=function(s,r,o){return kc(1,arguments,this),this},t.fromTo=function(s,r,o,a){return kc(2,arguments,this),this},t.set=function(s,r,o){return r.duration=0,r.parent=this,Nc(r).repeatDelay||(r.repeat=0),r.immediateRender=!!r.immediateRender,new Ln(s,r,ns(this,o),1),this},t.call=function(s,r,o){return ks(this,Ln.delayedCall(0,s,r),o)},t.staggerTo=function(s,r,o,a,l,c,h){return o.duration=r,o.stagger=o.stagger||a,o.onComplete=c,o.onCompleteParams=h,o.parent=this,new Ln(s,o,ns(this,l)),this},t.staggerFrom=function(s,r,o,a,l,c,h){return o.runBackwards=1,Nc(o).immediateRender=Bi(o.immediateRender),this.staggerTo(s,r,o,a,l,c,h)},t.staggerFromTo=function(s,r,o,a,l,c,h,u){return a.startAt=o,Nc(a).immediateRender=Bi(a.immediateRender),this.staggerTo(s,r,a,l,c,h,u)},t.render=function(s,r,o){var a=this._time,l=this._dirty?this.totalDuration():this._tDur,c=this._dur,h=s<=0?0:Fn(s),u=this._zTime<0!=s<0&&(this._initted||!c),d,f,p,A,m,g,y,_,v,b,T,L;if(this!==gn&&h>l&&s>=0&&(h=l),h!==this._tTime||o||u){if(a!==this._time&&c&&(h+=this._time-a,s+=this._time-a),d=h,v=this._start,_=this._ts,g=!_,u&&(c||(a=this._zTime),(s||!r)&&(this._zTime=s)),this._repeat){if(T=this._yoyo,m=c+this._rDelay,this._repeat<-1&&s<0)return this.totalTime(m*100+s,r,o);if(d=Fn(h%m),h===l?(A=this._repeat,d=c):(b=Fn(h/m),A=~~b,A&&A===b&&(d=c,A--),d>c&&(d=c)),b=Il(this._tTime,m),!a&&this._tTime&&b!==A&&this._tTime-b*m-this._dur<=0&&(b=A),T&&A&1&&(d=c-d,L=1),A!==b&&!this._lock){var I=T&&b&1,x=I===(T&&A&1);if(A<b&&(I=!I),a=I?0:h%c?c:h,this._lock=1,this.render(a||(L?0:Fn(A*m)),r,!c)._lock=0,this._tTime=h,!r&&this.parent&&qi(this,"onRepeat"),this.vars.repeatRefresh&&!L&&(this.invalidate()._lock=1),a&&a!==this._time||g!==!this._ts||this.vars.onRepeat&&!this.parent&&!this._act)return this;if(c=this._dur,l=this._tDur,x&&(this._lock=2,a=I?c:-1e-4,this.render(a,!0),this.vars.repeatRefresh&&!L&&this.invalidate()),this._lock=0,!this._ts&&!g)return this;zC(this,L)}}if(this._hasPause&&!this._forcing&&this._lock<2&&(y=kG(this,Fn(a),Fn(d)),y&&(h-=d-(d=y._start))),this._tTime=h,this._time=d,this._act=!_,this._initted||(this._onUpdate=this.vars.onUpdate,this._initted=1,this._zTime=s,a=0),!a&&h&&!r&&!b&&(qi(this,"onStart"),this._tTime!==h))return this;if(d>=a&&s>=0)for(f=this._first;f;){if(p=f._next,(f._act||d>=f._start)&&f._ts&&y!==f){if(f.parent!==this)return this.render(s,r,o);if(f.render(f._ts>0?(d-f._start)*f._ts:(f._dirty?f.totalDuration():f._tDur)+(d-f._start)*f._ts,r,o),d!==this._time||!this._ts&&!g){y=0,p&&(h+=this._zTime=-1e-8);break}}f=p}else{f=this._last;for(var w=s<0?s:d;f;){if(p=f._prev,(f._act||w<=f._end)&&f._ts&&y!==f){if(f.parent!==this)return this.render(s,r,o);if(f.render(f._ts>0?(w-f._start)*f._ts:(f._dirty?f.totalDuration():f._tDur)+(w-f._start)*f._ts,r,o||ei&&pv(f)),d!==this._time||!this._ts&&!g){y=0,p&&(h+=this._zTime=w?-1e-8:hi);break}}f=p}}if(y&&!r&&(this.pause(),y.render(d>=a?0:-1e-8)._zTime=d>=a?1:-1,this._ts))return this._start=v,df(this),this.render(s,r,o);this._onUpdate&&!r&&qi(this,"onUpdate",!0),(h===l&&this._tTime>=this.totalDuration()||!h&&a)&&(v===this._start||Math.abs(_)!==Math.abs(this._ts))&&(this._lock||((s||!c)&&(h===l&&this._ts>0||!h&&this._ts<0)&&fo(this,1),!r&&!(s<0&&!a)&&(h||a||!l)&&(qi(this,h===l&&s>=0?"onComplete":"onReverseComplete",!0),this._prom&&!(h<l&&this.timeScale()>0)&&this._prom())))}return this},t.add=function(s,r){var o=this;if(br(r)||(r=ns(this,r,s)),!(s instanceof dh)){if(ui(s))return s.forEach(function(a){return o.add(a,r)}),this;if(Jn(s))return this.addLabel(s,r);if(In(s))s=Ln.delayedCall(0,s);else return this}return this!==s?ks(this,s,r):this},t.getChildren=function(s,r,o,a){s===void 0&&(s=!0),r===void 0&&(r=!0),o===void 0&&(o=!0),a===void 0&&(a=-1e8);for(var l=[],c=this._first;c;)c._start>=a&&(c instanceof Ln?r&&l.push(c):(o&&l.push(c),s&&l.push.apply(l,c.getChildren(!0,r,o)))),c=c._next;return l},t.getById=function(s){for(var r=this.getChildren(1,1,1),o=r.length;o--;)if(r[o].vars.id===s)return r[o]},t.remove=function(s){return Jn(s)?this.removeLabel(s):In(s)?this.killTweensOf(s):(s.parent===this&&uf(this,s),s===this._recent&&(this._recent=this._last),Yo(this))},t.totalTime=function(s,r){return arguments.length?(this._forcing=1,!this._dp&&this._ts&&(this._start=Fn(Vi.time-(this._ts>0?s/this._ts:(this.totalDuration()-s)/-this._ts))),i.prototype.totalTime.call(this,s,r),this._forcing=0,this):this._tTime},t.addLabel=function(s,r){return this.labels[s]=ns(this,r),this},t.removeLabel=function(s){return delete this.labels[s],this},t.addPause=function(s,r,o){var a=Ln.delayedCall(0,r||ch,o);return a.data="isPause",this._hasPause=1,ks(this,a,ns(this,s))},t.removePause=function(s){var r=this._first;for(s=ns(this,s);r;)r._start===s&&r.data==="isPause"&&fo(r),r=r._next},t.killTweensOf=function(s,r,o){for(var a=this.getTweensOf(s,o),l=a.length;l--;)Kr!==a[l]&&a[l].kill(s,r);return this},t.getTweensOf=function(s,r){for(var o=[],a=ls(s),l=this._first,c=br(r),h;l;)l instanceof Ln?BG(l._targets,a)&&(c?(!Kr||l._initted&&l._ts)&&l.globalTime(0)<=r&&l.globalTime(l.totalDuration())>r:!r||l.isActive())&&o.push(l):(h=l.getTweensOf(a,r)).length&&o.push.apply(o,h),l=l._next;return o},t.tweenTo=function(s,r){r=r||{};var o=this,a=ns(o,s),l=r,c=l.startAt,h=l.onStart,u=l.onStartParams,d=l.immediateRender,f,p=Ln.to(o,Ki({ease:r.ease||"none",lazy:!1,immediateRender:!1,time:a,overwrite:"auto",duration:r.duration||Math.abs((a-(c&&"time"in c?c.time:o._time))/o.timeScale())||hi,onStart:function(){if(o.pause(),!f){var m=r.duration||Math.abs((a-(c&&"time"in c?c.time:o._time))/o.timeScale());p._dur!==m&&Ml(p,m,0,1).render(p._time,!0,!0),f=1}h&&h.apply(p,u||[])}},r));return d?p.render(0):p},t.tweenFromTo=function(s,r,o){return this.tweenTo(r,Ki({startAt:{time:ns(this,s)}},o))},t.recent=function(){return this._recent},t.nextLabel=function(s){return s===void 0&&(s=this._time),Uy(this,ns(this,s))},t.previousLabel=function(s){return s===void 0&&(s=this._time),Uy(this,ns(this,s),1)},t.currentLabel=function(s){return arguments.length?this.seek(s,!0):this.previousLabel(this._time+hi)},t.shiftChildren=function(s,r,o){o===void 0&&(o=0);for(var a=this._first,l=this.labels,c;a;)a._start>=o&&(a._start+=s,a._end+=s),a=a._next;if(r)for(c in l)l[c]>=o&&(l[c]+=s);return Yo(this)},t.invalidate=function(s){var r=this._first;for(this._lock=0;r;)r.invalidate(s),r=r._next;return i.prototype.invalidate.call(this,s)},t.clear=function(s){s===void 0&&(s=!0);for(var r=this._first,o;r;)o=r._next,this.remove(r),r=o;return this._dp&&(this._time=this._tTime=this._pTime=0),s&&(this.labels={}),Yo(this)},t.totalDuration=function(s){var r=0,o=this,a=o._last,l=zs,c,h,u;if(arguments.length)return o.timeScale((o._repeat<0?o.duration():o.totalDuration())/(o.reversed()?-s:s));if(o._dirty){for(u=o.parent;a;)c=a._prev,a._dirty&&a.totalDuration(),h=a._start,h>l&&o._sort&&a._ts&&!o._lock?(o._lock=1,ks(o,a,h-a._delay,1)._lock=0):l=h,h<0&&a._ts&&(r-=h,(!u&&!o._dp||u&&u.smoothChildTiming)&&(o._start+=h/o._ts,o._time-=h,o._tTime-=h),o.shiftChildren(-h,!1,-1/0),l=0),a._end>r&&a._ts&&(r=a._end),a=c;Ml(o,o===gn&&o._time>r?o._time:r,1,1),o._dirty=0}return o._tDur},e.updateRoot=function(s){if(gn._ts&&(wC(gn,bd(s,gn)),yC=Vi.frame),Vi.frame>=Fy){Fy+=Xi.autoSleep||120;var r=gn._first;if((!r||!r._ts)&&Xi.autoSleep&&Vi._listeners.length<2){for(;r&&!r._ts;)r=r._next;r||Vi.sleep()}}},e}(dh);Ki(_i.prototype,{_lock:0,_hasPause:0,_forcing:0});var ZG=function(e,t,n,s,r,o,a){var l=new Pi(this._pt,e,t,0,1,KC,null,r),c=0,h=0,u,d,f,p,A,m,g,y;for(l.b=n,l.e=s,n+="",s+="",(g=~s.indexOf("random("))&&(s=hh(s)),o&&(y=[n,s],o(y,e,t),n=y[0],s=y[1]),d=n.match(Xp)||[];u=Xp.exec(s);)p=u[0],A=s.substring(c,u.index),f?f=(f+1)%5:A.substr(-5)==="rgba("&&(f=1),p!==d[h++]&&(m=parseFloat(d[h-1])||0,l._pt={_next:l._pt,p:A||h===1?A:",",s:m,c:p.charAt(1)==="="?dl(m,p)-m:parseFloat(p)-m,m:f&&f<4?Math.round:0},c=Xp.lastIndex);return l.c=c<s.length?s.substring(c,s.length):"",l.fp=a,(mC.test(s)||g)&&(l.e=0),this._pt=l,l},mv=function(e,t,n,s,r,o,a,l,c,h){In(s)&&(s=s(r||0,e,o));var u=e[t],d=n!=="get"?n:In(u)?c?e[t.indexOf("set")||!In(e["get"+t.substr(3)])?t:"get"+t.substr(3)](c):e[t]():u,f=In(u)?c?sH:XC:gv,p;if(Jn(s)&&(~s.indexOf("random(")&&(s=hh(s)),s.charAt(1)==="="&&(p=dl(d,s)+(ci(d)||0),(p||p===0)&&(s=p))),!h||d!==s||TA)return!isNaN(d*s)&&s!==""?(p=new Pi(this._pt,e,t,+d||0,s-(d||0),typeof u=="boolean"?oH:YC,0,f),c&&(p.fp=c),a&&p.modifier(a,this,e),this._pt=p):(!u&&!(t in e)&&hv(t,s),ZG.call(this,e,t,d,s,f,l||Xi.stringFilter,c))},eH=function(e,t,n,s,r){if(In(e)&&(e=Oc(e,r,t,n,s)),!js(e)||e.style&&e.nodeType||ui(e)||fC(e))return Jn(e)?Oc(e,r,t,n,s):e;var o={},a;for(a in e)o[a]=Oc(e[a],r,t,n,s);return o},WC=function(e,t,n,s,r,o){var a,l,c,h;if(Qi[e]&&(a=new Qi[e]).init(r,a.rawVars?t[e]:eH(t[e],s,r,o,n),n,s,o)!==!1&&(n._pt=l=new Pi(n._pt,r,e,0,1,a.render,a,0,a.priority),n!==$a))for(c=n._ptLookup[n._targets.indexOf(r)],h=a._props.length;h--;)c[a._props[h]]=l;return a},Kr,TA,Av=function i(e,t,n){var s=e.vars,r=s.ease,o=s.startAt,a=s.immediateRender,l=s.lazy,c=s.onUpdate,h=s.runBackwards,u=s.yoyoEase,d=s.keyframes,f=s.autoRevert,p=e._dur,A=e._startAt,m=e._targets,g=e.parent,y=g&&g.data==="nested"?g.vars.targets:m,_=e._overwrite==="auto"&&!ov,v=e.timeline,b,T,L,I,x,w,P,z,H,K,le,J,W;if(v&&(!d||!r)&&(r="none"),e._ease=Ko(r,Cl.ease),e._yEase=u?VC(Ko(u===!0?r:u,Cl.ease)):0,u&&e._yoyo&&!e._repeat&&(u=e._yEase,e._yEase=e._ease,e._ease=u),e._from=!v&&!!s.runBackwards,!v||d&&!s.stagger){if(z=m[0]?Xo(m[0]).harness:0,J=z&&s[z.prop],b=wd(s,uv),A&&(A._zTime<0&&A.progress(1),t<0&&h&&a&&!f?A.render(-1,!0):A.revert(h&&p?zu:MG),A._lazy=0),o){if(fo(e._startAt=Ln.set(m,Ki({data:"isStart",overwrite:!1,parent:g,immediateRender:!0,lazy:!A&&Bi(l),startAt:null,delay:0,onUpdate:c&&function(){return qi(e,"onUpdate")},stagger:0},o))),e._startAt._dp=0,e._startAt._sat=e,t<0&&(ei||!a&&!f)&&e._startAt.revert(zu),a&&p&&t<=0&&n<=0){t&&(e._zTime=t);return}}else if(h&&p&&!A){if(t&&(a=!1),L=Ki({overwrite:!1,data:"isFromStart",lazy:a&&!A&&Bi(l),immediateRender:a,stagger:0,parent:g},b),J&&(L[z.prop]=J),fo(e._startAt=Ln.set(m,L)),e._startAt._dp=0,e._startAt._sat=e,t<0&&(ei?e._startAt.revert(zu):e._startAt.render(-1,!0)),e._zTime=t,!a)i(e._startAt,hi,hi);else if(!t)return}for(e._pt=e._ptCache=0,l=p&&Bi(l)||l&&!p,T=0;T<m.length;T++){if(x=m[T],P=x._gsap||fv(m)[T]._gsap,e._ptLookup[T]=K={},bA[P.id]&&ro.length&&xd(),le=y===m?T:y.indexOf(x),z&&(H=new z).init(x,J||b,e,le,y)!==!1&&(e._pt=I=new Pi(e._pt,x,H.name,0,1,H.render,H,0,H.priority),H._props.forEach(function(O){K[O]=I}),H.priority&&(w=1)),!z||J)for(L in b)Qi[L]&&(H=WC(L,b,e,le,x,y))?H.priority&&(w=1):K[L]=I=mv.call(e,x,L,"get",b[L],le,y,0,s.stringFilter);e._op&&e._op[T]&&e.kill(x,e._op[T]),_&&e._pt&&(Kr=e,gn.killTweensOf(x,K,e.globalTime(t)),W=!e.parent,Kr=0),e._pt&&l&&(bA[P.id]=1)}w&&$C(e),e._onInit&&e._onInit(e)}e._onUpdate=c,e._initted=(!e._op||e._pt)&&!W,d&&t<=0&&v.render(zs,!0,!0)},tH=function(e,t,n,s,r,o,a,l){var c=(e._pt&&e._ptCache||(e._ptCache={}))[t],h,u,d,f;if(!c)for(c=e._ptCache[t]=[],d=e._ptLookup,f=e._targets.length;f--;){if(h=d[f][t],h&&h.d&&h.d._pt)for(h=h.d._pt;h&&h.p!==t&&h.fp!==t;)h=h._next;if(!h)return TA=1,e.vars[t]="+=0",Av(e,a),TA=0,l?lh(t+" not eligible for reset"):1;c.push(h)}for(f=c.length;f--;)u=c[f],h=u._pt||u,h.s=(s||s===0)&&!r?s:h.s+(s||0)+o*h.c,h.c=n-h.s,u.e&&(u.e=Bn(n)+ci(u.e)),u.b&&(u.b=h.s+ci(u.b))},nH=function(e,t){var n=e[0]?Xo(e[0]).harness:0,s=n&&n.aliases,r,o,a,l;if(!s)return t;r=Sl({},t);for(o in s)if(o in r)for(l=s[o].split(","),a=l.length;a--;)r[l[a]]=r[o];return r},iH=function(e,t,n,s){var r=t.ease||s||"power1.inOut",o,a;if(ui(t))a=n[e]||(n[e]=[]),t.forEach(function(l,c){return a.push({t:c/(t.length-1)*100,v:l,e:r})});else for(o in t)a=n[o]||(n[o]=[]),o==="ease"||a.push({t:parseFloat(e),v:t[o],e:r})},Oc=function(e,t,n,s,r){return In(e)?e.call(t,n,s,r):Jn(e)&&~e.indexOf("random(")?hh(e):e},qC=dv+"repeat,repeatDelay,yoyo,repeatRefresh,yoyoEase,autoRevert",jC={};Ri(qC+",id,stagger,delay,duration,paused,scrollTrigger",function(i){return jC[i]=1});var Ln=function(i){uC(e,i);function e(n,s,r,o){var a;typeof s=="number"&&(r.duration=s,s=r,r=null),a=i.call(this,o?s:Nc(s))||this;var l=a.vars,c=l.duration,h=l.delay,u=l.immediateRender,d=l.stagger,f=l.overwrite,p=l.keyframes,A=l.defaults,m=l.scrollTrigger,g=l.yoyoEase,y=s.parent||gn,_=(ui(n)||fC(n)?br(n[0]):"length"in s)?[n]:ls(n),v,b,T,L,I,x,w,P;if(a._targets=_.length?fv(_):lh("GSAP target "+n+" not found. https://gsap.com",!Xi.nullTargetWarn)||[],a._ptLookup=[],a._overwrite=f,p||d||Bu(c)||Bu(h)){if(s=a.vars,v=a.timeline=new _i({data:"nested",defaults:A||{},targets:y&&y.data==="nested"?y.vars.targets:_}),v.kill(),v.parent=v._dp=hr(a),v._start=0,d||Bu(c)||Bu(h)){if(L=_.length,w=d&&RC(d),js(d))for(I in d)~qC.indexOf(I)&&(P||(P={}),P[I]=d[I]);for(b=0;b<L;b++)T=wd(s,jC),T.stagger=0,g&&(T.yoyoEase=g),P&&Sl(T,P),x=_[b],T.duration=+Oc(c,hr(a),b,x,_),T.delay=(+Oc(h,hr(a),b,x,_)||0)-a._delay,!d&&L===1&&T.delay&&(a._delay=h=T.delay,a._start+=h,T.delay=0),v.to(x,T,w?w(b,x,_):0),v._ease=Ut.none;v.duration()?c=h=0:a.timeline=0}else if(p){Nc(Ki(v.vars.defaults,{ease:"none"})),v._ease=Ko(p.ease||s.ease||"none");var z=0,H,K,le;if(ui(p))p.forEach(function(J){return v.to(_,J,">")}),v.duration();else{T={};for(I in p)I==="ease"||I==="easeEach"||iH(I,p[I],T,p.easeEach);for(I in T)for(H=T[I].sort(function(J,W){return J.t-W.t}),z=0,b=0;b<H.length;b++)K=H[b],le={ease:K.e,duration:(K.t-(b?H[b-1].t:0))/100*c},le[I]=K.v,v.to(_,le,z),z+=le.duration;v.duration()<c&&v.to({},{duration:c-v.duration()})}}c||a.duration(c=v.duration())}else a.timeline=0;return f===!0&&!ov&&(Kr=hr(a),gn.killTweensOf(_),Kr=0),ks(y,hr(a),r),s.reversed&&a.reverse(),s.paused&&a.paused(!0),(u||!c&&!p&&a._start===Fn(y._time)&&Bi(u)&&LG(hr(a))&&y.data!=="nested")&&(a._tTime=-1e-8,a.render(Math.max(0,-h)||0)),m&&IC(hr(a),m),a}var t=e.prototype;return t.render=function(s,r,o){var a=this._time,l=this._tDur,c=this._dur,h=s<0,u=s>l-hi&&!h?l:s<hi?0:s,d,f,p,A,m,g,y,_,v;if(!c)NG(this,s,r,o);else if(u!==this._tTime||!s||o||!this._initted&&this._tTime||this._startAt&&this._zTime<0!==h||this._lazy){if(d=u,_=this.timeline,this._repeat){if(A=c+this._rDelay,this._repeat<-1&&h)return this.totalTime(A*100+s,r,o);if(d=Fn(u%A),u===l?(p=this._repeat,d=c):(m=Fn(u/A),p=~~m,p&&p===m?(d=c,p--):d>c&&(d=c)),g=this._yoyo&&p&1,g&&(v=this._yEase,d=c-d),m=Il(this._tTime,A),d===a&&!o&&this._initted&&p===m)return this._tTime=u,this;p!==m&&(_&&this._yEase&&zC(_,g),this.vars.repeatRefresh&&!g&&!this._lock&&d!==A&&this._initted&&(this._lock=o=1,this.render(Fn(A*p),!0).invalidate()._lock=0))}if(!this._initted){if(MC(this,h?s:d,o,r,u))return this._tTime=0,this;if(a!==this._time&&!(o&&this.vars.repeatRefresh&&p!==m))return this;if(c!==this._dur)return this.render(s,r,o)}if(this._tTime=u,this._time=d,!this._act&&this._ts&&(this._act=1,this._lazy=0),this.ratio=y=(v||this._ease)(d/c),this._from&&(this.ratio=y=1-y),!a&&u&&!r&&!m&&(qi(this,"onStart"),this._tTime!==u))return this;for(f=this._pt;f;)f.r(y,f.d),f=f._next;_&&_.render(s<0?s:_._dur*_._ease(d/this._dur),r,o)||this._startAt&&(this._zTime=s),this._onUpdate&&!r&&(h&&EA(this,s,r,o),qi(this,"onUpdate")),this._repeat&&p!==m&&this.vars.onRepeat&&!r&&this.parent&&qi(this,"onRepeat"),(u===this._tDur||!u)&&this._tTime===u&&(h&&!this._onUpdate&&EA(this,s,!0,!0),(s||!c)&&(u===this._tDur&&this._ts>0||!u&&this._ts<0)&&fo(this,1),!r&&!(h&&!a)&&(u||a||g)&&(qi(this,u===l?"onComplete":"onReverseComplete",!0),this._prom&&!(u<l&&this.timeScale()>0)&&this._prom()))}return this},t.targets=function(){return this._targets},t.invalidate=function(s){return(!s||!this.vars.runBackwards)&&(this._startAt=0),this._pt=this._op=this._onUpdate=this._lazy=this.ratio=0,this._ptLookup=[],this.timeline&&this.timeline.invalidate(s),i.prototype.invalidate.call(this,s)},t.resetTo=function(s,r,o,a,l){uh||Vi.wake(),this._ts||this.play();var c=Math.min(this._dur,(this._dp._time-this._start)*this._ts),h;return this._initted||Av(this,c),h=this._ease(c/this._dur),tH(this,s,r,o,a,h,c,l)?this.resetTo(s,r,o,a,1):(ff(this,0),this.parent||CC(this._dp,this,"_first","_last",this._dp._sort?"_start":0),this.render(0))},t.kill=function(s,r){if(r===void 0&&(r="all"),!s&&(!r||r==="all"))return this._lazy=this._pt=0,this.parent?hc(this):this.scrollTrigger&&this.scrollTrigger.kill(!!ei),this;if(this.timeline){var o=this.timeline.totalDuration();return this.timeline.killTweensOf(s,r,Kr&&Kr.vars.overwrite!==!0)._first||hc(this),this.parent&&o!==this.timeline.totalDuration()&&Ml(this,this._dur*this.timeline._tDur/o,0,1),this}var a=this._targets,l=s?ls(s):a,c=this._ptLookup,h=this._pt,u,d,f,p,A,m,g;if((!r||r==="all")&&PG(a,l))return r==="all"&&(this._pt=0),hc(this);for(u=this._op=this._op||[],r!=="all"&&(Jn(r)&&(A={},Ri(r,function(y){return A[y]=1}),r=A),r=nH(a,r)),g=a.length;g--;)if(~l.indexOf(a[g])){d=c[g],r==="all"?(u[g]=r,p=d,f={}):(f=u[g]=u[g]||{},p=r);for(A in p)m=d&&d[A],m&&((!("kill"in m.d)||m.d.kill(A)===!0)&&uf(this,m,"_pt"),delete d[A]),f!=="all"&&(f[A]=1)}return this._initted&&!this._pt&&h&&hc(this),this},e.to=function(s,r){return new e(s,r,arguments[2])},e.from=function(s,r){return kc(1,arguments)},e.delayedCall=function(s,r,o,a){return new e(r,0,{immediateRender:!1,lazy:!1,overwrite:!1,delay:s,onComplete:r,onReverseComplete:r,onCompleteParams:o,onReverseCompleteParams:o,callbackScope:a})},e.fromTo=function(s,r,o){return kc(2,arguments)},e.set=function(s,r){return r.duration=0,r.repeatDelay||(r.repeat=0),new e(s,r)},e.killTweensOf=function(s,r,o){return gn.killTweensOf(s,r,o)},e}(dh);Ki(Ln.prototype,{_targets:[],_lazy:0,_startAt:0,_op:0,_onInit:0});Ri("staggerTo,staggerFrom,staggerFromTo",function(i){Ln[i]=function(){var e=new _i,t=SA.call(arguments,0);return t.splice(i==="staggerFromTo"?5:4,0,0),e[i].apply(e,t)}});var gv=function(e,t,n){return e[t]=n},XC=function(e,t,n){return e[t](n)},sH=function(e,t,n,s){return e[t](s.fp,n)},rH=function(e,t,n){return e.setAttribute(t,n)},vv=function(e,t){return In(e[t])?XC:av(e[t])&&e.setAttribute?rH:gv},YC=function(e,t){return t.set(t.t,t.p,Math.round((t.s+t.c*e)*1e6)/1e6,t)},oH=function(e,t){return t.set(t.t,t.p,!!(t.s+t.c*e),t)},KC=function(e,t){var n=t._pt,s="";if(!e&&t.b)s=t.b;else if(e===1&&t.e)s=t.e;else{for(;n;)s=n.p+(n.m?n.m(n.s+n.c*e):Math.round((n.s+n.c*e)*1e4)/1e4)+s,n=n._next;s+=t.c}t.set(t.t,t.p,s,t)},_v=function(e,t){for(var n=t._pt;n;)n.r(e,n.d),n=n._next},aH=function(e,t,n,s){for(var r=this._pt,o;r;)o=r._next,r.p===s&&r.modifier(e,t,n),r=o},lH=function(e){for(var t=this._pt,n,s;t;)s=t._next,t.p===e&&!t.op||t.op===e?uf(this,t,"_pt"):t.dep||(n=1),t=s;return!n},cH=function(e,t,n,s){s.mSet(e,t,s.m.call(s.tween,n,s.mt),s)},$C=function(e){for(var t=e._pt,n,s,r,o;t;){for(n=t._next,s=r;s&&s.pr>t.pr;)s=s._next;(t._prev=s?s._prev:o)?t._prev._next=t:r=t,(t._next=s)?s._prev=t:o=t,t=n}e._pt=r},Pi=function(){function i(t,n,s,r,o,a,l,c,h){this.t=n,this.s=r,this.c=o,this.p=s,this.r=a||YC,this.d=l||this,this.set=c||gv,this.pr=h||0,this._next=t,t&&(t._prev=this)}var e=i.prototype;return e.modifier=function(n,s,r){this.mSet=this.mSet||this.set,this.set=cH,this.m=n,this.mt=r,this.tween=s},i}();Ri(dv+"parent,duration,ease,delay,overwrite,runBackwards,startAt,yoyo,immediateRender,repeat,repeatDelay,data,paused,reversed,lazy,callbackScope,stringFilter,id,yoyoEase,stagger,inherit,repeatRefresh,keyframes,autoRevert,scrollTrigger",function(i){return uv[i]=1});Yi.TweenMax=Yi.TweenLite=Ln;Yi.TimelineLite=Yi.TimelineMax=_i;gn=new _i({sortChildren:!1,defaults:Cl,autoRemoveChildren:!0,id:"root",smoothChildTiming:!0});Xi.stringFilter=QC;var $o=[],Hu={},hH=[],Vy=0,uH=0,Zp=function(e){return(Hu[e]||hH).map(function(t){return t()})},BA=function(){var e=Date.now(),t=[];e-Vy>2&&(Zp("matchMediaInit"),$o.forEach(function(n){var s=n.queries,r=n.conditions,o,a,l,c;for(a in s)o=Ds.matchMedia(s[a]).matches,o&&(l=1),o!==r[a]&&(r[a]=o,c=1);c&&(n.revert(),l&&t.push(n))}),Zp("matchMediaRevert"),t.forEach(function(n){return n.onMatch(n,function(s){return n.add(null,s)})}),Vy=e,Zp("matchMedia"))},JC=function(){function i(t,n){this.selector=n&&IA(n),this.data=[],this._r=[],this.isReverted=!1,this.id=uH++,t&&this.add(t)}var e=i.prototype;return e.add=function(n,s,r){In(n)&&(r=s,s=n,n=In);var o=this,a=function(){var c=mn,h=o.selector,u;return c&&c!==o&&c.data.push(o),r&&(o.selector=IA(r)),mn=o,u=s.apply(o,arguments),In(u)&&o._r.push(u),mn=c,o.selector=h,o.isReverted=!1,u};return o.last=a,n===In?a(o,function(l){return o.add(null,l)}):n?o[n]=a:a},e.ignore=function(n){var s=mn;mn=null,n(this),mn=s},e.getTweens=function(){var n=[];return this.data.forEach(function(s){return s instanceof i?n.push.apply(n,s.getTweens()):s instanceof Ln&&!(s.parent&&s.parent.data==="nested")&&n.push(s)}),n},e.clear=function(){this._r.length=this.data.length=0},e.kill=function(n,s){var r=this;if(n?function(){for(var a=r.getTweens(),l=r.data.length,c;l--;)c=r.data[l],c.data==="isFlip"&&(c.revert(),c.getChildren(!0,!0,!1).forEach(function(h){return a.splice(a.indexOf(h),1)}));for(a.map(function(h){return{g:h._dur||h._delay||h._sat&&!h._sat.vars.immediateRender?h.globalTime(0):-1/0,t:h}}).sort(function(h,u){return u.g-h.g||-1/0}).forEach(function(h){return h.t.revert(n)}),l=r.data.length;l--;)c=r.data[l],c instanceof _i?c.data!=="nested"&&(c.scrollTrigger&&c.scrollTrigger.revert(),c.kill()):!(c instanceof Ln)&&c.revert&&c.revert(n);r._r.forEach(function(h){return h(n,r)}),r.isReverted=!0}():this.data.forEach(function(a){return a.kill&&a.kill()}),this.clear(),s)for(var o=$o.length;o--;)$o[o].id===this.id&&$o.splice(o,1)},e.revert=function(n){this.kill(n||{})},i}(),dH=function(){function i(t){this.contexts=[],this.scope=t,mn&&mn.data.push(this)}var e=i.prototype;return e.add=function(n,s,r){js(n)||(n={matches:n});var o=new JC(0,r||this.scope),a=o.conditions={},l,c,h;mn&&!o.selector&&(o.selector=mn.selector),this.contexts.push(o),s=o.add("onMatch",s),o.queries=n;for(c in n)c==="all"?h=1:(l=Ds.matchMedia(n[c]),l&&($o.indexOf(o)<0&&$o.push(o),(a[c]=l.matches)&&(h=1),l.addListener?l.addListener(BA):l.addEventListener("change",BA)));return h&&s(o,function(u){return o.add(null,u)}),this},e.revert=function(n){this.kill(n||{})},e.kill=function(n){this.contexts.forEach(function(s){return s.kill(n,!0)})},i}(),Ed={registerPlugin:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];t.forEach(function(s){return kC(s)})},timeline:function(e){return new _i(e)},getTweensOf:function(e,t){return gn.getTweensOf(e,t)},getProperty:function(e,t,n,s){Jn(e)&&(e=ls(e)[0]);var r=Xo(e||{}).get,o=n?EC:bC;return n==="native"&&(n=""),e&&(t?o((Qi[t]&&Qi[t].get||r)(e,t,n,s)):function(a,l,c){return o((Qi[a]&&Qi[a].get||r)(e,a,l,c))})},quickSetter:function(e,t,n){if(e=ls(e),e.length>1){var s=e.map(function(h){return Fi.quickSetter(h,t,n)}),r=s.length;return function(h){for(var u=r;u--;)s[u](h)}}e=e[0]||{};var o=Qi[t],a=Xo(e),l=a.harness&&(a.harness.aliases||{})[t]||t,c=o?function(h){var u=new o;$a._pt=0,u.init(e,n?h+n:h,$a,0,[e]),u.render(1,u),$a._pt&&_v(1,$a)}:a.set(e,l);return o?c:function(h){return c(e,l,n?h+n:h,a,1)}},quickTo:function(e,t,n){var s,r=Fi.to(e,Ki((s={},s[t]="+=0.1",s.paused=!0,s.stagger=0,s),n||{})),o=function(l,c,h){return r.resetTo(t,l,c,h)};return o.tween=r,o},isTweening:function(e){return gn.getTweensOf(e,!0).length>0},defaults:function(e){return e&&e.ease&&(e.ease=Ko(e.ease,Cl.ease)),Ny(Cl,e||{})},config:function(e){return Ny(Xi,e||{})},registerEffect:function(e){var t=e.name,n=e.effect,s=e.plugins,r=e.defaults,o=e.extendTimeline;(s||"").split(",").forEach(function(a){return a&&!Qi[a]&&!Yi[a]&&lh(t+" effect requires "+a+" plugin.")}),Yp[t]=function(a,l,c){return n(ls(a),Ki(l||{},r),c)},o&&(_i.prototype[t]=function(a,l,c){return this.add(Yp[t](a,js(l)?l:(c=l)&&{},this),c)})},registerEase:function(e,t){Ut[e]=Ko(t)},parseEase:function(e,t){return arguments.length?Ko(e,t):Ut},getById:function(e){return gn.getById(e)},exportRoot:function(e,t){e===void 0&&(e={});var n=new _i(e),s,r;for(n.smoothChildTiming=Bi(e.smoothChildTiming),gn.remove(n),n._dp=0,n._time=n._tTime=gn._time,s=gn._first;s;)r=s._next,(t||!(!s._dur&&s instanceof Ln&&s.vars.onComplete===s._targets[0]))&&ks(n,s,s._start-s._delay),s=r;return ks(gn,n,0),n},context:function(e,t){return e?new JC(e,t):mn},matchMedia:function(e){return new dH(e)},matchMediaRefresh:function(){return $o.forEach(function(e){var t=e.conditions,n,s;for(s in t)t[s]&&(t[s]=!1,n=1);n&&e.revert()})||BA()},addEventListener:function(e,t){var n=Hu[e]||(Hu[e]=[]);~n.indexOf(t)||n.push(t)},removeEventListener:function(e,t){var n=Hu[e],s=n&&n.indexOf(t);s>=0&&n.splice(s,1)},utils:{wrap:HG,wrapYoyo:WG,distribute:RC,random:DC,snap:PC,normalize:GG,getUnit:ci,clamp:UG,splitColor:OC,toArray:ls,selector:IA,mapRange:FC,pipe:VG,unitize:zG,interpolate:qG,shuffle:BC},install:vC,effects:Yp,ticker:Vi,updateRoot:_i.updateRoot,plugins:Qi,globalTimeline:gn,core:{PropTween:Pi,globals:_C,Tween:Ln,Timeline:_i,Animation:dh,getCache:Xo,_removeLinkedListItem:uf,reverting:function(){return ei},context:function(e){return e&&mn&&(mn.data.push(e),e._ctx=mn),mn},suppressOverwrites:function(e){return ov=e}}};Ri("to,from,fromTo,delayedCall,set,killTweensOf",function(i){return Ed[i]=Ln[i]});Vi.add(_i.updateRoot);$a=Ed.to({},{duration:0});var fH=function(e,t){for(var n=e._pt;n&&n.p!==t&&n.op!==t&&n.fp!==t;)n=n._next;return n},pH=function(e,t){var n=e._targets,s,r,o;for(s in t)for(r=n.length;r--;)o=e._ptLookup[r][s],o&&(o=o.d)&&(o._pt&&(o=fH(o,s)),o&&o.modifier&&o.modifier(t[s],e,n[r],s))},em=function(e,t){return{name:e,headless:1,rawVars:1,init:function(s,r,o){o._onInit=function(a){var l,c;if(Jn(r)&&(l={},Ri(r,function(h){return l[h]=1}),r=l),t){l={};for(c in r)l[c]=t(r[c]);r=l}pH(a,r)}}}},Fi=Ed.registerPlugin({name:"attr",init:function(e,t,n,s,r){var o,a,l;this.tween=n;for(o in t)l=e.getAttribute(o)||"",a=this.add(e,"setAttribute",(l||0)+"",t[o],s,r,0,0,o),a.op=o,a.b=l,this._props.push(o)},render:function(e,t){for(var n=t._pt;n;)ei?n.set(n.t,n.p,n.b,n):n.r(e,n.d),n=n._next}},{name:"endArray",headless:1,init:function(e,t){for(var n=t.length;n--;)this.add(e,n,e[n]||0,t[n],0,0,0,0,0,1)}},em("roundProps",MA),em("modifiers"),em("snap",PC))||Ed;Ln.version=_i.version=Fi.version="3.13.0";gC=1;lv()&&Tl();Ut.Power0;Ut.Power1;Ut.Power2;Ut.Power3;Ut.Power4;Ut.Linear;Ut.Quad;Ut.Cubic;Ut.Quart;Ut.Quint;Ut.Strong;Ut.Elastic;Ut.Back;Ut.SteppedEase;Ut.Bounce;Ut.Sine;Ut.Expo;Ut.Circ;/*!
 * CSSPlugin 3.13.0
 * https://gsap.com
 *
 * Copyright 2008-2025, GreenSock. All rights reserved.
 * Subject to the terms at https://gsap.com/standard-license
 * @author: Jack Doyle, jack@greensock.com
*/var zy,$r,fl,yv,Go,Gy,xv,mH=function(){return typeof window<"u"},Er={},No=180/Math.PI,pl=Math.PI/180,Qa=Math.atan2,Hy=1e8,wv=/([A-Z])/g,AH=/(left|right|width|margin|padding|x)/i,gH=/[\s,\(]\S/,Qs={autoAlpha:"opacity,visibility",scale:"scaleX,scaleY",alpha:"opacity"},RA=function(e,t){return t.set(t.t,t.p,Math.round((t.s+t.c*e)*1e4)/1e4+t.u,t)},vH=function(e,t){return t.set(t.t,t.p,e===1?t.e:Math.round((t.s+t.c*e)*1e4)/1e4+t.u,t)},_H=function(e,t){return t.set(t.t,t.p,e?Math.round((t.s+t.c*e)*1e4)/1e4+t.u:t.b,t)},yH=function(e,t){var n=t.s+t.c*e;t.set(t.t,t.p,~~(n+(n<0?-.5:.5))+t.u,t)},ZC=function(e,t){return t.set(t.t,t.p,e?t.e:t.b,t)},eS=function(e,t){return t.set(t.t,t.p,e!==1?t.b:t.e,t)},xH=function(e,t,n){return e.style[t]=n},wH=function(e,t,n){return e.style.setProperty(t,n)},bH=function(e,t,n){return e._gsap[t]=n},EH=function(e,t,n){return e._gsap.scaleX=e._gsap.scaleY=n},CH=function(e,t,n,s,r){var o=e._gsap;o.scaleX=o.scaleY=n,o.renderTransform(r,o)},SH=function(e,t,n,s,r){var o=e._gsap;o[t]=n,o.renderTransform(r,o)},_n="transform",Di=_n+"Origin",IH=function i(e,t){var n=this,s=this.target,r=s.style,o=s._gsap;if(e in Er&&r){if(this.tfm=this.tfm||{},e!=="transform")e=Qs[e]||e,~e.indexOf(",")?e.split(",").forEach(function(a){return n.tfm[a]=ur(s,a)}):this.tfm[e]=o.x?o[e]:ur(s,e),e===Di&&(this.tfm.zOrigin=o.zOrigin);else return Qs.transform.split(",").forEach(function(a){return i.call(n,a,t)});if(this.props.indexOf(_n)>=0)return;o.svg&&(this.svgo=s.getAttribute("data-svg-origin"),this.props.push(Di,t,"")),e=_n}(r||t)&&this.props.push(e,t,r[e])},tS=function(e){e.translate&&(e.removeProperty("translate"),e.removeProperty("scale"),e.removeProperty("rotate"))},MH=function(){var e=this.props,t=this.target,n=t.style,s=t._gsap,r,o;for(r=0;r<e.length;r+=3)e[r+1]?e[r+1]===2?t[e[r]](e[r+2]):t[e[r]]=e[r+2]:e[r+2]?n[e[r]]=e[r+2]:n.removeProperty(e[r].substr(0,2)==="--"?e[r]:e[r].replace(wv,"-$1").toLowerCase());if(this.tfm){for(o in this.tfm)s[o]=this.tfm[o];s.svg&&(s.renderTransform(),t.setAttribute("data-svg-origin",this.svgo||"")),r=xv(),(!r||!r.isStart)&&!n[_n]&&(tS(n),s.zOrigin&&n[Di]&&(n[Di]+=" "+s.zOrigin+"px",s.zOrigin=0,s.renderTransform()),s.uncache=1)}},nS=function(e,t){var n={target:e,props:[],revert:MH,save:IH};return e._gsap||Fi.core.getCache(e),t&&e.style&&e.nodeType&&t.split(",").forEach(function(s){return n.save(s)}),n},iS,PA=function(e,t){var n=$r.createElementNS?$r.createElementNS((t||"http://www.w3.org/1999/xhtml").replace(/^https/,"http"),e):$r.createElement(e);return n&&n.style?n:$r.createElement(e)},cs=function i(e,t,n){var s=getComputedStyle(e);return s[t]||s.getPropertyValue(t.replace(wv,"-$1").toLowerCase())||s.getPropertyValue(t)||!n&&i(e,Bl(t)||t,1)||""},Wy="O,Moz,ms,Ms,Webkit".split(","),Bl=function(e,t,n){var s=t||Go,r=s.style,o=5;if(e in r&&!n)return e;for(e=e.charAt(0).toUpperCase()+e.substr(1);o--&&!(Wy[o]+e in r););return o<0?null:(o===3?"ms":o>=0?Wy[o]:"")+e},DA=function(){mH()&&window.document&&(zy=window,$r=zy.document,fl=$r.documentElement,Go=PA("div")||{style:{}},PA("div"),_n=Bl(_n),Di=_n+"Origin",Go.style.cssText="border-width:0;line-height:0;position:absolute;padding:0",iS=!!Bl("perspective"),xv=Fi.core.reverting,yv=1)},qy=function(e){var t=e.ownerSVGElement,n=PA("svg",t&&t.getAttribute("xmlns")||"http://www.w3.org/2000/svg"),s=e.cloneNode(!0),r;s.style.display="block",n.appendChild(s),fl.appendChild(n);try{r=s.getBBox()}catch(o){}return n.removeChild(s),fl.removeChild(n),r},jy=function(e,t){for(var n=t.length;n--;)if(e.hasAttribute(t[n]))return e.getAttribute(t[n])},sS=function(e){var t,n;try{t=e.getBBox()}catch(s){t=qy(e),n=1}return t&&(t.width||t.height)||n||(t=qy(e)),t&&!t.width&&!t.x&&!t.y?{x:+jy(e,["x","cx","x1"])||0,y:+jy(e,["y","cy","y1"])||0,width:0,height:0}:t},rS=function(e){return!!(e.getCTM&&(!e.parentNode||e.ownerSVGElement)&&sS(e))},ca=function(e,t){if(t){var n=e.style,s;t in Er&&t!==Di&&(t=_n),n.removeProperty?(s=t.substr(0,2),(s==="ms"||t.substr(0,6)==="webkit")&&(t="-"+t),n.removeProperty(s==="--"?t:t.replace(wv,"-$1").toLowerCase())):n.removeAttribute(t)}},Jr=function(e,t,n,s,r,o){var a=new Pi(e._pt,t,n,0,1,o?eS:ZC);return e._pt=a,a.b=s,a.e=r,e._props.push(n),a},Xy={deg:1,rad:1,turn:1},TH={grid:1,flex:1},po=function i(e,t,n,s){var r=parseFloat(n)||0,o=(n+"").trim().substr((r+"").length)||"px",a=Go.style,l=AH.test(t),c=e.tagName.toLowerCase()==="svg",h=(c?"client":"offset")+(l?"Width":"Height"),u=100,d=s==="px",f=s==="%",p,A,m,g;if(s===o||!r||Xy[s]||Xy[o])return r;if(o!=="px"&&!d&&(r=i(e,t,n,"px")),g=e.getCTM&&rS(e),(f||o==="%")&&(Er[t]||~t.indexOf("adius")))return p=g?e.getBBox()[l?"width":"height"]:e[h],Bn(f?r/p*u:r/100*p);if(a[l?"width":"height"]=u+(d?o:s),A=s!=="rem"&&~t.indexOf("adius")||s==="em"&&e.appendChild&&!c?e:e.parentNode,g&&(A=(e.ownerSVGElement||{}).parentNode),(!A||A===$r||!A.appendChild)&&(A=$r.body),m=A._gsap,m&&f&&m.width&&l&&m.time===Vi.time&&!m.uncache)return Bn(r/m.width*u);if(f&&(t==="height"||t==="width")){var y=e.style[t];e.style[t]=u+s,p=e[h],y?e.style[t]=y:ca(e,t)}else(f||o==="%")&&!TH[cs(A,"display")]&&(a.position=cs(e,"position")),A===e&&(a.position="static"),A.appendChild(Go),p=Go[h],A.removeChild(Go),a.position="absolute";return l&&f&&(m=Xo(A),m.time=Vi.time,m.width=A[h]),Bn(d?p*r/u:p&&r?u/p*r:0)},ur=function(e,t,n,s){var r;return yv||DA(),t in Qs&&t!=="transform"&&(t=Qs[t],~t.indexOf(",")&&(t=t.split(",")[0])),Er[t]&&t!=="transform"?(r=ph(e,s),r=t!=="transformOrigin"?r[t]:r.svg?r.origin:Sd(cs(e,Di))+" "+r.zOrigin+"px"):(r=e.style[t],(!r||r==="auto"||s||~(r+"").indexOf("calc("))&&(r=Cd[t]&&Cd[t](e,t,n)||cs(e,t)||xC(e,t)||(t==="opacity"?1:0))),n&&!~(r+"").trim().indexOf(" ")?po(e,t,r,n)+n:r},BH=function(e,t,n,s){if(!n||n==="none"){var r=Bl(t,e,1),o=r&&cs(e,r,1);o&&o!==n?(t=r,n=o):t==="borderColor"&&(n=cs(e,"borderTopColor"))}var a=new Pi(this._pt,e.style,t,0,1,KC),l=0,c=0,h,u,d,f,p,A,m,g,y,_,v,b;if(a.b=n,a.e=s,n+="",s+="",s.substring(0,6)==="var(--"&&(s=cs(e,s.substring(4,s.indexOf(")")))),s==="auto"&&(A=e.style[t],e.style[t]=s,s=cs(e,t)||s,A?e.style[t]=A:ca(e,t)),h=[n,s],QC(h),n=h[0],s=h[1],d=n.match(Ka)||[],b=s.match(Ka)||[],b.length){for(;u=Ka.exec(s);)m=u[0],y=s.substring(l,u.index),p?p=(p+1)%5:(y.substr(-5)==="rgba("||y.substr(-5)==="hsla(")&&(p=1),m!==(A=d[c++]||"")&&(f=parseFloat(A)||0,v=A.substr((f+"").length),m.charAt(1)==="="&&(m=dl(f,m)+v),g=parseFloat(m),_=m.substr((g+"").length),l=Ka.lastIndex-_.length,_||(_=_||Xi.units[t]||v,l===s.length&&(s+=_,a.e+=_)),v!==_&&(f=po(e,t,A,_)||0),a._pt={_next:a._pt,p:y||c===1?y:",",s:f,c:g-f,m:p&&p<4||t==="zIndex"?Math.round:0});a.c=l<s.length?s.substring(l,s.length):""}else a.r=t==="display"&&s==="none"?eS:ZC;return mC.test(s)&&(a.e=0),this._pt=a,a},Yy={top:"0%",bottom:"100%",left:"0%",right:"100%",center:"50%"},RH=function(e){var t=e.split(" "),n=t[0],s=t[1]||"50%";return(n==="top"||n==="bottom"||s==="left"||s==="right")&&(e=n,n=s,s=e),t[0]=Yy[n]||n,t[1]=Yy[s]||s,t.join(" ")},PH=function(e,t){if(t.tween&&t.tween._time===t.tween._dur){var n=t.t,s=n.style,r=t.u,o=n._gsap,a,l,c;if(r==="all"||r===!0)s.cssText="",l=1;else for(r=r.split(","),c=r.length;--c>-1;)a=r[c],Er[a]&&(l=1,a=a==="transformOrigin"?Di:_n),ca(n,a);l&&(ca(n,_n),o&&(o.svg&&n.removeAttribute("transform"),s.scale=s.rotate=s.translate="none",ph(n,1),o.uncache=1,tS(s)))}},Cd={clearProps:function(e,t,n,s,r){if(r.data!=="isFromStart"){var o=e._pt=new Pi(e._pt,t,n,0,0,PH);return o.u=s,o.pr=-10,o.tween=r,e._props.push(n),1}}},fh=[1,0,0,1,0,0],oS={},aS=function(e){return e==="matrix(1, 0, 0, 1, 0, 0)"||e==="none"||!e},Ky=function(e){var t=cs(e,_n);return aS(t)?fh:t.substr(7).match(pC).map(Bn)},bv=function(e,t){var n=e._gsap||Xo(e),s=e.style,r=Ky(e),o,a,l,c;return n.svg&&e.getAttribute("transform")?(l=e.transform.baseVal.consolidate().matrix,r=[l.a,l.b,l.c,l.d,l.e,l.f],r.join(",")==="1,0,0,1,0,0"?fh:r):(r===fh&&!e.offsetParent&&e!==fl&&!n.svg&&(l=s.display,s.display="block",o=e.parentNode,(!o||!e.offsetParent&&!e.getBoundingClientRect().width)&&(c=1,a=e.nextElementSibling,fl.appendChild(e)),r=Ky(e),l?s.display=l:ca(e,"display"),c&&(a?o.insertBefore(e,a):o?o.appendChild(e):fl.removeChild(e))),t&&r.length>6?[r[0],r[1],r[4],r[5],r[12],r[13]]:r)},LA=function(e,t,n,s,r,o){var a=e._gsap,l=r||bv(e,!0),c=a.xOrigin||0,h=a.yOrigin||0,u=a.xOffset||0,d=a.yOffset||0,f=l[0],p=l[1],A=l[2],m=l[3],g=l[4],y=l[5],_=t.split(" "),v=parseFloat(_[0])||0,b=parseFloat(_[1])||0,T,L,I,x;n?l!==fh&&(L=f*m-p*A)&&(I=v*(m/L)+b*(-A/L)+(A*y-m*g)/L,x=v*(-p/L)+b*(f/L)-(f*y-p*g)/L,v=I,b=x):(T=sS(e),v=T.x+(~_[0].indexOf("%")?v/100*T.width:v),b=T.y+(~(_[1]||_[0]).indexOf("%")?b/100*T.height:b)),s||s!==!1&&a.smooth?(g=v-c,y=b-h,a.xOffset=u+(g*f+y*A)-g,a.yOffset=d+(g*p+y*m)-y):a.xOffset=a.yOffset=0,a.xOrigin=v,a.yOrigin=b,a.smooth=!!s,a.origin=t,a.originIsAbsolute=!!n,e.style[Di]="0px 0px",o&&(Jr(o,a,"xOrigin",c,v),Jr(o,a,"yOrigin",h,b),Jr(o,a,"xOffset",u,a.xOffset),Jr(o,a,"yOffset",d,a.yOffset)),e.setAttribute("data-svg-origin",v+" "+b)},ph=function(e,t){var n=e._gsap||new HC(e);if("x"in n&&!t&&!n.uncache)return n;var s=e.style,r=n.scaleX<0,o="px",a="deg",l=getComputedStyle(e),c=cs(e,Di)||"0",h,u,d,f,p,A,m,g,y,_,v,b,T,L,I,x,w,P,z,H,K,le,J,W,O,fe,ue,ee,de,ae,R,M;return h=u=d=A=m=g=y=_=v=0,f=p=1,n.svg=!!(e.getCTM&&rS(e)),l.translate&&((l.translate!=="none"||l.scale!=="none"||l.rotate!=="none")&&(s[_n]=(l.translate!=="none"?"translate3d("+(l.translate+" 0 0").split(" ").slice(0,3).join(", ")+") ":"")+(l.rotate!=="none"?"rotate("+l.rotate+") ":"")+(l.scale!=="none"?"scale("+l.scale.split(" ").join(",")+") ":"")+(l[_n]!=="none"?l[_n]:"")),s.scale=s.rotate=s.translate="none"),L=bv(e,n.svg),n.svg&&(n.uncache?(O=e.getBBox(),c=n.xOrigin-O.x+"px "+(n.yOrigin-O.y)+"px",W=""):W=!t&&e.getAttribute("data-svg-origin"),LA(e,W||c,!!W||n.originIsAbsolute,n.smooth!==!1,L)),b=n.xOrigin||0,T=n.yOrigin||0,L!==fh&&(P=L[0],z=L[1],H=L[2],K=L[3],h=le=L[4],u=J=L[5],L.length===6?(f=Math.sqrt(P*P+z*z),p=Math.sqrt(K*K+H*H),A=P||z?Qa(z,P)*No:0,y=H||K?Qa(H,K)*No+A:0,y&&(p*=Math.abs(Math.cos(y*pl))),n.svg&&(h-=b-(b*P+T*H),u-=T-(b*z+T*K))):(M=L[6],ae=L[7],ue=L[8],ee=L[9],de=L[10],R=L[11],h=L[12],u=L[13],d=L[14],I=Qa(M,de),m=I*No,I&&(x=Math.cos(-I),w=Math.sin(-I),W=le*x+ue*w,O=J*x+ee*w,fe=M*x+de*w,ue=le*-w+ue*x,ee=J*-w+ee*x,de=M*-w+de*x,R=ae*-w+R*x,le=W,J=O,M=fe),I=Qa(-H,de),g=I*No,I&&(x=Math.cos(-I),w=Math.sin(-I),W=P*x-ue*w,O=z*x-ee*w,fe=H*x-de*w,R=K*w+R*x,P=W,z=O,H=fe),I=Qa(z,P),A=I*No,I&&(x=Math.cos(I),w=Math.sin(I),W=P*x+z*w,O=le*x+J*w,z=z*x-P*w,J=J*x-le*w,P=W,le=O),m&&Math.abs(m)+Math.abs(A)>359.9&&(m=A=0,g=180-g),f=Bn(Math.sqrt(P*P+z*z+H*H)),p=Bn(Math.sqrt(J*J+M*M)),I=Qa(le,J),y=Math.abs(I)>2e-4?I*No:0,v=R?1/(R<0?-R:R):0),n.svg&&(W=e.getAttribute("transform"),n.forceCSS=e.setAttribute("transform","")||!aS(cs(e,_n)),W&&e.setAttribute("transform",W))),Math.abs(y)>90&&Math.abs(y)<270&&(r?(f*=-1,y+=A<=0?180:-180,A+=A<=0?180:-180):(p*=-1,y+=y<=0?180:-180)),t=t||n.uncache,n.x=h-((n.xPercent=h&&(!t&&n.xPercent||(Math.round(e.offsetWidth/2)===Math.round(-h)?-50:0)))?e.offsetWidth*n.xPercent/100:0)+o,n.y=u-((n.yPercent=u&&(!t&&n.yPercent||(Math.round(e.offsetHeight/2)===Math.round(-u)?-50:0)))?e.offsetHeight*n.yPercent/100:0)+o,n.z=d+o,n.scaleX=Bn(f),n.scaleY=Bn(p),n.rotation=Bn(A)+a,n.rotationX=Bn(m)+a,n.rotationY=Bn(g)+a,n.skewX=y+a,n.skewY=_+a,n.transformPerspective=v+o,(n.zOrigin=parseFloat(c.split(" ")[2])||!t&&n.zOrigin||0)&&(s[Di]=Sd(c)),n.xOffset=n.yOffset=0,n.force3D=Xi.force3D,n.renderTransform=n.svg?LH:iS?lS:DH,n.uncache=0,n},Sd=function(e){return(e=e.split(" "))[0]+" "+e[1]},tm=function(e,t,n){var s=ci(t);return Bn(parseFloat(t)+parseFloat(po(e,"x",n+"px",s)))+s},DH=function(e,t){t.z="0px",t.rotationY=t.rotationX="0deg",t.force3D=0,lS(e,t)},Ro="0deg",sc="0px",Po=") ",lS=function(e,t){var n=t||this,s=n.xPercent,r=n.yPercent,o=n.x,a=n.y,l=n.z,c=n.rotation,h=n.rotationY,u=n.rotationX,d=n.skewX,f=n.skewY,p=n.scaleX,A=n.scaleY,m=n.transformPerspective,g=n.force3D,y=n.target,_=n.zOrigin,v="",b=g==="auto"&&e&&e!==1||g===!0;if(_&&(u!==Ro||h!==Ro)){var T=parseFloat(h)*pl,L=Math.sin(T),I=Math.cos(T),x;T=parseFloat(u)*pl,x=Math.cos(T),o=tm(y,o,L*x*-_),a=tm(y,a,-Math.sin(T)*-_),l=tm(y,l,I*x*-_+_)}m!==sc&&(v+="perspective("+m+Po),(s||r)&&(v+="translate("+s+"%, "+r+"%) "),(b||o!==sc||a!==sc||l!==sc)&&(v+=l!==sc||b?"translate3d("+o+", "+a+", "+l+") ":"translate("+o+", "+a+Po),c!==Ro&&(v+="rotate("+c+Po),h!==Ro&&(v+="rotateY("+h+Po),u!==Ro&&(v+="rotateX("+u+Po),(d!==Ro||f!==Ro)&&(v+="skew("+d+", "+f+Po),(p!==1||A!==1)&&(v+="scale("+p+", "+A+Po),y.style[_n]=v||"translate(0, 0)"},LH=function(e,t){var n=t||this,s=n.xPercent,r=n.yPercent,o=n.x,a=n.y,l=n.rotation,c=n.skewX,h=n.skewY,u=n.scaleX,d=n.scaleY,f=n.target,p=n.xOrigin,A=n.yOrigin,m=n.xOffset,g=n.yOffset,y=n.forceCSS,_=parseFloat(o),v=parseFloat(a),b,T,L,I,x;l=parseFloat(l),c=parseFloat(c),h=parseFloat(h),h&&(h=parseFloat(h),c+=h,l+=h),l||c?(l*=pl,c*=pl,b=Math.cos(l)*u,T=Math.sin(l)*u,L=Math.sin(l-c)*-d,I=Math.cos(l-c)*d,c&&(h*=pl,x=Math.tan(c-h),x=Math.sqrt(1+x*x),L*=x,I*=x,h&&(x=Math.tan(h),x=Math.sqrt(1+x*x),b*=x,T*=x)),b=Bn(b),T=Bn(T),L=Bn(L),I=Bn(I)):(b=u,I=d,T=L=0),(_&&!~(o+"").indexOf("px")||v&&!~(a+"").indexOf("px"))&&(_=po(f,"x",o,"px"),v=po(f,"y",a,"px")),(p||A||m||g)&&(_=Bn(_+p-(p*b+A*L)+m),v=Bn(v+A-(p*T+A*I)+g)),(s||r)&&(x=f.getBBox(),_=Bn(_+s/100*x.width),v=Bn(v+r/100*x.height)),x="matrix("+b+","+T+","+L+","+I+","+_+","+v+")",f.setAttribute("transform",x),y&&(f.style[_n]=x)},FH=function(e,t,n,s,r){var o=360,a=Jn(r),l=parseFloat(r)*(a&&~r.indexOf("rad")?No:1),c=l-s,h=s+c+"deg",u,d;return a&&(u=r.split("_")[1],u==="short"&&(c%=o,c!==c%(o/2)&&(c+=c<0?o:-360)),u==="cw"&&c<0?c=(c+o*Hy)%o-~~(c/o)*o:u==="ccw"&&c>0&&(c=(c-o*Hy)%o-~~(c/o)*o)),e._pt=d=new Pi(e._pt,t,n,s,c,vH),d.e=h,d.u="deg",e._props.push(n),d},$y=function(e,t){for(var n in t)e[n]=t[n];return e},NH=function(e,t,n){var s=$y({},n._gsap),r="perspective,force3D,transformOrigin,svgOrigin",o=n.style,a,l,c,h,u,d,f,p;s.svg?(c=n.getAttribute("transform"),n.setAttribute("transform",""),o[_n]=t,a=ph(n,1),ca(n,_n),n.setAttribute("transform",c)):(c=getComputedStyle(n)[_n],o[_n]=t,a=ph(n,1),o[_n]=c);for(l in Er)c=s[l],h=a[l],c!==h&&r.indexOf(l)<0&&(f=ci(c),p=ci(h),u=f!==p?po(n,l,c,p):parseFloat(c),d=parseFloat(h),e._pt=new Pi(e._pt,a,l,u,d-u,RA),e._pt.u=p||0,e._props.push(l));$y(a,s)};Ri("padding,margin,Width,Radius",function(i,e){var t="Top",n="Right",s="Bottom",r="Left",o=(e<3?[t,n,s,r]:[t+r,t+n,s+n,s+r]).map(function(a){return e<2?i+a:"border"+a+i});Cd[e>1?"border"+i:i]=function(a,l,c,h,u){var d,f;if(arguments.length<4)return d=o.map(function(p){return ur(a,p,c)}),f=d.join(" "),f.split(d[0]).length===5?d[0]:f;d=(h+"").split(" "),f={},o.forEach(function(p,A){return f[p]=d[A]=d[A]||d[(A-1)/2|0]}),a.init(l,f,u)}});var cS={name:"css",register:DA,targetTest:function(e){return e.style&&e.nodeType},init:function(e,t,n,s,r){var o=this._props,a=e.style,l=n.vars.startAt,c,h,u,d,f,p,A,m,g,y,_,v,b,T,L,I;yv||DA(),this.styles=this.styles||nS(e),I=this.styles.props,this.tween=n;for(A in t)if(A!=="autoRound"&&(h=t[A],!(Qi[A]&&WC(A,t,n,s,e,r)))){if(f=typeof h,p=Cd[A],f==="function"&&(h=h.call(n,s,e,r),f=typeof h),f==="string"&&~h.indexOf("random(")&&(h=hh(h)),p)p(this,e,A,h,n)&&(L=1);else if(A.substr(0,2)==="--")c=(getComputedStyle(e).getPropertyValue(A)+"").trim(),h+="",oo.lastIndex=0,oo.test(c)||(m=ci(c),g=ci(h)),g?m!==g&&(c=po(e,A,c,g)+g):m&&(h+=m),this.add(a,"setProperty",c,h,s,r,0,0,A),o.push(A),I.push(A,0,a[A]);else if(f!=="undefined"){if(l&&A in l?(c=typeof l[A]=="function"?l[A].call(n,s,e,r):l[A],Jn(c)&&~c.indexOf("random(")&&(c=hh(c)),ci(c+"")||c==="auto"||(c+=Xi.units[A]||ci(ur(e,A))||""),(c+"").charAt(1)==="="&&(c=ur(e,A))):c=ur(e,A),d=parseFloat(c),y=f==="string"&&h.charAt(1)==="="&&h.substr(0,2),y&&(h=h.substr(2)),u=parseFloat(h),A in Qs&&(A==="autoAlpha"&&(d===1&&ur(e,"visibility")==="hidden"&&u&&(d=0),I.push("visibility",0,a.visibility),Jr(this,a,"visibility",d?"inherit":"hidden",u?"inherit":"hidden",!u)),A!=="scale"&&A!=="transform"&&(A=Qs[A],~A.indexOf(",")&&(A=A.split(",")[0]))),_=A in Er,_){if(this.styles.save(A),f==="string"&&h.substring(0,6)==="var(--"&&(h=cs(e,h.substring(4,h.indexOf(")"))),u=parseFloat(h)),v||(b=e._gsap,b.renderTransform&&!t.parseTransform||ph(e,t.parseTransform),T=t.smoothOrigin!==!1&&b.smooth,v=this._pt=new Pi(this._pt,a,_n,0,1,b.renderTransform,b,0,-1),v.dep=1),A==="scale")this._pt=new Pi(this._pt,b,"scaleY",b.scaleY,(y?dl(b.scaleY,y+u):u)-b.scaleY||0,RA),this._pt.u=0,o.push("scaleY",A),A+="X";else if(A==="transformOrigin"){I.push(Di,0,a[Di]),h=RH(h),b.svg?LA(e,h,0,T,0,this):(g=parseFloat(h.split(" ")[2])||0,g!==b.zOrigin&&Jr(this,b,"zOrigin",b.zOrigin,g),Jr(this,a,A,Sd(c),Sd(h)));continue}else if(A==="svgOrigin"){LA(e,h,1,T,0,this);continue}else if(A in oS){FH(this,b,A,d,y?dl(d,y+h):h);continue}else if(A==="smoothOrigin"){Jr(this,b,"smooth",b.smooth,h);continue}else if(A==="force3D"){b[A]=h;continue}else if(A==="transform"){NH(this,h,e);continue}}else A in a||(A=Bl(A)||A);if(_||(u||u===0)&&(d||d===0)&&!gH.test(h)&&A in a)m=(c+"").substr((d+"").length),u||(u=0),g=ci(h)||(A in Xi.units?Xi.units[A]:m),m!==g&&(d=po(e,A,c,g)),this._pt=new Pi(this._pt,_?b:a,A,d,(y?dl(d,y+u):u)-d,!_&&(g==="px"||A==="zIndex")&&t.autoRound!==!1?yH:RA),this._pt.u=g||0,m!==g&&g!=="%"&&(this._pt.b=c,this._pt.r=_H);else if(A in a)BH.call(this,e,A,c,y?y+h:h);else if(A in e)this.add(e,A,c||e[A],y?y+h:h,s,r);else if(A!=="parseTransform"){hv(A,h);continue}_||(A in a?I.push(A,0,a[A]):typeof e[A]=="function"?I.push(A,2,e[A]()):I.push(A,1,c||e[A])),o.push(A)}}L&&$C(this)},render:function(e,t){if(t.tween._time||!xv())for(var n=t._pt;n;)n.r(e,n.d),n=n._next;else t.styles.revert()},get:ur,aliases:Qs,getSetter:function(e,t,n){var s=Qs[t];return s&&s.indexOf(",")<0&&(t=s),t in Er&&t!==Di&&(e._gsap.x||ur(e,"x"))?n&&Gy===n?t==="scale"?EH:bH:(Gy=n||{})&&(t==="scale"?CH:SH):e.style&&!av(e.style[t])?xH:~t.indexOf("-")?wH:vv(e,t)},core:{_removeProperty:ca,_getMatrix:bv}};Fi.utils.checkPrefix=Bl;Fi.core.getStyleSaver=nS;(function(i,e,t,n){var s=Ri(i+","+e+","+t,function(r){Er[r]=1});Ri(e,function(r){Xi.units[r]="deg",oS[r]=1}),Qs[s[13]]=i+","+e,Ri(n,function(r){var o=r.split(":");Qs[o[1]]=s[o[0]]})})("x,y,z,scale,scaleX,scaleY,xPercent,yPercent","rotation,rotationX,rotationY,skewX,skewY","transform,transformOrigin,svgOrigin,force3D,smoothOrigin,transformPerspective","0:translateX,1:translateY,2:translateZ,8:rotate,8:rotationZ,8:rotateZ,9:rotateX,10:rotateY");Ri("x,y,z,top,right,bottom,left,width,height,fontSize,padding,margin,perspective",function(i){Xi.units[i]="px"});Fi.registerPlugin(cS);var dc=Fi.registerPlugin(cS)||Fi;dc.core.Tween;class kH{constructor(){this.experience=new ti,this.scene=this.experience.scene,this.resources=this.experience.resources,this.debug=this.experience.debug,this.instance=null,this.scale=.3,this.movesQueue=[],this.isMoving=!1,this.currentTile={x:0,z:0},this.targetTile={x:0,z:0},this.moveClock=new DB(!1),this.stepLength=1,this.agentGroup=new Wi,this.scene.add(this.agentGroup),this.initChicken(),this.debug.active&&this.debuggerInit(),this.pressedKeys=new Set,this.listenKeyboard(),fd()&&this.listenTouch(),this.isInvincible=!1,this._invincibleTimeout=null,this.isSpeedUp=!1,this._speedUpTimeout=null}initChicken(){const e=this.resources.items.bigChicken;if(!e){console.warn(" instance ");return}this.instance=e.scene.clone(),this.instance.traverse(t=>{t instanceof $n&&(t.castShadow=!0)}),this.instance.position.set(0,.22,0),this.instance.scale.set(this.scale,this.scale,this.scale),this.agentGroup.add(this.instance)}debuggerInit(){this.debugFolder=this.debug.ui.addFolder({title:"",expanded:!0}),this.debugFolder.addBinding(this,"scale",{label:"",min:.1,max:5,step:.01}).on("change",e=>{this.instance&&this.instance.scale.set(this.scale,this.scale,this.scale)})}listenKeyboard(){window.addEventListener("keydown",e=>{if(this.experience.isPaused)return;let t=null;switch(e.code){case"ArrowUp":case"KeyW":t="forward";break;case"ArrowDown":case"KeyS":t="backward";break;case"ArrowLeft":case"KeyA":t="left";break;case"ArrowRight":case"KeyD":t="right";break}t&&!this.pressedKeys.has(e.code)&&(this.movesQueue.push(t),this.pressedKeys.add(e.code))}),window.addEventListener("keyup",e=>{this.pressedKeys.delete(e.code)})}listenTouch(){let e=0,t=0;window.addEventListener("touchstart",n=>{n.touches.length===1&&(e=n.touches[0].clientX,t=n.touches[0].clientY)}),window.addEventListener("touchend",n=>{if(n.changedTouches.length===1){const s=n.changedTouches[0].clientX,r=n.changedTouches[0].clientY,o=mF(e,t,s,r);o&&this.movesQueue.push(o)}})}update(){if(!this.instance||!this.movesQueue.length)return;if(!this.isMoving){const n=this.movesQueue[0],s={...this.currentTile};switch(n){case"forward":s.z-=1;break;case"backward":s.z+=1;break;case"left":s.x-=1;break;case"right":s.x+=1;break}this.startRot=this.instance.rotation.y,this.endRot=fF(n);const r=this.experience.world.map.metadata;if(!pF(s,r)){this.setRotation(1),this.playYoyoAnimation(s),this.movesQueue.shift();return}this.isMoving=!0,this.moveClock.start(),this.targetTile=s,this.startPos={x:this.currentTile.x*this.stepLength,z:this.currentTile.z*this.stepLength},this.endPos={x:this.targetTile.x*this.stepLength,z:this.targetTile.z*this.stepLength}}const e=this.isSpeedUp?aF:lF,t=Math.min(1,this.moveClock.getElapsedTime()/e);this.setPosition(t),this.setRotation(t),t>=1&&(this.stepCompleted(),this.moveClock.stop(),this.isMoving=!1,this.movesQueue.shift())}setPosition(e){if(!this.instance)return;const t=bn.lerp(this.startPos.x,this.endPos.x,e),n=bn.lerp(this.startPos.z,this.endPos.z,e);this.agentGroup.position.set(t,0,n);const s=Math.sin(e*Math.PI)*.28;this.instance.position.y=.22+s;const r=.85+.15*Math.sin(e*Math.PI),o=1+.15*(1-Math.sin(e*Math.PI));this.instance.scale.set(this.scale*o,this.scale*r,this.scale*o)}setRotation(e){if(!this.instance)return;let t=this.endRot-this.startRot;t=((t+Math.PI)%(2*Math.PI)+2*Math.PI)%(2*Math.PI)-Math.PI;const n=this.startRot+t*e;this.instance.rotation.y=n}stepCompleted(){this.currentTile={...this.targetTile},this.agentGroup.position.set(this.currentTile.x*this.stepLength,0,this.currentTile.z*this.stepLength),this.instance.position.y=.22,this.instance.rotation.y=this.endRot,this.instance.scale.set(this.scale,this.scale,this.scale),this.maxZ===void 0&&(this.maxZ=0),this.currentTile.z>this.maxZ&&(this.maxZ=this.currentTile.z,this.experience.trigger("scoreUpdate",[this.maxZ]))}playYoyoAnimation(e){if(!this.instance)return;const t={x:this.currentTile.x*this.stepLength,z:this.currentTile.z*this.stepLength},n={x:e.x*this.stepLength,z:e.z*this.stepLength},s={x:(n.x-t.x)*.8,z:(n.z-t.z)*.8};dc.to(this.agentGroup.position,{x:n.x-s.x,z:n.z-s.z,duration:.12,yoyo:!0,repeat:1,ease:"power1.inOut",onComplete:()=>{this.agentGroup.position.set(t.x,0,t.z)}}),dc.to(this.instance.position,{y:.5,duration:.12,yoyo:!0,repeat:1,ease:"power1.inOut",onComplete:()=>{this.instance.position.y=.22}}),dc.to(this.instance.scale,{x:this.scale*.7,y:this.scale*1.18,z:this.scale*.7,duration:.12,yoyo:!0,repeat:1,ease:"power1.inOut",onComplete:()=>{this.instance.scale.set(this.scale,this.scale,this.scale)}})}reset(){this.currentTile={x:0,z:0},this.targetTile={x:0,z:0},this.maxZ=0,this.agentGroup.position.set(0,0,0),this.instance.position.set(0,1,0),dc.to(this.instance.position,{y:.22,duration:.5,ease:"bounce.out"}),this.instance.scale.set(this.scale,this.scale,this.scale),this.instance.rotation.y=0,this.experience.trigger("scoreUpdate",[0])}_setMaterialEffect(e,t){var s;const n=(s=this.instance)==null?void 0:s.children[0];n!=null&&n.material&&(n.material.transparent=!0,n.material.opacity=t,e&&(n.material._originalColor||(n.material._originalColor=n.material.color.clone()),n.material.color.set(e)))}_resetMaterial(){var t;const e=(t=this.instance)==null?void 0:t.children[0];e!=null&&e.material&&(e.material._originalColor&&e.material.color.copy(e.material._originalColor),e.material.opacity=1,e.material.transparent=!1)}setInvincible(e,t=3e3){e?(this.isInvincible=!0,this._setMaterialEffect(null,.3),this._invincibleTimeout&&clearTimeout(this._invincibleTimeout),this._invincibleTimeout=setTimeout(()=>{this.isInvincible=!1,this._invincibleTimeout=null,this._resetMaterial()},t)):(this.isInvincible=!1,this._invincibleTimeout&&(clearTimeout(this._invincibleTimeout),this._invincibleTimeout=null),this._resetMaterial())}setSpeedUp(e,t=5e3){e?(this.isSpeedUp=!0,this._setMaterialEffect("#ff0000",.75),this._speedUpTimeout&&clearTimeout(this._speedUpTimeout),this._speedUpTimeout=setTimeout(()=>{this.isSpeedUp=!1,this._speedUpTimeout=null,this._resetMaterial()},t)):(this.isSpeedUp=!1,this._speedUpTimeout&&(clearTimeout(this._speedUpTimeout),this._speedUpTimeout=null),this._resetMaterial())}}class OH{constructor(){this.experience=new ti,this.scene=this.experience.scene,this.camera=this.experience.camera,this.resources=this.experience.resources,this.isGameOver=!1,this.uploadScore=vF(this.uploadScore.bind(this),1e3),this.resources.on("ready",()=>this.initializeWorld())}initializeWorld(){this.setupSceneComponents(),this.setupEventListeners()}setupSceneComponents(){this.environment=new gG,this.map=new wG,this.user=new kH,this.itemManager=this.map.itemManager,this.user.agentGroup.add(this.camera.instance),this.user.agentGroup.add(this.environment.sunLight),this.textMesh=new YQ({texts:["Pass the Road"],position:new he(0,.9,-6),rotation:new Rn(0,0,0)})}setupEventListeners(){this.experience.on("restart",()=>{this.onRestart()}),this.experience.on("itemCollected",e=>{let t=0;switch(e){case nn.RANDOM:t=1;break;case nn.SHOE:t=2;break;case nn.CLOCK:t=3;break;case nn.SHEID:t=4;break;case nn.ZONGZI:t=5;break}t>0?(this.experience.trigger("itemScore",[t]),console.warn("[] ".concat(e,"+").concat(t))):console.warn("[] ".concat(e,""));let n=0;switch(e){case nn.SHOE:n=R0,this.user.setSpeedUp(!0,R0),console.warn("[] 5");break;case nn.CLOCK:n=lb;break;case nn.SHEID:n=mp,this.user.setInvincible(!0,mp),console.warn("[] 3");break;case nn.ZONGZI:n=oF;break;default:n=mp}tV(e,n),JQ(e,n)})}update(){if(this.map&&(this.map.update(),this.user&&!this.isGameOver)){this.map.checkAndExtendMap(this.user.currentTile.z);const e=this.user.instance;if(e){const t=this.user.currentTile.z,n=this.map.getCarMeshesByRow(t);if(n.length>0){const s=new ps().setFromObject(e);for(const r of n){const o=new ps().setFromObject(r);s.intersectsBox(o)&&(this.user.isInvincible||this.onGameOver())}}}this.itemManager&&this.itemManager.checkUserTile(this.user.currentTile),this.user.update()}this.user&&(this.camera.instance.lookAt(this.user.agentGroup.position),this.environment.sunLight.target.position.copy(this.user.agentGroup.position)),this.textMesh&&this.textMesh.update()}async uploadScore(e){const t=localStorage.getItem("username")||"unknown";try{await hC.from(cb).insert([{username:t,score:e}])}catch(n){console.warn("",n)}}async onGameOver(){if(this.isGameOver)return;this.user.instance.scale.set(.3,.1,.3),this.isGameOver=!0;const e=this.user.maxZ||0;this.experience.trigger("restart"),this.uploadScore(e)}async onRestart(){this.isGameOver=!1,this.map.resetMap(),this.user.reset()}}let nm;class ti extends nf{constructor(e){if(nm)return nm;super(),nm=this,window.Experience=this,this.canvas=e,this.debug=new WU,this.stats=new VQ,this.sizes=new QQ,this.time=new zQ,this.scene=new y1,this.camera=new _F(!0),this.renderer=new yF,this.resources=new UQ(xF),this.physics=new jQ,this.iMouse=new jU,this.world=new OH,this.sizes.on("resize",()=>{this.resize()}),this.time.on("tick",()=>{this.update()}),this.on("pause",()=>{this.isPaused=!0}),this.on("resume",()=>{this.isPaused=!1})}resize(){this.camera.resize(),this.renderer.resize()}update(){this.isPaused||(this.camera.update(),this.world.update(),this.renderer.update(),this.stats.update(),this.iMouse.update())}}const pf=(i,e)=>{const t=i.__vccOpts||i;for(const[n,s]of e)t[n]=s;return t},UH={class:"fixed top-0 left-0 w-full flex justify-center z-[9999] select-none pointer-events-none"},QH={key:0,class:"mt-6 bg-green-600 bg-opacity-70 text-white text-xl md:text-2xl font-bold px-8 py-3 rounded-xl shadow-lg animate-fade-in-down"},VH={__name:"BlessingMessage",props:{show:Boolean,text:{type:String,default:""}},setup(i){const e=i;return(t,n)=>(ln(),En("div",UH,[e.show?(ln(),En("div",QH,$t(e.text),1)):tl("",!0)]))}},zH=pf(VH,[["__scopeId","data-v-46b45bf2"]]),GH="/image/musicOn.png",HH="/image/musicOff.png",WH="/image/leaderboardsComplex.png",qH="/image/pause.png",jH="/image/play.png",XH="/image/restart.png",mf=zM("lang",()=>{const i=localStorage.getItem("lang")||"zh",e=cn(i);function t(n){e.value=n,localStorage.setItem("lang",n)}return{lang:e,setLang:t}}),YH={class:"fixed inset-0 flex items-center justify-center z-[4000] bg-black/60"},KH={class:"bg-white/95 rounded-lg p-4 sm:p-6 w-full max-w-xs sm:w-80 relative max-h-[80vh] overflow-auto"},$H={class:"text-2xl sm:text-3xl font-bold text-center mb-4 text-yellow-600"},JH={key:0,class:"text-center text-gray-500"},ZH={key:1,class:"w-full text-center text-base sm:text-2xl"},e4={class:"py-1"},t4={class:"py-1"},n4={class:"py-1"},i4={class:"py-1 truncate max-w-[6rem]"},s4={class:"py-1"},r4={__name:"LeaderboardDialog",setup(i){const e=mf(),{lang:t}=Qd(e),n=cn([]),s=cn(!0),r={zh:{title:"",close:"",name:"",score:""},en:{title:"Leaderboard",close:"Close",name:"Name",score:"Score"}},o=()=>r[t.value];async function a(){s.value=!0;const{data:l,error:c}=await hC.from(cb).select("*").order("score",{ascending:!1}).limit(100);n.value=l||[],s.value=!1,c&&console.error(c)}return Rl(a),(l,c)=>(ln(),En("div",YH,[ft("div",KH,[ft("div",$H,$t(o().title),1),ft("button",{class:"absolute top-2 right-3 text-base sm:text-lg",onClick:c[0]||(c[0]=h=>l.$emit("close"))},"  "),s.value?(ln(),En("div",JH," Loading... ")):(ln(),En("table",ZH,[ft("thead",null,[ft("tr",null,[c[1]||(c[1]=ft("th",{class:"py-1"}," # ",-1)),ft("th",e4,$t(o().name),1),ft("th",t4,$t(o().score),1)])]),ft("tbody",null,[(ln(!0),En(ws,null,Qx(n.value,(h,u)=>(ln(),En("tr",{key:h.id},[ft("td",n4,$t(u+1),1),ft("td",i4,$t(h.username),1),ft("td",s4,$t(h.score),1)]))),128))])]))])]))}},o4={class:"fixed inset-0 flex items-center justify-center z-[3000] bg-black/40"},a4={class:"w-full max-w-xs sm:max-w-lg max-h-[80vh] h-fit p-4 sm:p-8 relative overflow-auto flex flex-col justify-between"},l4={class:"pixel"},c4={key:0,class:"mb-4 flex flex-col items-center"},h4={class:"text-yellow-300 text-base sm:text-lg mb-2"},u4=["placeholder"],d4={key:1,class:"mb-2 flex justify-start items-center"},f4={class:"text-white mr-2 text-base sm:text-lg"},p4={class:"text-xl sm:text-2xl font-bold text-center mb-3 text-yellow-300 tracking-widest"},m4={class:"mb-4"},A4={class:"font-bold text-lg sm:text-2xl mb-1 text-blue-200"},g4={class:"list-disc pl-4 sm:pl-6 text-sm sm:text-base text-white space-y-1"},v4={class:"mb-4"},_4={class:"font-bold text-sm sm:text-base mb-1 text-green-200"},y4={class:"flex flex-col gap-2 sm:gap-3"},x4=["src","alt"],w4={class:"text-white text-base sm:text-xl"},b4={class:"flex justify-center mt-2"},E4={__name:"PauseGuide",emits:["usernameSet","continue"],setup(i,{emit:e}){const t=e,n=mf(),{lang:s}=Qd(n),r=cn(localStorage.getItem("username")||""),o=cn(!r.value),a={zh:{title:"",controlTitle:"",control1:" WASD   ",control2:"",itemTitle:"",nameLabel:"",namePlaceholder:"",nameBtn:"",items:[{img:"/image/clock.png",label:""},{img:"/image/random.png",label:""},{img:"/image/sheid.png",label:""},{img:"/image/shoe.png",label:""}],continue:"",langBtn:"EN"},en:{title:"Game Guide",controlTitle:"How to Control",control1:"Move with WASD or Arrow Keys",control2:"On mobile, swipe to move",itemTitle:"Item Guide",nameLabel:"Enter your username",namePlaceholder:"Your nickname",nameBtn:"OK",items:[{img:"/image/clock.png",label:"Clock: Temporarily slow down all cars"},{img:"/image/random.png",label:"Random Box: Get a random item effect"},{img:"/image/sheid.png",label:"Shield: Invincible for a short time"},{img:"/image/shoe.png",label:"Shoes: Move faster for a short time"}],continue:"Continue",langBtn:""}},l=()=>a[s.value];function c(){n.setLang(s.value==="zh"?"en":"zh")}function h(){r.value.trim()&&(localStorage.setItem("username",r.value.trim()),o.value=!1,t("usernameSet",r.value.trim()))}function u(){o.value=!0}return Rl(()=>{r.value||(o.value=!0)}),(d,f)=>(ln(),En("div",o4,[ft("div",a4,[ft("div",l4,[ft("button",{class:"absolute top-2 right-2 text-base sm:text-xl font-bold bg-yellow-300 text-black rounded px-2 py-1 shadow hover:brightness-110 transition-all",onClick:c},$t(l().langBtn),1),o.value?(ln(),En("div",c4,[ft("label",h4,$t(l().nameLabel),1),Lx(ft("input",{"onUpdate:modelValue":f[0]||(f[0]=p=>r.value=p),placeholder:l().namePlaceholder,class:"px-3 py-2 rounded text-black w-full max-w-[12rem] mb-2",maxlength:"12"},null,8,u4),[[MM,r.value]]),ft("button",{class:"pixel-yellow px-4 py-1 rounded w-full max-w-[8rem]",onClick:h},$t(l().nameBtn),1)])):(ln(),En("div",d4,[ft("span",f4,$t(r.value),1),ft("button",{class:"text-lg sm:text-xl text-blue-200 underline",onClick:u},"  ")])),ft("div",p4,$t(l().title),1),ft("div",m4,[ft("div",A4,$t(l().controlTitle),1),ft("ul",g4,[ft("li",null,$t(l().control1),1),ft("li",null,$t(l().control2),1)])]),ft("div",v4,[ft("div",_4,$t(l().itemTitle),1),ft("div",y4,[(ln(!0),En(ws,null,Qx(l().items,p=>(ln(),En("div",{key:p.img,class:"flex items-center space-x-2 sm:space-x-4"},[ft("img",{src:p.img,class:"w-10 h-10 sm:w-12 sm:h-12 rounded-full bg-white/70 border border-white/20 flex-shrink-0",alt:p.label},null,8,x4),ft("span",w4,$t(p.label),1)]))),128))])]),ft("div",b4,[ft("button",{class:"pixel-yellow px-6 sm:px-8 text-xs sm:text-base rounded shadow hover:brightness-110 transition-all w-full max-w-[10rem]",onClick:f[1]||(f[1]=p=>d.$emit("continue"))},$t(l().continue),1)])])])]))}},C4={class:"fixed top-4 right-14 flex gap-4 z-[1000] select-none touch-none"},S4=["disabled","title"],I4=["alt"],M4=["alt"],T4={key:0,src:qH,alt:"",class:"w-12 h-12"},B4={key:1,src:jH,alt:"",class:"w-12 h-12"},R4={key:2,class:"fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-[2000]"},P4={class:"rounded-lg p-6 shadow-lg flex flex-col items-center"},D4={class:"pixel"},L4={class:"mb-4 text-2xl font-bold"},F4={class:"mb-4 text-white/75"},N4={class:"flex items-center mb-6 select-none"},k4={class:"text-lg text-gray-500"},O4={class:"flex gap-4 justify-center text-lg"},U4={__name:"GameControlPanel",setup(i){const e=cn(!1),t=cn(!1);function n(){const b=new ti;e.value?(b.trigger("resume"),e.value=!1):(b.trigger("pause"),e.value=!0)}function s(){new ti().trigger("restart"),e.value=!1}function r(){new ti().trigger("resume"),e.value=!1}const o=cn(null),a=cn(!1),l=cn(!1),c=cn(!1),h=cn(!1);Rl(()=>{const b=localStorage.getItem("musicNoAsk"),T=localStorage.getItem("musicAllowed");b==="true"?(a.value=T==="true",a.value&&u(),c.value=!1):c.value=!0});function u(){o.value&&(o.value.play(),l.value=!0)}function d(){o.value&&(o.value.pause(),l.value=!1)}function f(){a.value&&(l.value?d():u())}function p(){a.value=!0,localStorage.setItem("musicAllowed","true"),h.value?localStorage.setItem("musicNoAsk","true"):localStorage.removeItem("musicNoAsk"),u(),c.value=!1}function A(){a.value=!1,localStorage.setItem("musicAllowed","false"),h.value?localStorage.setItem("musicNoAsk","true"):localStorage.removeItem("musicNoAsk"),d(),c.value=!1}_c(a,b=>{b?u():d()});const m=mf(),{lang:g}=Qd(m),y={zh:{musicTitle:"",musicDesc:"",dontAsk:"",allow:"",deny:"",musicOn:"",musicOff:"",musicSwitch:"",langBtn:"EN"},en:{musicTitle:"Allow background music?",musicDesc:"For a better experience, we recommend enabling music. You can always toggle it in the top right corner.",dontAsk:"Don't ask again",allow:"Allow",deny:"Deny",musicOn:"Music On",musicOff:"Music Off",musicSwitch:"Music",langBtn:""}},_=()=>y[g.value];function v(){m.setLang(g.value==="zh"?"en":"zh")}return(b,T)=>(ln(),En("div",C4,[ft("button",{class:"w-12 h-12 flex items-center justify-center rounded mr-2",disabled:!a.value,title:_().musicSwitch,onClick:f},[l.value?(ln(),En("img",{key:0,src:GH,alt:_().musicOn,class:"w-10 h-10"},null,8,I4)):(ln(),En("img",{key:1,src:HH,alt:_().musicOff,class:"w-10 h-10"},null,8,M4))],8,S4),ft("button",{class:"w-12 h-12 flex items-center justify-center rounded",onClick:T[0]||(T[0]=L=>t.value=!0)},T[3]||(T[3]=[ft("img",{src:WH,alt:"",class:"w-12 h-12"},null,-1)])),ft("button",{class:"w-12 h-12 flex items-center justify-center rounded opacity-100",onClick:n},[e.value?(ln(),En("img",B4)):(ln(),En("img",T4))]),ft("button",{class:"w-12 h-12 flex items-center justify-center rounded opacity-100",onClick:s},T[4]||(T[4]=[ft("img",{src:XH,alt:"",class:"w-12 h-12"},null,-1)])),e.value?(ln(),$u(E4,{key:0,onContinue:r})):tl("",!0),t.value?(ln(),$u(r4,{key:1,onClose:T[1]||(T[1]=L=>t.value=!1)})):tl("",!0),ft("audio",{ref_key:"audioRef",ref:o,src:"/audio/bg.mp3",loop:"",preload:"auto",style:{display:"none"}},null,512),c.value?(ln(),En("div",R4,[ft("div",P4,[ft("div",D4,[ft("div",L4,$t(_().musicTitle),1),ft("div",F4,$t(_().musicDesc),1),ft("label",N4,[Lx(ft("input",{"onUpdate:modelValue":T[2]||(T[2]=L=>h.value=L),type:"checkbox",class:"mr-2"},null,512),[[TM,h.value]]),ft("span",k4,$t(_().dontAsk),1)]),ft("div",O4,[ft("button",{class:"px-4 py-2 bg-green-500 text-white rounded",onClick:p},$t(_().allow),1),ft("button",{class:"px-4 py-2 bg-gray-300 text-gray-700 rounded",onClick:A},$t(_().deny),1)]),ft("button",{class:"absolute top-2 right-2 z-[2001] text-base sm:text-xl font-bold bg-yellow-300 text-black rounded px-2 py-1 shadow hover:brightness-110 transition-all",title:"",onClick:v},$t(_().langBtn),1)])])])):tl("",!0)]))}},Q4=pf(U4,[["__scopeId","data-v-f326b432"]]),V4={class:"absolute left-1/2 bottom-12 -translate-x-1/2 flex flex-col items-center z-[999] pointer-events-none select-none"},z4={class:"flex flex-row justify-center mb-1"},G4=["src"],H4={class:"flex flex-row justify-center"},W4=["src"],q4=["src"],j4=["src"],X4="/image/keyboard_arrow_up.png",Y4="/image/keyboard_arrow_up_outline.png",K4="/image/keyboard_arrow_down.png",$4="/image/keyboard_arrow_down_outline.png",J4="/image/keyboard_arrow_left.png",Z4="/image/keyboard_arrow_left_outline.png",e5="/image/keyboard_arrow_right.png",t5="/image/keyboard_arrow_right_outline.png",n5={__name:"KeyIndicator",setup(i){const e=cn(!1),t=cn(!1),n=cn(!1),s=cn(!1),r={ArrowUp:"up",KeyW:"up",ArrowDown:"down",KeyS:"down",ArrowLeft:"left",KeyA:"left",ArrowRight:"right",KeyD:"right"};function o(l){const c=r[l.code];c&&(c==="up"&&(e.value=!0),c==="down"&&(t.value=!0),c==="left"&&(n.value=!0),c==="right"&&(s.value=!0))}function a(l){const c=r[l.code];c&&(c==="up"&&(e.value=!1),c==="down"&&(t.value=!1),c==="left"&&(n.value=!1),c==="right"&&(s.value=!1))}return Rl(()=>{window.addEventListener("keydown",o),window.addEventListener("keyup",a)}),Ox(()=>{window.removeEventListener("keydown",o),window.removeEventListener("keyup",a)}),(l,c)=>(ln(),En("div",V4,[ft("div",z4,[ft("img",{src:e.value?X4:Y4,alt:"up",class:"w-24 h-24 mx-1 drop-shadow transition-transform duration-100",draggable:"false"},null,8,G4)]),ft("div",H4,[ft("img",{src:n.value?J4:Z4,alt:"left",class:"w-24 h-24 mx-1 drop-shadow transition-transform duration-100",draggable:"false"},null,8,W4),ft("img",{src:t.value?K4:$4,alt:"down",class:"w-24 h-24 mx-1 drop-shadow transition-transform duration-100",draggable:"false"},null,8,q4),ft("img",{src:s.value?e5:t5,alt:"right",class:"w-24 h-24 mx-1 drop-shadow transition-transform duration-100",draggable:"false"},null,8,j4)])]))}},i5=pf(n5,[["__scopeId","data-v-321cb927"]]),s5={class:"fixed top-10 left-10 z-[999] px-6 py-3 rounded-lg shadow-lg"},r5={class:"text-[10vh] font-bold text-center text-white/95 select-none",style:{"letter-spacing":"2px"}},o5={class:"text-2xl text-white/80 mt-1 select-none"},a5={__name:"ScorePanel",props:{score:{type:Number,default:0},highScore:{type:Number,default:0}},setup(i){const e=mf(),{lang:t}=Qd(e),n={zh:{score:"",highScore:""},en:{score:"Score",highScore:"High Score"}},s=()=>n[t.value];return(r,o)=>(ln(),En("div",s5,[ft("div",r5,$t(i.score),1),ft("div",o5,$t(s().highScore)+""+$t(i.highScore),1)]))}},l5={class:"relative w-screen h-screen"},c5={key:1,class:"try-again-overlay"},h5={__name:"App",setup(i){const e=cn(null),t=cn(0),n=cn(0),s=cn(Number(localStorage.getItem("highScore")||0)),r=cn(!1),o=cn(!1),a=cn("");return Rl(()=>{const l=new ti(e.value);l.on("scoreUpdate",c=>{t.value=c;const h=t.value+n.value;h>s.value&&(s.value=h,localStorage.setItem("highScore",h))}),l.on("itemScore",c=>{n.value+=c;const h=t.value+n.value;h>s.value&&(s.value=h,localStorage.setItem("highScore",h))}),l.on("restart",()=>{n.value=0,t.value=0,r.value=!0,setTimeout(()=>{r.value=!1},1e3)}),l.on("itemCollected",c=>{c==="zongzi"&&(console.log("itemCollected",c),o.value=!0,setTimeout(()=>{o.value=!1},1500))})}),(l,c)=>(ln(),En("div",l5,[ft("canvas",{ref_key:"threeCanvas",ref:e,class:"three-canvas absolute inset-0 z-[999]"},null,512),us(Q4),us(a5,{score:t.value+n.value,"high-score":s.value},null,8,["score","high-score"]),Cx(fd)()?tl("",!0):(ln(),$u(i5,{key:0})),r.value?(ln(),En("div",c5,c[0]||(c[0]=[ft("div",{class:"try-again-text"}," Try again ",-1)]))):tl("",!0),us(zH,{show:o.value,text:a.value},null,8,["show","text"])]))}},u5=pf(h5,[["__scopeId","data-v-50de9639"]]),hS=DM(u5);hS.use(NM());hS.mount("#app");export{d5 as __vite_legacy_guard,GQ as g};
